(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function t(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,n){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;"number"==typeof s&&(e+=s,n++)}return e/n}(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o="visualVariables"in n?r(s,n.visualVariables):s;if("simple"===n.type)return t(o,n.symbol);if("unique-value"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if("class-breaks"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}__webpack_require__.d(__webpack_exports__,"a",(function(){return s}))},"./node_modules/@arcgis/core/symbols/cim/SDFHelper.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return m})),__webpack_require__.d(__webpack_exports__,"b",(function(){return f})),__webpack_require__.d(__webpack_exports__,"c",(function(){return r})),__webpack_require__.d(__webpack_exports__,"d",(function(){return a}));var _core_floatRGBA_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js"),_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),_Rect_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/Rect.js");function r(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const n=t.symbolLayers;return n&&1===n.length?r(n[0]):null}case"CIMVectorMarker":{var n;const o=t.markerGraphics;if(!o||1!==o.length)return null;const r=o[0];if(!r)return null;const l=r.geometry;if(!l)return null;const e=r.symbol;return!e||"CIMPolygonSymbol"!==e.type&&"CIMLineSymbol"!==e.type||null!=(n=e.symbolLayers)&&n.some((t=>!!t.effects))?null:{geom:l,asFill:"CIMPolygonSymbol"===e.type}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function i(t){let n=1/0,o=-1/0,r=1/0,l=-1/0;for(const e of t)for(const t of e)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return[n,r,o,l]}function f(t){return t?t.rings?i(t.rings):t.paths?i(t.paths):Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_1__.d)(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function a(t,n,o,r,l){const[e,s,i,f]=t;if(i<e||f<s)return[0,0,0];const a=i-e,m=f-s,y=Math.floor(31.5),h=(128-2*(y+1))/Math.max(a,m),x=Math.round(a*h)+2*y,M=Math.round(m*h)+2*y;let g=1;n&&(g=M/h/(n.ymax-n.ymin));let p=0,d=0;if(r)if(l){if(n&&o&&n.ymax-n.ymin>0){const t=(n.xmax-n.xmin)/(n.ymax-n.ymin);p=r.x/(o*t),d=r.y/o}}else p=r.x,d=r.y;return p=.5*(n.xmax+n.xmin)+p*(n.xmax-n.xmin),d=.5*(n.ymax+n.ymin)+d*(n.ymax-n.ymin),p-=e,d-=s,p*=h,d*=h,p+=y,d+=y,[g,p/x-.5,-(d/M-.5)]}function m(t){const n=function e(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}(t.geom),o=function s(t){let n=1/0,r=-1/0,l=1/0,e=-1/0;for(const o of t)for(const t of o)t[0]<n&&(n=t[0]),t[0]>r&&(r=t[0]),t[1]<l&&(l=t[1]),t[1]>e&&(e=t[1]);return new _Rect_js__WEBPACK_IMPORTED_MODULE_2__.a(n,l,r-n,e-l)}(n),i=Math.floor(31.5),f=(128-2*(i+1))/Math.max(o.width,o.height),a=Math.round(o.width*f)+2*i,m=Math.round(o.height*f)+2*i,h=[];for(const e of n)if(e&&e.length>1){const n=[];for(const r of e){let[l,e]=r;l-=o.x,e-=o.y,l*=f,e*=f,l+=i-.5,e+=i-.5,t.asFill?n.push([l,e]):n.push([Math.round(l),Math.round(e)])}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0])}h.push(n)}const x=function u(t,n,o,r){const l=n*o,e=new Array(l),s=r*r+1;for(let i=0;i<l;++i)e[i]=s;for(const i of t){const t=i.length;for(let l=1;l<t;++l){const t=i[l-1],s=i[l];let f,a,m,u;t[0]<s[0]?(f=t[0],a=s[0]):(f=s[0],a=t[0]),t[1]<s[1]?(m=t[1],u=s[1]):(m=s[1],u=t[1]);let c=Math.floor(f)-r,y=Math.floor(a)+r,h=Math.floor(m)-r,x=Math.floor(u)+r;c<0&&(c=0),y>n&&(y=n),h<0&&(h=0),x>o&&(x=o);const M=s[0]-t[0],g=s[1]-t[1],p=M*M+g*g;for(let r=c;r<y;r++)for(let l=h;l<x;l++){let i,f,a=(r-t[0])*M+(l-t[1])*g;a<0?(i=t[0],f=t[1]):a>p?(i=s[0],f=s[1]):(a/=p,i=t[0]+a*M,f=t[1]+a*g);const m=(r-i)*(r-i)+(l-f)*(l-f),u=(o-l-1)*n+r;m<e[u]&&(e[u]=m)}}}for(let i=0;i<l;++i)e[i]=Math.sqrt(e[i]);return e}(h,a,m,i);return t.asFill&&function c(t,n,o,r,l){for(const e of t){const t=e.length;for(let s=1;s<t;++s){const t=e[s-1],i=e[s];let f,a,m,u;t[0]<i[0]?(f=t[0],a=i[0]):(f=i[0],a=t[0]),t[1]<i[1]?(m=t[1],u=i[1]):(m=i[1],u=t[1]);let c=Math.floor(f),y=Math.floor(a)+1,h=Math.floor(m),x=Math.floor(u)+1;c<r&&(c=r),y>n-r&&(y=n-r),h<r&&(h=r),x>o-r&&(x=o-r);for(let e=h;e<x;++e){if(t[1]>e==i[1]>e)continue;const s=(o-e-1)*n;for(let n=c;n<y;++n)n<(i[0]-t[0])*(e-t[1])/(i[1]-t[1])+t[0]&&(l[s+n]=-l[s+n]);for(let t=r;t<c;++t)l[s+t]=-l[s+t]}}}}(h,a,m,i,x),[y(x,i),a,m]}function y(n,o){const r=2*o,l=n.length,e=new Uint8Array(4*l);for(let s=0;s<l;++s){const o=.5-n[s]/r;Object(_core_floatRGBA_js__WEBPACK_IMPORTED_MODULE_0__.a)(o,e,4*s)}return e}},"./node_modules/@arcgis/core/symbols/cim/cimAnalyzer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return q})),__webpack_require__.d(__webpack_exports__,"b",(function(){return I}));var _Color_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/Color.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),_core_string_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/string.js"),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js"),_SDFHelper_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/SDFHelper.js"),_utils_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/utils.js"),_effects_CIMEffectHelper_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/effects/CIMEffectHelper.js"),_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/2d/arcade/callExpressionWithFeature.js");const S=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.a.getLogger("esri.symbols.cim.cimAnalyzer");function v(e){switch(e){case"Butt":return 0;case"Square":return 2;default:return 1}}function N(e){switch(e){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function b(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function k(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function P(e,t,i,o){let r;e[t]?r=e[t]:(r={},e[t]=r),r[i]=o}function M(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function I(e,t,i,o,r){const a=null!=o?o:[];if(!e)return a;let l,s;const c={};if("CIMSymbolReference"!==e.type)return S.error("Expect cim type to be 'CIMSymbolReference'"),a;if(l=e.symbol,s=e.primitiveOverrides,s){const e=[];for(const i of s){const o=i.valueExpressionInfo;if(o&&t){const r=o.expression,a=Object(_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_5__.d)(r,t.spatialReference,t.fields).then((e=>{e&&P(c,i.primitiveName,i.propertyName,e)}));e.push(a)}else null!=i.value&&P(c,i.primitiveName,i.propertyName,i.value)}e.length>0&&await Promise.all(e)}const f=[];switch(K(l,i,f),f.length>0&&await Promise.all(f),l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function L(e,t,i,o,r,n,a){if(!e)return;const c=e.symbolLayers;if(!c)return;const f=e.effects;let m;const p=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(m=1);let u=c.length;for(;u--;){const l=c[u];if(!l||!1===l.enable)continue;let h;f&&f.length&&(h=[...f]);const y=l.effects;y&&y.length&&(f?h.push(...y):h=[...y]);const g=[];switch(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.c.findApplicableOverrides(l,t,g),l.type){case"CIMSolidFill":w(l,h,i,g,o,r);break;case"CIMPictureFill":X(l,h,i,g,o,n,r);break;case"CIMHatchFill":z(l,h,i,g,o,r);break;case"CIMGradientFill":x(l,h,i,g,o,r);break;case"CIMSolidStroke":J(l,h,i,g,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMPictureStroke":H(l,h,i,g,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMGradientStroke":Y(l,h,i,g,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMCharacterMarker":if(R(l,h,i,g,o,r))break;break;case"CIMPictureMarker":if(R(l,h,i,g,o,r))break;"CIMLineSymbol"===e.type&&(m=M(l)),A(l,h,i,g,o,n,r,m,p);break;case"CIMVectorMarker":if(R(l,h,i,g,o,r))break;"CIMLineSymbol"===e.type&&(m=M(l)),$(l,h,i,g,o,r,n,m,p,a);break;default:S.error("Cannot analyze CIM layer",l.type)}}}(l,s,c,t,a,i,r)}return a}function w(e,t,i,o,n,a){const l=e.primitiveName,s=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(e.color),[c,f]=V(o,l),p=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+f).toString();a.push({type:"fill",templateHash:p,materialHash:c?()=>p:p,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:U(l,i,"Color",n,s,G),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t})}function X(e,t,o,n,a,l,s){const c=e.primitiveName,f=e.tintColor?Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(e.tintColor):{r:255,g:255,b:255,a:1},[u,h]=V(n,c),y=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+h).toString(),g=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let d=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.scaleX);if("width"in e){const t=e.width;let o=1;const r=l.getResource(e.url);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(r)&&(o=r.width/r.height),d/=o*(e.height/t)}s.push({type:"fill",templateHash:y,materialHash:u?()=>g:g,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:U(c,o,"TintColor",a,f,G),height:U(c,o,"Height",a,e.height),scaleX:U(c,o,"ScaleX",a,d),angle:U(c,o,"Rotation",a,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation)),offsetX:U(c,o,"OffsetX",a,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX)),offsetY:U(c,o,"OffsetY",a,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY)),url:e.url})}function z(e,t,i,o,n,a){const l=["Rotation","OffsetX","OffsetY"],s=o.filter((t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName))),c=e.primitiveName,[f,m]=V(o,c),u=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+m).toString(),h=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();a.push({type:"fill",templateHash:u,materialHash:f?B(h,i,s,n):h,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:U(c,i,"Separation",n,e.separation),scaleX:1,angle:U(c,i,"Rotation",n,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation)),offsetX:U(c,i,"OffsetX",n,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX)),offsetY:U(c,i,"OffsetY",n,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY))})}function x(e,t,i,o,n,a){const l=e.primitiveName,[s,c]=V(o,l),f=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+c).toString();a.push({type:"fill",templateHash:f,materialHash:s?B(f,i,o,n):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function J(e,t,i,o,n,a,l,s){const c=e.primitiveName,f=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(e.color),p=void 0!==e.width?e.width:4,u=v(e.capStyle),h=N(e.joinStyle),y=e.miterLimit,[g,d]=V(o,c),S=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+d).toString();let b,k;if(t&&t.length>0){const i=t[t.length-1];if("CIMGeometricEffectDashes"===i.type&&"NoConstraint"===i.lineDashEnding){const i=(t=[...e.effects]).pop();b=i.dashTemplate,k=i.scaleDash}}a.push({type:"line",templateHash:S,materialHash:g?()=>S:S,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:U(c,i,"Color",n,f,G),width:U(c,i,"Width",n,p),cap:U(c,i,"CapStyle",n,u),join:U(c,i,"JoinStyle",n,h),miterLimit:U(c,i,"MiterLimit",n,y),referenceWidth:s,zOrder:E(e.name),dashTemplate:b,scaleDash:k})}function H(e,t,i,o,n,a,l,s){const c=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,p=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(e.tintColor),u=void 0!==e.width?e.width:4,h=v(e.capStyle),y=N(e.joinStyle),g=e.miterLimit,[d,S]=V(o,f),b=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+S).toString();a.push({type:"line",templateHash:b,materialHash:d?()=>c:c,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:U(f,i,"TintColor",n,p,G),width:U(f,i,"Width",n,u),cap:U(f,i,"CapStyle",n,h),join:U(f,i,"JoinStyle",n,y),miterLimit:U(f,i,"MiterLimit",n,g),referenceWidth:s,zOrder:E(e.name),dashTemplate:null,scaleDash:!1,url:e.url})}function Y(e,t,i,o,n,a,l,s){const c=e.primitiveName,f=void 0!==e.width?e.width:4,m=v(e.capStyle),p=N(e.joinStyle),u=e.miterLimit,[h,y]=V(o,c),g=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+y).toString();a.push({type:"line",templateHash:g,materialHash:h?B(g,i,o,n):g,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:U(c,i,"Width",n,f),cap:U(c,i,"CapStyle",n,m),join:U(c,i,"JoinStyle",n,p),miterLimit:U(c,i,"MiterLimit",n,u),referenceWidth:s,zOrder:E(e.name),dashTemplate:null,scaleDash:!1})}function R(e,t,i,o,n,a){const l=e.markerPlacement;if(!l||"CIMMarkerPlacementInsidePolygon"!==l.type)return!1;const s=l,c=["Rotation","OffsetX","OffsetY"],f=o.filter((t=>t.primitiveName!==e.primitiveName&&-1===c.indexOf(t.propertyName))),m="url"in e?e.url:null,[u,h]=V(o,s.primitiveName),y=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+h).toString();let g=s.stepY,d=null,S=1;return l.shiftOddRows&&(g*=2,d=function(e){return e?2*e:0},S=.5),a.push({type:"fill",templateHash:y,materialHash:u?B(y,i,f,n):y,cim:e,materialOverrides:f,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:U(s.primitiveName,i,"StepY",n,g,d),scaleX:S,angle:U(s.primitiveName,i,"GridAngle",n,s.gridAngle),offsetX:U(s.primitiveName,i,"OffsetX",n,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(s.offsetX)),offsetY:U(s.primitiveName,i,"OffsetY",n,Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(s.offsetY)),url:m}),!0}function A(e,t,o,n,a,l,s,c,f){var u;const h=e.primitiveName,y=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.size);let g=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.scaleX);const d=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation),S=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX),v=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY),N=e.tintColor?Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(e.tintColor):{r:255,g:255,b:255,a:1},b=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[k,C]=V(n,h),O=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(e)+C).toString(),P=null!=(u=e.anchorPoint)?u:{x:0,y:0};if("width"in e){const t=e.width;let o=1;const r=l.getResource(e.url);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(r)&&(o=r.width/r.height),g/=o*(y/t)}s.push({type:"marker",templateHash:O,materialHash:k?()=>b:b,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:c,size:U(h,o,"Size",a,y),scaleX:U(h,o,"ScaleX",a,g),rotation:U(h,o,"Rotation",a,d),offsetX:U(h,o,"OffsetX",a,S),offsetY:U(h,o,"OffsetY",a,v),color:U(h,o,"TintColor",a,N,G),anchorPoint:{x:P.x,y:-P.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:1,markerPlacement:e.markerPlacement,url:e.url})}function $(e,t,i,o,r,n,a,l,s,c){const f=e.markerGraphics;if(!f)return;let m=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(m=t.ymax-t.ymin)}for(const p of f)if(p){const f=p.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":j(e,t,p,o,i,r,n,a,l,s,m,c);break;case"CIMTextSymbol":F(e,t,p,i,o,r,n,l,s,m)}}}function F(e,t,i,o,n,a,c,f,g,d){_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.c.findApplicableOverrides(i,n,[]);const v=i.geometry;if(!("x"in v)||!("y"in v))return;const N=i.symbol,P=function O(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(N),M=function C(e){let t="",i="";if(e){const o=e.toLowerCase();-1!==o.indexOf("italic")?t="italic":-1!==o.indexOf("oblique")&&(t="oblique"),-1!==o.indexOf("bold")?i="bold":-1!==o.indexOf("light")&&(i="lighter")}return{style:t,weight:i}}(N.fontStyleName),I=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.m)(N.fontFamilyName);N.font={family:I,decoration:P,...M};const L=e.frame,w=v.x-.5*(L.xmin+L.xmax),X=v.y-.5*(L.ymin+L.ymax),z=e.size/d,x=e.primitiveName,J=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(N.height)*z,H=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(N.angle),Y=(Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(N.offsetX)+w)*z,R=(Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(N.offsetY)+X)*z,A=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getFillColor(N));let $=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeColor(N)),F=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeWidth(N);F||($=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getFillColor(N.haloSymbol)),F=N.haloSize*z);const[j,W]=V(n,x),T=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),D=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(i)+T+W).toString(),E=U(i.primitiveName,o,"TextString",a,i.textString,_utils_js__WEBPACK_IMPORTED_MODULE_8__.a,N.textCase),{fontStyleName:G}=N,B=I+(G?"-"+G.toLowerCase():"-regular"),q=B;c.push({type:"text",templateHash:D,materialHash:j||"function"==typeof E||E.match(/\[(.*?)\]/)?(e,t,i)=>q+"-"+Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.d)(E,e,t,i):q+"-"+Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(E),cim:N,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:f,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:B,decoration:P,weight:U(x,o,"Weight",a,M.weight),style:U(x,o,"Size",a,M.style),size:U(x,o,"Size",a,J),angle:U(x,o,"Rotation",a,H),offsetX:U(x,o,"OffsetX",a,Y),offsetY:U(x,o,"OffsetY",a,R),horizontalAlignment:b(N.horizontalAlignment),verticalAlignment:k(N.verticalAlignment),text:E,color:A,outlineColor:$,outlineSize:F,referenceSize:g,sizeRatio:1,markerPlacement:e.markerPlacement})}function j(e,t,i,o,n,a,s,u,h,y,d,S){const v=i.symbol,N=v.symbolLayers;if(!N)return;if(S)return void T(e,t,i,n,o,a,s,u,h,y,d);let b=N.length;if(_(N))return void function W(e,t,i,o,n,a,s,u,h,y){const g=t.geometry,d=i[0],S=i[1],v=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_7__.b)(g);if(!v)return;const[N,b,k]=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_7__.d)(v,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),C={type:"sdf",geom:g,asFill:!0},O=e.primitiveName,P=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.size),M=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation),I=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX),L=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY),w=S.path,X=S.primitiveName,z=d.primitiveName,x=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getFillColor(S)),J=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeColor(d)),H=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeWidth(d);let Y=!1,R="";for(const r of o)r.primitiveName!==X&&r.primitiveName!==z&&r.primitiveName!==O||(void 0!==r.value?R+=`-${r.primitiveName}-${r.propertyName}-${JSON.stringify(r.value)}`:r.valueExpressionInfo&&(Y=!0));const A=JSON.stringify({...e,markerGraphics:null}),$=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(C)+w).toString(),F={type:"marker",templateHash:Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(t)+JSON.stringify(S)+JSON.stringify(d)+A+R).toString(),materialHash:Y?()=>$:$,cim:C,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:u,anchorPoint:{x:b,y:k},isAbsoluteAnchorPoint:!1,size:U(e.primitiveName,n,"Size",a,P),rotation:U(e.primitiveName,n,"Rotation",a,M),offsetX:U(e.primitiveName,n,"OffsetX",a,I),offsetY:U(e.primitiveName,n,"OffsetY",a,L),scaleX:1,frameHeight:y,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:N,color:U(X,n,"Color",a,x,G),outlineColor:U(z,n,"Color",a,J,G),outlineWidth:U(z,n,"Width",a,H),markerPlacement:e.markerPlacement,path:w};s.push(F)}(e,i,N,o,n,a,s,h,y,d);const k=_effects_CIMEffectHelper_js__WEBPACK_IMPORTED_MODULE_9__.a.applyEffects(v.effects,i.geometry);if(k)for(;b--;){const S=N[b];if(S&&!1!==S.enable)switch(S.type){case"CIMSolidFill":case"CIMSolidStroke":{var C;const u=_effects_CIMEffectHelper_js__WEBPACK_IMPORTED_MODULE_9__.a.applyEffects(S.effects,k),v=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_7__.b)(u);if(!v)continue;const[N,b,O]=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_7__.d)(v,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),P="CIMSolidFill"===S.type,M={type:"sdf",geom:u,asFill:P},I=e.primitiveName,L=null!=(C=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.size))?C:10,w=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation),X=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX),z=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY),x=S.path,J=S.primitiveName,H=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(P?_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getFillColor(S):_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeColor(S)),Y=P?{r:0,g:0,b:0,a:0}:Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.e)(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeColor(S)),R=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getStrokeWidth(S);if(!P&&!R)break;let A=!1,$="";for(const e of o)e.primitiveName!==J&&e.primitiveName!==I||(void 0!==e.value?$+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(A=!0));const F=JSON.stringify({...e,markerGraphics:null}),j=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(M)+x).toString(),W={type:"marker",templateHash:Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(i)+JSON.stringify(S)+F+$).toString(),materialHash:A?()=>j:j,cim:M,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:b,y:O},isAbsoluteAnchorPoint:!1,size:U(e.primitiveName,n,"Size",a,L),rotation:U(e.primitiveName,n,"Rotation",a,w),offsetX:U(e.primitiveName,n,"OffsetX",a,X),offsetY:U(e.primitiveName,n,"OffsetY",a,z),scaleX:1,frameHeight:d,rotateClockwise:e.rotateClockwise,referenceSize:y,sizeRatio:N,color:U(J,n,"Color",a,H,G),outlineColor:U(J,n,"Color",a,Y,G),outlineWidth:U(J,n,"Width",a,R),markerPlacement:e.markerPlacement,path:x};s.push(W);break}default:T(e,t,i,n,o,a,s,u,h,y,d)}}}function T(e,t,i,n,a,s,c,f,m,u,h){const y=function D(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}(e,i);let g=[];const d=["Rotation","OffsetX","OffsetY"];g=a.filter((t=>t.primitiveName!==e.primitiveName||-1===d.indexOf(t.propertyName)));let S="";for(const o of a)void 0!==o.value&&(S+=`-${o.primitiveName}-${o.propertyName}-${JSON.stringify(o.value)}`);const[v,N,b]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.b.getTextureAnchor(y,f),k=e.primitiveName,C=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.rotation),O=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetX),P=Object(_utils_js__WEBPACK_IMPORTED_MODULE_8__.f)(e.offsetY),M=Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(JSON.stringify(y)+S).toString(),I={type:"marker",templateHash:M,materialHash:0===g.length?M:B(M,n,g,s),cim:y,materialOverrides:g,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:m,anchorPoint:{x:v,y:N},isAbsoluteAnchorPoint:!1,size:e.size,rotation:U(k,n,"Rotation",s,C),offsetX:U(k,n,"OffsetX",s,O),offsetY:U(k,n,"OffsetY",s,P),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:b/Object(_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_3__.g)(e.size),markerPlacement:e.markerPlacement};c.push(I)}function E(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function G(t){if(!t||0===t.length)return null;const i=new _Color_js__WEBPACK_IMPORTED_MODULE_0__.a(t).toRgba();return{r:i[0],g:i[1],b:i[2],a:i[3]}}function U(e,t,i,o,r,n,l){const s=t[e];if(s){const e=s[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return n?n.call(null,e,l):e;if(null!=e&&e instanceof _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_5__.a)return(t,i,a)=>{let s=Object(_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_10__.a)(e,t,{$view:a},o.geometryType,i);return null!==s&&n&&(s=n.call(null,s,l)),null!==s?s:r}}return r}function B(e,t,i,o){for(const r of i)if(r.valueExpressionInfo){const e=t[r.primitiveName]&&t[r.primitiveName][r.propertyName];e instanceof _support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_5__.a&&(r.fn=(t,i,r)=>Object(_views_2d_arcade_callExpressionWithFeature_js__WEBPACK_IMPORTED_MODULE_10__.a)(e,t,{$view:r},o.geometryType,i))}return(t,o,n)=>{for(const e of i)e.fn&&(e.value=e.fn(t,o,n));return Object(_core_string_js__WEBPACK_IMPORTED_MODULE_4__.b)(e+_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.c.buildOverrideKey(i)).toString()}}function q(e,t){if(!t||0===t.length)return e;const i=JSON.parse(JSON.stringify(e));return _CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_6__.c.applyOverrides(i,t),i}function V(e,t){let i=!1,o="";for(const r of e)r.primitiveName===t&&(void 0!==r.value?o+=`-${r.primitiveName}-${r.propertyName}-${JSON.stringify(r.value)}`:r.valueExpressionInfo&&(i=!0));return[i,o]}function K(e,t,i){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const o=e.symbolLayers;if(!o)return;for(const e of o)switch(e.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in e&&e.url&&i.push(t.fetchResource(e.url,null));break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)continue;for(const e of o)if(e){const o=e.symbol;o&&K(o,t,i)}}}}}}const _=e=>e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&!e[0].effects&&!e[1].effects},"./node_modules/@arcgis/core/symbols/cim/effects/CIMEffectHelper.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return f}));var _geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),_CIMCursor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMCursor.js"),_CIMEffects_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMEffects.js"),_CIMOperators_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMOperators.js");class f{static executeEffects(t,s){const r=Object(_CIMCursor_js__WEBPACK_IMPORTED_MODULE_1__.c)(s);let p=new _CIMEffects_js__WEBPACK_IMPORTED_MODULE_2__.a(r);for(const e of t){const t=Object(_CIMOperators_js__WEBPACK_IMPORTED_MODULE_3__.a)(e);t&&(p=t.execute(p,e,1.3333333333333333,!0))}return p}static next(t){const s=t.next();return Object(_CIMCursor_js__WEBPACK_IMPORTED_MODULE_1__.d)(s),s}static applyEffects(e,r){if(!e)return r;let c=new _CIMEffects_js__WEBPACK_IMPORTED_MODULE_2__.a(r);for(const t of e){const s=Object(_CIMOperators_js__WEBPACK_IMPORTED_MODULE_3__.a)(t);s&&(c=s.execute(c,t,1,!1))}let f,p=null;for(;f=c.next();)p?Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__.h)(p)?Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__.h)(f)&&p.paths.push(...f.paths):Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__.g)(p)&&Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_0__.g)(f)&&p.rings.push(...f.rings):p=f;return p}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/visualVariablesUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return o}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_enums_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_Utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js");const l=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.a.getLogger("esri.views.2d.engine.webgl");function o(s){return Object(_Utils_js__WEBPACK_IMPORTED_MODULE_3__.u)(s.minDataValue)&&Object(_Utils_js__WEBPACK_IMPORTED_MODULE_3__.u)(s.maxDataValue)&&null!=s.minSize&&null!=s.maxSize?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_MINMAX_VALUE:(s.expression&&"view.scale"===s.expression||s.valueExpression&&"$view.scale"===s.valueExpression)&&Array.isArray(s.stops)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_SCALE_STOPS:(null!=s.field||s.expression&&"view.scale"!==s.expression||s.valueExpression&&"$view.scale"!==s.valueExpression)&&(Array.isArray(s.stops)||"levels"in s&&s.levels)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_FIELD_STOPS:(null!=s.field||s.expression&&"view.scale"!==s.expression||s.valueExpression&&"$view.scale"!==s.valueExpression)&&null!=s.valueUnit?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_UNIT_VALUE:(l.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("mapview-bad-type","Found invalid size VisualVariable",s)),_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.NONE)}},"./node_modules/@arcgis/core/views/2d/layers/FeatureLayerView2D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return D}));var AggregateGraphic_p,tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),has=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js")),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"));let AggregateGraphic_s=AggregateGraphic_p=class extends Graphic.a{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const r=this.sourceLayer&&this.sourceLayer.featureReduction;return r&&"popupTemplate"in r&&r.popupEnabled?r.popupTemplate:null}getObjectId(){return this.objectId}clone(){return new AggregateGraphic_p({objectId:this.objectId,...this.cloneProperties()})}};Object(tslib_es6.a)([Object(property.b)({type:Boolean})],AggregateGraphic_s.prototype,"isAggregate",void 0),Object(tslib_es6.a)([Object(property.b)({type:Number,json:{read:!0}})],AggregateGraphic_s.prototype,"objectId",void 0),AggregateGraphic_s=AggregateGraphic_p=Object(tslib_es6.a)([Object(subclass.a)("esri.AggregateGraphic")],AggregateGraphic_s);const AggregateGraphic_c=AggregateGraphic_s;__webpack_require__("./node_modules/@arcgis/core/geometry.js");var Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),lang=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),reactiveUtils=__webpack_require__("./node_modules/@arcgis/core/core/reactiveUtils.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),EffectView=__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js");let FeatureEffectView_o=class extends Accessor.a{constructor(e){super(e),this._filter=null,this.duration=Object(has.a)("mapview-transitions-duration"),this._excludedEffectView=new EffectView.a(e),this._includedEffectView=new EffectView.a(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){var e;return this._filter||(null==(e=Object(maybe.u)(this.featureEffect))?void 0:e.filter)||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}end(){this._includedEffectView.end(),this._excludedEffectView.end(),this._filter=null}_transitionTo(e){const t=this._get("featureEffect"),i=Object(maybe.u)(e),f=Object(maybe.u)(null==i?void 0:i.includedEffect),c=Object(maybe.u)(null==i?void 0:i.excludedEffect),r=this._includedEffectView.canTransitionTo(f)&&this._excludedEffectView.canTransitionTo(c);this._includedEffectView.effect=f,this._excludedEffectView.effect=c,this._set("featureEffect",i),this._filter=(null==i?void 0:i.filter)||(null==t?void 0:t.filter)||null,r||this.end()}};Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"_filter",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"_excludedEffectView",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"_includedEffectView",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"duration",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"excludedEffects",null),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"featureEffect",null),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"filter",null),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"hasEffects",null),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"includedEffects",null),Object(tslib_es6.a)([Object(property.b)({value:0})],FeatureEffectView_o.prototype,"scale",null),Object(tslib_es6.a)([Object(property.b)()],FeatureEffectView_o.prototype,"transitioning",null),FeatureEffectView_o=Object(tslib_es6.a)([Object(subclass.a)("esri.layers.effects.FeatureEffectView")],FeatureEffectView_o);const FeatureEffectView_l=FeatureEffectView_o;var FeatureFilter=__webpack_require__("./node_modules/@arcgis/core/layers/support/FeatureFilter.js"),clickToleranceUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js"),FeatureSet=__webpack_require__("./node_modules/@arcgis/core/rest/support/FeatureSet.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),definitions=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),LayerView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/LayerView2D.js"),schemaUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/schemaUtils.js");var pixelBuffering=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/pixelBuffering.js"),clusterUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/clusterUtils.js"),QueueProcessor=__webpack_require__("./node_modules/@arcgis/core/views/support/QueueProcessor.js");function FeatureCommandQueue_n(e){return e.some((e=>e.globalId))}function FeatureCommandQueue_d(e){return e.filter((e=>!e.error)).map((e=>{var r;return null!=(r=e.objectId)?r:e.globalId}))}function FeatureCommandQueue_a(e,r){const s=new Set(e);for(const t of r.values())s.add(t);return s}function FeatureCommandQueue_i(e,r){const s=new Set(e);for(const t of r.values())s.delete(t);return s}let FeatureCommandQueue_u=class extends Accessor.a{constructor(e){super(e),this._hasGlobalIds=!1}normalizeCtorArgs(e){return this._queueProcessor=new QueueProcessor.a({concurrency:1,process:e.process}),{}}destroy(){this._queueProcessor.clear()}get updating(){return this._queueProcessor.length>0}push(e){const r=this._queueProcessor,s=r.last();switch(e.type){case"update":case"refresh":if((null==s?void 0:s.type)===e.type)return;r.push(e).finally((()=>this.notifyChange("updating")));break;case"edit":{const t="processed-edit"===(null==s?void 0:s.type)?s:null;t&&r.popLast();const o=this._mergeEdits(t,e);for(const e of o)r.push(e).finally((()=>this.notifyChange("updating")));break}}this.notifyChange("updating")}_mergeEdits(e,r){var s,t;const{addedFeatures:o,deletedFeatures:u,updatedFeatures:c}=r.edits;if(this._hasGlobalIds=this._hasGlobalIds||FeatureCommandQueue_n(o)||FeatureCommandQueue_n(c)||FeatureCommandQueue_n(u),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[...o,...c],removed:u}}];const l=new Set(FeatureCommandQueue_d(null!=(s=null==e?void 0:e.edits.addOrModified)?s:[])),p=new Set(FeatureCommandQueue_d(null!=(t=null==e?void 0:e.edits.removed)?t:[])),f=new Set([...FeatureCommandQueue_d(o),...FeatureCommandQueue_d(c)]),h=new Set(FeatureCommandQueue_d(u));return[{type:"processed-edit",edits:{addOrModified:Array.from(FeatureCommandQueue_a(FeatureCommandQueue_i(l,h),f)).map((e=>({objectId:e}))),removed:Array.from(FeatureCommandQueue_a(FeatureCommandQueue_i(p,f),h)).map((e=>({objectId:e})))}}]}};Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],FeatureCommandQueue_u.prototype,"updating",null),FeatureCommandQueue_u=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.layers.support.FeatureCommandQueue")],FeatureCommandQueue_u);const FeatureCommandQueue_c=FeatureCommandQueue_u;var core_Promise=__webpack_require__("./node_modules/@arcgis/core/core/Promise.js"),workers=__webpack_require__("./node_modules/@arcgis/core/core/workers/workers.js");let FeatureLayerProxy_l=class extends core_Promise.a{constructor(e){super(e),this._startupResolver=Object(promiseUtils.g)(),this.isReady=!1}initialize(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}destroy(){this._controller.abort(),this._connection&&this._connection.close()}set tileRenderer(e){this.client.tileRenderer=e}get closed(){return this._connection.closed}async startup(e,t,r,s){await this.when();const o=this._controller.signal,i=function FeatureLayerProxy_c(e){return Array.isArray(e)}(r.source)?{transferList:r.source,signal:o}:void 0,n={service:r,config:t,tileInfo:e.tileInfo.toJSON(),tiles:s};await this._connection.invoke("startup",n,i),this._startupResolver.resolve(),this._set("isReady",!0)}async updateTiles(e){return await this._startupResolver.promise,Object(promiseUtils.l)(this._connection.invoke("updateTiles",e))}async update(e){const t={config:e};return await this._startupResolver.promise,this._connection.invoke("update",t)}async applyUpdate(e){return await this._startupResolver.promise,this._connection.invoke("applyUpdate",e)}async setHighlight(e){return await this._startupResolver.promise,Object(promiseUtils.l)(this._connection.invoke("controller.setHighlight",e))}async refresh(e){return await this._startupResolver.promise,Object(promiseUtils.l)(this._connection.invoke("controller.refresh",e))}async querySummaryStatistics(e,t,r){return await this._startupResolver.promise,this._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:t},r)}async queryUniqueValues(e,t,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryUniqueValues",{query:e.toJSON(),params:t},r)}async queryClassBreaks(e,t,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:t},r)}async queryHistogram(e,t,r){return await this._startupResolver.promise,this._connection.invoke("controller.queryHistogram",{query:e.toJSON(),params:t},r)}async queryFeatures(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",e.toJSON(),t)}async queryVisibleFeatures(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryVisibleFeatures",e.toJSON(),t)}async queryObjectIds(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)}async queryFeatureCount(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)}async queryExtent(e,t){return this._connection.invoke("controller.queryExtent",e.toJSON(),t)}async queryLatestObservations(e,t){return await this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)}async queryStatistics(e){return await this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",e)}async getObjectId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getObjectId",e)}async getDisplayId(e){return await this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",e)}async getFeatures(e){return await this._startupResolver.promise,this._connection.invoke("controller.getFeatures",e)}async getAggregates(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregates")}async getAggregateValueRanges(){return await this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")}async mapValidDisplayIds(e){return await this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",e)}async onEdits(e){return await this._startupResolver.promise,Object(promiseUtils.l)(this._connection.invoke("controller.onEdits",e))}async enableEvent(e,t){return await this._startupResolver.promise,Object(promiseUtils.l)(this._connection.invoke("controller.enableEvent",{name:e,value:t}))}async _startWorker(e){try{this._connection=await Object(workers.b)("Pipeline",{client:this.client,strategy:"dedicated",signal:e})}catch(t){Object(promiseUtils.x)(t)}}};Object(tslib_es6.a)([Object(property.b)()],FeatureLayerProxy_l.prototype,"isReady",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureLayerProxy_l.prototype,"client",void 0),Object(tslib_es6.a)([Object(property.b)()],FeatureLayerProxy_l.prototype,"tileRenderer",null),FeatureLayerProxy_l=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.layers.support.FeatureLayerProxy")],FeatureLayerProxy_l);const FeatureLayerProxy_u=FeatureLayerProxy_l;var util=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/util.js"),TileCoverage=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileCoverage.js"),TileKey=__webpack_require__("./node_modules/@arcgis/core/views/2d/tiling/TileKey.js");class TileManager_s{constructor(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}destroy(){}clear(){this._tiles.forEach((e=>this._releaseTile(e)))}tileKeys(){const e=[];return this._tiles.forEach(((i,t)=>e.push(t))),e}update(e){const l=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),{spans:s,lodInfo:r}=l,{level:a}=r,o=[],d=[],h=new Set,n=new Set;for(const{row:i,colFrom:c,colTo:f}of s)for(let e=c;e<=f;e++){const l=TileKey.a.getId(a,i,r.normalizeCol(e),r.getWorldForColumn(e)),s=this._getOrAcquireTile(o,l);h.add(l),s.isReady?s.visible=!0:n.add(s.key)}return n.forEach((e=>this._addPlaceholders(h,e))),this._tiles.forEach((e=>{h.has(e.key.id)||(d.push(e.key.id),this._releaseTile(e))})),TileCoverage.a.pool.release(l),{hasMissingTiles:n.size>0,added:o,removed:d}}_getOrAcquireTile(e,i){if(!this._tiles.has(i)){const l=this.acquireTile(new TileKey.a(i));e.push(i),this._tiles.set(i,l),l.visible=!1}return this._tiles.get(i)}_getTile(e){return this._tiles.get(e)}_releaseTile(e){this._tiles.delete(e.key.id),this.releaseTile(e)}_addPlaceholders(e,i){const t=this._addPlaceholderChildren(e,i);Math.abs(1-t)<1e-6||this._addPlaceholderParent(e,i)||(this._getTile(i.id).visible=!0)}_addPlaceholderChildren(e,i){let t=0;return this._tiles.forEach((l=>{t+=this._addPlaceholderChild(e,l,i)})),t}_addPlaceholderChild(e,i,t){return i.key.level<=t.level||!i.hasData||!t.contains(i.key)?0:(i.visible=!0,e.add(i.key.id),1/(1<<2*(i.key.level-t.level)))}_addPlaceholderParent(i,t){let l=t.getParentKey(),s=0,r=null;for(;Object(maybe.l)(l);){if(i.has(l.id))return!0;const e=this._getTile(l.id);if(null!=e&&e.isReady)return e.visible=!0,i.add(e.key.id),!0;null!=e&&e.hasData&&e.patchCount>s&&(s=e.patchCount,r=e),l=l.getParentKey()}return!!r&&(r.visible=!0,i.add(r.key.id),!0)}}var FeatureLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/FeatureLayerView.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),RefreshableLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"),drapedUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/drapedUtils.js"),capabilities=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities.js"),Extent=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js");function Q(e){return e&&"openPorts"in e}const M=Logger.a.getLogger("esri.views.2d.layers.FeatureLayerView2D");let A=class extends(Object(FeatureLayerView.a)(Object(RefreshableLayerView.a)(Object(LayerView2D.a)(LayerView.a)))){constructor(){super(...arguments),this._pipelineIsUpdating=!0,this._commandsQueue=new FeatureCommandQueue_c({process:e=>{switch(e.type){case"processed-edit":return this._doEdit(e);case"refresh":return this._doRefresh(e.dataChanged);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightIds=new Map,this._lastPixelBuffer=0,this._updateHighlight=Object(promiseUtils.i)((async()=>this._proxy.setHighlight(Array.from(this._highlightIds.keys())))),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.featureEffectView=new FeatureEffectView_l,this._lastDefinitionExpression=null}destroy(){var e,t;Object(maybe.b)(this._updateClusterSizeTask,(e=>e.remove())),null==(e=this._proxy)||e.destroy(),null==(t=this.tileRenderer)||t.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(e=>{this._set("_aggregateValueRanges",e.valueRanges)})),Object(reactiveUtils.b)((()=>this.featureEffect),(e=>{this.featureEffectView.featureEffect=e}),{initial:!0,sync:!0})])}async _initProxy(){if("isTable"in this.layer&&this.layer.isTable)throw new Error.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const e=this._createClientOptions();return this._set("_proxy",new FeatureLayerProxy_u({client:e})),this._proxy.when()}async _initServiceOptions(){this._set("_serviceOptions",await this._createServiceOptions())}get orderByFields(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){const e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((e=>e.labelingInfo&&e.labelsVisible))}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,i=this.view.floors,{definitionExpression:r}=t,s="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,n="feature"===t.type?t.gdbVersion:void 0,o="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:l}=this,u="customParameters"in t?JSON.stringify(t.customParameters):void 0,d="apiKey"in t?t.apiKey:void 0,p="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,c=JSON.stringify(this.clips),y=t.featureReduction&&t.featureReduction.toJSON(),f="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),g="sublayers"in this.layer&&this.layer.sublayers.items.reduce(((e,t)=>e+`${t.visible?1:0}.${JSON.stringify(t.renderer)}.${t.labelsVisible}\n.${JSON.stringify(t.labelingInfo)}`),"");return JSON.stringify({orderBy:f,sublayerHash:g,filterHash:Object(maybe.l)(this.filter)&&this.filter.toJSON(),effectHash:Object(maybe.l)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:p,gdbVersion:n,definitionExpression:r,historicMoment:o,availableFields:e,renderer:a,labelingInfo:s,timeExtent:l,floors:i,clipsHash:c,featureReduction:y,customParameters:u,apiKey:d})}async fetchPopupFeatures(e,t){var i;if(Object(maybe.l)(t)&&0===t.clientGraphics.length)return[];if("cluster"!==(null==(i=this.layer.featureReduction)?void 0:i.type)){const i=Object(clickToleranceUtils.a)({renderer:"renderer"in this.layer&&this.layer.renderer,event:Object(maybe.l)(t)&&t.event}),r=Object(drapedUtils.a)(e,i,this.view),{features:s}=await this.queryVisibleFeatures(new Query.a({geometry:r,outFields:["*"],returnGeometry:!0}));t=Object(maybe.l)(t)?t:{};const a=new Set(t.clientGraphics.map((e=>e.getObjectId())));for(const e of s)a.has(e.getObjectId())||t.clientGraphics.push(e)}return super.fetchPopupFeatures(e,t)}highlight(e){var t;let s;return e instanceof Graphic.a?s=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?s=[e]:Array.isArray(e)&&e.length>0?s="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((e=>null==e?void 0:e.getObjectId())):Collection.a.isCollection(e)&&e.length>0&&(s=e.map((e=>null==e?void 0:e.getObjectId())).toArray()),s=null==(t=s)?void 0:t.filter((e=>null!=e)),s&&s.length?(this._addHighlight(s),{remove:()=>this._removeHighlight(s)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}async hitTest(e,r){if(!this.tileRenderer)return null;const s=await this.tileRenderer.hitTest(r);if(0===s.length)return null;const{features:a,aggregates:n}=await this._proxy.getFeatures(s);return[...n.map((e=>this._createHittestResult(AggregateGraphic_c.fromJSON(e)))),...a.map((e=>this._createHittestResult(Graphic.a.fromJSON(e))))]}async queryAggregates(){return(await this._proxy.getAggregates()).map((e=>AggregateGraphic_c.fromJSON(e)))}queryStatistics(){return this._proxy.queryStatistics()}async querySummaryStatistics(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(e),r,i)}async queryUniqueValues(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(e),r,i)}async queryClassBreaks(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(e),r,i)}async queryHistogram(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(e),r,i)}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=FeatureSet.default.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryVisibleFeatures(e,t){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((e=>{const t=FeatureSet.default.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((e=>({count:e.count,extent:Extent.a.fromJSON(e.extent)})))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:i,removed:r}=this._tileStrategy.update(e);(i.length||r.length)&&this._proxy.updateTiles({added:i,removed:r}),t&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new TileManager_s({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(Object(watchUtils.a)(this,"renderingConfigHash",(()=>this._update())),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(e=>this._edit(e))),"attach")}detach(){this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){var e;const t="renderer"in this.layer&&null!=this.layer.renderer,i=this._commandsQueue.updating,r=null!=this._updatingRequiredFieldsPromise,s=!this._proxy||!this._proxy.isReady,n=this._pipelineIsUpdating,o=null===this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),l=t&&(i||r||s||n||o);return Object(has.a)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${l}\n  -> hasRenderer ${t}\n  -> hasPendingCommand ${i}\n  -> updatingRequiredFields ${r}\n  -> updatingProxy ${s}\n  -> updatingPipeline ${n}\n  -> updatingTileRenderer ${o}\n`),l}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}async _detectQueryMode(e){var t;const i="path"in e,r="editingInfo"in this.layer&&(null==(t=this.layer.editingInfo)?void 0:t.lastEditDate),s=!!this.layer.refreshInterval,n=!r&&s;if(i&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&!this.layer.capabilities.operations.supportsEditing&&!n&&Object(has.a)("featurelayer-snapshot-enabled"))try{const e=await this.layer.queryFeatureCount();if(e<=Object(has.a)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:e};const t=Object(has.a)("featurelayer-snapshot-point-max-threshold"),i=Object(has.a)("featurelayer-snapshot-point-coverage"),r=this.view.extent,s=Object(maybe.u)(this.layer.fullExtent),n=null==s?void 0:s.clone().intersection(r),o=Object(maybe.l)(n)?n.width*n.height:0,l=(null==s?void 0:s.width)*(null==s?void 0:s.height),d=0===l?0:o/l;if(e<=t&&d>=i)return{mode:"snapshot",featureCount:e}}catch(o){M.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:o})}return{mode:"on-demand"}}async _createServiceOptions(){var e;const t=this.layer;if("stream"===t.type)return null;const{capabilities:i,objectIdField:r}=t,s=t.fields.map((e=>e.toJSON())),a=Object(maybe.l)(t.fullExtent)&&t.fullExtent.toJSON(),o=Object(util.b)(t.geometryType),l=t.timeInfo&&t.timeInfo.toJSON()||null,u=t.spatialReference?t.spatialReference.toJSON():null,d="feature"===t.type?t.globalIdField:null;let p;"ogc-feature"===t.type?p=t.source.getFeatureDefinition():Q(t.source)?p=await t.source.openPorts():t.parsedUrl&&(p=Object(lang.a)(t.parsedUrl),"dynamicDataSource"in t&&t.dynamicDataSource&&(p.query={layer:JSON.stringify({source:t.dynamicDataSource})}));const c="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone,y=null!=(e="subtypeField"in this.layer&&this.layer.subtypeField)?e:null,{mode:f,featureCount:g}=await this._detectQueryMode(p);let m=this.layer.objectIdField;if("feature"===this.layer.type&&Object(maybe.l)(this.layer.orderBy)&&this.layer.orderBy.length){const e=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;e&&(m=e)}return{type:f,timeReferenceUnknownClient:c,subtypeField:y,featureCount:g,globalIdField:d,maxRecordCount:i.query.maxRecordCount,tileMaxRecordCount:i.query.tileMaxRecordCount,capabilities:i,fields:s,fullExtent:a,geometryType:o,objectIdField:r,source:p,timeInfo:l,spatialReference:u,orderByFields:m}}async _createMemoryServiceOptions(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:"memory",source:t}}_cleanUpQuery(e){const t=Query.a.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(e){if(this._validateEdit(e))return this._commandsQueue.push({type:"edit",edits:e})}async doRefresh(e){return this._commandsQueue.push({type:"refresh",dataChanged:e})}_validateEdit(e){const t="globalIdField"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some((e=>-1===e.objectId||!e.objectId)),r=t&&this.availableFields.includes(t);return i&&!r?(M.error(new Error.a("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)),null):e}async _doUpdate(){try{if(this.destroyed||!this._hasRequiredSupport(this.layer)||!this._tileStrategy)return;const{featureEffectView:t,filter:i}=this;await this._updateRequiredFields();const{renderer:r}=this._getEffectiveRenderer();this._set("_effectiveRenderer",r);const s=this._createSchemaConfig(),a=Object(util.b)(this.layer.geometryType),n=await Object(pixelBuffering.a)(r,a,this.view.resourceManager,this.layer.fields,this.layer.spatialReference,this.layer.featureReduction),o=this._createConfiguration(s,i,t.filter),l=this._lastDefinitionExpression!==o.definitionExpression;this._lastDefinitionExpression=o.definitionExpression,this._lastPixelBuffer=0===n?0:Math.max(n,this._lastPixelBuffer),o.schema.source.pixelBuffer=this._lastPixelBuffer;const h=this._createTileRendererHash(r);if("snapshot"===this._serviceOptions.type&&(o.schema.source.featureCount=this._serviceOptions.featureCount),h!==this._tileRendererHash){await this._initTileRenderer(r);const e=this._serviceOptions;this.tileRenderer.onConfigUpdate(r);const t=this.layer;"stream"!==t.type&&Q(t.source)&&(e.source=await t.source.openPorts()),"stream"===t.type&&await this._initServiceOptions();const i={added:this._tileStrategy.tileKeys(),removed:[]};await this._proxy.startup(this.view.featuresTilingScheme,o,e,i),this.hasHighlight()&&await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),await this._onceTilesUpdated(),this.tileRenderer.onConfigUpdate(r)}else{"snapshot"===this._serviceOptions.type&&l&&(o.schema.source.featureCount=await this.layer.queryFeatureCount());const t=await this._proxy.update(o);(t.mesh||t.targets.aggregate)&&this._lockGPUUploads();try{await this._proxy.applyUpdate(t)}catch(e){Object(promiseUtils.m)(e)||M.error(e)}(t.mesh||t.targets.aggregate)&&this._unlockGPUUploads(),this.tileRenderer.onConfigUpdate(r),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload()}this._tileRendererHash=h,this.tileRenderer.invalidateLabels(),this.requestUpdate()}catch(e){}}async _doEdit(e){try{await this._proxy.onEdits(e)}catch(t){Object(promiseUtils.m)(t)}}async _doRefresh(e){this._lockGPUUploads();try{await this._proxy.refresh(e)}catch(t){Object(promiseUtils.m)(t)}this._unlockGPUUploads()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,t){return this.watch("_aggregateValueRanges",(async i=>{this._updateClusterEffectiveRendererSizeVariable(e,t,i),this._needsClusterSizeUpdate=!0,this._uploadsLocked||this._updateClusterSizeVariable()}))}async _updateClusterEffectiveRendererSizeVariable(e,t,i){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const r=Object(clusterUtils.c)(e.visualVariables);if(Object(maybe.l)(r)&&"cluster_count"===r.field){const s=e.visualVariables.indexOf(r);e.visualVariables[s]=Object(clusterUtils.a)(t,i);const a=e.clone();a.dynamicClusterSize=!0,this._set("_effectiveRenderer",a)}}}_getEffectiveRenderer(){const e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if(Object(maybe.l)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&Object(clusterUtils.d)(e)){const i=t,r=[],s=Object(clusterUtils.b)(r,e,i,this._aggregateValueRanges);return Object(maybe.b)(this._updateClusterSizeTask,(e=>e.remove())),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,i),{renderer:s,aggregateFields:r,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",(()=>{this.requestUpdate()})),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}async _initTileRenderer(e){const t=await async function tileRenderers_e(e,a){if(!e)return null;switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return new((await Promise.all([__webpack_require__.e(1),__webpack_require__.e(62)]).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/SymbolTileRenderer.js"))).default)(a);case"heatmap":return new((await Promise.all([__webpack_require__.e(1),__webpack_require__.e(75)]).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/HeatmapTileRenderer.js"))).default)(a)}}(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set("tileRenderer",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)}_createTileRendererHash(e){return`${"heatmap"===e.type?"heatmap":"symbol"}.${"dot-density"===e.type}`}get hasFilter(){const e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(e){const t=Object(maybe.l)(e)?e.timeExtent:null,i=Object(maybe.l)(this.timeExtent)&&Object(maybe.l)(t)?this.timeExtent.intersection(t):this.timeExtent||t;let r=null;const s="floorInfo"in this.layer&&this.layer.floorInfo;if(s){const t=Object(maybe.l)(e)&&e.where;r=this._addFloorFilterClause(t)}if(!this._visibilityOverrides.size&&!i&&!s)return Object(maybe.l)(e)?e.toJSON():null;(e=Object(maybe.l)(e)&&e.clone()||new FeatureFilter.a).timeExtent=i,r&&(e.where=r);const a=e.toJSON();return a.hiddenIds=Array.from(this._visibilityOverrides),a}_addFloorFilterClause(e){const t=this.layer;let i=e||"";if("floorInfo"in t&&t.floorInfo){var r;let e=this.view.floors;if(!e||!e.length)return i;null!=(r=t.floorInfo.viewAllLevelIds)&&r.length&&(e=t.floorInfo.viewAllLevelIds);const s=e.filter((e=>""!==e)).map((e=>"'"+e+"'"));s.push("''");const a=t.floorInfo.floorField;let n="("+a+" IN ({ids}) OR "+a+" IS NULL)";if(n=n.replace("{ids}",s.join(", ")),Object(maybe.l)(i)&&i.includes(a)){let e=new RegExp("AND \\("+a+".*NULL\\)","g");i=i.replace(e,""),e=new RegExp("\\("+a+".*NULL\\)","g"),i=i.replace(e,""),i=i.replace(/\s+/g," ").trim()}i=""!==i?"("+i+") AND "+n:n}return""!==i?i:null}_createConfiguration(e,t,i){const r="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(definitions.s),n=this._injectOverrides(t);a[0]=n,a[1]=Object(maybe.l)(i)?i.toJSON():null;const o=Object(schemaUtils.createSchema)(e);if(Object(maybe.k)(o))return null;const l=Object(capabilities.a)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:o,supportsTextureFloat:l.supportsTextureFloat,maxTextureSize:l.maxTextureSize}}_hasRequiredSupport(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!Object(capabilities.a)().supportsTextureFloat&&(M.error(new Error.a("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),Object(watchUtils.h)(this,"_pipelineIsUpdating",!1)}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){const e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:t,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0}}}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch((e=>{Object(promiseUtils.m)(e)||M.error(e)}))}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch((e=>{Object(promiseUtils.m)(e)||M.error(e)}))}_setLayersForFeature(e){const t=this.layer;e.layer=t,e.sourceLayer=t}_createHittestResult(e){return this._setLayersForFeature(e),Object(maybe.l)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}};Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_serviceOptions",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_proxy",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_pipelineIsUpdating",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_effectiveRenderer",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_aggregateValueRanges",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"_commandsQueue",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"featureEffectView",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"labelsVisible",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],A.prototype,"queryMode",null),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"renderingConfigHash",null),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"tileRenderer",void 0),Object(tslib_es6.a)([Object(property.b)()],A.prototype,"updating",void 0),A=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.layers.FeatureLayerView2D")],A);const D=A},"./node_modules/@arcgis/core/views/2d/layers/support/cimSymbolUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return cimSymbolUtils_i})),__webpack_require__.d(__webpack_exports__,"b",(function(){return cimSymbolUtils_l}));var cimAnalyzer=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/cimAnalyzer.js"),enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),MaterialKey=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/materialKey/MaterialKey.js");const ExpandedCIM_a={marker:enums.d.MARKER,fill:enums.d.FILL,line:enums.d.LINE,text:enums.d.TEXT};class ExpandedCIM_l{constructor(e,l,s,n){const r={minScale:null==l?void 0:l.minScale,maxScale:null==l?void 0:l.maxScale},c=function ExpandedCIM_i(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(r);this.layers=e,this.data=l,this.hash=this._createHash()+c,this.rendererKey=s;const m={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:s};for(const i of e){const e=ExpandedCIM_a[i.type];i.materialKey=Object(MaterialKey.g)(e,m),i.maxVVSize=n,i.scaleInfo=r,i.templateHash+=c}}get type(){return"expanded-cim"}_createHash(){let e="";for(const t of this.layers)e+=t.templateHash;return e}}var devEnvironmentUtils=__webpack_require__("./node_modules/@arcgis/core/core/devEnvironmentUtils.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),Portal=__webpack_require__("./node_modules/@arcgis/core/portal/Portal.js"),persistableUrlUtils=__webpack_require__("./node_modules/@arcgis/core/chunks/persistableUrlUtils.js"),styleUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/styleUtils.js");async function webStyleUtils_y(t,r,n){if(!t.name)return Promise.reject(new Error.a("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return async function webStyleUtils_f(t,r){const e=styleUtils.a.replace(/\{SymbolName\}/gi,t.name);try{const t=await Object(styleUtils.d)(e,r);return Object(styleUtils.c)(t.data)}catch(n){return Object(promiseUtils.w)(n),null}}(t,n);try{return async function webStyleUtils_p(m,a,y,f){const p=m.data,b={portal:y&&y.portal||Portal.a.getDefault(),url:Object(urlUtils.K)(m.baseUrl),origin:"portal-item"},d=p.items.find((t=>t.name===a));if(!d)throw new Error.a("symbolstyleutils:symbol-name-not-found",`The symbol name '${a}' could not be found`,{symbolName:a});let j=Object(persistableUrlUtils.a)(Object(styleUtils.e)(d,"cimRef"),b);Object(devEnvironmentUtils.b)()&&(j=Object(devEnvironmentUtils.a)(j));try{const t=await Object(styleUtils.d)(j,f);return Object(styleUtils.c)(t.data)}catch(U){return Object(promiseUtils.w)(U),null}}(await Object(styleUtils.b)(t,r,n),t.name,r,n)}catch(s){return Object(promiseUtils.w)(s),null}}const cimSymbolUtils_n=async(a,r,n)=>new ExpandedCIM_l(await Object(cimAnalyzer.b)(a.data,r,n),a.data,a.rendererKey,a.maxVVSize),cimSymbolUtils_l=async(e,t,r,l)=>{if(!e)return null;if("cim"===e.type)return cimSymbolUtils_n(e,t,r);if("web-style"===e.type){const i={type:"cim",data:await webStyleUtils_y(e,null,l),rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return cimSymbolUtils_n(i,t,r)}return e};function cimSymbolUtils_i(e){if(!e)return null;const{type:t,cim:a,url:r,materialHash:n}=e,l={cim:a,type:t,mosaicHash:n,url:r,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(t){case"marker":l.size=e.size,l.path=e.path;break;case"line":l.dashTemplate=e.dashTemplate;break;case"text":l.text=e.text,l.fontName=e.fontName}return l}},"./node_modules/@arcgis/core/views/layers/FeatureLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return O}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_deprecate_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/deprecate.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_11__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/layers/support/commonProperties.js"),_layers_support_FeatureEffect_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/layers/support/FeatureEffect.js"),_layers_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/layers/support/FeatureFilter.js"),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),_rest_support_Query_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js"),_support_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/views/support/floorFilterUtils.js");const P=_core_Logger_js__WEBPACK_IMPORTED_MODULE_3__.a.getLogger("esri.views.layers.FeatureLayerView"),O=i=>{let O=class extends i{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_6__.a)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","featureEffect","layer.timeInfo","layer.floorInfo","timeExtent"],(()=>this._handleRequiredFieldsChange()),!0),Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_6__.b)(this,"view.floors","change",(()=>this._handleRequiredFieldsChange())),Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_6__.b)(this,"layer.sublayer","change",(()=>this._handleRequiredFieldsChange()))}get availableFields(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.j)(t,[...Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.u)(t,e.outFields),...r]):Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.j)(t,r)}set effect(e){Object(_core_deprecate_js__WEBPACK_IMPORTED_MODULE_1__.c)(P,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=e}get effect(){return Object(_core_deprecate_js__WEBPACK_IMPORTED_MODULE_1__.c)(P,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){void 0!==e?this._override("featureEffect",e):this._clearOverride("featureEffect")}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){P.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this.filter)?this.filter.createQuery(e):new _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_16__.a(e);if("feature"===this.layer.type){const e=Object(_support_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_19__.b)(this);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this.timeExtent)&&(t.timeExtent=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeatures(e,t){const r=this.validateFetchPopupFeatures(t);if(r)throw r;return this.fetchClientPopupFeatures(t)}_loadArcadeModules(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return Object(_support_arcadeOnDemand_js__WEBPACK_IMPORTED_MODULE_17__.e)()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:r,objectIdField:i}}=this,o="renderer"in t&&t.renderer,n="orderBy"in t&&t.orderBy,l=t.featureReduction,u=new Set,p=await Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.j)([o?o.collectRequiredFields(u,r):null,Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.g)(u,t),e?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.b)(u,t):null,Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this.filter)?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.f)(u,t,this.filter):null,Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this.featureEffect)?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.f)(u,t,this.featureEffect.filter):null,l?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.c)(u,t,l):null,n?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.h)(u,t,n):null]);if(t.timeInfo&&this.timeExtent&&Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.e)(u,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"feature"===t.type&&t.floorInfo&&Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.e)(u,t.fieldsIndex,[t.floorInfo.floorField]),"subtype-group"===t.type){Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.d)(u,r,t.subtypeField);const e=t.sublayers.map((e=>{var t;return Promise.all([null==(t=e.renderer)?void 0:t.collectRequiredFields(u,r),Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.g)(u,e)])}));await Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.j)(e)}for(const s of p)s.error&&P.error(s.error);Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.d)(u,r,i),e&&"displayField"in t&&t.displayField&&Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.d)(u,r,t.displayField);const f=Array.from(u).sort();this._set("requiredFields",f)}validateFetchPopupFeatures(e){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e))return null;for(const t of e.clientGraphics){const i=t.layer;if("popupEnabled"in i&&!i.popupEnabled)return new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:i});if("popupTemplate"in i&&!Object(_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_18__.a)(i,e))return new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:i});if(t.isAggregate&&!(i.featureReduction&&"popupTemplate"in i.featureReduction&&i.featureReduction.popupEnabled&&i.featureReduction.popupTemplate))return new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:i})}}async fetchClientPopupFeatures(e){const t=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)?e.clientGraphics:null;if(!t||0===t.length)return[];const r=new Array(t.length),i=new Map,o=await this.createPopupQuery(e);for(let a=0;a<t.length;a++){const n=t[a];if(n.isAggregate){r[a]=n;continue}const{layer:l}=n;if(!("popupEnabled"in l))continue;const u=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.u)(this.layer.fieldsIndex,o.outFields),p=Object(_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_18__.a)(l,e);if(!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(p))continue;const f=await this._loadArcadeModules(p);f&&f.arcadeUtils.hasGeometryOperations(p)||!Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_15__.i)(u,n)?i.set(n.getObjectId(),a):r[a]=n}if("stream"===this.layer.type||0===i.size)return r.filter(Boolean);o.objectIds=Array.from(i.keys());try{const e=await this.layer.queryFeatures(o);for(const t of e.features)r[i.get(t.getObjectId())]=t}catch{}return r.filter(Boolean)}async createPopupQuery(e){const t=this.layer.createQuery(),r=new Set;let i=!1;const o=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)&&e.clientGraphics?e.clientGraphics.map((e=>e.layer)):[this.layer];for(const a of o){if(!("popupEnabled"in a))continue;const t=Object(_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_18__.a)(a,e);if(!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(t))continue;const o=await this._loadArcadeModules(t),n=o&&o.arcadeUtils.hasGeometryOperations(t);i=!("point"!==this.layer.geometryType&&!n);const l=await Object(_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_18__.b)(this.layer,t);for(const e of l)r.add(e)}if(t.returnGeometry=i,t.returnZ=i,t.returnM=i,t.outFields=Array.from(r),t.outSpatialReference=this.view.spatialReference,"feature"===this.layer.type){const e=Object(_support_floorFilterUtils_js__WEBPACK_IMPORTED_MODULE_19__.b)(this);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return t}canResume(){return!(!super.canResume()||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this.timeExtent)&&this.timeExtent.isEmpty)}};return Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)()],O.prototype,"_updatingRequiredFieldsPromise",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({readOnly:!0})],O.prototype,"availableFields",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)()],O.prototype,"effect",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({type:_layers_support_FeatureEffect_js__WEBPACK_IMPORTED_MODULE_13__.a})],O.prototype,"featureEffect",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({type:_layers_support_FeatureFilter_js__WEBPACK_IMPORTED_MODULE_14__.a})],O.prototype,"filter",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)(_layers_support_commonProperties_js__WEBPACK_IMPORTED_MODULE_12__.a)],O.prototype,"timeExtent",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)()],O.prototype,"layer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({type:Number})],O.prototype,"maximumNumberOfFeatures",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({readOnly:!0,type:Boolean})],O.prototype,"maximumNumberOfFeaturesExceeded",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)({readOnly:!0})],O.prototype,"requiredFields",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)()],O.prototype,"suspended",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_7__.b)()],O.prototype,"view",void 0),O=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_11__.a)("esri.views.layers.FeatureLayerView")],O),O}},"./node_modules/@arcgis/core/views/layers/RefreshableLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return i}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"));const i=i=>{let c=class extends i{initialize(){this.handles.add(Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_3__.b)(this,"layer","refresh",(r=>{this.doRefresh(r.dataChanged).catch((r=>{Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_2__.m)(r)||_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.a.getLogger(this.declaredClass).error(r)}))})),"RefreshableLayerView")}};return Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)()],c.prototype,"layer",void 0),c=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.a)("esri.layers.mixins.RefreshableLayerView")],c),c}},"./node_modules/@arcgis/core/views/layers/support/popupUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return d})),__webpack_require__.d(__webpack_exports__,"b",(function(){return t}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");async function t(t,d=t.popupTemplate){if(!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes("*"))return["*"];const f=n?await Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.n)(t):[],r=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.j)(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(l)&&l.defaultPopupTemplateEnabled&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}},"./node_modules/@arcgis/core/views/support/drapedUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return a}));__webpack_require__("./node_modules/@arcgis/core/geometry.js");var _core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_4__=(__webpack_require__("./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js"),__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"));function a(t,n,a,o=new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_4__.a){let s;if("2d"===a.type)s=n*a.resolution;else if("3d"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.l)(o)&&!o.equals(a.spatialReference)?Object(_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.f)(o)/Object(_core_unitUtils_js__WEBPACK_IMPORTED_MODULE_2__.f)(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}new _geometry_Extent_js__WEBPACK_IMPORTED_MODULE_4__.a}}]);