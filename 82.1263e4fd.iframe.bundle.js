(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{"./node_modules/@arcgis/core/chunks/PointRenderer.glsl.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return n})),__webpack_require__.d(__webpack_exports__,"b",(function(){return r}));var _views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),_views_3d_webgl_engine_core_shaderLibrary_util_RgbaFloatEncoding_glsl_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl.js"),_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/interfaces.js"),_views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js");function r(r){const n=new _views_3d_webgl_engine_core_shaderModules_ShaderBuilder_js__WEBPACK_IMPORTED_MODULE_4__.a,c=0===r.output,d=1===r.output,s=4===r.output;return n.extensions.add("GL_OES_standard_derivatives"),n.include(_views_3d_webgl_engine_core_shaderLibrary_Slice_glsl_js__WEBPACK_IMPORTED_MODULE_0__.a,r),n.attributes.add("position","vec3"),n.attributes.add("color","vec3"),n.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3"),d?(n.vertex.uniforms.add("nearFar","vec2"),n.varyings.add("depth","float")):4!==r.output&&n.varyings.add("vColor","vec3"),n.vertex.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${r.drawScreenSize?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`
      float clampedScreenSize = pointSize;`:_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${d?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${c?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`vColor = color;`:""}
    }
  `),n.fragment.include(_views_3d_webgl_engine_core_shaderLibrary_util_RgbaFloatEncoding_glsl_js__WEBPACK_IMPORTED_MODULE_2__.a,r),s&&n.include(_views_3d_webgl_engine_core_shaderLibrary_output_OutputHighlight_glsl_js__WEBPACK_IMPORTED_MODULE_1__.a),n.fragment.code.add(_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${d?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`gl_FragColor = float2rgba(depth);`:""}
      ${s?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`outputHighlight();`:""}
      ${c?_views_3d_webgl_engine_core_shaderModules_interfaces_js__WEBPACK_IMPORTED_MODULE_3__.a`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `),n}const n=Object.freeze({__proto__:null,build:r})},"./node_modules/@arcgis/core/views/3d/layers/PointCloudLayerView3D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return ce}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),typedArrayUtil=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),aaBoundingBox=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),plane=__webpack_require__("./node_modules/@arcgis/core/geometry/support/plane.js"),dehydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js"),CodedValue=__webpack_require__("./node_modules/@arcgis/core/layers/support/CodedValue.js"),CodedValueDomain=__webpack_require__("./node_modules/@arcgis/core/layers/support/CodedValueDomain.js"),fieldUtils=(__webpack_require__("./node_modules/@arcgis/core/layers/support/Domain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/InheritedDomain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/RangeDomain.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js")),PromiseQueue=__webpack_require__("./node_modules/@arcgis/core/layers/support/PromiseQueue.js"),unitConversionUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/unitConversionUtils.js"),LayerView3D=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/LayerView3D.js"),WorkerHandle=__webpack_require__("./node_modules/@arcgis/core/core/workers/WorkerHandle.js");class PointCloudWorkerHandle_e extends WorkerHandle.a{constructor(t){super("PointCloudWorker","transform",t)}getTransferList(r){const e=[r.geometryBuffer];if(Object(maybe.l)(r.primaryAttributeData)&&r.primaryAttributeData.buffer&&e.push(r.primaryAttributeData.buffer),Object(maybe.l)(r.modulationAttributeData)&&r.modulationAttributeData.buffer&&e.push(r.modulationAttributeData.buffer),Object(maybe.l)(r.filterAttributesData))for(const u of r.filterAttributesData)Object(maybe.l)(u)&&u.buffer&&e.push(u.buffer);for(const t of r.userAttributesData)t.buffer&&e.push(t.buffer);return e}}var I3SUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js");const LoDUtil_n=[!1],LoDUtil_l=[null],LoDUtil_r=[!1],LoDUtil_o=[null];function LoDUtil_h(e,t,n){let l=e;for(;l>0;){const e=t.indexOf(l);if(e>=0)return e;l=n.getParentId(l)}return t.indexOf(l)}function LoDUtil_d(e,t,n){const l=[t.remove[0]],r=[];for(;1===l.length;){const e=l.pop();r.length=0;for(let o=0;o<t.load.length;o++){let h=t.load[o],g=n.getParentId(h);for(;g!==e;)h=g,g=n.getParentId(h);let u=l.indexOf(h);u<0&&(u=l.length,l.push(h),r.push([])),r[u].push(t.load[o])}}t.load=l;for(let o=0;o<l.length;o++)r[o].length>1?e.push({remove:[l[o]],load:r[o]}):l[o]=r[o][0]}var orientedBoundingBox=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js");class PagedNodeIndex_h{constructor(e,t,s){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=s}addPage(e,t,s=0){for(;this._pages.length<e;)this._pages.push(null);const n=function PagedNodeIndex_g(e,t,s,i){const r=new orientedBoundingBox.a(e.length);for(let o=0;o<e.length;o++)Object(I3SUtil.v)(e[o].obb,t,r.obbs[o],s,i);return r.obbs}(t,this._nodeSR,this._renderSR,s);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function PagedNodeIndex_u(e,t){const s=[0];for(;s.length;){const n=s.pop(),i=e[PagedNodeIndex_l(n,t)].nodes[PagedNodeIndex_c(n,t)];for(let r=0;r<i.childCount;r++){const o=i.firstChild+r;null!=e[PagedNodeIndex_l(o,t)]&&(e[PagedNodeIndex_l(o,t)].parents[PagedNodeIndex_c(o,t)]=n,s.push(o))}}}(this._pages,this.pageSize)}hasPage(e){return!!this._pages[e]}getNode(e){const t=this.pageSize;return this._pages[PagedNodeIndex_l(e,t)].nodes[PagedNodeIndex_c(e,t)]}getRenderObb(e){const t=this.pageSize;return this._pages[PagedNodeIndex_l(e,t)].renderObbs[PagedNodeIndex_c(e,t)]}getRenderCenter(e){return this.getRenderObb(e).center}setRenderObb(e,t){const s=this.pageSize;Object(orientedBoundingBox.m)(t,this._pages[PagedNodeIndex_l(e,s)].renderObbs[PagedNodeIndex_c(e,s)])}getParentId(e){const t=this.pageSize;return this._pages[PagedNodeIndex_l(e,t)].parents[PagedNodeIndex_c(e,t)]}hasNodes(e,t){const s=PagedNodeIndex_l(e,this.pageSize),n=PagedNodeIndex_l(e+t-1,this.pageSize);for(let i=s;i<=n;i++)if(null==this._pages[i])return!1;return!0}forEachNodeId(e){for(let t=0;t<this._pages.length;t++){const s=this._pages[t];if(s)for(let n=0;n<s.nodes.length;n++)e(t*this.pageSize+n)}}createVisibilityTraverse(){const t={index:this,queue:[],masks:[],tempAabb:Object(aaBoundingBox.h)()};return(e,s)=>function PagedNodeIndex_a(e,n,i){const p=e.index;if(!p.hasNodes(0,1))return;const h=e.queue;h.length=0,h.push(0);const a=e.masks;for(a.length=0,a.push(0);h.length>0;){const g=h.pop();let u=a.pop();const c=p.getNode(g),d=p.getRenderObb(g);let f=!0;if(null!=n.clippingBox){const i=1<<n.frustum.length;if(0==(u&i)){const o=Object(orientedBoundingBox.n)(d,e.tempAabb);Object(aaBoundingBox.f)(n.clippingBox,o)?u|=i:Object(aaBoundingBox.v)(n.clippingBox,o)||(f=!1)}}for(let e=0;e<n.frustum.length&&f;e++){const t=1<<e;if(0==(u&t)){const s=Object(orientedBoundingBox.g)(d,n.frustum[e]);s>0?f=!1:s<0&&(u|=t)}}if(i.predicate(g,c,f)){const e=c.firstChild,t=c.childCount;let s=!1;const n=PagedNodeIndex_l(e,p.pageSize),r=PagedNodeIndex_l(e+t-1,p.pageSize);for(let o=n;o<=r;o++)if(!p.hasPage(o)){i.pageMiss(g,o),s=!0;break}if(!s)for(let i=0;i<t;i++)h.push(e+i),a.push(u)}}}(t,e,s)}}function PagedNodeIndex_l(e,t){return e/t|0}function PagedNodeIndex_c(e,t){return e%t}function PointCloudRendererUtil_t(t){const e=t.renderer,n=e&&e.type,o=e&&t.renderer.toJSON()||null;let r=null,i=!1;"point-cloud-unique-value"===n||"point-cloud-stretch"===n||"point-cloud-class-breaks"===n?r=PointCloudRendererUtil_u(t.attributeStorageInfo,e.field):"point-cloud-rgb"===n?(r=PointCloudRendererUtil_l(t.attributeStorageInfo,e.field),i=null!=r):(r=PointCloudRendererUtil_l(t.attributeStorageInfo,"RGB"),i=null!=r);let a=null;return e&&e.colorModulation&&(a=PointCloudRendererUtil_u(t.attributeStorageInfo,e.colorModulation.field)),{rendererJSON:o,isRGBRenderer:i,primaryAttribute:r,modulationAttribute:a}}function PointCloudRendererUtil_e(t){const e=t.filters;return e?e.map((e=>({filterJSON:e.toJSON(),attributeInfo:PointCloudRendererUtil_u(t.attributeStorageInfo,e.field)}))):[]}function PointCloudRendererUtil_o(t){const e=t&&t.pointSizeAlgorithm;return e&&"fixed-size"===e.type?e:null}function PointCloudRendererUtil_l(t,e){for(const n of t)if(n.name===e&&null!=n.attributeValues&&"UInt8"===n.attributeValues.valueType&&3===n.attributeValues.valuesPerElement)return{name:e,storageInfo:n,useElevation:!1};return null}function PointCloudRendererUtil_u(t,e){for(const n of t)if(n.name===e){const t="embedded-elevation"===n.encoding;return{name:e,storageInfo:t?null:n,useElevation:t}}return"elevation"===e.toLowerCase()?{name:e,storageInfo:null,useElevation:!0}:null}var PointGraphic_e,PointCloudWorkerUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js");let PointGraphic_p=PointGraphic_e=class extends Graphic.a{constructor(r){super(r)}clone(){return new PointGraphic_e(this.cloneProperties())}cloneProperties(){const{pointCloudMetadata:r}=this;return{...super.cloneProperties(),pointCloudMetadata:r}}};Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],PointGraphic_p.prototype,"pointCloudMetadata",void 0),PointGraphic_p=PointGraphic_e=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.i3s.PointGraphic")],PointGraphic_p);var PooledArray=__webpack_require__("./node_modules/@arcgis/core/core/PooledArray.js"),mat4=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),mat4f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f32.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),vec4=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),ray=__webpack_require__("./node_modules/@arcgis/core/geometry/support/ray.js"),handleUtils=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js"),Object3DStateID=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateID.js");class PointHighlights_h{constructor(e){this.context=e,this.highlights=new Set}get hasHighlights(){return this.highlights.size>0}destroy(){this.highlights=null}add(t){const i=new PointHighlights_s(t);return this.highlights.add(i),this.enableSet(i),Object(handleUtils.b)((()=>this.removeSet(i)))}removeSet(e){this.disableSet(e),this.highlights.delete(e)}enableSet(e){e.enabled||(e.enabled=!0,this.context.forEachNode((t=>this.enableSetForNode(e,t))))}enableSetForNode(e,t){if(!e.enabled)return;const i=e.ids.get(t.id);i&&i.forEach((i=>this.context.addHighlight(t,i,e.id)))}disableSet(e){e.enabled&&(e.enabled=!1,this.context.forEachNode((t=>this.disableSetForNode(e,t))))}disableSetForNode(e,t){e.enabled||this.context.removeHighlight(t,e.id)}nodeAdded(e){this.highlights.forEach((t=>this.enableSetForNode(t,e)))}nodeRemoved(e){this.highlights.forEach((t=>this.disableSetForNode(t,e)))}removeAll(){this.highlights.forEach((e=>this.disableSet(e)))}}class PointHighlights_s{constructor(e){this.id=new Object3DStateID.a(0),this.ids=new Map,this.enabled=!1;for(const i of e)Object(maybe.l)(i)&&this.add(i.nodeId,i.pointId)}add(e,t){const i=this.ids.get(e);i?i.add(t):this.ids.set(e,new Set([t]))}}var Slice_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js"),OutputHighlight_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js"),DefaultVertexAttributeLocations=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations.js"),Intersector=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Intersector.js"),ReloadableShaderModule=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule.js"),ShaderTechnique=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique.js"),ShaderTechniqueConfiguration=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration.js"),Program=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Program.js"),StencilUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/StencilUtils.js"),PointRenderer_glsl=__webpack_require__("./node_modules/@arcgis/core/chunks/PointRenderer.glsl.js"),renderState=__webpack_require__("./node_modules/@arcgis/core/views/webgl/renderState.js");class PointRendererTechnique_h extends ShaderTechnique.a{constructor(e,r,t){super(e,r,t)}initializeProgram(e){const r=PointRendererTechnique_h.shader.get(),t=this.configuration,i=r.build({output:t.output,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:t.drawScreenSize});return new Program.a(e.rctx,i,DefaultVertexAttributeLocations.a)}initializePipeline(){return Object(renderState.g)({depthTest:{func:513},depthWrite:renderState.e,colorWrite:renderState.d,stencilWrite:this.configuration.sceneHasOcludees?StencilUtils.j:null,stencilTest:this.configuration.sceneHasOcludees?StencilUtils.e:null})}}PointRendererTechnique_h.shader=new ReloadableShaderModule.a(PointRenderer_glsl.a,(()=>__webpack_require__.e(238).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/PointRenderer.glsl.js"))));class PointRendererTechnique_m extends ShaderTechniqueConfiguration.a{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.drawScreenSize=!1,this.sceneHasOcludees=!1}}Object(tslib_es6.a)([Object(ShaderTechniqueConfiguration.b)({count:8})],PointRendererTechnique_m.prototype,"output",void 0),Object(tslib_es6.a)([Object(ShaderTechniqueConfiguration.b)()],PointRendererTechnique_m.prototype,"slicePlaneEnabled",void 0),Object(tslib_es6.a)([Object(ShaderTechniqueConfiguration.b)()],PointRendererTechnique_m.prototype,"drawScreenSize",void 0),Object(tslib_es6.a)([Object(ShaderTechniqueConfiguration.b)()],PointRendererTechnique_m.prototype,"sceneHasOcludees",void 0);var BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js");const T={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};class PointRenderer_W{constructor(e){this._params=e,this.type=5,this.isGround=!1,this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null},this._highlights=new PointHighlights_h({forEachNode:e=>this.forEachNode(e),addHighlight:(e,i,t)=>this.addHighlight(e,i,t),removeHighlight:(e,i)=>this.removeHighlight(e,i)}),this.canRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=Object(aaBoundingBox.h)(aaBoundingBox.b),this._techniqueConfig=new PointRendererTechnique_m,this.tempMatrix4=Object(mat4f32.a)(),this.tempVec3=Object(vec3f32.c)(),this.nodes=new PooledArray.a}get needsHighlight(){return this._highlights.hasHighlights}initializeRenderContext(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRep,e.requestRender()}uninitializeRenderContext(){}intersect(e,i,t,s){const r=Object(vec3f64.f)(),n=Object(vec3f64.f)(),o=Object(vec3f64.f)(),h=Object(vec3f64.f)(),a=Object(plane.d)(),g=e.camera.perScreenPixelRatio/2,f=e.camera.near,z=this._getSizeParams();Object(vec3.l)(n,s,t);const R=1/Object(vec3.r)(n);Object(vec3.g)(n,n,R),Object(vec3.u)(o,n),Object(vec4.l)(a,n[0],n[1],n[2],-Object(vec3.j)(n,t));class y{constructor(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=""}}const M=new y,A=new y,U=[],C=Object(aaBoundingBox.h)(),B=Object(aaBoundingBox.h)(this._clipBox);Object(aaBoundingBox.z)(B,-t[0],-t[1],-t[2],B),this.nodes.forAll((c=>{const d=c.splatSize*this._scaleFactor;let u=Object(orientedBoundingBox.j)(c.obb,a),_=Object(orientedBoundingBox.i)(c.obb,a);u-=D(d,u+f,z,g,c.isLeaf),_-=D(d,_+f,z,g,c.isLeaf);const x=_<0,S=null!=M.dist&&null!=A.dist&&M.dist<u*R&&A.dist>_*R;if(x||S)return;const q=I(d,_+f,z,g,c.isLeaf);if(!Object(orientedBoundingBox.f)(c.obb,t,n,q))return;const v=q*q;Object(orientedBoundingBox.n)(c.obb,C),Object(aaBoundingBox.z)(C,-t[0],-t[1],-t[2],C);const E=!Object(aaBoundingBox.f)(B,C);Object(vec3.l)(h,c.origin,t);const L=c.coordinates.length/3;for(let a=0;a<L;a++){if(r[0]=h[0]+c.coordinates[3*a],r[1]=h[1]+c.coordinates[3*a+1],r[2]=h[2]+c.coordinates[3*a+2],E&&!Object(aaBoundingBox.g)(B,r))continue;const l=Object(vec3.j)(r,n),u=Object(vec3.v)(r)-l*l;if(u>v)continue;let _=l+f;const x=D(d,_,z,g,c.isLeaf);if(l-x<0)continue;_-=x;const S=I(d,_,z,g,c.isLeaf);if(u>S*S)continue;const b=(l-x)*R,P=e=>{e.point=G(c,a,e.point),e.dist=b,e.normal=o,e.node=c,e.pointId=a,e.layerUid=this.layerUid};if((null==M.dist||b<M.dist)&&(null==i||i(t,s,b))&&P(M),0!==e.options.store&&(null==A.dist||b>A.dist)&&(null==i||i(t,s,b))&&P(A),2===e.options.store&&(null==i||i(t,s,b))){const e=new y;P(e),U.push(e)}}}));const L=e=>{const{layerUid:i,node:t,pointId:s}=e;return{point:e.point,layerUid:i,graphicUid:s,createGraphic:()=>this._params.createGraphic(t,s,e.point)}},N=(e,i)=>{const t=L(i);e.set(this.type,t,i.dist,i.normal)};if(null!=M.dist){const i=e.results.min;(null==i.dist||M.dist<i.dist)&&N(i,M)}if(null!=A.dist&&0!==e.options.store){const i=e.results.max;(null==i.dist||A.dist>i.dist)&&N(i,A)}if(2===e.options.store){const i=Object(ray.f)(t,s);for(const t of U){const s=Object(Intersector.c)(i);N(s,t),e.results.all.push(s)}}}render(e){if(0===this.nodes.length||0!==e.pass&&2!==e.pass&&5!==e.pass)return!1;const i=this._getSizeParams(),t=this.selectTechnique(e,i),s=t.program;if(null==s)return!1;this.nodes.forAll((i=>{null==i.vao&&this._initNode(e,i)}));const r=e.rctx;r.useProgram(s),t.bindPipelineState(r);const a=this._clipBox,l=!Object(aaBoundingBox.l)(a,aaBoundingBox.b,((e,i)=>e===i));l||(Object(vec3.y)(this.tempVec3,-1/0,-1/0,-1/0),s.setUniform3fv("uClipMin",this.tempVec3),Object(vec3.y)(this.tempVec3,1/0,1/0,1/0),s.setUniform3fv("uClipMax",this.tempVec3)),s.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),2===e.pass&&s.setUniform2f("nearFar",e.camera.near,e.camera.far),e.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=e.highlightDepthTexture,Object(OutputHighlight_glsl.b)(s,this._bindParameters));const c=e.camera.pixelRatio;i.drawFixedSize&&s.setUniform2f("uPointScale",i.fixedSize*c,e.camera.fullHeight);const d=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null;return this.nodes.forAll((u=>{if(0===u.coordinates.length||e.isHighlightPass&&!u.highlights)return;if(s.setUniform2f("uScreenMinMaxSize",i.screenMinSize*c,k(u.isLeaf)*c),!i.drawFixedSize){const i=u.splatSize*this._scaleFactor;s.setUniform2f("uPointScale",i*c,e.camera.fullHeight/c)}const m=u.origin;l&&(Object(vec3.y)(this.tempVec3,a[0]-m[0],a[1]-m[1],a[2]-m[2]),s.setUniform3fv("uClipMin",this.tempVec3),Object(vec3.y)(this.tempVec3,a[3]-m[0],a[4]-m[1],a[5]-m[2]),s.setUniform3fv("uClipMax",this.tempVec3)),Object(mat4.i)(this.tempMatrix4),Object(mat4.a)(this.tempMatrix4,this.tempMatrix4,m),Object(mat4.m)(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),s.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),Object(Slice_glsl.b)(s,t.configuration,d,m),r.bindVAO(u.vao),e.isHighlightPass?this._renderHighlightFragments(r,u):r.drawArrays(0,0,u.coordinates.length/3)})),!0}_renderHighlightFragments(t,s){const r=s.highlights;if(Object(maybe.k)(r))return;let n=Object(maybe.u)(r[0].component),o=n+1;for(let e=1;e<r.length;e++){const s=Object(maybe.u)(r[e].component);if(s!==o){const e=o-n;e>0&&t.drawArrays(0,n,e),n=s}o=s+1}const h=o-n;h>0&&t.drawArrays(0,n,h)}set useFixedSizes(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())}get useFixedSizes(){return this._useFixedSizes}set scaleFactor(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())}get scaleFactor(){return this._scaleFactor}set minSizePx(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())}get minSizePx(){return this._minSizePx}set useRealWorldSymbolSizes(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())}get useRealWorldSymbolSizes(){return this._useRealWorldSymbolSizes}set size(e){this._size!==e&&(this._size=e,this._requestRender())}get size(){return this._size}set sizePx(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())}get sizePx(){return this._sizePx}set clippingBox(e){Object(aaBoundingBox.B)(this._clipBox,e||aaBoundingBox.b)}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}addNode(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}removeNode(e){let i=null;return this.nodes.filterInPlace((s=>s.id!==e||(i=s,s.vao=Object(maybe.f)(s.vao),this._highlights.nodeRemoved(s),!1))),this._requestRender(),i}forEachNode(e){this.nodes.forAll(e)}removeAll(){this.nodes.forAll((e=>e.vao=Object(maybe.f)(e.vao))),this._highlights.removeAll(),this.nodes.clear(),this._requestRender()}highlight(e){return this._highlights.add(e)}addHighlight(e,i,t){e.highlights=function K(i,t,s){Object(maybe.k)(i)&&(i=[]);const r={component:t,id:s};i.push(r);const n=J(r);let o=i.length-1;for(;o>0&&n<J(i[o-1]);)[i[o-1],i[o]]=[i[o],i[o-1]],--o;return i}(e.highlights,i,t),this._requestRender()}removeHighlight(e,i){e.highlights=function Q(i,t){if(Object(maybe.k)(i))return i;const s=i.filter((e=>e.id!==t));return 0===s.length?null:s}(e.highlights,i),this._requestRender()}_initNode(e,i){const t=e.rctx;i.vao=new VertexArrayObject.a(t,DefaultVertexAttributeLocations.a,T,{positions:BufferObject.a.createVertex(t,35044,i.coordinates),colors:BufferObject.a.createVertex(t,35044,i.rgb)})}_requestRender(){this._context&&this._context.requestRender()}_getSizeParams(){const e=this._useFixedSizes,i=e&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:i,drawFixedSize:e,fixedSize:i?this._sizePx:this._size,screenMinSize:e?0:this._minSizePx}}selectTechnique(e,i){return this._techniqueConfig.drawScreenSize=i.drawScreenSpace,this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled,this._techniqueConfig.sceneHasOcludees=e.hasOccludees,this._techniqueConfig.output=2===e.pass?1:5===e.pass?4:0,this._techniqueRep.releaseAndAcquire(PointRendererTechnique_h,this._techniqueConfig,this._technique)}}function k(e){return e?256:64}function I(e,i,t,s,r){if(t.drawScreenSpace)return t.fixedSize*i*s;const n=k(r)*i*s;return t.drawFixedSize?Math.min(t.fixedSize/2,n):t.screenMinSize>0?Math.min(Math.max(t.screenMinSize*i*s,e/2),n):Math.min(e/2,n)}function D(e,i,t,s,r){return t.drawScreenSpace?0:I(e,i,t,s,r)}function G(e,i,t){return null==t&&(t=Object(vec3f64.f)()),t[0]=e.origin[0]+e.coordinates[3*i],t[1]=e.origin[1]+e.coordinates[3*i+1],t[2]=e.origin[2]+e.coordinates[3*i+2],t}function J(e){return Object(maybe.l)(e.component)?e.component:-1}(PointRenderer_W||(PointRenderer_W={})).isInstanceOfNode=function i(e){return e.hasOwnProperty("splatSize")};var PopupSceneLayerView=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js"),extentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/extentUtils.js"),updatingProperties=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/updatingProperties.js"),LayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"),layerViewUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/layerViewUtils.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");const ne=Logger.a.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),de=Object(plane.d)();let le=class extends(Object(PopupSceneLayerView.a)(Object(LayerView3D.a)(LayerView.a))){constructor(){super(...arguments),this.type="point-cloud-3d",this.maximumPointCount=4e6,this.slicePlaneEnabled=!1,this._renderer=null,this._rendererAdded=!1,this._renderedNodes=new Set,this._nodeScales=new Map,this._updateViewNeeded=!0,this._lodFactor=1,this._maxLoggedBoxWarnings=5,this._pageMultiplier=1,this._nodeLoadEpoch=0,this._indexQueue=[],this._workQueue=new Array,this._idleQueue=new PromiseQueue.a,this._indexPagesLoading=new Map,this._loadingNodes=new Map,this._recalcWork=!0,this._layerIsVisible=!1,this._codedDomainPopulationPromise=null,this._codedDomainPopulationAbortController=null,this._totalWork=0,this._index=null,this._loadingInitNodePage=!1,this._nodeIdArray=[]}get pointScale(){const e=function PointCloudRendererUtil_n(t){const e=t&&t.pointSizeAlgorithm;return e&&"splat"===e.type?e:null}(this.layer&&this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1}get useRealWorldSymbolSizes(){const e=PointCloudRendererUtil_o(this.layer&&this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes}get pointSize(){const e=PointCloudRendererUtil_o(this.layer&&this.layer.renderer);return e&&null!=e.size?e.size:0}get inverseDensity(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}get availableFields(){const e=PointCloudRendererUtil_t(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);const i=PointCloudRendererUtil_e(this.layer);if(i)for(const r of i)t.add(r.attributeInfo.name);if(this.layer.outFields)for(const r of Object(fieldUtils.u)(this.layer.fieldsIndex,this.layer.outFields))t.add(r);return Array.from(t)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const e=Object(aaBoundingBox.h)(),t=this.view.renderSpatialReference;return Object(extentUtils.a)(this.view.clippingArea,e,t)?e:null}get _elevationOffset(){const e=this.layer&&this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){const t=Object(unitUtils.g)(this.layer.spatialReference),i=Object(unitConversionUtils.a)(e.unit);return Object(maybe.v)(e.offset,0)*i/t}return 0}initialize(){const e=this.view.resourceController;this._worker=new PointCloudWorkerHandle_e((t=>e.schedule(t))),this.addResolvingPromise(this._worker.promise),this._tmpPoint=Object(dehydratedFeatures.j)(0,0,0,this.layer.spatialReference),Object(I3SUtil.c)(this.layer),Object(I3SUtil.b)(this.layer,this.view),this._indexRequester=e.createStreamDataRequester(2),this._dataRequester=e.createStreamDataRequester(3),this._initRenderer();const t=this._initNodePages(),i=this.view.resourceController.memoryController;this._memCache=i.newCache(this.layer.uid),this.updatingHandles.add(this,"_clippingBox",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,"_elevationOffset",(()=>this._elevationOffsetChanged()),2),this.updatingHandles.add(this.layer,"renderer",(()=>this._rendererChanged()),2),this.updatingHandles.add(this.layer,"filters",(()=>this._reload()),2),this.updatingHandles.add(this.layer,"outFields",(()=>this._reload()),2),this.updatingHandles.add(this.layer,"scaleRangeId",(()=>this._setUpdateViewNeeded())),this.updatingHandles.add(this,"clippingArea",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view.state,"contentCamera",(()=>this._setUpdateViewNeeded())),this.handles.add([this.view.basemapTerrain.on("scale-change",(e=>this._scaleUpdateHandler(e))),i.events.on("quality-changed",(()=>this._setUpdateViewNeeded()))]),this.addResolvingPromise(t),this.when((()=>{this.handles.add([e.scheduler.registerTask(Scheduler.b.POINT_CLOUD_LAYER,this),e.scheduler.registerIdleStateCallbacks((()=>this._idleBegin()),(()=>this._idleEnd())),this.updatingHandles.add(this,"suspended",(e=>{e?this._clearNodeState():this._setUpdateViewNeeded()}),2)])}),(()=>{this.updatingHandles.removeAll(),this.handles.removeAll()}))}_setUpdateViewNeeded(){this._updateViewNeeded=!0,this._updateLoading()}destroy(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new PointRenderer_W({createGraphic:(e,t,i)=>this._createGraphic(e,t,i)}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,"_clippingBox",(e=>this._renderer.clippingBox=e),2),this.updatingHandles.add(this,"suspended",(e=>this._setPointsVisible(!e)),2),this.updatingHandles.add(this,"pointScale",(e=>this._renderer.scaleFactor=e),2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,"useRealWorldSymbolSizes",(e=>this._renderer.useRealWorldSymbolSizes=e),2),this.updatingHandles.add(this,"pointSize",(e=>{const t=Object(screenUtils.g)(e);this._renderer.size=e,this._renderer.sizePx=t}),2),this.updatingHandles.add(this,"slicePlaneEnabled",(e=>this._renderer.slicePlaneEnabled=e),2),this.updatingHandles.add(this,"inverseDensity",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,"maximumPointCount",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",(e=>{this._lodFactor=e,this._setUpdateViewNeeded()}),2)}_destroyRenderer(){this._renderer.removeAll(),this._setPointsVisible(!1)}_createGraphic(e,t,i){const r=Object(maybe.l)(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,s=this.view.computeMapPointFromVec3d(i),o=this._createGraphicAttributes(e,r);return new PointGraphic_p({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:r,epoch:this._nodeLoadEpoch},geometry:s,attributes:o,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(e,t){const i={};for(const r of e.attributes)this._encodeGraphicAttribute(r.attributeInfo,r.values,t,i);return i}_encodeGraphicAttribute(e,t,i,r){const s=e.storageInfo&&e.storageInfo.attributeValues,o=s?s.valuesPerElement:1;if(1===o)r[e.name]=t[i];else if("UInt8"===s.valueType&&o<=4){let s=0;const n=i*o;for(let e=n;e<n+o;e++)s=(s<<8)+t[e];r[e.name]=s}else r[e.name]=void 0}_setPointsVisible(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([3],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=function PointCloudRendererUtil_r(t){const e=t&&t.pointSizeAlgorithm;return!(!e||!e.type)&&"fixed-size"===e.type}(this.layer.renderer),this._reload()}_reload(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}_scaleUpdateHandler(e){this.layer.minScale||this.layer.maxScale?Object(projection.n)(e.extent,e.spatialReference,ue,this.layer.spatialReference)&&(this._nodeScales.forEach(((t,i)=>{if(!this._renderedNodes.has(i))return void this._nodeScales.delete(i);const r=this._index.getNode(i);Object(aaBoundingRect.h)(ue,r.obb.center)&&this._nodeScales.set(i,e.scale)})),this._setUpdateViewNeeded()):this._nodeScales.clear()}displayNodes(e){this._workQueue=function LoDUtil_t(e,t,g){for(let n=0;n<t.length;n++)LoDUtil_r[n]=!1,LoDUtil_o[n]=null;for(let r=0;r<e.length;r++)LoDUtil_n[r]=!1,LoDUtil_l[r]=null;for(let n=0;n<t.length;n++){const o=LoDUtil_h(t[n],e,g);o>=0&&(LoDUtil_r[n]=!0,null!=LoDUtil_l[o]?LoDUtil_l[o].push(t[n]):LoDUtil_l[o]=[t[n]])}for(let l=0;l<e.length;l++){const r=LoDUtil_h(e[l],t,g);r>=0&&(LoDUtil_n[l]=!0,null!=LoDUtil_o[r]?LoDUtil_o[r].push(e[l]):LoDUtil_o[r]=[e[l]])}const u=[];for(let r=0;r<e.length;r++)null!=LoDUtil_l[r]||LoDUtil_n[r]||u.push({load:[],remove:[e[r]]});for(let n=0;n<t.length;n++)null!=LoDUtil_o[n]||LoDUtil_r[n]||u.push({load:[t[n]],remove:[]});for(let n=0;n<t.length;n++)null!=LoDUtil_o[n]&&(LoDUtil_o[n].length>1||LoDUtil_o[n][0]!==t[n])&&u.push({load:[t[n]],remove:LoDUtil_o[n]});for(let n=0;n<e.length;n++)null!=LoDUtil_l[n]&&(LoDUtil_l[n].length>1||LoDUtil_l[n][0]!==e[n])&&u.push({load:LoDUtil_l[n],remove:[e[n]]});return u}([...this._renderedNodes],e,this._index),function LoDUtil_g(t,n,l){return t.sort(((t,r)=>{if(0===t.load.length&&0===r.load.length)return 0;if(0===t.load.length)return-1;if(0===r.load.length)return 1;if(0===t.remove.length&&0===r.remove.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return Object(vec3.j)(o,n)-Object(vec3.j)(h,n)}if(0===t.remove.length)return-1;if(0===r.remove.length)return 1;if(1===t.load.length&&1===r.load.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return Object(vec3.j)(o,n)-Object(vec3.j)(h,n)}if(1===t.load.length)return-1;if(1===r.load.length)return 1;{const o=l.getRenderCenter(t.remove[0]),h=l.getRenderCenter(r.remove[0]);return Object(vec3.j)(o,n)-Object(vec3.j)(h,n)}}))}(this._workQueue,this.view.state.contentCamera.viewForward,this._index),function LoDUtil_u(e,t,n){for(let l=0;l<e.length;++l){const r=e[l];r.load.length>t&&1===r.remove.length&&LoDUtil_d(e,r,n)}}(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading(),this._cancelIndexLoading()}_cancelNodeLoading(){const e=new Array;this._loadingNodes.forEach((({abortController:t})=>e.push(t))),this._loadingNodes.clear();for(const t of e)t.abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}_updateQueues(){const e=new Set;this._workQueue.forEach((t=>t.load.forEach((t=>e.add(t)))));const t=new Array,i=new Map;this._loadingNodes.forEach(((r,s)=>{e.has(s)?i.set(s,r):t.push(r)})),this._loadingNodes=i;for(const{abortController:r}of t)r.abort();this._workQueue=this._workQueue.filter((e=>{for(const t of e.load)if(this._loadingNodes.has(t))return this._recalcWork=!0,!1;return!0})),this._totalWork=this._computeWork(),this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[],this._indexPagesLoading.forEach((({abortController:e})=>e.abort())),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++,this._renderedNodes.forEach((e=>this._removeFromRenderer(e))),this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.running}runTask(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;const e=this._isRootNodeVisible();e!==this._layerIsVisible&&(this._layerIsVisible=e,this.notifyChange("suspended")),this._updateLoading()}}else{for(e.run((()=>this._updateWorkQueues()));this._indexQueue.length>0&&e.run((()=>this._processIndexQueue())););this._processWorkQueue(e),this._idleQueue.runTask(e)}}_processIndexQueue(){const e=this._indexQueue.shift(),t=this._loadNodePage(e);return this._indexPagesLoading.set(e,t),t.promise.then((t=>{this._index.addPage(e,t,this._elevationOffset),this._setUpdateViewNeeded()})).then((()=>{this._indexPagesLoading.delete(e)}),(()=>{this._indexPagesLoading.delete(e)})),!0}_processWorkQueue(e){for(;!e.done;){const t=this._scheduleWorkEntry();if(Object(maybe.k)(t))return;this._processWorkEntry(t),e.madeProgress()}}_scheduleWorkEntry(){let e=this._workQueue.length;for(;e--;){const e=this._workQueue.shift();if(!e.remove.find((e=>!this._renderedNodes.has(e))))return e;this._workQueue.push(e)}return null}_processWorkEntry(e){if(0!==e.load.length)Promise.all(e.load.map((e=>{const t=new AbortController,i=this._memCache.pop(e.toString());return Object(maybe.l)(i)?this._loadingNodes.set(e,{abortController:t,promise:Promise.resolve(i)}):this._loadingNodes.has(e)||this._loadingNodes.set(e,{abortController:t,promise:this.loadNode(e,t.signal)}),this._loadingNodes.get(e).promise}))).then((t=>{for(let i=0;i<e.load.length;i++)if(t[i]){const r=this._setupRendererData(e.load[i],t[i]);this._addToRenderer(r)}for(const i of e.remove)this._removeFromRenderer(i)})).catch((()=>{})).then((()=>{for(const t of e.load)this._loadingNodes.delete(t);this._updateLoading(),this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())})),this._updateLoading();else for(const t of e.remove)this._removeFromRenderer(t)}async populateClassCodeCodedDomain(e,i){const r="CLASS_CODE",s=this.layer.fieldsIndex.get(r);if(!s||s.domain)return;if(-1===e.indexOf(s.name))return;const o=await Object(asyncUtils.d)(this.layer.queryCachedStatistics(r,{signal:i}));if(!1===o.ok)return;const n=o.value,a=n&&n.labels&&n.labels.labels;a&&Array.isArray(a)&&(s.domain=new CodedValueDomain.a({name:"CLASS_CODE",codedValues:a.map((e=>new CodedValue.a({code:e.value,name:e.label})))}))}async prepareFetchPopupFeatures(e){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then((()=>{this._codedDomainPopulationAbortController=null}))),this._codedDomainPopulationPromise}async whenGraphicAttributes(e,t){const r=this._splitGraphicsPerNode(e),s=this.layer.attributeStorageInfo,o=t.map((e=>PointCloudRendererUtil_u(s,e))),n=async(e,t)=>{const r=this._index.getNode(t);await Object(asyncUtils.b)(o,(async t=>{const i=t.useElevation?await this._loadElevationAttributeFromGeometry(r.resourceId):await this._loadAndParseAttribute(r,t);if(i)for(const r of e)if(this._isValidPointGraphic(r)){const e=r.pointCloudMetadata.attributePointIndexInNode;this._encodeGraphicAttribute(t,i,e,r.attributes)}}))},a=[];return r.forEach(((e,t)=>{a.push(n(e,t))})),await Object(promiseUtils.j)(a),e}_isValidPointGraphic(e){return e instanceof PointGraphic_p&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(e){const t=new Map;for(const i of e){if(!this._isValidPointGraphic(i))continue;const e=i.pointCloudMetadata,r=t.get(e.nodeId);r?r.push(i):t.set(e.nodeId,[i])}return t}async _loadAndParseAttribute(e,t){const i=await this._loadAttribute(e.resourceId,t,null);return Object(maybe.l)(i)?Object(PointCloudWorkerUtil.d)({attributeInfo:t,buffer:i},null,e.vertexCount):null}async _loadElevationAttributeFromGeometry(e){const t=this.layer.store.defaultGeometrySchema,i=Object(PointCloudWorkerUtil.e)(t,await this._loadGeometry(e,null));return Object(PointCloudWorkerUtil.a)(i,i.length/3)}highlight(e){if(!e)return{remove(){}};const t=Collection.a.isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(t.map((e=>this._graphicToPointDefinition(e))))}_graphicToPointDefinition(e){if(!this._isValidPointGraphic(e))return null;const{nodeId:t,pointIndexInNode:i}=e.pointCloudMetadata;return null!=t&&null!=i?{nodeId:t,pointId:i}:null}_computeWork(){let e=0;for(const t of this._workQueue)e+=t.load.length+t.remove.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,e+=this._loadingInitNodePage?100:0,e+=this._updateViewNeeded?100:0,e}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}_updateLoading(){this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}_initNodePages(){const e=this.layer.store.index,t=e.nodesPerPage||e.nodePerIndexBlock;return this._index=new PagedNodeIndex_h(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,t),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=e.nodesPerPage?1:e.nodePerIndexBlock,this._loadNodePage(0).promise.then((e=>{this._index.addPage(0,e,this._elevationOffset),this._loadingInitNodePage=!1,this._setUpdateViewNeeded()}))}_loadNodePage(e){const t=new AbortController,i=`${this.baseUrl}/nodepages/${e*this._pageMultiplier}`;return{promise:this._requestNodePage(i,t.signal).then((t=>t.nodes.map(((t,i)=>({resourceId:null!=t.resourceId?t.resourceId:e*this._index.pageSize+i,obb:t.obb,firstChild:t.firstChild,childCount:t.childCount,vertexCount:null!=t.vertexCount?t.vertexCount:t.pointCount,lodThreshold:null!=t.lodThreshold?t.lodThreshold:t.effectiveArea}))))),abortController:t}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;let e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(r/(.75*t));for(;r>t;)e*=s,i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(2);return this.displayNodes(i),this._updateViewNeeded=!1,this._updateLoading(),!0}_computePointCount(e){let t=0;for(let i=0;i<e.length;i++){const r=this._index.getNode(e[i]);r&&(t+=r.vertexCount)}return t}_getLodMemoryFactor(){return this.view.resourceController.memoryController.memoryFactor}_isRootNodeVisible(){let e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(t,i,r)=>(e=r,!1),pageMiss:()=>{}}),e}_computeNodesForMinimumDensity(e){const t=this.view.state.contentCamera,i=t.frustum,r=this._clippingBox,s=t.viewForward,o=Object(vec3.j)(s,t.eye),n=Object(plane.f)(s,-o,de),a=t.perScreenPixelRatio/2,d=e*e,l=this._nodeIdArray;l.length=0;const{minScale:h,maxScale:u}=Object(layerViewUtils.a)(this.layer),p=0===h&&0===u?e=>l.push(e):e=>{const t=this._getScale(e);Object(layerViewUtils.d)(t,h,u)&&l.push(e)};return this._traverseVisible({frustum:i,clippingBox:r},{predicate:(e,t,i)=>{if(!i)return!1;if(0===t.childCount)return p(e),!1;const r=this._index.getRenderObb(e);return!(this._computeAveragePixelArea(r,t.lodThreshold,t.vertexCount,n,a)<=d&&(p(e),1))},pageMiss:(e,t)=>{p(e),this._indexQueue.indexOf(t)<0&&this._indexQueue.push(t)}}),l}_getScale(e){let t=this._nodeScales.get(e);if(null==t){const i=this._index.getNode(e).obb.center;this._tmpPoint.x=i[0],this._tmpPoint.y=i[1],this._tmpPoint.z=i[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}_computeAveragePixelArea(e,t,i,r,s){const n=Math.max(1e-7,Object(orientedBoundingBox.j)(e,r));return t/(n*n)/(4*s*s)/i}loadNode(e,t){try{return this.loadNodeAsync(e,t)}catch(i){throw Object(promiseUtils.m)(i)||ne.error(i),i}}async loadAdditionalUserAttributes(e,t,i){const r=this.layer.outFields;if(!r)return[];const s=Object(fieldUtils.u)(this.layer.fieldsIndex,r),o=new Set(e.map((e=>Object(maybe.l)(e)?e.name:null))),a=this.layer.attributeStorageInfo,l=[];for(const n of s){if(o.has(n))continue;const e=PointCloudRendererUtil_u(a,n);e&&l.push(t(e))}const h=await Object(promiseUtils.k)(l);return Object(promiseUtils.w)(i),Object(maybe.p)(h,(e=>e))}async loadNodeAsync(e,t){const i=this._index.getNode(e),r=PointCloudRendererUtil_t(this.layer),s=PointCloudRendererUtil_e(this.layer),o=i.resourceId,d=async e=>{if(Object(maybe.k)(e))return null;if(e.useElevation)return{attributeInfo:e,buffer:null};const i=await this._loadAttribute(o,e,t);return Object(maybe.l)(i)?{attributeInfo:e,buffer:i}:null};return this._idleQueue.push((async()=>{const i=this._loadGeometry(o,t),{primaryAttribute:n,modulationAttribute:a}=r,l=d(n),h=d(a),u=s.map((e=>e.attributeInfo)),c=u.map((e=>d(e))),_=this.loadAdditionalUserAttributes([n,a,...u],d,t),[m,g,f,y,b]=await Promise.all([i,l,h,Promise.all(c),_]);Object(promiseUtils.w)(t);const w={geometryBuffer:m,primaryAttributeData:g,modulationAttributeData:f,filterAttributesData:y,userAttributesData:b,schema:this.layer.store.defaultGeometrySchema,rendererInfo:r,filterInfo:s,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(w,t)}),t)}async _loadGeometry(e,t){return this._requestData(`${this.baseUrl}/nodes/${e}/geometries/0`,t)}async _loadAttribute(e,t,i){if(Object(maybe.k)(t)||!t.storageInfo)return null;const r=t.storageInfo.key;return this._requestData(`${this.baseUrl}/nodes/${e}/attributes/${r}`,i)}_requestNodePage(e,t){const i={f:"json",token:this.layer.apiKey};return this._indexRequester.request(e,"json",{query:i,signal:t})}_requestData(e,t){return this._dataRequester.request(e,"binary",{query:{token:this.layer.apiKey},signal:t})}_removeFromRenderer(e){if(this._renderedNodes.has(e)){const t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,function he(e){return 5*e.coordinates.length+128}(t))}}_addToRenderer(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}_setupRendererData(e,t){const i=this._index.getNode(e),r=Math.sqrt(i.lodThreshold/i.vertexCount),s=this._index.getRenderObb(e);if(PointRenderer_W.isInstanceOfNode(t))return t.splatSize=r,t.obb=s,t.origin=Object(vec3f32.a)(t.obb.center),t;const o=.01*Math.max(s.halfSize[0],s.halfSize[1],s.halfSize[2]);if(t.obb.halfSize[0]>s.halfSize[0]+o||t.obb.halfSize[1]>s.halfSize[1]+o||t.obb.halfSize[2]>s.halfSize[2]+o){if(this._maxLoggedBoxWarnings>0){const i=e=>`[${e.halfSize[0]}, ${e.halfSize[1]}, ${e.halfSize[2]}]`;ne.warn(`Node ${e} reported bounding box too small. got ${i(s)} but points cover ${i(t.obb)}`),0==--this._maxLoggedBoxWarnings&&ne.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:Object(vec3f32.a)(s.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:r,obb:s,isLeaf:0===i.childCount}}getUsedMemory(){let e=0;return this._renderer.forEachNode((t=>{e+=pe,e+=Object(typedArrayUtil.a)(t.coordinates);for(const i of t.attributes){const t=i.values;Object(typedArrayUtil.c)(t.buffer)&&(e+=Object(typedArrayUtil.a)(t))}})),e}getUnloadedMemory(){const e=this._renderedNodes.size;if(e<4)return 0;const t=[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount));let i=this._loadingNodes.size;for(let r=0;r<this._workQueue.length;r++)i+=this._workQueue[r].load.length,i-=this._workQueue[r].remove.length;return i<0?0:i*t/e*((this.getUsedMemory()-e*pe)/t)+i*pe}ignoresMemoryFactor(){return!1}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount),0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};Object(tslib_es6.a)([Object(property.b)()],le.prototype,"layer",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],le.prototype,"baseUrl",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"pointScale",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"useRealWorldSymbolSizes",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"pointSize",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"inverseDensity",null),Object(tslib_es6.a)([Object(property.b)()],le.prototype,"maximumPointCount",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"availableFields",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"_clippingBox",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"_elevationOffset",null),Object(tslib_es6.a)([Object(property.b)({type:Boolean})],le.prototype,"slicePlaneEnabled",void 0),Object(tslib_es6.a)([Object(property.b)()],le.prototype,"updating",void 0),Object(tslib_es6.a)([Object(property.b)(updatingProperties.a)],le.prototype,"updatingProgress",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],le.prototype,"updatingProgressValue",null),le=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.PointCloudLayerView3D")],le);const ue=Object(aaBoundingRect.l)(),pe=160,ce=le},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SProjectionUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return a})),__webpack_require__.d(__webpack_exports__,"b",(function(){return h}));var _chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js");function a(o,n,a,s){const c=h(o,n,a),i=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_0__.d)();return Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_2__.d)(a,c,i,s),i}function h(t,r,a){const h=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_1__.f)(),i=t[3],e=2**(4*Math.ceil(Math.log(i)*Math.LOG2E/4)+1);if(a.isGeographic){const o=e/Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_3__.e)(a).radius*180/Math.PI,r=Math.round(t[1]/o),s=Math.max(-90,Math.min(90,r*o)),c=o/Math.cos((Math.abs(s)-o/2)/180*Math.PI),i=Math.round(t[0]/c)*c;h[0]=i,h[1]=s}else{const o=Math.round(t[0]/e),r=Math.round(t[1]/e);h[0]=o*e,h[1]=r*e}const M=t[2]+r,m=Math.round(M/e);return h[2]=m*e,h}},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Ie})),__webpack_require__.d(__webpack_exports__,"b",(function(){return Re})),__webpack_require__.d(__webpack_exports__,"c",(function(){return qe})),__webpack_require__.d(__webpack_exports__,"d",(function(){return xe})),__webpack_require__.d(__webpack_exports__,"e",(function(){return Me})),__webpack_require__.d(__webpack_exports__,"f",(function(){return ge})),__webpack_require__.d(__webpack_exports__,"g",(function(){return Se})),__webpack_require__.d(__webpack_exports__,"h",(function(){return Ze})),__webpack_require__.d(__webpack_exports__,"i",(function(){return X})),__webpack_require__.d(__webpack_exports__,"j",(function(){return _})),__webpack_require__.d(__webpack_exports__,"k",(function(){return se})),__webpack_require__.d(__webpack_exports__,"l",(function(){return Y})),__webpack_require__.d(__webpack_exports__,"m",(function(){return be})),__webpack_require__.d(__webpack_exports__,"n",(function(){return he})),__webpack_require__.d(__webpack_exports__,"o",(function(){return re})),__webpack_require__.d(__webpack_exports__,"p",(function(){return de})),__webpack_require__.d(__webpack_exports__,"q",(function(){return Ae})),__webpack_require__.d(__webpack_exports__,"r",(function(){return ye})),__webpack_require__.d(__webpack_exports__,"s",(function(){return ne})),__webpack_require__.d(__webpack_exports__,"t",(function(){return ee})),__webpack_require__.d(__webpack_exports__,"u",(function(){return We})),__webpack_require__.d(__webpack_exports__,"v",(function(){return Ce})),__webpack_require__.d(__webpack_exports__,"w",(function(){return ze})),__webpack_require__.d(__webpack_exports__,"x",(function(){return ie}));var _request_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/request.js"),_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f64.js"),_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js"),_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/chunks/quatf32.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js"),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_rest_support_Query_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js"),_I3SProjectionUtil_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SProjectionUtil.js"),_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/edgeUtils.js"),_support_symbolColorUtils_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/symbolColorUtils.js"),_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js");function V(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function X(e){if(Object(_core_has_js__WEBPACK_IMPORTED_MODULE_3__.a)("disable-feature:i3s-draco")||!e)return!1;for(const r of e)for(const e of r.geometryBuffers){var t;if("draco"===(null==(t=e.compressedAttributes)?void 0:t.encoding))return!0}return!1}function Y(e,t,r,o,n,a){n.traverse(r,(r=>{let n=r.mbs;t!==o&&(n=oe,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.o)(r.mbs,o,n,t));const s=ne(e,n);return 0!==s&&(a(r,s),!0)}))}function _(e,t,r){let o=0,n=0;for(let a=0;a<t.length&&o<e.length;a++)e[o]===t[a]&&(r(a)&&(e[n]=e[o],n++),o++);e.length=n}function ee(e,r,o){let n=0,a=0;for(;n<o.length;)Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.b)(e,o[n])>=0===r&&(o[a]=o[n],a++),n++;o.length=a}const te=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)();function re(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return te[0]=(e[0]-t.position[0])/t.rotationScale[0],te[1]=(e[1]-t.position[1])/t.rotationScale[4],te[2]=(e[2]-t.position[0])/t.rotationScale[0],te[3]=(e[3]-t.position[1])/t.rotationScale[4],te}const oe=Object(_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_15__.e)();function ne(e,t){const r=t[0],o=t[1],n=t[3],a=e[0]-r,s=r-e[2],i=e[1]-o,c=o-e[3],l=Math.max(a,s,0),f=Math.max(i,c,0),u=l*l+f*f;return u>n*n?0:u>0?1:-Math.max(a,s,i,c)>n?3:2}function se(e,t,r){const o=[],n=r&&r.missingFields,a=r&&r.originalFields;for(const s of e){const e=s.toLowerCase();let r=!1;for(const n of t)if(e===n.name.toLowerCase()){o.push(n.name),r=!0,a&&a.push(s);break}!r&&n&&n.push(s)}return o}async function ie(e,t,o,a,c){if(0===t.length)return[];const l=e.attributeStorageInfo;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e.associatedLayer))try{return await async function le(e,t,r,o){t.sort(((e,t)=>e.attributes[r]-t.attributes[r]));const n=t.map((e=>e.attributes[r])),a=[],s=se(o,e.fields,{originalFields:a}),i=await fe(e,n,s);for(let c=0;c<t.length;c++){const e=t[c],r=i[c],o={};if(e.attributes)for(const t in e.attributes)o[t]=e.attributes[t];for(let t=0;t<a.length;t++)o[a[t]]=r[s[t]];e.attributes=o}return t}(e.associatedLayer,t,o,a)}catch(f){if(e.associatedLayer.loaded)throw f}if(l){const s=function ce(e,t,r){const o=new Map,n=[],a=r();for(const s of e){const e=s.attributes[t];for(let t=0;t<a.length;t++){const r=a[t],i=r.featureIds.indexOf(e);if(i>=0){let e=o.get(r.node);e||(e={node:r.node,indices:[],graphics:[]},n.push(e),o.set(r.node,e)),e.indices.push(i),e.graphics.push(s);for(let r=t;r>0;r--)a[r]=a[r-1];a[0]=r;break}}}return n}(t,o,c);if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(s))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const f=e.parsedUrl.path,u=await Promise.all(s.map((e=>function ue(t,r,o,n,a){const s=[];for(const e of r)if(e&&-1!==a.indexOf(e.name)){const r=`${t}/nodes/${o.resources.attributes}/attributes/${e.key}/0`;s.push({url:r,storageInfo:e})}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.j)(s.map((t=>Object(_request_js__WEBPACK_IMPORTED_MODULE_0__.default)(t.url,{responseType:"array-buffer"}).then((e=>Object(_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_22__.d)(t.storageInfo,e.data)))))).then((e=>{const t=[];for(const r of n){const o={};for(let t=0;t<e.length;t++)null!=e[t].value&&(o[s[t].storageInfo.name]=he(e[t].value,r));t.push(o)}return t}))}(f,l,e.node,e.indices,a).then((t=>{for(let r=0;r<e.graphics.length;r++){const o=e.graphics[r],n=t[r];if(o.attributes)for(const e in o.attributes)e in n||(n[e]=o.attributes[e]);o.attributes=n}return e.graphics})))));return Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.f)(u)}throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function fe(e,t,a){const s=e.capabilities.query.maxRecordCount;if(null!=s&&t.length>s){const n=Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.n)(t,s);return Promise.all(n.map((t=>fe(e,t,a)))).then(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.f)}const i=new _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_21__.a({objectIds:t,outFields:a,orderByFields:[e.objectIdField]});return e.queryFeatures(i).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}function he(e,t){if(!e)return null;const r=e[t];return Object(_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__.f)(e)?-32768===r?null:r:Object(_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__.g)(e)?-2147483648===r?null:r:r!=r?null:r}function de(e){const t=e.store.indexCRS||e.store.geographicCRS,r=void 0===t?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const o=t?new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__.a(V(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function ye(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=void 0===t?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const o=t?new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__.a(V(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function be(e,t){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(t)?"@null":t===Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function ge(e,t,r){if(!Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.b)(e,t))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&!function we(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}(e,t))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Se(e,t,r){const o=de(e),n=ye(e);ge(o,t,r),ge(n,t,r)}function Me(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function ve(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function xe(e,t){Se(e,t.spatialReference,t.viewingMode)}function qe(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function je(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Re(e,t){ge(e.spatialReference,t.spatialReference,t.viewingMode)}function Te(e){return"mesh-3d"===e.type}function We(e){if(null==e||!function ke(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const r of t){if(!Te(r)||0===r.symbolLayers.length)return!0;for(const e of r.symbolLayers.items)if("fill"!==e.type||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e.material)||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e.material.color)||"replace"!==e.material.colorMixMode)return!0}return!1}const ze=Object(_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__.c)({color:[0,0,0,0],opacity:0});class Fe{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Ae(e){const t=new Fe;let r=!1,o=!1;for(const n of e.symbolLayers.items)if("fill"===n.type&&n.enabled){const e=n.material,a=n.edges;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)&&!r){const o=e.color,a=Object(_support_symbolColorUtils_js__WEBPACK_IMPORTED_MODULE_25__.b)(e.colorMixMode);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(o)?t.material={color:[o.r/255,o.g/255,o.b/255],alpha:o.a,colorMixMode:a}:t.material={color:[1,1,1],alpha:1,colorMixMode:1},t.castShadows=n.castShadows,r=!0}Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(a)&&!o&&(t.edgeMaterial=Object(_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__.b)(a,{}),o=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:1}),t}function Ie(e,t){return(0|e)+(0|t)|0}function Ce(e,t,r,o,n=0){o===Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(o)?t.isGeographic?function Qe(e,t,r,o){const n=Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.e)(r),a=1+Math.max(0,o)/(n.radius+e.center[2]);Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,e.center[0],e.center[1],e.center[2]+o),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(t.center,r,0,t.center,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r),0,1),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.a)(t.quaternion,e.quaternion),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.b)(He,e.quaternion),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(Ye,0,0,1),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.w)(Ye,Ye,He),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(Ye,e.halfSize[0]*Math.abs(Ye[0]),e.halfSize[1]*Math.abs(Ye[1]),e.halfSize[2]*Math.abs(Ye[2])),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.g)(Ye,Ye,n.inverseFlattening),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.h)(t.halfSize,e.halfSize,Ye),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.g)(t.halfSize,t.halfSize,a)}(e,r,t,n):function $e(e,t,r,o){Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.d)(e,Je),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,e.center[0],e.center[1],e.center[2]+o),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.d)(r,t.center,De,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r)),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,De[12],De[13],De[14]);const n=2*Math.sqrt(1+De[0]+De[5]+De[10]);He[0]=(De[6]-De[9])/n,He[1]=(De[8]-De[2])/n,He[2]=(De[1]-De[4])/n,He[3]=.25*n,Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.g)(t.quaternion,He,e.quaternion),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.b)(He,t.quaternion);let a=0,s=0,i=0;for(const c of Je)c[2]+=o,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(c,r,0,c,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r),0,1),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.B)(Ye,c,t.center),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.w)(Ye,Ye,He),a=Math.max(a,Math.abs(Ye[0])),s=Math.max(s,Math.abs(Ye[1])),i=Math.max(i,Math.abs(Ye[2]));Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.halfSize,a,s,i)}(e,r,t,n):t.isWGS84&&(o.isWebMercator||Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__.k)(o))?function Ue(e,t,r,o,n){Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(Be,t.center),Be[2]+=n;const a=Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r);Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(Be,e,0,Be,a,0,1),Pe(a,t,Be,r,o)}(t,e,o,r,n):t.isWebMercator&&Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__.k)(o)?function Oe(e,t,r,o,n){Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(Be,t.center),Be[2]+=n,Pe(e,t,Be,r,o)}(t,e,o,r,n):e===r?(r.center[2]+=n,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(r.center,t,0,r.center,o,0,1)):(Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(r.center,e.center[0],e.center[1],e.center[2]+n),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(r.center,t,0,r.center,o,0,1),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.a)(r.quaternion,e.quaternion),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(r.halfSize,e.halfSize))}const Ge=new Float64Array(24),Ke={data:Ge,size:3},Le=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__.f)(),Be=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__.f)(),Ee=Object(_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_8__.b)();function Pe(e,t,r,o,n){const a=Object(_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_7__.h)(Ee,t.quaternion);for(let s=0;s<8;++s){for(let e=0;e<3;++e)Le[e]=t.halfSize[e]*(0!=(s&1<<e)?-1:1);for(let e=0;e<3;++e){let t=r[e];for(let r=0;r<3;++r)t+=Le[r]*a[3*r+e];Ge[3*s+e]=t}}Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(Ge,e,0,Ge,o,0,8),Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.c)(Ke,n)}function Ze(e,t,r,o,n,a){if(!a||0===a.length||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(t))return null;const c=Object(_I3SProjectionUtil_js__WEBPACK_IMPORTED_MODULE_23__.a)(e.mbs,n,r,t);let l;Object(_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_9__.b)(et,c);const f=()=>{if(!l)if(l=Je,Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.n)(Ve),Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e.serviceObb)){Ce(e.serviceObb,r,Xe,t,n),Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.d)(Xe,l);for(const e of l)Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(e,e,et),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ve,e)}else{const o=e.mbs,a=o[3];Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.y)(o,r,Ye,t),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,Ye,et),Ye[2]+=n;for(let e=0;e<8;++e){const t=1&e?a:-a,r=2&e?a:-a,o=4&e?a:-a,n=l[e];Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(n,[Ye[0]+t,Ye[1]+r,Ye[2]+o]),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ve,n)}}};let u=1/0,p=-1/0;if(a.forEach((e=>(e=>{if("replace"!==e.type)return;const r=e.geometry;if(!r.hasZ)return;Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.n)(Ne);const n=r.spatialReference||o,a=r.rings.reduce(((e,r)=>r.reduce(((e,r)=>(Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.y)(r,n,Ye,t),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,Ye,et),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ne,Ye),Math.min(Ye[2],e))),e)),1/0);f(),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.w)(Ve,Ne)&&(u=Math.min(u,a),p=Math.max(p,a))})(e))),u===1/0)return null;const d=(e,t,r)=>{Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2],t+=24,r[2]=u,Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2],t+=24,r[2]=p,Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2]};for(let s=0;s<8;++s)d(_e.data,3*s,l[s]);return Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.c)(_e)}const De=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__.d)(),He=Object(_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_12__.b)(),Je=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ne=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)(),Ve=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)(),Xe=Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.e)(),Ye=[0,0,0],_e={data:new Array(72),size:3},et=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__.d)()},"./node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return c}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/set.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js");const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;return t?Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.a)(s,e)?void 0:new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s}):new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);const c=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(r)?r.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const u="scene"===this.layer.type&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,n=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.u)(this.layer.fieldsIndex,await Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.b)(u,Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.a)(this.layer,r)));await this.prepareFetchPopupFeatures(n);const l=new Set,h=[],y=[];for(const s of c)Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.s)(n,s,l)?y.push(s):h.push(s);return 0===y.length?Promise.resolve(h):this.whenGraphicAttributes(y,[...l]).catch((()=>y)).then((e=>h.concat(e)))}};return u=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.a)("esri.views.3d.layers.support.PopupSceneLayerView")],u),u}},"./node_modules/@arcgis/core/views/layers/support/popupUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return d})),__webpack_require__.d(__webpack_exports__,"b",(function(){return t}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");async function t(t,d=t.popupTemplate){if(!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes("*"))return["*"];const f=n?await Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.n)(t):[],r=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.j)(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(l)&&l.defaultPopupTemplateEnabled&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}}}]);