(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{"./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return h}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),_chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js"),_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/quatf32.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js");class p{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)"buffer"in t.values&&Object(_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__.c)(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.e)(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],s=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.d)(r.primaryAttributeData,e,a);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(r.primaryAttributeData)&&s&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:s});const i=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.d)(r.modulationAttributeData,e,a);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(r.modulationAttributeData)&&i&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:i});let p=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.b)(r.rendererInfo,s,i,a);if(r.filterInfo&&r.filterInfo.length>0&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(r.filterAttributesData)){const t=r.filterAttributesData.map((t=>{const r=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.d)(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.c)(e,p,o,r.filterInfo,t)}for(const t of r.userAttributesData){const r=Object(_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.d)(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<p.length&&(p=new Uint8Array(p.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const c=this._transformCoordinates(e,a,r.obb,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_7__.a.fromJSON(r.inSR),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_7__.a.fromJSON(r.outSR));return{obb:r.obb,points:c,rgb:p,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,n,u){if(!Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_6__.p)(t,n,0,t,u,0,r))throw Error("Can't reproject");const l=Object(_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.d)(a.center[0],a.center[1],a.center[2]),b=Object(_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)(),m=Object(_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)();Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__.b)(c,a.quaternion);const p=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__.w)(m,b,c),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),p[3*e]=b[0],p[3*e+1]=b[1],p[3*e+2]=b[2];return p}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const c=Object(_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_3__.b)();function h(){return new p}}}]);