(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"./node_modules/@arcgis/core/core/CircularArray.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return s}));var _maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js");class s{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const s=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,s}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}find(s){if(0===this.size)return null;for(const e of this._buffer)if(Object(_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(e)&&s(e))return e;return null}clear(s){let e=this.dequeue();for(;Object(_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(e);)s&&s(e),e=this.dequeue()}}},"./node_modules/@arcgis/core/geometry/geometryAdapters/json.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return t}));const t={convertToGEGeometry:function s(t,s){return null==s?null:t.convertJSONToGeometry(s)},exportPoint:function n(t,s,n){const e=new i(t.getPointX(s),t.getPointY(s),n),o=t.hasZ(s),h=t.hasM(s);return o&&(e.z=t.getPointZ(s)),h&&(e.m=t.getPointM(s)),e},exportPolygon:function o(t,s,i){return new e(t.exportPaths(s),i,t.hasZ(s),t.hasM(s))},exportPolyline:function a(t,s,i){return new h(t.exportPaths(s),i,t.hasZ(s),t.hasM(s))},exportMultipoint:function c(t,s,i){return new r(t.exportPoints(s),i,t.hasZ(s),t.hasM(s))},exportExtent:function m(t,s,i){const n=t.hasZ(s),e=t.hasM(s),o=new x(t.getXMin(s),t.getYMin(s),t.getXMax(s),t.getYMax(s),i);if(n){const i=t.getZExtent(s);o.zmin=i.vmin,o.zmax=i.vmax}if(e){const i=t.getMExtent(s);o.mmin=i.vmin,o.mmax=i.vmax}return o}};class i{constructor(t,s,i){this.x=t,this.y=s,this.spatialReference=i,this.z=void 0,this.m=void 0}}class e{constructor(t,s,i,n){this.rings=t,this.spatialReference=s,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class h{constructor(t,s,i,n){this.paths=t,this.spatialReference=s,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class r{constructor(t,s,i,n){this.points=t,this.spatialReference=s,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class x{constructor(t,s,i,n,e){this.xmin=t,this.ymin=s,this.xmax=i,this.ymax=n,this.spatialReference=e,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},"./node_modules/@arcgis/core/layers/effects/EffectView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return u}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_lang_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_parser_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/parser.js"),_utils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/utils.js");const a=-1;let h=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.a{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_2__.a)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(_(t))}catch(e){this._transitionTo([]),_core_Logger_js__WEBPACK_IMPORTED_MODULE_4__.a.getLogger(this.declaredClass).warn("Invalid Effect",{effect:t,error:e})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&p(this._current,_(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}end(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.a)(t),function m(t,e,s){var r,i;const n=t.length>e.length?t:e,c=t.length>e.length?e:t,o=c[c.length-1],l=null!=(r=null==o?void 0:o.scale)?r:s,h=null!=(i=null==o?void 0:o.effects)?i:[];for(let f=c.length;f<n.length;f++)c.push({scale:l,effects:[...h]});for(let u=0;u<n.length;u++)c[u].scale=c[u].scale===a?s:c[u].scale,n[u].scale=n[u].scale===a?s:n[u].scale,Object(_utils_js__WEBPACK_IMPORTED_MODULE_9__.c)(c[u].effects,n[u].effects)}(this._current,this._to,this.scale),this._from=Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.a)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.a)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],r=this._from[s],i=this._to[s];t.scale=g(r.scale,i.scale,e);for(let s=0;s<t.effects.length;s++){const n=t.effects[s],c=r.effects[s],o=i.effects[s];n.interpolate(c,o,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.a)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let r,i,n=1;if(1===e.length||t>=e[0].scale)i=r=e[0].effects;else if(t<=e[s].scale)i=r=e[s].effects;else for(let c=0;c<s;c++){const s=e[c],o=e[c+1];if(s.scale>=t&&o.scale<=t){n=(t-s.scale)/(o.scale-s.scale),r=s.effects,i=o.effects;break}}for(let c=0;c<this.effects.length;c++)this.effects[c].interpolate(r[c],i[c],n)}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)()],h.prototype,"_to",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)()],h.prototype,"duration",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({value:""})],h.prototype,"effect",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({readOnly:!0})],h.prototype,"effects",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({readOnly:!0})],h.prototype,"hasEffects",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({value:0})],h.prototype,"scale",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({readOnly:!0})],h.prototype,"transitioning",null),h=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.a)("esri.layers.effects.EffectView")],h);const u=h;function _(t){const e=Object(_parser_js__WEBPACK_IMPORTED_MODULE_8__.a)(t)||[];return function d(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:a,effects:e}]:e}function p(t,e,s){var r,i,n,c;return null==(r=t[0])||!r.effects||null==(i=e[0])||!i.effects||!(((null==(n=t[0])?void 0:n.scale)===a||(null==(c=e[0])?void 0:c.scale)===a)&&(t.length>1||e.length>1)&&s<=0)&&Object(_utils_js__WEBPACK_IMPORTED_MODULE_9__.a)(t[0].effects,e[0].effects)}function g(t,e,s){return t+(e-t)*s}},"./node_modules/@arcgis/core/layers/graphics/centroid.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return e}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js");function n(t,n){return t?n?4:3:n?3:2}function e(e,o,u,l,N){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(o)||!o.lengths.length)return null;const s="upperLeft"===(null==N?void 0:N.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const c=e.coords,f=[],i=u?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:T,coords:h}=o,g=n(u,l);let E=0;for(const t of T){const n=r(i,h,E,t,u,l,s);n&&f.push(n),E+=t*g}if(f.sort(((t,n)=>{let e=s*t[2]-s*n[2];return 0===e&&u&&(e=t[4]-n[4]),e})),f.length){let t=6*f[0][2];c[0]=f[0][0]/t,c[1]=f[0][1]/t,u&&(t=6*f[0][4],c[2]=0!==t?f[0][3]/t:0),(c[0]<i[0]||c[0]>i[1]||c[1]<i[2]||c[1]>i[3]||u&&(c[2]<i[4]||c[2]>i[5]))&&(c.length=0)}if(!c.length){const t=o.lengths[0]?I(h,0,T[0],u,l):null;if(!t)return null;c[0]=t[0],c[1]=t[1],u&&t.length>2&&(c[2]=t[2])}return e}function r(t,e,r,I,o,u,l=1){const N=n(o,u);let s=r,c=r+N,f=0,i=0,T=0,h=0,g=0;for(let n=0,m=I-1;n<m;n++,s+=N,c+=N){const n=e[s],r=e[s+1],I=e[s+2],u=e[c],l=e[c+1],N=e[c+2];let E=n*l-u*r;h+=E,f+=(n+u)*E,i+=(r+l)*E,o&&(E=n*N-u*I,T+=(I+N)*E,g+=E),n<t[0]&&(t[0]=n),n>t[1]&&(t[1]=n),r<t[2]&&(t[2]=r),r>t[3]&&(t[3]=r),o&&(I<t[4]&&(t[4]=I),I>t[5]&&(t[5]=I))}if(h*l>0&&(h*=-1),g*l>0&&(g*=-1),!h)return null;const E=[f,i,.5*h];return o&&(E[3]=T,E[4]=.5*g),E}function I(t,e,r,I,s){const c=n(I,s);let f=e,i=e+c,T=0,h=0,g=0,E=0;for(let n=0,m=r-1;n<m;n++,f+=c,i+=c){const n=t[f],e=t[f+1],r=t[f+2],s=t[i],c=t[i+1],m=t[i+2],b=I?u(n,e,r,s,c,m):o(n,e,s,c);if(b)if(T+=b,I){const t=N(n,e,r,s,c,m);h+=b*t[0],g+=b*t[1],E+=b*t[2]}else{const t=l(n,e,s,c);h+=b*t[0],g+=b*t[1]}}return T>0?I?[h/T,g/T,E/T]:[h/T,g/T]:r>0?I?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function o(t,n,e,r){const I=e-t,o=r-n;return Math.sqrt(I*I+o*o)}function u(t,n,e,r,I,o){const u=r-t,l=I-n,N=o-e;return Math.sqrt(u*u+l*l+N*N)}function l(t,n,e,r){return[t+.5*(e-t),n+.5*(r-n)]}function N(t,n,e,r,I,o){return[t+.5*(r-t),n+.5*(I-n),e+.5*(o-e)]}},"./node_modules/@arcgis/core/layers/graphics/data/projectionSupport.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return f})),__webpack_require__.d(__webpack_exports__,"b",(function(){return g})),__webpack_require__.d(__webpack_exports__,"c",(function(){return M}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_geometryAdapters_json_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/geometryAdapters/json.js"),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/webMercatorUtils.js");const u=[0,0];function c(s,t){if(!t)return null;if("x"in t){const e={x:0,y:0};return[e.x,e.y]=s(t.x,t.y,u),null!=t.z&&(e.z=t.z),null!=t.m&&(e.m=t.m),e}if("xmin"in t){const e={xmin:0,ymin:0,xmax:0,ymax:0};return[e.xmin,e.ymin]=s(t.xmin,t.ymin,u),[e.xmax,e.ymax]=s(t.xmax,t.ymax,u),t.hasZ&&(e.zmin=t.zmin,e.zmax=t.zmax,e.hasZ=!0),t.hasM&&(e.mmin=t.mmin,e.mmax=t.mmax,e.hasM=!0),e}return"rings"in t?{rings:p(t.rings,s),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:p(t.paths,s),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:l(t.points,s),hasM:t.hasM,hasZ:t.hasZ}:void 0}function p(s,t){const e=[];for(const n of s)e.push(l(n,t));return e}function l(s,t){const e=[];for(const n of s){const s=t(n[0],n[1],[0,0]);e.push(s),n.length>2&&s.push(n[2]),n.length>3&&s.push(n[3])}return e}async function f(e,n){if(!n)return;const r=Array.isArray(e)?e.map((t=>Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(t.geometry)&&t.geometry.spatialReference)):[e];await Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_1__.g)(r.map((s=>({source:s,dest:n}))))}const x=c.bind(null,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_4__.c),y=c.bind(null,_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_4__.g);function g(s,t,m){return s?(m||(m=t,t=s.spatialReference),Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.l)(t)&&Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.l)(m)&&!Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.d)(t,m)?Object(_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_4__.a)(t,m)?Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.p)(m)?x(s):y(s):Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_1__.r)(_geometry_geometryAdapters_json_js__WEBPACK_IMPORTED_MODULE_2__.a,[s],t,m,null)[0]:s):s}const j=new class _{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(s,t,e){if(!s||!s.length||!t||!e||Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.d)(t,e))return s;const n={geometries:s,inSpatialReference:t,outSpatialReference:e,resolve:null};return this._jobs.push(n),new Promise((s=>{n.resolve=s,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const s=this._jobs.shift();if(!s)return;const{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:m}=s;Object(_geometry_support_webMercatorUtils_js__WEBPACK_IMPORTED_MODULE_4__.a)(r,i)?Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_3__.p)(i)?m(t.map(x)):m(t.map(y)):m(Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_1__.r)(_geometry_geometryAdapters_json_js__WEBPACK_IMPORTED_MODULE_2__.a,t,r,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function M(s,t,e){return j.push(s,t,e)}},"./node_modules/@arcgis/core/symbols/cim/Rasterizer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return m}));var _CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js"),_Rect_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/Rect.js"),_SDFHelper_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/SDFHelper.js"),_utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/utils.js");class m{constructor(e){this._resourceManager=e}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(s,o,m){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===s.type||"esriSFS"===s.type){const[t,r,a]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.d.rasterizeSimpleFill(this._rasterizationCanvas,s.style,o);return{size:[r,a],image:new Uint32Array(t.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===s.type||"esriSLS"===s.type||"line"===s.type&&s.dashTemplate){let r,a;if("simple-line"===s.type||"esriSLS"===s.type)switch(r=Object(_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.e)(s.style,s.cap),s.cap){case"butt":a="Butt";break;case"square":a="Square";break;default:a="Round"}else r=s.dashTemplate,a=s.cim.capStyle;const[i,n,o]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.d.rasterizeSimpleLine(r,a);return{size:[n,o],image:new Uint32Array(i.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let l,c,f;if("simple-marker"===s.type||"esriSMS"===s.type||"line-marker"===s.type?(l=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.b.fromSimpleMarker(s),f=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_2__.c)(l)):s.cim&&"CIMHatchFill"===s.cim.type?(l=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.b.fromCIMHatchFill(s.cim),c=new _Rect_js__WEBPACK_IMPORTED_MODULE_1__.a(l.frame.xmin,-l.frame.ymax,l.frame.xmax-l.frame.xmin,l.frame.ymax-l.frame.ymin)):s.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===s.cim.markerPlacement.type?(l=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.b.fromCIMInsidePolygon(s.cim),c=new _Rect_js__WEBPACK_IMPORTED_MODULE_1__.a(l.frame.xmin,-l.frame.ymax,l.frame.xmax-l.frame.xmin,l.frame.ymax-l.frame.ymin)):(l=s.cim,f=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_2__.c)(l)),f&&!m){const[e,t,r]=Object(_SDFHelper_js__WEBPACK_IMPORTED_MODULE_2__.a)(f);return e?{size:[t,r],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[p,h,u,y,d]=_CIMSymbolHelper_js__WEBPACK_IMPORTED_MODULE_0__.b.rasterize(this._rasterizationCanvas,l,c,this._resourceManager,!m);return p?{size:[h,u],image:new Uint32Array(p.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:d}:null}rasterizeImageResource(e,t,r,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext("2d");r instanceof ImageData?i.putImageData(r,0,0):(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`),i.drawImage(r,0,0,e,t));const n=i.getImageData(0,0,e,t),m=new Uint8Array(n.data);if(a)for(const s of a)if(s&&s.oldColor&&4===s.oldColor.length&&s.newColor&&4===s.newColor.length){const[e,t,r,a]=s.oldColor,[i,n,o,l]=s.newColor;if(e===i&&t===n&&r===o&&a===l)continue;for(let s=0;s<m.length;s+=4)e===m[s]&&t===m[s+1]&&r===m[s+2]&&a===m[s+3]&&(m[s]=i,m[s+1]=n,m[s+2]=o,m[s+3]=l)}let l;for(let s=0;s<m.length;s+=4)l=m[s+3]/255,m[s]=m[s]*l,m[s+1]=m[s+1]*l,m[s+2]=m[s+2]*l;let c=m,f=e,p=t;const h=512;if(f>=h||p>=h){const r=f/p;r>1?(f=h,p=Math.round(h/r)):(p=h,f=Math.round(h*r)),c=new Uint8Array(4*f*p);const a=new Uint8ClampedArray(c.buffer);Object(_utils_js__WEBPACK_IMPORTED_MODULE_3__.k)(m,e,t,a,f,p,!1)}return{size:[f,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},"./node_modules/@arcgis/core/views/2d/engine/Container.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return s}));var _chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),_layers_effects_EffectView_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/layers/effects/EffectView.js"),_DisplayObject_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js");class s extends _DisplayObject_js__WEBPACK_IMPORTED_MODULE_2__.a{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new _layers_effects_EffectView_js__WEBPACK_IMPORTED_MODULE_1__.a),this._effectView.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:Object(_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_0__.b)()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}}},"./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return FeatureContainer_o}));var promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),Queue=__webpack_require__("./node_modules/@arcgis/core/core/Queue.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),FramebufferObject=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js")),Texture=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js")),definitions=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js")),DisplayId=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayId.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),debug=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/util/debug.js");const U=Logger.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),D=Object(debug.b)(debug.a,U);class AttributeStoreView_j{constructor(t,e,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:s,pixelType:r,textureOnly:a}=t,h=Object(Utils.l)(r);this.shared=i,this.pixelType=r,this.size=e,this.textureOnly=a,a||(this.data=new h(Object(maybe.u)(s))),this._resetRange()}destroy(){Object(maybe.b)(this._texture,(t=>t.dispose()));for(const t in this._fbos)Object(maybe.b)(this._fbos[t],(e=>{"0"===t&&e.detachColorTexture(),e.dispose()})),this._fbos[t]=null;this._texture=null}get _textureDesc(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}setData(t,e,i){const s=Object(DisplayId.f)(t),r=Object(maybe.u)(this.data),a=s*this.texelSize+e;!r||a>=r.length||(r[a]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s))}getData(t,e){if(Object(maybe.k)(this.data))return null;const i=Object(DisplayId.f)(t)*this.texelSize+e;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(t){return Object(maybe.v)(this._texture,(()=>this._initTexture(t)))}getFBO(t,e=0){if(Object(maybe.k)(this._fbos[e])){const i={colorTarget:0,depthStencilTarget:0},s=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new FramebufferObject.a(t,i,s)}return this._fbos[e]}get locked(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(has.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}get hasDirty(){const t=this.dirtyStart;return this.dirtyEnd>=t}updateTexture(e,i){if(!this.locked){try{const i=this.dirtyStart,s=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const r=Object(maybe.u)(this.data).buffer,a=this.getTexture(e),h=4,n=(i-i%this.size)/this.size,d=(s-s%this.size)/this.size,u=n,l=this.size,p=d,c=n*this.size*h,x=(l+p*this.size)*h-c,g=Object(Utils.l)(this.pixelType),_=new g(r,c*g.BYTES_PER_ELEMENT,x),f=this.size,b=p-u+1;if(b>this.size)return void U.error(new Error.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));a.updateData(0,0,u,f,b,_)}catch(s){}i()}}update(t){const{data:e,start:i,end:s}=t;if(Object(maybe.l)(e)){const s=this.data,r=i*this.texelSize;for(let i=0;i<e.length;i++){const a=1<<i%this.texelSize;t.layout&a&&(s[r+i]=e[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,s)}resize(t,e){const i=this.size;if(this.size=e,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const s=Object(Utils.l)(this.pixelType);this.destroy(),this.data=new s(Object(maybe.u)(t.buffer))}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new Texture.a(t,this._textureDesc,Object(maybe.v)(this.data,void 0));if(Object(maybe.l)(this._lastTexture)&&this._fbos[0]){const i=this._lastTexture.descriptor.width,s=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,a=this._lastTexture.descriptor.pixelFormat,h=this.getFBO(t),o=Object(Utils.m)(r),n=new(Object(Utils.l)(r))(new ArrayBuffer(i*s*o*this.texelSize)),d=t.getBoundFramebufferObject(),{x:u,y:l,width:p,height:c}=t.getViewport();t.bindFramebuffer(h),h.readPixels(0,0,i,s,a,r,n),e.updateData(0,0,0,2*i,s/2,n),t.setViewport(u,l,p,c),t.bindFramebuffer(d)}return this.destroy(),this._texture=e,this._texture}}class AttributeStoreView_S{constructor(t){this._onUpdate=t,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(t){const{blocks:e,shared:i,size:h}=t;if(this.shared=i,this.size=h,D("Initializing AttributeStoreView",t),Object(maybe.k)(this._data))this._data=Object(maybe.n)(e,(t=>new AttributeStoreView_j(t,h,i)));else for(let r=0;r<this._data.length;r++){const t=this._data[r],o=e[r];Object(maybe.l)(o)&&(Object(maybe.k)(t)?this._data[r]=new AttributeStoreView_j(o,h,i):t.resize(o,h))}this._initialized=!0}destroy(){Object(maybe.b)(this._data,(t=>Object(maybe.n)(t,(t=>t.destroy())))),Object(maybe.b)(this._defaultTexture,(t=>t.dispose()))}isEmpty(){const t=this._data;return Object(maybe.k)(t)}isUpdating(){const t=Object(maybe.l)(this._pendingAttributeUpdate),i=t;return Object(has.a)("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${i}\n  -> hasPendingUpdate ${t}`),i}getBlock(t){return Object(maybe.k)(this._data)?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,definitions.b,0,0)}getData(t,e,i,r){if(!this._data)return 0;const h=Object(maybe.u)(this._data)[e];if(Object(maybe.k)(h))return 0;const n=h.getData(t,i);return Object(maybe.l)(n)?n:r}setData(t,e,i,s){const r=Object(maybe.u)(this._data)[e];Object(maybe.u)(r).setData(t,i,s)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}async requestUpdate(e){if(this._pendingAttributeUpdate)return void U.error(new Error.a("mapview-webgl","Tried to update attribute data with a pending update"));const i=Object(promiseUtils.g)();return D("AttributeStoreView Update Requested",e),this._pendingAttributeUpdate={data:e,resolver:i},i.promise}update(){if(this._initialized&&Object(maybe.l)(this._pendingAttributeUpdate)){const{data:t,resolver:e}=this._pendingAttributeUpdate,i=Object(maybe.u)(this._data);for(let s=0;s<t.blocks.length;s++){const e=t.blocks[s],r=i[s];Object(maybe.b)(r,(t=>Object(maybe.b)(e,(e=>{D(`Updating block ${s}`,e),t.update(e)}))))}this._pendingAttributeUpdate=null,e(),this._onUpdate()}}bindTextures(t,e=!0){this.update();const i=this._getDefaultTexture(t);if(!this._initialized)return t.bindTexture(i,definitions.y),void(e&&(t.bindTexture(i,definitions.z),t.bindTexture(i,definitions.A),t.bindTexture(i,definitions.B)));const s=Object(maybe.u)(this._data);this._locked&&!this._forceNextUpload||(Object(maybe.i)(s,(e=>e.updateTexture(t,(()=>this._onUpdate())))),this._forceNextUpload=!1),t.bindTexture(Object(maybe.o)(s[0],i,(e=>e.getTexture(t))),definitions.y),e&&(t.bindTexture(Object(maybe.o)(s[1],i,(e=>e.getTexture(t))),definitions.z),t.bindTexture(Object(maybe.o)(s[2],i,(e=>e.getTexture(t))),definitions.A),t.bindTexture(Object(maybe.o)(s[3],i,(e=>e.getTexture(t))),definitions.B))}_getDefaultTexture(t){if(Object(maybe.k)(this._defaultTexture)){const e={wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1};this._defaultTexture=new Texture.a(t,e,new Uint8Array(4))}return this._defaultTexture}}var TileContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js"),Color=__webpack_require__("./node_modules/@arcgis/core/Color.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),lengthUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js"),capabilities=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities.js");function WGLRendererInfo_c(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function WGLRendererInfo_p(e,t,i=0){if(Object(maybe.k)(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r:s,g:o,b:l,a:r}=t;e[i+0]=s*r/255,e[i+1]=o*r/255,e[i+2]=l*r/255,e[i+3]=r}class WGLRendererInfo_h{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}getSizeVVFieldStops(e){const s=this._vvSizeFieldStops;switch(s.type){case"static":return s;case"level-dependent":return Object(maybe.v)(s.levels[e],(()=>{let t=1/0,a=0;for(const i in s.levels){const s=parseFloat(i),o=Math.abs(e-s);o<t&&(t=o,a=s)}if(t===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const o=2**((e-a)/2),l=Object(maybe.u)(s.levels[a]),r=new Float32Array(l.values);return r[2]*=o,r[3]*=o,{sizes:Object(maybe.u)(l.sizes),values:r}}))}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){Object(maybe.l)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){this._updateEffects(i),this._vvInfo=t,"dot-density"===e.type&&this._updateDotDensityInfo(e)}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(capabilities.a)().supportsTextureFloat}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}_updateEffects(e){Object(maybe.l)(e)?this.outsideLabelsVisible=e.excludedLabelsVisible:this.outsideLabelsVisible=!1}_updateVisualVariables(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const s=e.size;if(s){if(i.vvSizeEnabled=!0,s.minMaxValue){const e=s.minMaxValue;let i,a;if(Object(Utils.r)(e.minSize)&&Object(Utils.r)(e.maxSize))if(Object(Utils.u)(e.minSize)&&Object(Utils.u)(e.maxSize))i=Object(screenUtils.g)(e.minSize),a=Object(screenUtils.g)(e.maxSize);else{const s=t.scale;i=Object(screenUtils.g)(WGLRendererInfo_c(s,e.minSize.stops)),a=Object(screenUtils.g)(WGLRendererInfo_c(s,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,a])}if(s.scaleStops&&(this.vvSizeScaleStopsValue=Object(screenUtils.g)(WGLRendererInfo_c(t.scale,s.scaleStops.stops))),s.unitValue){const e=Object(unitUtils.f)(t.spatialReference)/lengthUtils.a[s.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}s.fieldStops&&(this._vvSizeFieldStops=s.fieldStops)}const a=e.color;a&&(i.vvColorEnabled=!0,this.vvColorValues.set(a.values),this.vvColors.set(a.colors));const n=e.opacity;n&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(n.values),this.vvOpacities.set(n.opacities));const u=e.rotation;u&&(i.vvRotationEnabled=!0,i.vvRotationType=u.type)}_updateDotDensityInfo(t){const i=t.attributes;this.ddDotValue=t.dotValue,this.ddDotScale=t.referenceScale,this.ddDotSize=t.dotSize,this.ddDotBlending=t.dotBlendingEnabled,this.ddSeed=t.seed;for(let s=0;s<definitions.l;s++){const t=s>=i.length?new Color.a([0,0,0,0]):i[s].color;WGLRendererInfo_p(this.ddColors,t,4*s)}for(let e=0;e<8;e++)this.ddActiveDots[e]=e<t.attributes.length?1:0;WGLRendererInfo_p(this.ddBackgroundColor,t.backgroundColor)}}class FeatureContainer_o extends TileContainer.a{constructor(e){super(e),this._rendererInfo=new WGLRendererInfo_h,this._materialItemsRequestQueue=new Queue.a,this.attributeView=new AttributeStoreView_S((()=>this.onAttributeStoreUpdate()))}destroy(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}async getMaterialItems(t,r){if(!t||0===t.length)return null;const s=Object(promiseUtils.g)();return this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:s}),this.requestRender(),s.promise}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let t=this._materialItemsRequestQueue.pop();for(;t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop()}super.doRender(e)}renderChildren(e){for(const t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){const t=super.createRenderParams(e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:s}){const{painter:i,pixelRatio:o}=e,n=t.map((e=>i.textureManager.rasterizeItem(e.symbol,o,e.glyphIds,r)));Promise.all(n).then((e=>{if(!this.stage)return void s.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));s.resolve(r)}),s.reject)}}},"./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/VTLMaterialManager.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return VTLMaterialManager_c}));__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js");var Program=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Program.js"),programUtils=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/programUtils.js")),ShaderCompiler=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ShaderCompiler.js");const shaderRepository_e={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = mod(v_accumulatedDistance / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = mod((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio), 1.0);\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * v_lineHalfWidth;\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};const resolver_o=new ShaderCompiler.a((function resolver_t(r){let t=shaderRepository_e;return r.split("/").forEach((r=>{t&&(t=t[r])})),t}));function resolver_s(r){return resolver_o.resolveIncludes(r)}const Programs_t=r=>Object(programUtils.b)({ID:r.id,PATTERN:r.pattern}),Programs_a={shaders:e=>({vertexShader:Programs_t(e)+resolver_s("background/background.vert"),fragmentShader:Programs_t(e)+resolver_s("background/background.frag")})},Programs_i=r=>Object(programUtils.b)({ID:r.id}),Programs_s={shaders:e=>({vertexShader:Programs_i(e)+resolver_s("circle/circle.vert"),fragmentShader:Programs_i(e)+resolver_s("circle/circle.frag")})},d=r=>Object(programUtils.b)({ID:r.id,PATTERN:r.pattern}),Programs_o={shaders:e=>({vertexShader:d(e)+resolver_s("fill/fill.vert"),fragmentShader:d(e)+resolver_s("fill/fill.frag")})},l=r=>Object(programUtils.b)({ID:r.id}),Programs_n={shaders:e=>({vertexShader:l(e)+resolver_s("outline/outline.vert"),fragmentShader:l(e)+resolver_s("outline/outline.frag")})},f=r=>Object(programUtils.b)({ID:r.id,SDF:r.sdf}),Programs_g={shaders:e=>({vertexShader:f(e)+resolver_s("icon/icon.vert"),fragmentShader:f(e)+resolver_s("icon/icon.frag")})},Programs_c=r=>Object(programUtils.b)({ID:r.id,PATTERN:r.pattern,SDF:r.sdf}),h={shaders:e=>({vertexShader:Programs_c(e)+resolver_s("line/line.vert"),fragmentShader:Programs_c(e)+resolver_s("line/line.frag")})},Programs_m=r=>Object(programUtils.b)({ID:r.id}),b={shaders:e=>({vertexShader:Programs_m(e)+resolver_s("text/text.vert"),fragmentShader:Programs_m(e)+resolver_s("text/text.frag")})};class VTLMaterialManager_c{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((e=>e.dispose())),this._programByKey.clear()}getMaterialProgram(r,t,a){const s=t.key<<3|this._getMaterialOptionsValue(t.type,a);if(this._programByKey.has(s))return this._programByKey.get(s);const n=this._getProgramTemplate(t.type),{shaders:i}=n,{vertexShader:o,fragmentShader:c}=i(a),p=t.getShaderHeader(),u=t.getShaderMain(),g=o.replace("#pragma header",p).replace("#pragma main",u),m=new Program.a(r,g,c,t.getAttributeLocations());return this._programByKey.set(s,m),m}_getMaterialOptionsValue(e,r){switch(e){case 0:{const e=r;return(e.pattern?1:0)<<1|(e.id?1:0)}case 1:{const e=r;return(e.pattern?1:0)<<1|(e.id?1:0)}case 2:case 5:case 6:return r.id?1:0;case 3:{const e=r;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1|(e.id?1:0)}case 4:{const e=r;return(e.sdf?1:0)<<1|(e.id?1:0)}default:return 0}}_getProgramTemplate(e){switch(e){case 0:return Programs_a;case 5:return Programs_s;case 1:return Programs_o;case 4:return Programs_g;case 3:return h;case 2:return Programs_n;case 6:return b;default:return null}}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayId.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return n})),__webpack_require__.d(__webpack_exports__,"b",(function(){return c})),__webpack_require__.d(__webpack_exports__,"c",(function(){return u})),__webpack_require__.d(__webpack_exports__,"d",(function(){return s})),__webpack_require__.d(__webpack_exports__,"e",(function(){return i})),__webpack_require__.d(__webpack_exports__,"f",(function(){return f})),__webpack_require__.d(__webpack_exports__,"g",(function(){return e})),__webpack_require__.d(__webpack_exports__,"h",(function(){return p}));const n=8388607,t=8388608,u=0,c=1,e=n=>(n&t)>>>23,f=t=>t&n,i=n=>e(n)===c?254:255;function p(n){return e(n)===c}function s(n,r){return((r?t:0)|n)>>>0}},"./node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return o}));var _core_has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js"),_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushInfo.js"),_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushStencil.js");const i=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class o extends _WGLContainer_js__WEBPACK_IMPORTED_MODULE_2__.a{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(i),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(s){const i=super.prepareRenderPasses(s);return i.push(s.registerRenderPass({name:"stencil",brushes:[_brushes_WGLBrushStencil_js__WEBPACK_IMPORTED_MODULE_4__.a],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_1__.c.DEBUG|_enums_js__WEBPACK_IMPORTED_MODULE_1__.c.MAP|_enums_js__WEBPACK_IMPORTED_MODULE_1__.c.HIGHLIGHT,target:()=>this.getStencilTarget()})),Object(_core_has_js__WEBPACK_IMPORTED_MODULE_0__.a)("esri-tiles-debug")&&i.push(s.registerRenderPass({name:"tileInfo",brushes:[_brushes_WGLBrushInfo_js__WEBPACK_IMPORTED_MODULE_3__.a],drawPhase:_enums_js__WEBPACK_IMPORTED_MODULE_1__.c.DEBUG,target:()=>this.children})),i}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Z})),__webpack_require__.d(__webpack_exports__,"b",(function(){return R})),__webpack_require__.d(__webpack_exports__,"c",(function(){return $})),__webpack_require__.d(__webpack_exports__,"d",(function(){return ye})),__webpack_require__.d(__webpack_exports__,"e",(function(){return X})),__webpack_require__.d(__webpack_exports__,"f",(function(){return _})),__webpack_require__.d(__webpack_exports__,"g",(function(){return ne})),__webpack_require__.d(__webpack_exports__,"h",(function(){return ie})),__webpack_require__.d(__webpack_exports__,"i",(function(){return k})),__webpack_require__.d(__webpack_exports__,"j",(function(){return V})),__webpack_require__.d(__webpack_exports__,"k",(function(){return pe})),__webpack_require__.d(__webpack_exports__,"l",(function(){return Q})),__webpack_require__.d(__webpack_exports__,"m",(function(){return H})),__webpack_require__.d(__webpack_exports__,"n",(function(){return z})),__webpack_require__.d(__webpack_exports__,"o",(function(){return ae})),__webpack_require__.d(__webpack_exports__,"p",(function(){return q})),__webpack_require__.d(__webpack_exports__,"q",(function(){return le})),__webpack_require__.d(__webpack_exports__,"r",(function(){return O})),__webpack_require__.d(__webpack_exports__,"s",(function(){return ce})),__webpack_require__.d(__webpack_exports__,"t",(function(){return se})),__webpack_require__.d(__webpack_exports__,"u",(function(){return P})),__webpack_require__.d(__webpack_exports__,"v",(function(){return ue})),__webpack_require__.d(__webpack_exports__,"w",(function(){return de})),__webpack_require__.d(__webpack_exports__,"x",(function(){return oe})),__webpack_require__.d(__webpack_exports__,"y",(function(){return fe})),__webpack_require__.d(__webpack_exports__,"z",(function(){return me})),__webpack_require__.d(__webpack_exports__,"A",(function(){return j}));var Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),enums=(__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/color.js"),__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js")),ObjectPool=__webpack_require__("./node_modules/@arcgis/core/core/ObjectPool.js");class h{constructor(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}acquire(o,h,s,t,i,l,r,e,c){this.color=o,this.haloColor=h,this.haloSize=s,this.size=t,this.angle=i,this.offsetX=l,this.offsetY=r,this.hAnchor=e,this.vAnchor=c}release(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}}h.pool=new ObjectPool.a(h);__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js");const u=Logger.a.getLogger("esri.views.2d.engine.webgl.Utils"),l="geometry",p=[{name:l,strideInBytes:32,divisor:0}],y=[{name:l,strideInBytes:20,divisor:0}],g=[{name:l,strideInBytes:12,divisor:0}],Utils_h=[{name:l,strideInBytes:40,divisor:0}],w=[{name:l,strideInBytes:36,divisor:0}],v=[{name:l,strideInBytes:36,divisor:0}];function S(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const I=S([{name:l,strideInBytes:36,divisor:0}]),L=S(p),M=S(y),A=S(g),T=S(Utils_h),C=S(w),b=S(v);function z(e,{fill:t}){switch(e){case enums.d.MARKER:return I;case enums.d.FILL:return"dot-density"===t?A:"simple"===t?M:L;case enums.d.LINE:return T;case enums.d.TEXT:return C;case enums.d.LABEL:return b}}const x=[l],E=[l],F=[l],B=[l],D=[l];function U(e){switch(e){case enums.d.MARKER:return x;case enums.d.FILL:return E;case enums.d.LINE:return F;case enums.d.TEXT:return B;case enums.d.LABEL:return D}}function j(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function R(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function $(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function O(e){return null!=e}function P(e){return"number"==typeof e}function k(t){switch(t){case"butt":return 0;case"round":return 1;case"square":return 2;default:return u.error(new Error.a("mapview-invalid-type",`Cap type ${t} is not a valid option. Defaulting to round`)),1}}function V(t){switch(t){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return u.error(new Error.a("mapview-invalid-type",`Join type ${t} is not a valid option. Defaulting to round`)),1}}function q(e){switch(e){case"opacity":return enums.b.OPACITY;case"color":return enums.b.COLOR;case"rotation":return enums.b.ROTATION;case"size":return enums.b.SIZE;default:return u.error(`Cannot interpret unknown vv: ${e}`),null}}function X(e,t,r,n,i,o,s){for(const c in o){const t=o[c].stride,n=j(t),s=o[c].data,a=r[c].data,u=t*i.vertexCount/n,l=t*e/n,f=t*i.vertexFrom/n;for(let e=0;e<u;++e)a[e+l]=s[e+f]}const a=i.indexCount;for(let c=0;c<a;++c)n[c+t]=s[c+i.indexFrom]-i.vertexFrom+e}const Z={[l]:35044};function _(e,t){const r=[];for(let n=0;n<5;++n){const i=U(n),o={};for(const e of i)o[e]={data:t(n,e)};r.push({data:e(n),buffers:o})}return r}function G(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function H(t){switch(t){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void u.error(new Error.a("webgl-utils",`Unable to handle type ${t}`))}}function Q(t){switch(t){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void u.error(new Error.a("webgl-utils",`Unable to handle type ${t}`))}}const ee=e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t},te=e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t},re=new Map,ne=(e,t)=>{if(!re.has(e)){const r=function W(e){const t={};for(const r in e){const n=e[r];let i=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:i,stride:0};return i+=e.count*G(e.type),t})),t[r].forEach((e=>e.stride=i))}return t}(t),n={strides:te(r),bufferLayouts:r,attributes:ee(t)};re.set(e,n)}return re.get(e)};function ie(e){e(enums.d.FILL),e(enums.d.LINE),e(enums.d.MARKER),e(enums.d.TEXT),e(enums.d.LABEL)}const oe=e=>"path"in e&&ge(e.path),se=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,ae=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,ce=e=>"url"in e&&e.url&&e.url.includes(".gif")||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/gif"),ue=e=>"url"in e&&e.url&&e.url.includes(".png")||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&e.imageData.includes("data:image/png"),le=e=>e.type&&-1!==e.type.toLowerCase().indexOf("3d");function fe(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const de=e=>e.includes("data:image/svg+xml");function me(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":case"CIMVectorMarker":case"CIMPictureMarker":case"CIMCharacterMarker":return!1;default:return!0}}function pe(e){const t="maxVVSize"in e&&e.maxVVSize,r="width"in e&&e.width||"size"in e&&e.size||0;return t||r}function ye(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}const ge=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4))},"./node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return WGLContainer_a}));__webpack_require__("./node_modules/@arcgis/core/core/has.js");var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),brushes=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/brushes.js"),Container=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Container.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),earcut=__webpack_require__("./node_modules/@arcgis/core/chunks/earcut.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),featureConversionUtils=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),OptimizedGeometry=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedGeometry.js"),number=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js");const Mesh2D_m=Logger.a.getLogger("esri.views.2d.engine.webgl.Mesh2D"),y=(e,t,r,s)=>{let n=0;for(let o=1;o<r;o++){const r=e[2*(t+o-1)],s=e[2*(t+o-1)+1];n+=(e[2*(t+o)]-r)*(e[2*(t+o)+1]+s)}return s?n>0:n<0},x=({coords:e,lengths:t},r)=>{const n=[];for(let o=0,c=0;o<t.length;c+=t[o],o+=1){const i=c,a=[];for(;o<t.length-1&&y(e,c+t[o],t[o+1],r);o+=1,c+=t[o])a.push(c+t[o]-i);const f=e.slice(2*i,2*(c+t[o])),h=Object(earcut.a)(f,a,2);for(const e of h)n.push(e+i)}return n};class Mesh2D_g{constructor(e,t,r,s=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=s}static fromRect({x:e,y:t,width:r,height:s}){const n=e,o=t,c=n+r,i=o+s;return Mesh2D_g.fromScreenExtent({xmin:n,ymin:o,xmax:c,ymax:i})}static fromPath(e){const t=Object(featureConversionUtils.f)(new OptimizedGeometry.a,e.path,!1,!1),r=t.coords,s=new Uint32Array(x(t,!0)),n=new Uint32Array(r.length/2);for(let o=0;o<n.length;o++)n[o]=Object(number.a)(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new Mesh2D_g({geometry:n},s,4)}static fromGeometry(t,r){const s=r.geometry.type;switch(s){case"polygon":return Mesh2D_g.fromPolygon(t,r.geometry);case"extent":return Mesh2D_g.fromMapExtent(t,r.geometry);default:return Mesh2D_m.error(new Error.a("mapview-bad-type",`Unable to create a mesh from type ${s}`,r)),Mesh2D_g.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=Object(featureConversionUtils.g)(new OptimizedGeometry.a,t,!1,!1),s=r.coords,c=new Uint32Array(x(r,!1)),h=new Uint32Array(s.length/2),m=Object(vec2f64.b)(),u=Object(vec2f64.b)();for(let o=0;o<h.length;o++)Object(vec2.s)(m,s[2*o],s[2*o+1]),e.toScreen(u,m),h[o]=Object(number.a)(Math.floor(u[0]),Math.floor(u[1]));return new Mesh2D_g({geometry:h},c,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:s}){const n={geometry:new Uint32Array([Object(number.a)(e,r),Object(number.a)(t,r),Object(number.a)(e,s),Object(number.a)(e,s),Object(number.a)(t,r),Object(number.a)(t,s)])},o=new Uint32Array([0,1,2,3,4,5]);return new Mesh2D_g(n,o,4)}static fromMapExtent(e,t){const[r,s]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,o]=e.toScreen([0,0],[t.xmax,t.ymax]),c={geometry:new Uint32Array([Object(number.a)(r,s),Object(number.a)(n,s),Object(number.a)(r,o),Object(number.a)(r,o),Object(number.a)(n,s),Object(number.a)(n,o)])},i=new Uint32Array([0,1,2,3,4,5]);return new Mesh2D_g(c,i,4)}destroy(){Object(maybe.l)(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)Object(maybe.l)(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return(t=>{switch(t.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new Error.a("Cannot get DataType of array")}})(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=BufferObject.a.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,s)=>({...r,[s]:BufferObject.a.createVertex(e,t,this.vertices[s])})),{})),this._cache.vertexBuffers}}var VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js");const ClippingInfo_c=Logger.a.getLogger("esri.views.2d.engine.webgl.ClippingInfo"),ClippingInfo_n=t=>parseFloat(t)/100;class ClippingInfo_m extends DisplayObject.a{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=e.watch("version",(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new ClippingInfo_m(t,e)}_destroyGL(){Object(maybe.l)(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(maybe.l)(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,r,i){const[o,h]=e.size;if("geometry"!==this._clip.type&&this._lastWidth===o&&this._lastHeight===h||(this._lastWidth=o,this._lastHeight=h,this._destroyGL()),Object(maybe.k)(this._cache.vao)){const s=this._createMesh(e,this._clip),o=s.getIndexBuffer(t),h=s.getVertexBuffers(t);this._cache.mesh=s,this._cache.vao=new VertexArrayObject.a(t,r,i,h,o)}return this._cache.vao}_createTransforms(){return{dvs:Object(mat3f32.b)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(t,e){const[r,s]=t.size,i="string"==typeof e.left?ClippingInfo_n(e.left)*r:e.left,o="string"==typeof e.right?ClippingInfo_n(e.right)*r:e.right,h="string"==typeof e.top?ClippingInfo_n(e.top)*s:e.top,a="string"==typeof e.bottom?ClippingInfo_n(e.bottom)*s:e.bottom,c=i,m=h;return{x:c,y:m,width:Math.max(r-o-c,0),height:Math.max(s-a-m,0)}}_createMesh(e,r){switch(r.type){case"rect":return Mesh2D_g.fromRect(this._createScreenRect(e,r));case"path":return Mesh2D_g.fromPath(r);case"geometry":return Mesh2D_g.fromGeometry(e,r);default:return ClippingInfo_c.error(new Error.a("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),Mesh2D_g.fromRect({x:0,y:0,width:1,height:1})}}}var enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js");class WGLContainer_a extends Container.a{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}_createTransforms(){return{dvs:Object(mat3f32.b)()}}doRender(e){const r=this.createRenderParams(e),{painter:s,globalOpacity:t,profiler:i,drawPhase:n}=r,a=n===enums.c.LABEL||n===enums.c.HIGHLIGHT?1:t*this.computedOpacity;i.recordContainerStart(this.name),s.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(r),s.compositeLayer(r,a),i.recordContainerEnd()}renderChildren(r){Object(maybe.k)(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(r.painter));for(const e of this.children)e.beforeRender(r);for(const e of this._renderPasses)try{e.render(r)}catch(s){}for(const e of this.children)e.afterRender(r)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[brushes.a.clip],target:()=>this._clippingInfos,drawPhase:enums.c.MAP|enums.c.LABEL|enums.c.LABEL_ALPHA|enums.c.DEBUG|enums.c.HIGHLIGHT})]}updateTransforms(e){for(const r of this.children)r.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(Object(maybe.l)(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;Object(maybe.l)(e)&&e.length&&(this._clippingInfos=e.items.map((e=>ClippingInfo_m.fromClipArea(this.stage,e)))),this.requestRender()}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/WGLTile.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return f}));var _chunks_mat2d_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat2d.js"),_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),_chunks_vec2_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),_definitions_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),_TiledDisplayObject_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/TiledDisplayObject.js");class f extends _TiledDisplayObject_js__WEBPACK_IMPORTED_MODULE_6__.a{constructor(s,t,r){super(s,t,r,_definitions_js__WEBPACK_IMPORTED_MODULE_5__.L,_definitions_js__WEBPACK_IMPORTED_MODULE_5__.L)}destroy(){super.destroy(),this._transforms&&f.TransformCache.release(this.key.hash)}setTransform(i,h){const m=h/(i.resolution*i.pixelRatio),c=this.transforms.tileMat3,[f,l]=i.toScreenNoRotation([0,0],[this.x,this.y]),u=this.width/this.rangeX*m,d=this.height/this.rangeY*m;Object(_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.n)(c,u,0,0,0,d,0,f,l,1),Object(_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_1__.k)(this.transforms.dvs,i.displayViewMat3,c);const p=this.transforms.labelMat2d,j=i.getScreenTransform(p,h),y=Object(_chunks_vec2f32_js__WEBPACK_IMPORTED_MODULE_4__.a)();Object(_chunks_vec2_js__WEBPACK_IMPORTED_MODULE_3__.t)(y,[this.x,this.y],j),Object(_chunks_mat2d_js__WEBPACK_IMPORTED_MODULE_0__.d)(p),Object(_chunks_mat2d_js__WEBPACK_IMPORTED_MODULE_0__.h)(p,p,y),Object(_chunks_mat2d_js__WEBPACK_IMPORTED_MODULE_0__.e)(p,i.viewMat2d,p)}_createTransforms(){return f.TransformCache.acquire(this.key.hash)}}f.TransformCache=new class c{acquire(s){return{refCount:1,version:-1,labelMat2d:Object(_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.b)(),tileMat3:Object(_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.b)(),dvs:Object(_chunks_mat3f32_js__WEBPACK_IMPORTED_MODULE_2__.b)()}}release(s){}}},"./node_modules/@arcgis/core/views/2d/engine/webgl/color.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return c})),__webpack_require__.d(__webpack_exports__,"b",(function(){return o})),__webpack_require__.d(__webpack_exports__,"c",(function(){return i})),__webpack_require__.d(__webpack_exports__,"d",(function(){return f}));var _number_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/number.js");function u(r,n){return Array.isArray(n)?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3]):(r[0]=n.r,r[1]=n.g,r[2]=n.b,r[3]=n.a),r}function o(r,n=0,t=!1){const u=r[n+3];return r[n+0]*=u,r[n+1]*=u,r[n+2]*=u,t||(r[n+3]*=255),r}function c(r){return o(u([],r))}function i(n){if(!n)return 0;const{r:t,g:u,b:o,a:c}=n;return Object(_number_js__WEBPACK_IMPORTED_MODULE_0__.b)(t*c,u*c,o*c,255*c)}function f(n){if(!n)return 0;const[t,u,o,c]=n;return Object(_number_js__WEBPACK_IMPORTED_MODULE_0__.b)(t*(c/255),u*(c/255),o*(c/255),c)}},"./node_modules/@arcgis/core/views/2d/engine/webgl/cpuMapped/DisplayRecordReader.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return i}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_definitions_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js");const r=2147483647;class i{constructor(t){this._head=t,this._cursor=t}static from(t,e=0,s=t.byteLength/_.BYTES_PER_RECORD-e){const r=new _(new Int32Array(t,e*_.BYTES_PER_RECORD,s*_.ELEMENTS_PER_RECORD));return new i(r)}size(){let t=this._cursor,e=0;for(;t;)e+=t.size(),t=t._link;return e}get id(){return this._cursor.id}set id(t){this._cursor.id=t}get materialKey(){return this._cursor.materialKey}set materialKey(t){this._cursor.materialKey=t}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(t){this._cursor.indexFrom=t}get indexCount(){return this._cursor.indexCount}set indexCount(t){this._cursor.indexCount=t}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(t){this._cursor.vertexFrom=t}get vertexCount(){return this._cursor.vertexCount}set vertexCount(t){this._cursor.vertexCount=t}get sortKey(){return this._cursor.sortKey}set sortKey(t){this._cursor.sortKey=t}get index(){return this._cursor._indexStart+this._cursor._index}seekIndex(t){let e=t;for(this._cursor=this._head;this._cursor;){const t=this._cursor.size();if(e<t)return this._cursor._index=e,!0;e-=t,this._cursor=this._cursor._link}return!1}forEach(t){const e=this.getCursor();for(;e.next();)t(e)}link(t){if(!this._head)return void(this._head=t._head);let e=this._head;for(;e._link;)e=e._link;e._link=t._head,e._link._indexStart=e._indexStart+e.size()}getCursor(){return this.copy()}lookup(t){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(t);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}copy(){var t;const e=new i(null==(t=this._head)?void 0:t.copy());if(!e._head)return e;let s=e._head,r=e._head._link;for(;r;)s._link=r.copy(),s=r,r=s._link;return e}next(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}peekId(){var t;return null!=(t=this._cursor.peekId())?t:this._cursor._link.peekId()}delete(e){let s=this._head,r=null;for(;s;){if(s.delete(e))return s.isEmpty()&&(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(r)&&(r._link=s._link),s===this._head&&(this._head=s._link),s===this._cursor&&(this._cursor=s._link)),!0;r=s,s=s._link}return!1}}i.ELEMENTS_PER_RECORD=_definitions_js__WEBPACK_IMPORTED_MODULE_1__.k,i.BYTES_PER_RECORD=i.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class _{constructor(t){this._link=null,this._index=-1,this._indexStart=0,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=t}static from(t,e=0,s=t.byteLength/this.BYTES_PER_RECORD-e){return new _(new Int32Array(t,e*this.BYTES_PER_RECORD,s*this.ELEMENTS_PER_RECORD))}delete(t){const e=this._index,s=this.lookup(t);if(s)for(this.id=r,++this._deletedCount;this.next()&&this.id===t;)this.id=r,++this._deletedCount;return this._index=e,s}isEmpty(){return this._deletedCount===this.size()}link(t){this._link?this._link.link(t):this._link=t}lookup(t){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(this._offsets.instance)){this._offsets.instance=new Map;const t=this.copy();t._index=-1;let e=0;for(;t.next();)t.id!==e&&(this._offsets.instance.set(t.id,t._index),e=t.id)}if(!this._offsets.instance.has(t))return!1;const s=this._index;return this._index=this._offsets.instance.get(t),this.id!==r||(this._index=s,!1)}get id(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]}set id(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD]=t}get materialKey(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]}set materialKey(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+1]=t}get insertAfter(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]}set indexFrom(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+3]=t}get indexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]}set indexCount(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+4]=t}get vertexFrom(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]}set vertexFrom(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+5]=t}get vertexCount(){return this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]}set vertexCount(t){this._packedRecords[this._index*_.ELEMENTS_PER_RECORD+6]=t}get sortKey(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]}set sortKey(t){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*_.ELEMENTS_PER_RECORD+7]=t}get index(){return this._index}size(){return this._packedRecords.length/_.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&this.id===r;);return this._index<this.size()}peekId(){const t=(this._index+1)*_.ELEMENTS_PER_RECORD;return t>=this._packedRecords.length?0:this._packedRecords[t]}getCursor(){return this.copy()}copy(){const t=new _(this._packedRecords);return t._indexStart=this._indexStart,t._link=this._link,t._index=this._index,t._offsets=this._offsets,t._deletedCount=this._deletedCount,t}}_.ELEMENTS_PER_RECORD=_definitions_js__WEBPACK_IMPORTED_MODULE_1__.k,_.BYTES_PER_RECORD=_.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},"./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return J})),__webpack_require__.d(__webpack_exports__,"b",(function(){return K})),__webpack_require__.d(__webpack_exports__,"c",(function(){return k})),__webpack_require__.d(__webpack_exports__,"d",(function(){return ct})),__webpack_require__.d(__webpack_exports__,"e",(function(){return dt})),__webpack_require__.d(__webpack_exports__,"f",(function(){return it})),__webpack_require__.d(__webpack_exports__,"g",(function(){return ht})),__webpack_require__.d(__webpack_exports__,"h",(function(){return ot})),__webpack_require__.d(__webpack_exports__,"i",(function(){return at})),__webpack_require__.d(__webpack_exports__,"j",(function(){return nt})),__webpack_require__.d(__webpack_exports__,"k",(function(){return Z})),__webpack_require__.d(__webpack_exports__,"l",(function(){return r})),__webpack_require__.d(__webpack_exports__,"m",(function(){return Q})),__webpack_require__.d(__webpack_exports__,"n",(function(){return P})),__webpack_require__.d(__webpack_exports__,"o",(function(){return b})),__webpack_require__.d(__webpack_exports__,"p",(function(){return O})),__webpack_require__.d(__webpack_exports__,"q",(function(){return T})),__webpack_require__.d(__webpack_exports__,"r",(function(){return s})),__webpack_require__.d(__webpack_exports__,"s",(function(){return N})),__webpack_require__.d(__webpack_exports__,"t",(function(){return et})),__webpack_require__.d(__webpack_exports__,"u",(function(){return c})),__webpack_require__.d(__webpack_exports__,"v",(function(){return $})),__webpack_require__.d(__webpack_exports__,"w",(function(){return i})),__webpack_require__.d(__webpack_exports__,"x",(function(){return Y})),__webpack_require__.d(__webpack_exports__,"y",(function(){return A})),__webpack_require__.d(__webpack_exports__,"z",(function(){return B})),__webpack_require__.d(__webpack_exports__,"A",(function(){return C})),__webpack_require__.d(__webpack_exports__,"B",(function(){return D})),__webpack_require__.d(__webpack_exports__,"C",(function(){return z})),__webpack_require__.d(__webpack_exports__,"D",(function(){return y})),__webpack_require__.d(__webpack_exports__,"E",(function(){return E})),__webpack_require__.d(__webpack_exports__,"F",(function(){return F})),__webpack_require__.d(__webpack_exports__,"G",(function(){return G})),__webpack_require__.d(__webpack_exports__,"H",(function(){return H})),__webpack_require__.d(__webpack_exports__,"I",(function(){return u})),__webpack_require__.d(__webpack_exports__,"J",(function(){return j})),__webpack_require__.d(__webpack_exports__,"K",(function(){return S})),__webpack_require__.d(__webpack_exports__,"L",(function(){return o})),__webpack_require__.d(__webpack_exports__,"M",(function(){return W})),__webpack_require__.d(__webpack_exports__,"N",(function(){return V})),__webpack_require__.d(__webpack_exports__,"O",(function(){return U}));const c=1e-30,i=4294967295,o=512,r=8,s=29,b=24,j=8,k={metrics:{width:15,height:17,left:0,top:-7,advance:14}},u=0,y=0,z=0,A=1,B=2,C=3,D=4,E=5,F=6,G=5,H=6,J=1,K=2,N=2,O=1,P=2,Q=4,S=1.05,T=6,U=5,V=6,W=1.15,Y=2,Z=8,$=500,et=10,ct=2,ht=0,it=1,ot=4,at=8,dt=4,nt=1},"./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js":function(module,__webpack_exports__,__webpack_require__){"use strict";var E,T,I,L,A,_,O;__webpack_require__.d(__webpack_exports__,"a",(function(){return O})),__webpack_require__.d(__webpack_exports__,"b",(function(){return L})),__webpack_require__.d(__webpack_exports__,"c",(function(){return I})),__webpack_require__.d(__webpack_exports__,"d",(function(){return E})),__webpack_require__.d(__webpack_exports__,"e",(function(){return A})),__webpack_require__.d(__webpack_exports__,"f",(function(){return _})),function(E){E[E.FILL=0]="FILL",E[E.LINE=1]="LINE",E[E.MARKER=2]="MARKER",E[E.TEXT=3]="TEXT",E[E.LABEL=4]="LABEL"}(E||(E={})),function(E){E[E.SUCCEEDED=0]="SUCCEEDED",E[E.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"}(T||(T={})),function(E){E[E.NONE=0]="NONE",E[E.MAP=1]="MAP",E[E.LABEL=2]="LABEL",E[E.LABEL_ALPHA=4]="LABEL_ALPHA",E[E.HITTEST=8]="HITTEST",E[E.HIGHLIGHT=16]="HIGHLIGHT",E[E.CLIP=32]="CLIP",E[E.DEBUG=64]="DEBUG",E[E.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(I||(I={})),function(E){E[E.SIZE=0]="SIZE",E[E.COLOR=1]="COLOR",E[E.OPACITY=2]="OPACITY",E[E.ROTATION=3]="ROTATION"}(L||(L={})),function(E){E[E.NONE=0]="NONE",E[E.OPACITY=1]="OPACITY",E[E.COLOR=2]="COLOR",E[E.ROTATION=4]="ROTATION",E[E.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",E[E.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",E[E.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",E[E.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(A||(A={})),function(E){E[E.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",E[E.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",E[E.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",E[E.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(_||(_={})),function(E){E[E.SPRITE=0]="SPRITE",E[E.GLYPH=1]="GLYPH"}(O||(O={}))},"./node_modules/@arcgis/core/views/2d/engine/webgl/materialKey/MaterialKey.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return x})),__webpack_require__.d(__webpack_exports__,"b",(function(){return b})),__webpack_require__.d(__webpack_exports__,"c",(function(){return B})),__webpack_require__.d(__webpack_exports__,"d",(function(){return U})),__webpack_require__.d(__webpack_exports__,"e",(function(){return _})),__webpack_require__.d(__webpack_exports__,"f",(function(){return R})),__webpack_require__.d(__webpack_exports__,"g",(function(){return L})),__webpack_require__.d(__webpack_exports__,"h",(function(){return F}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_enums_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/meshUtils.js");function L(t,e){switch(t){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.FILL:return x.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LINE:return B.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.MARKER:return U.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.TEXT:return R.from(e);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LABEL:return b.from(e);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function F(t){switch(_.load(t).geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.MARKER:return new U(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.FILL:return new x(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LINE:return new B(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.TEXT:return new R(t);case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LABEL:return new b(t)}}class _{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.FILL:return"fill";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.MARKER:return"marker";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LINE:return"line";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.TEXT:return"text";case _enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LABEL:return"label";default:throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const i=1<<t;e?this._data|=i:this._data&=~i}bit(t){return(this._data&1<<t)>>t}setBits(t,e,i){for(let s=e,a=0;s<i;s++,a++)this.setBit(s,0!=(t&1<<a))}bits(t,e){let i=0;for(let s=t,a=0;s<e;s++,a++)i|=this.bit(s)<<a;return i}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}_.shared=new _(0);const I=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,i){super.setVV(t,i);const s=function r(t,s){const a=_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_FIELD_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_MINMAX_VALUE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_SCALE_STOPS|_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_UNIT_VALUE,r=(t&(_enums_js__WEBPACK_IMPORTED_MODULE_1__.f.FIELD_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.f.MINMAX_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.f.SCALE_TARGETS_OUTLINE|_enums_js__WEBPACK_IMPORTED_MODULE_1__.f.UNIT_TARGETS_OUTLINE))>>>4;return s.isOutline||s.isOutlinedFill?a&r:a&~r}(t,i)&t;this.vvSizeMinMaxValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.SIZE_SCALE_STOPS)}},O=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,i){super.setVV(t,i),this.vvRotation=!i.isOutline&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.ROTATION)}},A=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,i){super.setVV(t,i),this.vvColor=!i.isOutline&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.COLOR)}},f=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,i){super.setVV(t,i),this.vvOpacity=!i.isOutline&&!!(t&_enums_js__WEBPACK_IMPORTED_MODULE_1__.e.OPACITY)}};class x extends(A(f(I(_)))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.d.FILL,e.dotDensity="dot-density"===t.stride.fill,e.simple="simple"===t.stride.fill,e.outlinedFill=t.isOutlinedFill,e.dotDensity||e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}get simple(){return!!this.bit(22)}set simple(t){this.setBit(22,t)}get outlinedFill(){return!!this.bit(21)}set outlinedFill(t){this.setBit(21,t)}}x.shared=new x(0);class U extends(A(f(O(I(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.d.MARKER,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}U.shared=new U(0);class B extends(A(f(I(_)))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LINE,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}B.shared=new B(0);class R extends(A(f(O(I(_))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.d.TEXT,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}R.shared=new R(0);class b extends(I(_)){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=_enums_js__WEBPACK_IMPORTED_MODULE_1__.d.LABEL,e.setVV(t.vvFlags,t),e.mapAligned=Object(_mesh_templates_meshUtils_js__WEBPACK_IMPORTED_MODULE_2__.a)(t.placement),e.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0)},"./node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/meshUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function e(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}__webpack_require__.d(__webpack_exports__,"a",(function(){return e}))},"./node_modules/@arcgis/core/views/2d/engine/webgl/number.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return w})),__webpack_require__.d(__webpack_exports__,"b",(function(){return x})),__webpack_require__.d(__webpack_exports__,"c",(function(){return M}));const n=new Float32Array(1);new Uint32Array(n.buffer);function M(n){return[255&n,(65280&n)>>>8,(16711680&n)>>>16,(4278190080&n)>>>24]}function w(n,r){return 65535&n|r<<16}function x(n,r,t,u){return 255&n|(255&r)<<8|(255&t)<<16|u<<24}},"./node_modules/@arcgis/core/views/2d/engine/webgl/util/debug.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return l})),__webpack_require__.d(__webpack_exports__,"b",(function(){return n}));const n=(n,l)=>n&&((...n)=>l.warn("DEBUG:",...n))||(()=>null),l=!1},"./node_modules/@arcgis/core/views/2d/engine/webgl/visualVariablesUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return o}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_enums_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_Utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js");const l=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.a.getLogger("esri.views.2d.engine.webgl");function o(s){return Object(_Utils_js__WEBPACK_IMPORTED_MODULE_3__.u)(s.minDataValue)&&Object(_Utils_js__WEBPACK_IMPORTED_MODULE_3__.u)(s.maxDataValue)&&null!=s.minSize&&null!=s.maxSize?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_MINMAX_VALUE:(s.expression&&"view.scale"===s.expression||s.valueExpression&&"$view.scale"===s.valueExpression)&&Array.isArray(s.stops)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_SCALE_STOPS:(null!=s.field||s.expression&&"view.scale"!==s.expression||s.valueExpression&&"$view.scale"!==s.valueExpression)&&(Array.isArray(s.stops)||"levels"in s&&s.levels)?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_FIELD_STOPS:(null!=s.field||s.expression&&"view.scale"!==s.expression||s.valueExpression&&"$view.scale"!==s.valueExpression)&&null!=s.valueUnit?_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.SIZE_UNIT_VALUE:(l.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("mapview-bad-type","Found invalid size VisualVariable",s)),_enums_js__WEBPACK_IMPORTED_MODULE_2__.e.NONE)}},"./node_modules/@arcgis/core/views/2d/layers/features/support/AttributeStore.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return M}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/diffUtils.js"),_layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/layers/support/FieldsIndex.js"),_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayId.js"),_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js"),_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/util/debug.js"),_tileRenderers_support_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/visualVariablesUtils.js");const E=_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),F=Object(_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_11__.b)(_engine_webgl_util_debug_js__WEBPACK_IMPORTED_MODULE_11__.a,E),U={sharedArrayBuffer:Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("esri-shared-array-buffer"),atomics:Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("esri-atomics")};function C(t,e){return i=>e(t(i))}class R{constructor(t,e,i,s){this.size=0,this.texelSize=4;const{pixelType:r,layout:a,textureOnly:o}=s;this.textureOnly=o||!1,this.pixelType=r,this._ctype=e,this.layout=a,this._resetRange(),this._shared=t,this.size=i,o||(this.data=this._initData(r,i,t,e))}get buffer(){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.b)(this.data,(t=>t.buffer))}unsetComponentAllTexels(t,e){const i=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data);for(let s=0;s<this.size*this.size;s++)i[s*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const s=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data);for(const r of i)s[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data)[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data)[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t);return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data)[i*this.texelSize+e]}setData(t,e,i){const s=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t),r=1<<e;0!=(this.layout&r)?(this.data[s*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)):E.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&U.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&U.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t,this._shared,this._ctype),i=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data);e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const s=!(this._shared||"local"===this._ctype),r=this.pixelType,a=this.layout,o=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.u)(this.data);return{start:t,end:e,data:s&&o.slice(t*i,(e+1)*i)||null,pixelType:r,layout:a}}_initData(t,e,i,s){const r=i&&"local"!==s?SharedArrayBuffer:ArrayBuffer,a=Object(_engine_webgl_Utils_js__WEBPACK_IMPORTED_MODULE_10__.l)(t),o=new a(new r(e*e*4*a.BYTES_PER_ELEMENT));for(let n=0;n<o.length;n+=4)o[n+1]=255;return o}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class M{constructor(t,e){this._client=t,this.config=e,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.s),this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const i=e.supportsTextureFloat?5126:5121;F(`Creating AttributeStore ${U.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:i,layout:15},{pixelType:i,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(t,i){this.config=i;const s=i.schema.processors[0].storage,o=Object(_core_accessorSupport_diffUtils_js__WEBPACK_IMPORTED_MODULE_6__.a)(this._schema,s);if((t.targets.feature||t.targets.aggregate)&&(t.storage.data=!0),o&&(Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",o),t.storage.data=!0,this._schema=s,this._attributeComputeMap.clear(),!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(s))){switch(s.target){case"feature":this._targetType=_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.c;break;case"aggregate":this._targetType=_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.b}if("subtype"===s.type)for(const t in s.mapping){const e=s.mapping[t];if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e))for(const t of e.mapping)this._bindAttribute(t)}else for(const t of s.mapping)this._bindAttribute(t)}}onTileData(t,e){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e.addOrUpdate))return;const i=e.addOrUpdate.getCursor();for(;i.next();){const t=i.getDisplayId();this.setAttributeData(t,i)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=new AbortController}async setHighlight(t,e){const s=this._getBlock(0),r=e.map((t=>Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t)));s.lock(),s.unsetComponentAllTexels(0,1),s.setComponent(0,1,r),s.unlock(),this._idsToHighlight.clear();for(const a of t)this._idsToHighlight.add(a);await this.sendUpdates()}async updateFilters(t,i){const{config:s,service:r,spatialReference:a}=i,{filters:o}=s,n=o.map(((t,e)=>this._updateFilter(t,e,r,a)));(await Promise.all(n)).some((t=>t))&&(t.storage.filters=!0,Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}setData(t,e,i,s){const r=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,s)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlag(t){return this._idsToHighlight.has(t)?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.p:0}unsetAttributeData(t){const e=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e){const i=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.f)(t);if(this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(e)),this._targetType!==Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.g)(t))return;const r=this._attributeComputeMap,a=this.config.supportsTextureFloat?1:2;r.size&&r.forEach(((t,r)=>{const n=r*a%4,l=Math.floor(r*a/4),h=this._getBlock(l+_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.b),c=t(e);if(this.config.supportsTextureFloat)h.setData(i,n,c);else if(c===_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.u)h.setData(i,n,255),h.setData(i,n+1,255);else{const t=Object(_core_mathUtils_js__WEBPACK_IMPORTED_MODULE_3__.f)(Math.round(c),-32767,32766)+32768,e=255&t,r=(65280&t)>>8;h.setData(i,n,e),h.setData(i,n+1,r)}}))}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.g)(),this._nextUpdate.promise;const e={blocks:this._blocks.map((t=>Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(t)?t.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{const t=()=>{if(this._currUpdate=null,this._nextUpdate){const t=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>t.resolve()))}},i=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),i})).catch((e=>Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.m)(e)?(this._createResourcesPromise=null,this._createResources()):(E.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("mapview-attribute-store","Encountered an error during client update",e)),Promise.resolve()))),this._currUpdate}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bindAttribute(t){let s;if(null!=t.fieldIndex)s=function i(){return t.normalizationField&&E.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),e=>e.getComputedNumericAtIndex(t.fieldIndex)}();else{if(!t.field)return;s=function e(){return t.normalizationField?e=>{const i=e.readAttribute(t.normalizationField);return i?e.readAttribute(t.field)/i:null}:e=>e.readAttribute(t.field)}()}t.valueRepresentation&&(s=C(s,(e=>Object(_tileRenderers_support_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_12__.b)(e,t.valueRepresentation))));this._attributeComputeMap.set(t.binding,C(s,(t=>null===t||isNaN(t)||t===1/0?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.u:t)))}_createResources(){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_8__.a),F("Initializing AttributeStore");const e={shared:U.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.n)(this._blocks,(t=>({textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType})))},i=this._client.initialize(e,this._signal).catch((e=>{Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.m)(e)?this._createResourcesPromise=null:E.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("mapview-attribute-store","Encountered an error during client initialization",e))}));return this._createResourcesPromise=i,i.then((()=>Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(this._createResourcesPromise)?this._createResources():void 0)),i}_getBlock(t){const e=this._blocks[t];if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e))return e;F(`Initializing AttributeBlock at index ${t}`);const i=U.sharedArrayBuffer,s=this._client.type,r=new R(i,s,this._size,this._blockDescriptors[t]);return this._blocks[t]=r,this._createResourcesPromise=null,r}_expand(){if(this._size<this.config.maxTextureSize){const t=this._size<<=1;return F("Expanding block size to",t,this._blocks),Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.i)(this._blocks,(e=>e.expand(t))),this._createResourcesPromise=null,this._size=t,0}return E.error(new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}async _updateFilter(t,e,i,s){const o=this._filters[e],n=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(o)&&o.hash;if(!o&&!t)return!1;if(n===JSON.stringify(t))return!1;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(t)){if(!o)return!1;const t=1<<e+1,i=this._getBlock(0);return this._filters[e]=null,i.setComponentAllTexels(0,t),this.sendUpdates(),!0}const l=await this._getFilter(e,i);return await l.update(t,s),!0}async _getFilter(t,e){const i=this._filters[t];if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(i))return i;const{default:s}=await __webpack_require__.e(72).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilter.js")),r=new s({geometryType:e.geometryType,hasM:!1,hasZ:!1,timeInfo:e.timeInfo,fieldsIndex:new _layers_support_FieldsIndex_js__WEBPACK_IMPORTED_MODULE_7__.a(e.fields)});return this._filters[t]=r,r}isVisible(t){return!!(2&this._getBlock(0).getData(t,0))}getFilterFlags(t){let e=0;const i=Object(_engine_webgl_DisplayId_js__WEBPACK_IMPORTED_MODULE_9__.e)(t.getDisplayId());for(let a=0;a<this._filters.length;a++){const s=!!(i&1<<a),o=this._filters[a];e|=(!s||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(o)||o.check(t)?1:0)<<a}let s=0;if(this._idsToHighlight.size){const e=t.getObjectId();s=this.getHighlightFlag(e)}return e<<1|s}}},"./node_modules/@arcgis/core/views/2d/layers/features/support/ComputedAttributeStorage.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ComputedAttributeStorage_r}));var DisplayId=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/DisplayId.js");class DisplayIdGenerator_r{constructor(){this._freeIds=[],this._idCounter=1}createId(r=!1){return Object(DisplayId.d)(this._getFreeId(),r)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var StaticBitSet=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/StaticBitSet.js");function ComputedAttributeStorage_n(t,e,s){if(!(t.length>e))for(;t.length<=e;)t.push(s)}class ComputedAttributeStorage_r{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new DisplayIdGenerator_r,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const e=this._bitsets.length;return this._bitsets.push(StaticBitSet.a.create(this._allocatedSize,DisplayId.a)),e+1}getBitset(t){return this._bitsets[t-1]}_expand(){this._allocatedSize<<=1;for(const t of this._bitsets)t.resize(this._allocatedSize)}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),ComputedAttributeStorage_n(this._numerics[t],e,0)}_ensureInstanceId(t){ComputedAttributeStorage_n(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),ComputedAttributeStorage_n(this._strings[t],e,null)}createDisplayId(t=!1){const s=this._idGenerator.createId();return s>this._allocatedSize&&this._expand(),Object(DisplayId.d)(s,t)}releaseDisplayId(e){for(const t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(e&DisplayId.a)}getComputedNumeric(e,s){return this.getComputedNumericAtIndex(e&DisplayId.a,0)}setComputedNumeric(e,s,i){return this.setComputedNumericAtIndex(e&DisplayId.a,i,0)}getComputedString(e,s){return this.getComputedStringAtIndex(e&DisplayId.a,0)}setComputedString(e,s,i){return this.setComputedStringAtIndex(e&DisplayId.a,0,i)}getComputedNumericAtIndex(e,s){const i=e&DisplayId.a;return this._ensureNumeric(s,i),this._numerics[s][i]}setComputedNumericAtIndex(e,s,i){const n=e&DisplayId.a;this._ensureNumeric(s,n),this._numerics[s][n]=i}getInstanceId(e){const s=e&DisplayId.a;return this._ensureInstanceId(s),this._instanceIds[s]}setInstanceId(e,s){const i=e&DisplayId.a;this._ensureInstanceId(i),this._instanceIds[i]=s}getComputedStringAtIndex(e,s){const i=e&DisplayId.a;return this._ensureString(s,i),this._strings[s][i]}setComputedStringAtIndex(e,s,i){const n=e&DisplayId.a;this._ensureString(s,n),this._strings[s][n]=i}getXMin(e){return this._bounds[4*(e&DisplayId.a)]}getYMin(e){return this._bounds[4*(e&DisplayId.a)+1]}getXMax(e){return this._bounds[4*(e&DisplayId.a)+2]}getYMax(e){return this._bounds[4*(e&DisplayId.a)+3]}setBounds(e,s){const i=s.readHydratedGeometry();if(!i||!i.coords.length)return!1;let r=1/0,u=1/0,o=-1/0,h=-1/0;i.forEachVertex(((t,e)=>{r=Math.min(r,t),u=Math.min(u,e),o=Math.max(o,t),h=Math.max(h,e)}));const d=e&DisplayId.a;return ComputedAttributeStorage_n(this._bounds,4*d+4,0),this._bounds[4*d]=r,this._bounds[4*d+1]=u,this._bounds[4*d+2]=o,this._bounds[4*d+3]=h,!0}}},"./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReader.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return b}));__webpack_require__("./node_modules/@arcgis/core/geometry.js");var h,u,l,_core_has_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/centroid.js"),_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),_layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedGeometry.js"),_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/StaticBitSet.js"),_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js");let c=0;const m=null!=(h=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("featurelayer-simplify-thresholds"))?h:[.5,.5,.5,.5],_=m[0],g=m[1],p=m[2],y=m[3],f=null!=(u=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("featurelayer-simplify-payload-size-factors"))?u:[1,2,4],I=f[0],x=f[1],A=f[2],j=null!=(l=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("featurelayer-simplify-mobile-factor"))?l:2,S=Object(_core_has_js__WEBPACK_IMPORTED_MODULE_1__.a)("esri-mobile");class b{constructor(e){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=e}static createInstance(){return c++,c=c>65535?0:c,c}get isEmpty(){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(e){this._level=e}getAreaSimplificationThreshold(e,t){let r=1;const s=S?j:1;t>4e6?r=A*s:t>1e6?r=x*s:t>5e5?r=I*s:t>1e5&&(r=s);let i=0;e>4e3?i=y*r:e>2e3?i=p*r:e>100?i=g:e>15&&(i=_);let o=8;return this._level<4?o=1:this._level<5?o=2:this._level<6&&(o=4),i*o}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,s){const i=this.copy();return i._tx+=e,i._ty+=t,i._sx*=r,i._sy*=s,i}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const s of this._joined){s.setIndex(this.getIndex());const r=s._readAttribute(e,t);if(void 0!==r)return r}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const r=t._readAttributes();for(const t of Object.keys(r))e[t]=r[t]}return e}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_4__.k)(e,this.geometryType,this.hasZ,this.hasM),r=Object(_geometry_support_jsonUtils_js__WEBPACK_IMPORTED_MODULE_7__.a)(t);return r&&(r.spatialReference=this._arcadeSpatialReference),r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}removeIds(e){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.k)(this._objectIdToIndex)){const e=new Map,t=this.getCursor();for(;t.next();)e.set(t.getObjectId(),t.getIndex());this._objectIdToIndex=e}const t=this._objectIdToIndex;for(const r of e)t.has(r)&&this.removeAtIndex(t.get(r))}removeAtIndex(e){Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.k)(this._deleted)&&(this._deleted=_StaticBitSet_js__WEBPACK_IMPORTED_MODULE_6__.a.create(this.getSize())),this._deleted.set(e)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const e=this.getCursor();for(;e.next();)yield e.readOptimizedFeature()}_getExists(){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.k)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.v)(this.getQuantizationTransform(),null);return Object(_layers_graphics_centroid_js__WEBPACK_IMPORTED_MODULE_3__.a)(new _layers_graphics_OptimizedGeometry_js__WEBPACK_IMPORTED_MODULE_5__.a,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex}}},"./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReaderJSON.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return d}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedFeature.js"),_FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReader.js");class d extends _FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_3__.a{constructor(t,e,r){super(t),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=e}static fromFeatures(t,e,s){const i=Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.c)([],t,e,!1,!1,s);for(let r=0;r<i.length;r++)i[r].displayId=t[r].displayId;return d.fromOptimizedFeatures(i,e)}static fromFeatureSet(t,e){const r=Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.b)(t,e);return d.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(t){const{features:e,geometryType:r}=t,s=d.fromOptimizedFeatures(e,r);s._exceededTransferLimit=t.exceededTransferLimit,s._transform=t.transform;for(const i of t.fields)"esriFieldTypeDate"===i.type&&s._dateFields.add(i.name);return s}static fromOptimizedFeatures(t,e,r){const s=_FeatureSetReader_js__WEBPACK_IMPORTED_MODULE_3__.a.createInstance(),i=new d(s,t,e);return i._transform=r,i}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(t){const e=new Set(t);this._features=this._features.filter((t=>!e.has(t.objectId)))}append(t){for(const e of t)this._features.push(e)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getIndex(){return this._featureIndex}setIndex(t){this._featureIndex=t}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){this._current.displayId=t}getGroupId(){return this._current.groupId}setGroupId(t){this._current.groupId=t}copy(){const t=new d(this.instance,this._features,this.geometryType);return this.copyInto(t),t}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.i)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const t=this.readGeometry();return Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.k)(t,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const e=this.readCentroid();return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(e)?null:{x:e.coords[0]*this._sx+this._tx,y:e.coords[1]*this._sy+this._ty}}readGeometryArea(){return Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current)?Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.s)(this._current.geometry,2):0}readUnquantizedGeometry(){const t=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!t)return t;const e=t.clone();return function c({coords:t,lengths:e}){let r=0;for(const s of e){for(let e=1;e<s;e++)t[2*(r+e)]+=t[2*(r+e)-2],t[2*(r+e)+1]+=t[2*(r+e)-1];r+=s}}(e),e}readHydratedGeometry(){const r=this._current.geometry;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(r))return null;const s=r.clone();return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(this._transform)&&Object(_layers_graphics_featureConversionUtils_js__WEBPACK_IMPORTED_MODULE_1__.z)(s,s,this.hasZ,this.hasM,this._transform),s}getXHydrated(){if(!Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current))return 0;const e=this._current.geometry.coords[0],r=this.getQuantizationTransform();return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(r)?e:e*r.scale[0]+r.translate[0]}getYHydrated(){if(!Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current))return 0;const e=this._current.geometry.coords[1],r=this.getQuantizationTransform();return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(r)?e:r.translate[1]-e*r.scale[1]}getX(){return Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current))return null;const t=this._current.geometry.clone();if(t.isPoint)return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sy+this._ty,t;let e=0;for(const r of t.lengths)t.coords[2*e]=t.coords[2*e]*this._sx+this._tx,t.coords[2*e+1]=t.coords[2*e+1]*this._sy+this._ty,e+=r;return t}readCentroid(){if(!Object(_layers_graphics_OptimizedFeature_js__WEBPACK_IMPORTED_MODULE_2__.c)(this._current))return null;if(!this._current.centroid){const t=this._computeCentroid();if(!t)return null;t.coords[0]=(t.coords[0]-this._tx)/this._sx,t.coords[1]=(t.coords[1]-this._ty)/this._sy,this._current.centroid=t}const t=this._current.centroid.clone();return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sx+this._ty,t}_readAttribute(t,e){const r=this._current.attributes[t];if(void 0!==r)return null!=r&&e&&this._dateFields.has(t)?new Date(r):r;const s=this.readAttributes(),i=t.toLocaleLowerCase().trim();for(const n in s)if(n.toLocaleLowerCase().trim()===i){const t=this._current.attributes[n];return null!=t&&e&&this._dateFields.has(n)?new Date(t):t}}copyInto(t){super.copyInto(t),t._featureIndex=this._featureIndex,t._transform=this._transform,t._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}},"./node_modules/@arcgis/core/views/2d/layers/features/support/StaticBitSet.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return t}));class t{constructor(t,e){this._mask=0,this._buf=t,this._mask=e}static fromBuffer(e,s){return new t(e,s)}static create(e,s=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new t(r,s)}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let s=t,r=e;for(;s%32&&s!==r;){if(this.has(s))return!0;s++}for(;r%32&&s!==r;){if(this.has(s))return!0;r--}if(s===r)return!1;for(let h=s/32;h!==r/32;h++)if(this._buf[h])return!0;return!1}set(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]|=r}setRange(t,e){let s=t,r=e;for(;s%32&&s!==r;)this.set(s++);for(;r%32&&s!==r;)this.set(r--);if(s!==r)for(let h=s/32;h!==r/32;h++)this._buf[h]=4294967295}unset(t){const e=this._mask&t,s=this._getIndex(e),r=1<<e%32;this._buf[s]&=4294967295^r}resize(t){const e=this._buf,s=new Uint32Array(Math.ceil(t/32));s.set(e),this._buf=s}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0}forEachSet(t){for(let e=0;e<this._buf.length;e++){let s=this._buf[e],r=32*e;if(s)for(;s;)1&s&&t(r),s>>>=1,r++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}},"./node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/visualVariablesUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return m})),__webpack_require__.d(__webpack_exports__,"b",(function(){return r}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),_engine_webgl_color_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/color.js"),_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js"),_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_engine_webgl_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/visualVariablesUtils.js");function r(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function u(e){return e.map((e=>function a(e){return{value:e.value,size:Object(_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_1__.j)(e.size)}}(e)))}function c(e){if("string"==typeof e||"number"==typeof e)return Object(_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_1__.j)(e);const s=e;return{type:"size",expression:s.expression,stops:u(s.stops)}}const f=e=>{const t=[],n=[],i=u(e),l=i.length;for(let r=0;r<6;r++){const e=i[Math.min(r,l-1)];t.push(e.value),n.push(null==e.size?_engine_webgl_definitions_js__WEBPACK_IMPORTED_MODULE_3__.u:Object(_core_screenUtils_js__WEBPACK_IMPORTED_MODULE_1__.g)(e.size))}return{values:new Float32Array(t),sizes:new Float32Array(n)}};function m(e){const t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(const n of e)if(n.field&&(t[n.type]=n.field),"size"===n.type){s.size||(s.size={});const e=n;switch(Object(_engine_webgl_visualVariablesUtils_js__WEBPACK_IMPORTED_MODULE_5__.a)(e)){case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_4__.e.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:c(e.minSize),maxSize:c(e.maxSize)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_4__.e.SIZE_SCALE_STOPS:s.size.scaleStops={stops:u(e.stops)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_4__.e.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const s in e.levels)t[s]=f(e.levels[s]);s.size.fieldStops={type:"level-dependent",levels:t}}else s.size.fieldStops={type:"static",...f(e.stops)};break;case _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_4__.e.SIZE_UNIT_VALUE:s.size.unitValue={unit:e.valueUnit,valueRepresentation:e.valueRepresentation}}}else if("color"===n.type)s.color=y(n);else if("opacity"===n.type)s.opacity=v(n);else if("rotation"===n.type){const e=n;s.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:s}}function v(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const s=e.stops;for(let e=0;e<8;++e){const n=s[Math.min(e,s.length-1)];t.values[e]=n.value,t.opacities[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=s}}return t}function g(e,t,s){e[4*t+0]=s.r/255,e[4*t+1]=s.g/255,e[4*t+2]=s.b/255,e[4*t+3]=s.a}function y(t){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(t))return null;if(t.normalizationField)return null;const s={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;s.field=t.field;const e=t.stops;for(let t=0;t<8;++t){const n=e[Math.min(t,e.length-1)];s.values[t]=n.value,g(s.colors,t,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const e=t.stops&&t.stops.length>=0&&t.stops[0].color;for(let t=0;t<8;t++)s.values[t]=1/0,g(s.colors,t,e)}}for(let e=0;e<32;e+=4)Object(_engine_webgl_color_js__WEBPACK_IMPORTED_MODULE_2__.b)(s.colors,e,!0);return s}},"./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BaseGraphicContainer_t}));var FeatureContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/FeatureContainer.js"),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),vec2f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),vec3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f32.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),Program=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Program.js")),VertexArrayObject=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js")),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js"),Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js");const d=Math.PI/180;class GraphicBoundsRenderer_ extends DisplayObject.a{constructor(t){super(),this._dvsMat3=Object(mat3f32.b)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program&&(this._program.dispose(),this._program=null)}doRender(t){const{context:e}=t,s=this._getBounds();if(s.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,s),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(1,771),e.setColorMask(!0,!0,!0,!0);const r=this._program;e.bindVAO(this._vao),e.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(1,8*s.length,5125,0),e.bindVAO()}_createTransforms(){return{dvs:Object(mat3f32.b)()}}_createShaderProgram(t){if(this._program)return;this._program=new Program.a(t,"precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",GraphicBoundsRenderer_g().attributes)}_updateMatricesAndLocalOrigin(o){const{state:l}=o,{displayMat3:m,size:u,resolution:c,pixelRatio:h,rotation:p,viewpoint:_}=l,g=d*p,{x:v,y:b}=_.targetGeometry,x=Object(normalizeUtils.b)(v,l.spatialReference);this._localOrigin.x=x,this._localOrigin.y=b;const j=h*u[0],y=h*u[1],B=c*j,w=c*y,M=Object(mat3.b)(this._dvsMat3);Object(mat3.k)(M,M,m),Object(mat3.c)(M,M,Object(vec2f32.b)(j/2,y/2)),Object(mat3.d)(M,M,Object(vec3f32.d)(u[0]/B,-y/w,1)),Object(mat3.m)(M,M,-g)}_updateBufferData(t,e){const{x:s,y:r}=this._localOrigin,i=8*e.length,o=new Float32Array(i),a=new Uint32Array(8*e.length);let n=0,f=0;for(const l of e)l&&(o[2*n+0]=l[0]-s,o[2*n+1]=l[1]-r,o[2*n+2]=l[0]-s,o[2*n+3]=l[3]-r,o[2*n+4]=l[2]-s,o[2*n+5]=l[3]-r,o[2*n+6]=l[2]-s,o[2*n+7]=l[1]-r,a[f+0]=n+0,a[f+1]=n+3,a[f+2]=n+3,a[f+3]=n+2,a[f+4]=n+2,a[f+5]=n+1,a[f+6]=n+1,a[f+7]=n+0,n+=4,f+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=BufferObject.a.createVertex(t,35048,o.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=BufferObject.a.createIndex(t,35048,a),!this._vao){const e=GraphicBoundsRenderer_g();this._vao=new VertexArrayObject.a(t,e.attributes,e.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const GraphicBoundsRenderer_g=()=>Object(Utils.g)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:5126}]});class BaseGraphicContainer_t extends FeatureContainer.a{constructor(e){super(e),this.hasHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer&&(this._boundsRenderer.destroy(),this._boundsRenderer=null)}enableRenderingBounds(e){this._boundsRenderer=new GraphicBoundsRenderer_(e),this.requestRender()}get hasLabels(){return!1}onTileData(e,s){e.patch(s),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,s){for(const t of this.children)t.isReady&&t.hasData&&(t.commit(e),e.context.setStencilFunction(514,t.stencilRef,255),t._displayList.replay(e,t,s))}}},"./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicContainer.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return i}));var _engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),_BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/BaseGraphicContainer.js");class i extends _BaseGraphicContainer_js__WEBPACK_IMPORTED_MODULE_1__.a{renderChildren(r){this.attributeView.bindTextures(r.context,!1),this.children.some((e=>e.hasData))&&(super.renderChildren(r),r.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.c.MAP&&this._renderChildren(r),this.hasHighlight()&&r.drawPhase===_engine_webgl_enums_js__WEBPACK_IMPORTED_MODULE_0__.c.HIGHLIGHT&&this._renderHighlight(r),this._boundsRenderer&&this._boundsRenderer.doRender(r))}_renderHighlight(e){const{painter:r}=e,i=r.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}}},"./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return it}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),BidiText=__webpack_require__("./node_modules/@arcgis/core/core/BidiText.js"),HandleOwner=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),SpatialReference=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),coordsUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/coordsUtils.js"),jsonUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/jsonUtils.js"),boundsUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/boundsUtils.js"),intersectsBase=__webpack_require__("./node_modules/@arcgis/core/geometry/support/intersectsBase.js"),normalizeUtilsCommon=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtilsCommon.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js");function normalizeUtilsSync_u(n){if(!n)return null;let r=null;const u=n.spatialReference,d=Object(spatialReferenceUtils.e)(u);if(!d)return"toJSON"in n?n.toJSON():n;const I=Object(spatialReferenceUtils.p)(u)?102100:4326,g=normalizeUtilsCommon.a[I].maxX,j=normalizeUtilsCommon.a[I].minX,M=normalizeUtilsCommon.a[I].plus180Line,N=normalizeUtilsCommon.a[I].minus180Line;let O;const S="toJSON"in n?n.toJSON():n;if(Object(jsonUtils.f)(S))O=normalizeUtilsSync_h(S,g,j);else if(Object(jsonUtils.e)(S))S.points=S.points.map((n=>normalizeUtilsSync_h(n,g,j))),O=S;else if(Object(jsonUtils.d)(S))O=function normalizeUtilsSync_y(n,t){if(!t)return n;const i=function normalizeUtilsSync_d(n,t){const i=[],{ymin:m,ymax:s}=n,e=n.xmax-n.xmin,x=n.xmin,o=n.xmax;let a;const[r,f]=t.valid;a=normalizeUtilsSync_I(n.xmin,t);const c=a.x,l=a.frameId;a=normalizeUtilsSync_I(n.xmax,t);const u=a.x,p=a.frameId,y=c===u&&e>0;if(e>2*f){const n={xmin:x<o?c:u,ymin:m,xmax:f,ymax:s},t={xmin:r,ymin:m,xmax:x<o?u:c,ymax:s},e={xmin:0,ymin:m,xmax:f,ymax:s},a={xmin:r,ymin:m,xmax:0,ymax:s},y=[],h=[];normalizeUtilsSync_g(n,e)&&y.push(l),normalizeUtilsSync_g(n,a)&&h.push(l),normalizeUtilsSync_g(t,e)&&y.push(p),normalizeUtilsSync_g(t,a)&&h.push(p);for(let i=l+1;i<p;i++)y.push(i),h.push(i);i.push({extent:n,frameIds:[l]},{extent:t,frameIds:[p]},{extent:e,frameIds:y},{extent:a,frameIds:h})}else c>u||y?i.push({extent:{xmin:c,ymin:m,xmax:f,ymax:s},frameIds:[l]},{extent:{xmin:r,ymin:m,xmax:u,ymax:s},frameIds:[p]}):i.push({extent:{xmin:c,ymin:m,xmax:u,ymax:s},frameIds:[l]});return i}(n,t).map((n=>n.extent));return i.length<2?i[0]||n:i.length>2?(n.xmin=t.valid[0],n.xmax=t.valid[1],n):{rings:i.map((n=>[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]))}}(S,d);else if(Object(jsonUtils.g)(S)||Object(jsonUtils.h)(S)){const n=J;Object(boundsUtils.a)(n,S);const m={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},s=Object(normalizeUtilsCommon.d)(m.xmin,j)*(2*g),e=0===s?S:function normalizeUtilsSync_p(n,t){const i=Object(normalizeUtilsCommon.b)(n);for(const m of i)for(const n of m)n[0]+=t;return n}(S,s);m.xmin+=s,m.xmax+=s,Object(intersectsBase.b)(m,M)&&m.xmax!==g||Object(intersectsBase.b)(m,N)&&m.xmin!==j?r=e:O=e}else O=S;return null!==r?(new v).cut(r,g):O}function normalizeUtilsSync_h(n,t,i){if(Array.isArray(n)){const m=n[0];if(m>t){const i=Object(normalizeUtilsCommon.d)(m,t);n[0]=m+i*(-2*t)}else if(m<i){const t=Object(normalizeUtilsCommon.d)(m,i);n[0]=m+t*(-2*i)}}else{const m=n.x;if(m>t){const i=Object(normalizeUtilsCommon.d)(m,t);n.x+=i*(-2*t)}else if(m<i){const t=Object(normalizeUtilsCommon.d)(m,i);n.x+=t*(-2*i)}}return n}function normalizeUtilsSync_I(n,t){const[i,m]=t.valid,s=2*m;let e,x=0;return n>m?(e=Math.ceil(Math.abs(n-m)/s),n-=e*s,x=e):n<i&&(e=Math.ceil(Math.abs(n-i)/s),n+=e*s,x=-e),{x:n,frameId:x}}function normalizeUtilsSync_g(n,t){const{xmin:i,ymin:m,xmax:s,ymax:e}=t;return normalizeUtilsSync_j(n,i,m)&&normalizeUtilsSync_j(n,i,e)&&normalizeUtilsSync_j(n,s,e)&&normalizeUtilsSync_j(n,s,m)}function normalizeUtilsSync_j(n,t,i){return t>=n.xmin&&t<=n.xmax&&i>=n.ymin&&i<=n.ymax}class v{cut(n,t){let i;if(n.rings)this.closed=!0,i=n.rings,this.minPts=4;else{if(!n.paths)return null;this.closed=!1,i=n.paths,this.minPts=2}const m=i.length,s=-2*t;for(let e=0;e<m;e++){const n=i[e];if(n&&n.length>=this.minPts){const t=[];for(const i of n)t.push([i[0]+s,i[1]]);i.push(t)}}return this.closed?n.rings=i:n.paths=i,n}}const J=Object(aaBoundingRect.l)();var projectionSupport=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/projectionSupport.js"),CIMSymbolHelper=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js"),defaults=__webpack_require__("./node_modules/@arcgis/core/symbols/support/defaults.js"),definitions=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js");class DirtyMap_e{constructor(){this._dirties=[{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1},{vertexFrom:-1,vertexCount:-1,indexFrom:-1,indexCount:-1,allDirty:!1}]}hasDirty(){return this._dirties.some((e=>-1!==e.indexCount||e.allDirty))}markAllClean(){for(const e of this._dirties)e.indexFrom=-1,e.indexCount=-1,e.vertexFrom=-1,e.vertexCount=-1,e.allDirty=!1}markAllDirty(){for(const t of this._dirties)t.allDirty=!0}forEach(e){for(let r=0;r<this._dirties.length;++r){const{indexCount:i,indexFrom:o,vertexCount:n,vertexFrom:x,allDirty:l}=this._dirties[r],s={};let d,m=!1;(l||-1!==x&&n>0)&&(s.geometry={count:n,from:x,allDirty:l},m=!0),(l||-1!==o&&i>0)&&(d={count:i,from:o,allDirty:l},m=!0),m&&e({indices:d,vertices:s},r)}}markDirtyIndices(e,r,i){const o=this._dirties[e],n=r,x=i;if(!o.allDirty)if(-1!==o.indexCount){const t=Math.min(o.indexFrom,n),e=Math.max(o.indexFrom+o.indexCount,n+x)-t;o.indexFrom=t,o.indexCount=e}else o.indexFrom=n,o.indexCount=x}markDirtyVertices(e,r,i,o){const n=this._dirties[e],x=i,l=o;if(!n.allDirty)if(-1!==n.vertexCount){const t=Math.min(n.vertexFrom,x),e=Math.max(n.vertexFrom+n.vertexCount,x+l)-t;n.vertexFrom=t,n.vertexCount=e}else n.vertexFrom=x,n.vertexCount=l}}class FreeList_e{constructor(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}get largestRange(){return this._largestRange}rangeCreated(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}rangeResized(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}findBestRange(e){let t=this._parent._freeHead,n=null;for(;null!==t;)t.count>=e&&(!n||t.count-e<n.count-e)&&(n=t),t=t.next;return n}findAdjacentRanges(e,t){let n=!0,r=!1,s=null,o=this._parent._freeHead;for(;n&&!r;){const a=null!==s?s.from+s.count:0,l=null!==o?o.from:this._parent._size;e>=a&&e+t<=l?(n=!1,r=!0):null!==o?(s=o,o=o.next):n=!1}return[s,o]}_updateLargestRange(){let e=null,t=this._parent._freeHead;for(;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}class FreeList_t{constructor(t,n){this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=n||new FreeList_e(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(e){const n=this._bookKeeper.findBestRange(e);if(null===n)return-1;const r=n.from,s=n.count;if(n.from+=e,n.count-=e,this._bookKeeper.rangeResized(n,r,s),this._allocated+=e,0===n.count){const e=null!==n.prev?this._freeHead:n.next;FreeList_t._removeRange(n),this._freeHead=e}return r}free(e,n){const[r,s]=this._bookKeeper.findAdjacentRanges(e,n),o={from:e,count:n,prev:r,next:s};if(null!==r&&(r.next=o),null!==s&&(s.prev=o),this._bookKeeper.rangeCreated(o),this._allocated-=n,null!==s&&o.from+o.count===s.from){const e=o.from,n=o.count;FreeList_t._fuse(o,s),FreeList_t._removeRange(s),this._bookKeeper.rangeResized(o,e,n),this._bookKeeper.rangeResized(s,void 0,0)}if(null!==r&&r.from+r.count===o.from){const e=r.from,n=r.count;FreeList_t._fuse(r,o),FreeList_t._removeRange(o),this._bookKeeper.rangeResized(r,e,n),this._bookKeeper.rangeResized(o,void 0,0)}this._freeHead=null!==o.prev?this._freeHead:o}get fragmentation(){const e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}static _removeRange(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}static _fuse(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}var Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js");const DisplayRecordStore_s=["FILL","LINE","MARKER","TEXT","LABEL"];class DisplayRecordStore_d{constructor(r,i,s,o){this._strides=r,this._displayList=i,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=s;for(const n in r){this._freeListsAndStorage[n]={vtxFreeList:o?new FreeList_t(o):null,idxFreeList:o?new FreeList_t(o):null,vertexBuffers:{},indexBuffer:o?new Uint32Array(o):null};for(const e in r[n])this._freeListsAndStorage[n].vertexBuffers[e]={data:o?Object(Utils.b)(o,r[n][e]):null,stride:r[n][e]}}}static fromTileData(t,i){const n=function DisplayRecordStore_o(e){const t=e.getStrides(),r={};for(let i=0;i<t.length;i++)r[DisplayRecordStore_s[i]]=t[i];return r}(t),a=[0,0,0,0,0],x=[0,0,0,0,0],u=t.tileDisplayData.displayObjects;for(const e of u)for(const t of e.displayRecords)a[t.geometryType]=Math.max(a[t.geometryType],t.vertexFrom+t.vertexCount),x[t.geometryType]=Math.max(x[t.geometryType],t.indexFrom+t.indexCount);const f=new DisplayRecordStore_d(n,t.tileDisplayData.displayList,i,null);for(let o=0;o<t.tileBufferData.geometries.length;++o){const i=a[o],n=x[o],d=t.tileBufferData.geometries[o],u=DisplayRecordStore_s[o],l=f._storageFor(u),c=t.tileBufferData.geometries[o].indexBuffer;let m;l.indexBuffer=c,l.idxFreeList=new FreeList_t(c.length),l.idxFreeList.allocate(n);for(const e in d.vertexBuffer){const i=t.tileBufferData.geometries[o].vertexBuffer[e];l.vertexBuffers[e].data=i.data,l.vertexBuffers[e].stride=i.stride;const s=Object(Utils.A)(i.stride),n=i.data.length*s/i.stride;m||(m=n)}l.vtxFreeList=new FreeList_t(m),l.vtxFreeList.allocate(i)}return f}delete(e){const t=DisplayRecordStore_s[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}setMeshData(e,t,r,o,n){const d=DisplayRecordStore_s[e.geometryType];let a,x;e.meshData=null,void 0===e.vertexFrom?(x=t.vertexCount,a=this._allocateVertices(d,x)):t.vertexCount>e.vertexCount?(this._freeVertices(d,e.vertexFrom,e.vertexCount),x=t.vertexCount,a=this._allocateVertices(d,x)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,x=e.vertexCount):(this._freeVertices(d,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,x=t.vertexCount);let u,f,l,c=!0;if(void 0===e.indexFrom?(u=n,l=t.indexCount,f=this._allocateIndices(d,l)):t.indexCount>e.indexCount?(u=this._displayList.removeFromList(e),this._freeIndices(d,e.indexFrom,e.indexCount),l=t.indexCount,f=this._allocateIndices(d,l)):t.indexCount===e.indexCount?(c=!1,f=e.indexFrom,l=e.indexCount):(u=this._displayList.removeFromList(e),this._freeIndices(d,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),f=e.indexFrom,l=t.indexCount),-1!==a&&-1!==f){const s=this._storageFor(d);if(Object(Utils.e)(a,f,s.vertexBuffers,s.indexBuffer,t,r,o),e.vertexFrom=a,e.indexFrom=f,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,e.vertexFrom,e.vertexCount)}return c&&this._displayList.addToList(e,u),!0}return-1!==a&&this._freeVertices(d,a,x),-1!==f&&this._freeIndices(d,f,l),e.setMeshDataFromBuffers(t,r,o),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}tryAddMeshData(e,t){const r=t.vertexBuffer,o=t.indexBuffer,n=DisplayRecordStore_s[e.geometryType],d=this._allocateVertices(n,e.vertexCount);if(-1===d)return this._freeVertices(n,d,e.vertexCount),!1;const a=this._allocateIndices(n,e.indexCount);if(-1===a)return this._freeVertices(n,d,e.vertexCount),this._freeIndices(n,a,e.indexCount),!1;const x=this._storageFor(n);if(Object(Utils.e)(d,a,x.vertexBuffers,x.indexBuffer,e,r,o),e.vertexFrom=d,e.indexFrom=a,this._dirtyMap){this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount);for(const t in r)this._dirtyMap.markDirtyVertices(e.geometryType,t,d,e.vertexCount)}return this._displayList.addToList(e),!0}_allocateVertices(e,t){const r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>.5?-1:i}_freeVertices(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}_freeIndices(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}_allocateIndices(e,t){const r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>.5?-1:i}_storageFor(e){return this._freeListsAndStorage[e]}_stridesFor(e,t){return this._strides[e][t]}}var BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),VertexArrayObject=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"));class WGLBuffers_a{constructor(t){this.geometryMap=Object(Utils.f)((()=>({indexBuffer:BufferObject.a.createIndex(t,35044),vao:null})),((r,a)=>({vertexBuffer:BufferObject.a.createVertex(t,Utils.a[a])})))}dispose(){for(let e=0;e<5;e++){const t=this.geometryMap[e];if(t){t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose();for(const e in t.buffers)t.buffers[e]&&t.buffers[e].data.vertexBuffer.dispose()}}}get(e){const r=this.geometryMap[e];return{draw(e,s,a,i,f){if(!r.data.vao){const i={};for(const e in r.buffers)i[e]=r.buffers[e].data.vertexBuffer;r.data.vao=new VertexArrayObject.a(e,a,s,i,r.data.indexBuffer)}const o=r.data.vao;e.bindVAO(o),e.drawElements(4,f,5125,Uint32Array.BYTES_PER_ELEMENT*i),e.bindVAO(null)}}}has(e){return null!=this.geometryMap[e]}upload(e,t){t.forEach(((t,r)=>{this._upload(t,r,e)}))}_upload(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){const s=e.vertices;for(const e in s){const a=s[e];a.allDirty?this._uploadVertices(r,t,e):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,e,a.from,a.count)}}}_uploadVertices(e,t,r,s,a){const i=this.geometryMap[t];if(!i)return;const f=e.geometries[t].vertexBuffer[r];if(!f)return;const o=f.stride,n=f.data.buffer;i.buffers[r]&&n.byteLength>0&&(null!=s&&null!=a?i.buffers[r].data.vertexBuffer.setSubData(n,s*o,s*o,(s+a)*o):i.buffers[r].data.vertexBuffer.setData(n))}_uploadIndices(e,t,r,s){const a=this.geometryMap[t];if(!a)return;const f=e.geometries[t].indexBuffer.buffer;a.data.indexBuffer&&f.byteLength>0&&(null!=r&&null!=s?a.data.indexBuffer.setSubData(f,4*r,4*r,4*(r+s)):a.data.indexBuffer.setData(f))}}var WGLTile=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/WGLTile.js");class GraphicTile_a extends WGLTile.a{constructor(){super(...arguments),this._data=null,this._displayList=null,this._lastCommitTime=0,this._hasData=!1,this._invalidated=!1,this._wglBuffers=null,this._dirtyMap=new DirtyMap_e}destroy(){super.destroy(),this.clear()}get hasData(){return!!this._hasData}get displayObjects(){var t;return null!=(t=this._displayObjects)?t:[]}getGeometry(t){return this._wglBuffers&&this._wglBuffers.has(t)?this._wglBuffers.get(t):null}getDisplayList(){return this._displayList}patch(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);const i=e.addOrUpdate,a=e.remove;!this._data&&i&&i.tileDisplayData.displayObjects.length?(i.tileDisplayData.computeDisplayList(),this._dirtyMap=new DirtyMap_e,this._dispRecStore=DisplayRecordStore_d.fromTileData(i,this._dirtyMap),this._data=i,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(i&&i.tileDisplayData.displayObjects.length||a.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}commit(t){t.time&&t.time===this._lastCommitTime||(this._lastCommitTime=t.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new WGLBuffers_a(t.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}clear(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}_doPatchData(t){this._invalidated=!0,this._patchData(t)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=DisplayRecordStore_d.fromTileData(this._data,this._dirtyMap)),this.requestRender()}_patchData(t){let s=!0;const e=t.addOrUpdate&&t.addOrUpdate.tileDisplayData&&t.addOrUpdate.tileDisplayData.displayObjects||[],i=(t.remove||[]).slice();for(const a of e)null!=a.insertAfter&&i.push(a.id);for(const a of i){const t=this._data.tileDisplayData.displayObjectRegistry.get(a);if(t){this._data.tileDisplayData.displayList.removeFromList(t.displayRecords);for(const e of t.displayRecords)this._dispRecStore.delete(e);this._data.tileDisplayData.displayObjectRegistry.delete(a);const s=this._data.tileDisplayData.displayObjects.indexOf(t);this._data.tileDisplayData.displayObjects.splice(s,1)}}for(const a of e){let e,i=this._data.tileDisplayData.displayObjectRegistry.get(a.id);if(i){const t=i.displayRecords;i.set(a),i.displayRecords=t;const s=i.displayRecords.length;for(let e=0;e<s;++e){const t=i.displayRecords[e],s=a.displayRecords[e];(e>=a.displayRecords.length||t.geometryType!==s.geometryType||t.symbolLevel!==s.symbolLevel||t.zOrder!==s.zOrder||t.materialKey!==s.materialKey)&&(this._dispRecStore.delete(i.displayRecords[e]),e<a.displayRecords.length&&(i.displayRecords[e]=void 0))}i.displayRecords.length=a.displayRecords.length}else{let t;i=a.copy(),i.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(a.id,i);const s=this._data.tileDisplayData.displayObjects;if(null!=i.insertAfter)if(e={},i.insertAfter>=0){const e=this._data.tileDisplayData.displayObjectRegistry.get(i.insertAfter);e?(t=s.indexOf(e)+1,t<s.length?s.splice(t,0,i):(s.push(i),t=s.length)):(s.push(i),t=s.length)}else s.unshift(i),t=0;else s.push(i),t=s.length;if(e){const i=a.displayRecords.length>0?1:0;let l=0;for(let a=t-1;a>=0&&l<i;--a)for(let t=s[a].displayRecords.length-1;t>=0&&l<i;--t){const i=s[a].displayRecords[t],d=this._data.tileDisplayData.displayList.getDPInfoType();e[d]||(e[d]=i,++l)}}}const l=a.displayRecords.length;for(let d=0;d<l;++d){const l=a.displayRecords[d];let r=i.displayRecords[d];r?(r.meshData=l.meshData,r.materialKey=l.materialKey):(r=l.copy(),r.vertexFrom=void 0,r.indexFrom=void 0,i.displayRecords[d]=r);const p=l.geometryType,h=this._data.tileDisplayData.displayList.getDPInfoType(),o=t.addOrUpdate.tileBufferData.geometries[p],y=o.vertexBuffer,c=o.indexBuffer;let n;e&&(n=e[h]?this._data.tileDisplayData.displayList.splitAfter(e[h]):-1),s=this._dispRecStore.setMeshData(r,l,y,c,n)&&s,e&&null!=r.indexFrom&&null!=r.indexFrom&&(e[h]=r)}}return s}}class MemoryRequirements_e{constructor(){this._byGeometryType=null}get satisfied(){return!this._byGeometryType}reset(){this._byGeometryType=null}verticesFor(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}indicesFor(e){return this._byGeometryType?this._byGeometryType[e].indices:0}needMore(e,t,i){if(!t&&!i)return;this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);const s=this._byGeometryType[e];s.vertices+=t,s.indices+=i}}class TileBufferData_f{constructor(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}clone(){const e=new TileBufferData_f;for(let r=0;r<this.geometries.length;r++){const f=this.geometries[r],t=e.geometries[r];t.indexBuffer=f.indexBuffer.slice(),t.vertexBuffer={};for(const e in f.vertexBuffer){const{data:r,stride:i}=f.vertexBuffer[e];t.vertexBuffer[e]={data:r.slice(),stride:i}}}return e}static deserialize(t){const i=new TileBufferData_f;for(let f=0;f<5;++f){i.geometries[f].indexBuffer=new Uint32Array(t.geometries[f].indexBuffer),i.geometries[f].vertexBuffer={};for(const r in t.geometries[f].vertexBuffer)i.geometries[f].vertexBuffer[r]={data:Object(Utils.c)(t.geometries[f].vertexBuffer[r].data,t.geometries[f].vertexBuffer[r].stride),stride:t.geometries[f].vertexBuffer[r].stride}}return i}serialize(){const e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]};for(let f=0;f<5;++f)for(const r in this.geometries[f].vertexBuffer)e.geometries[f].vertexBuffer[r]={data:this.geometries[f].vertexBuffer[r].data.buffer,stride:this.geometries[f].vertexBuffer[r].stride};return e}getBuffers(){const e=[];for(let f=0;f<5;++f){e.push(this.geometries[f].indexBuffer.buffer);for(const r in this.geometries[f].vertexBuffer)e.push(this.geometries[f].vertexBuffer[r].data.buffer)}return e}}var webgl_enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js");function GraphicDisplayList_n(e,t,n,...o){t<e.length?e.splice(t,n,...o):e.push(...o)}const GraphicDisplayList_o=new Map;GraphicDisplayList_o.set(webgl_enums.c.MAP,[webgl_enums.d.FILL,webgl_enums.d.LINE,webgl_enums.d.MARKER,webgl_enums.d.TEXT]),GraphicDisplayList_o.set(webgl_enums.c.LABEL,[webgl_enums.d.LABEL]),GraphicDisplayList_o.set(webgl_enums.c.LABEL_ALPHA,[webgl_enums.d.LABEL]);class GraphicDisplayList_i{constructor(){this.symbolLevels=[]}replay(e,t,n){for(const o of this.symbolLevels)for(const i of o.zLevels){const o=i.geometryDPInfo.unified;if(o)for(const i of o){const o=e.painter.getGeometryBrush(i.geometryType),r=t.getGeometry(i.geometryType),s={geometryType:i.geometryType,materialKey:i.materialKey,indexFrom:i.indexFrom,indexCount:i.indexCount,draw:(e,t,n)=>{r.draw(e,t,n,i.indexFrom,i.indexCount)}};o.prepareState(e,t),o.drawGeometry(e,t,s,n)}}}get empty(){return!this.symbolLevels||0===this.symbolLevels.length}clear(){this.symbolLevels.length=0}addToList(e,t){if(Array.isArray(e))for(const n of e)this._addToList(n,t);else this._addToList(e,t)}removeFromList(e){Array.isArray(e)||(e=[e]);let t=null;for(const n of e)t=this._removeFromList(n);return t}clone(){const e=new GraphicDisplayList_i;for(const t of this.symbolLevels)e.symbolLevels.push(t.clone());return e}splitAfter(e){const t=this._getDisplayList(e.symbolLevel,e.zOrder),n=t.length,o=e.indexFrom+e.indexCount;for(let i=0;i<n;++i){const n=t[i];if(n.geometryType===e.geometryType&&o>n.indexFrom&&o<=n.indexFrom+n.indexCount){if(o<n.indexFrom+n.indexCount){const e=new GraphicDisplayList_r;e.geometryType=n.geometryType,e.materialKey=n.materialKey,e.indexFrom=o,e.indexCount=n.indexFrom+n.indexCount-o,t.splice(i+1,0,e),n.indexCount=o-n.indexFrom}return i}}}_addToList(e,t){const o=e.symbolLevel,i=e.zOrder,s=this._getDisplayList(o,i),l=null!=t?t:s.length-1,m=l>=0&&l<s.length?s[l]:null;if(null!==m&&m.materialKey===e.materialKey&&m.indexFrom+m.indexCount===e.indexFrom&&m.geometryType===e.geometryType)m.indexCount+=e.indexCount;else{const t=new GraphicDisplayList_r;t.indexFrom=e.indexFrom,t.indexCount=e.indexCount,t.materialKey=e.materialKey,t.geometryType=e.geometryType,GraphicDisplayList_n(s,l+1,0,t)}}_removeFromList(e){const t=e.symbolLevel,o=e.zOrder,i=this._getDisplayList(t,o),s=i.length;let l;for(let n=0;n<s;++n){const t=i[n];if(e.indexFrom+e.indexCount>t.indexFrom&&e.indexFrom<t.indexFrom+t.indexCount&&t.geometryType===e.geometryType){l=n;break}}if(void 0!==l){const t=i[l];if(e.indexFrom===t.indexFrom)return t.indexCount-=e.indexCount,t.indexFrom+=e.indexCount,0===t.indexCount&&GraphicDisplayList_n(i,l,1),l-1;if(e.indexFrom+e.indexCount===t.indexFrom+t.indexCount)return t.indexCount-=e.indexCount,0===t.indexCount?(GraphicDisplayList_n(i,l,1),l-1):l;{const o=t.indexFrom,s=e.indexFrom-t.indexFrom,m=e.indexCount,d=t.indexFrom+t.indexCount-(e.indexFrom+e.indexCount);t.indexCount=s;const y=new GraphicDisplayList_r;return y.geometryType=t.geometryType,y.materialKey=t.materialKey,y.indexFrom=o+s+m,y.indexCount=d,GraphicDisplayList_n(i,l+1,0,y),l}}return null}_getDisplayList(e,t){let n;const o=this.symbolLevels.length;for(let s=0;s<o;s++)if(this.symbolLevels[s].symbolLevel===e){n=this.symbolLevels[s];break}let i;n||(n=new GraphicDisplayList_m,n.symbolLevel=e,this.symbolLevels.push(n));const r=n.zLevels.length;for(let s=0;s<r;s++)if(n.zLevels[s].zLevel===t){i=n.zLevels[s];break}return i||(i=new GraphicDisplayList_l,i.geometryDPInfo=new GraphicDisplayList_s,i.zLevel=t,n.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}getDPInfoType(){return"unified"}}class GraphicDisplayList_r{constructor(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}clone(){const e=new GraphicDisplayList_r;return e.geometryType=this.geometryType,e.materialKey=this.materialKey,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e}}class GraphicDisplayList_s{constructor(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}clone(){const e=new GraphicDisplayList_s;return e.fill=this.fill&&this.fill.map((e=>e.clone())),e.line=this.line&&this.line.map((e=>e.clone())),e.marker=this.marker&&this.marker.map((e=>e.clone())),e.text=this.text&&this.text.map((e=>e.clone())),e.label=this.label&&this.label.map((e=>e.clone())),e.unified=this.unified&&this.unified.map((e=>e.clone())),e}}class GraphicDisplayList_l{constructor(){this.geometryDPInfo=new GraphicDisplayList_s}clone(){const e=new GraphicDisplayList_l;return e.zLevel=this.zLevel,e.geometryDPInfo=this.geometryDPInfo.clone(),e}}class GraphicDisplayList_m{constructor(){this.zLevels=[]}clone(){const e=new GraphicDisplayList_m;e.symbolLevel=this.symbolLevel;for(const t of this.zLevels)e.zLevels.push(t.clone());return e}}class MeshData_t{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(t,e,a){for(const s in t)this.vertexData.set(s,t[s]);for(const s in this.vertexData)null===t[s]&&this.vertexData.delete(s);this.vertexCount=e,this.indexData=a}}class WGLDisplayRecord_s{constructor(t,e,s,r=0,i=0){this.id=t,this.geometryType=e,this.materialKey=s,this.minZoom=r,this.maxZoom=i,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const t=new WGLDisplayRecord_s(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}setMeshDataFromBuffers(s,r,i){const o=new MeshData_t;for(const t in r){const i=r[t].stride,a=r[t].data,h=[],n=Object(Utils.A)(i);for(let t=0;t<i*s.vertexCount/n;++t)h[t]=a[t+i*s.vertexFrom/n];o.vertexData.set(t,h)}o.indexData.length=0;for(let t=0;t<s.indexCount;++t)o.indexData[t]=i[t+s.indexFrom]-s.vertexFrom;o.vertexCount=s.vertexCount,this.meshData=o}readMeshDataFromBuffers(s,r){this.meshData?this.meshData.clear():this.meshData=new MeshData_t;for(const t in s){const r=s[t].stride,i=s[t].data,o=[],a=Object(Utils.A)(r);for(let t=0;t<r*this.vertexCount/a;++t)o[t]=i[t+r*this.vertexFrom/a];this.meshData.vertexData.set(t,o)}this.meshData.indexData.length=0;for(let t=0;t<this.indexCount;++t)this.meshData.indexData[t]=r[t+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(t,s,r,i){for(const o in s){const r=s[o].stride,i=this.meshData.vertexData.get(o),a=s[o].data,h=Object(Utils.A)(r);for(let e=0;e<r*this.meshData.vertexCount/h;++e)a[e+r*t/h]=i[e]}for(let e=0;e<this.meshData.indexData.length;++e)i[e+r]=this.meshData.indexData[e]+t;this.vertexFrom=t,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(t,e,s){let r=0,i=0;for(const o of t)o.writeMeshDataToBuffers(r,e,i,s),r+=o.vertexCount,i+=o.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(t){return t.push(this.geometryType),t.push(this.materialKey),t.push(this.vertexFrom),t.push(this.vertexCount),t.push(this.indexFrom),t.push(this.indexCount),t.push(this.minZoom),t.push(this.maxZoom),t}static deserialize(t,e){const r=t.readInt32(),i=t.readInt32(),o=new WGLDisplayRecord_s(e.id,r,i);return o.vertexFrom=t.readInt32(),o.vertexCount=t.readInt32(),o.indexFrom=t.readInt32(),o.indexCount=t.readInt32(),o.minZoom=t.readInt32(),o.maxZoom=t.readInt32(),o}}function serializationUtils_e(e,n){if(null!==n){e.push(n.length);for(const r of n)r.serialize(e);return e}e.push(0)}class WGLDisplayObject_e{constructor(s){this.insertAfter=null,this.id=s,this.displayRecords=[]}copy(){const s=new WGLDisplayObject_e(this.id);return s.set(this),s}clone(){const s=new WGLDisplayObject_e(this.id);return s.displayRecords=this.displayRecords.map((s=>s.clone())),s.insertAfter=this.insertAfter,s}set(s){this.id=s.id,this.displayRecords=s.displayRecords,this.insertAfter=s.insertAfter}serialize(s){return s.push(this.id),serializationUtils_e(s,this.displayRecords),s}static deserialize(i){const r=i.readInt32(),d=new WGLDisplayObject_e(r),o={id:r};return d.displayRecords=function serializationUtils_n(e,n,r){const t=e.readInt32(),o=new Array(t);for(let i=0;i<o.length;i++)o[i]=n.deserialize(e,r);return o}(i,WGLDisplayRecord_s,o),d}}class TileDisplayData_r{constructor(){}get displayObjectRegistry(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(const s of this.displayObjects)this._displayObjectRegistry.set(s.id,s)}return this._displayObjectRegistry}get displayList(){return this._displayList}computeDisplayList(){this._displayList=new GraphicDisplayList_i;for(const s of this.displayObjects)for(const t of s.displayRecords)this._displayList.addToList(t)}clone(){const s=new TileDisplayData_r;return this.displayObjects&&(s.displayObjects=this.displayObjects.map((s=>s.clone()))),s}serialize(s){return serializationUtils_e(s,this.displayObjects),s}_deserializeObjects(s){const i=s.readInt32(),e=new Array(i),r=new Map;for(let a=0;a<e.length;++a){const i=WGLDisplayObject_e.deserialize(s);e[a]=i,r.set(i.id,i)}this.displayObjects=e,this._displayList=null,this._displayObjectRegistry=r}static deserialize(s){const t=new TileDisplayData_r;return t._deserializeObjects(s),t}}var DisplayRecordReader=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/cpuMapped/DisplayRecordReader.js");class VertexBuffer_t{constructor(e,t){this.data=e,this.stride=t}static decode(r){const s=Object(Utils.c)(r.data,r.stride),n=r.stride;return new VertexBuffer_t(s,n)}static fromVertexVector(r){const s=Object(Utils.c)(r.data.buffer(),r.stride),n=r.stride;return new VertexBuffer_t(s,n)}}class VertexBuffer_r{constructor(e,t,r){this.geometryType=e,this.indexBuffer=new Uint32Array(t),this.namedBuffers=r}static decode(e){const s=e.geometryType,n=e.indexBuffer,o={};for(const r in e.namedBuffers)o[r]=VertexBuffer_t.decode(e.namedBuffers[r]);return new VertexBuffer_r(s,n,o)}static fromVertexData(s,n){const o=s.indices,c=Object(Utils.c)(s.vertices,s.stride),i=s.stride,d={geometry:new VertexBuffer_t(c,i)};return new VertexBuffer_r(n,o,d)}static fromVertexVectors(e){const s=e.geometryType,n=e.indexVector.buffer(),o={};for(const r in e.namedVectors)o[r]=VertexBuffer_t.fromVertexVector(e.namedVectors[r]);return new VertexBuffer_r(s,n,o)}}var Writer=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/util/Writer.js");class VertexVector_s{constructor(t,e){this.data=t,this.stride=e}get vertexCount(){const t=this.stride/4,e=this.data.length/t;return e!==(0|e)&&console.debug("Corrupted stride"),e}transfer(t,e){const r=this.data.buffer();t.vertexCount=this.vertexCount,t.data=r,t.stride=this.stride,e.push(r)}}class VertexVector_o{constructor(e,o,n){this.geometryType=e,this.indexVector=new Writer.a(Uint32Array,6*o),this.namedVectors={};const i=Object(Utils.n)(e,n);for(const t in i){const e=i[t];let n;switch(e%4){case 0:case 2:n=new Writer.a(Uint32Array,e*o);break;case 1:case 3:n=new Writer.a(Uint8Array,e*o)}this.namedVectors[t]=new VertexVector_s(n,e)}}get(t){return this.namedVectors[t].data}getVector(t){return this.namedVectors[t]}transfer(t,e){const r=this.indexVector.buffer(),s={};e.push(r);for(const o in this.namedVectors){const t=this.namedVectors[o];s[o]={},t.transfer(s[o],e)}t.geometryType=this.geometryType,t.indexBuffer=r,t.namedBuffers=s,this.destroy()}intoBuffers(){const t=VertexBuffer_r.fromVertexVectors(this);return this.destroy(),t}destroy(){this.indexVector=null,this.namedVectors=null}}const D=new MemoryRequirements_e,TileData_d=new MemoryRequirements_e;function TileData_x(e,t){const r={};for(const s in e){const i={data:Object(Utils.b)(t,e[s]),stride:e[s]};r[s]=i}return r}class TileData_y{constructor(){this.tileDisplayData=null,this.tileBufferData=null}reshuffle(){D.reset();const e=function TileDisplayData_e(s){const t=[[],[],[],[],[]],i=s;for(const e of i)for(const s of e.displayRecords)t[s.geometryType].push(s);return t}(this.tileDisplayData.displayObjects);for(const r of e)for(const e of r)e&&D.needMore(e.geometryType,e.meshData?e.meshData.vertexCount:e.vertexCount,e.meshData?e.meshData.indexData.length:e.indexCount);const t=e.length,s=new TileBufferData_f;for(let r=0;r<t;++r){s.geometries[r].indexBuffer=new Uint32Array(Math.round(1.5*D.indicesFor(r)));const e=[];for(const s in this.tileBufferData.geometries[r].vertexBuffer)e.push(this.tileBufferData.geometries[r].vertexBuffer[s].stride);const t=TileData_y._computeVertexAlignment(e),i=Math.round(1.5*D.verticesFor(r)),o=TileData_y._align(i,t);for(const f in this.tileBufferData.geometries[r].vertexBuffer){const e=this.tileBufferData.geometries[r].vertexBuffer[f].stride;s.geometries[r].vertexBuffer[f]={stride:e,data:Object(Utils.b)(o,e)}}}TileData_d.reset(),this.tileDisplayData.displayList.clear();for(let r=0;r<t;++r){const t=e[r];for(const e of t){if(e.meshData)e.writeMeshDataToBuffers(TileData_d.verticesFor(r),s.geometries[r].vertexBuffer,TileData_d.indicesFor(r),s.geometries[r].indexBuffer),e.meshData=null;else{const t=this.tileBufferData.geometries[r].vertexBuffer,i=this.tileBufferData.geometries[r].indexBuffer,a=s.geometries[r].vertexBuffer,f=s.geometries[r].indexBuffer,n=TileData_d.verticesFor(r),l=TileData_d.indicesFor(r);Object(Utils.e)(n,l,a,f,e,t,i),e.vertexFrom=n,e.indexFrom=l}TileData_d.needMore(r,e.vertexCount,e.indexCount)}}for(const r of this.tileDisplayData.displayObjects)this.tileDisplayData.displayList.addToList(r.displayRecords);this.tileBufferData=s}getStrides(){const e=[];for(let t=0;t<this.tileBufferData.geometries.length;++t){const r=this.tileBufferData.geometries[t];e[t]={};for(const s in r.vertexBuffer)e[t][s]=r.vertexBuffer[s].stride}return e}clone(){const e=new TileData_y;return e.tileBufferData=this.tileBufferData.clone(),e.tileDisplayData=this.tileDisplayData.clone(),e}_guessSize(){const{displayObjects:e}=this.tileDisplayData,t=Math.min(e.length,4);let i=0;for(let a=0;a<t;a++)i=Math.max(i,e[a].displayRecords.length);return 2*(12*e.length+e.length*i*40)}serialize(){const e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new Writer.a(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}static fromVertexData(t,r){const s={},i=new Map;for(const e of r)i.set(e.id,e);return Object(Utils.h)((r=>{const a=t.data[r];if(Object(maybe.l)(a)){const e=DisplayRecordReader.a.from(a.records).getCursor();for(;e.next();){const t=e.id,s=e.materialKey,a=e.indexFrom,o=e.indexCount,f=e.vertexFrom,l=e.vertexCount,u=i.get(t),c=new WGLDisplayRecord_s(t,r,s);c.indexFrom=a,c.indexCount=o,c.vertexFrom=f,c.vertexCount=l,u.displayRecords.push(c)}s[r]=VertexBuffer_r.fromVertexData(a,r)}else s[r]=new VertexVector_o(r,0,{fill:"default"}).intoBuffers()})),TileData_y.fromMeshData({displayObjects:r,vertexBuffersMap:s})}static fromMeshData(e){const t=new TileData_y,i=new TileDisplayData_r,a=new TileBufferData_f;i.displayObjects=e.displayObjects;for(const r in e.vertexBuffersMap){const t=e.vertexBuffersMap[r];a.geometries[r].indexBuffer=t.indexBuffer,a.geometries[r].vertexBuffer=t.namedBuffers}return t.tileDisplayData=i,t.tileBufferData=a,t}static bind(e,t){const r=new TileData_y;return r.tileDisplayData=e,r.tileBufferData=t,r}static create(e,t){const i=new TileData_y;i.tileDisplayData=new TileDisplayData_r,i.tileDisplayData.displayObjects=e;const a=[0,0,0,0,0],o=[0,0,0,0,0],f=[[],[],[],[],[]];for(const r of e)for(const e of r.displayRecords)f[e.geometryType].push(e),a[e.geometryType]+=e.meshData.vertexCount,o[e.geometryType]+=e.meshData.indexData.length;const l=new TileBufferData_f,u=function B(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(t);for(let r=0;r<5;r++){const e=new Uint32Array(o[r]),t=TileData_x(u[r],a[r]);WGLDisplayRecord_s.writeAllMeshDataToBuffers(f[r],t,e),l.geometries[r]={indexBuffer:e,vertexBuffer:t}}return i.tileBufferData=l,i}static _align(e,t){const r=e%t;return 0===r?e:e+(t-r)}static _computeVertexAlignment(e){let t=!1,r=!1;for(const s of e)s%4==2?t=!0:s%4!=0&&(r=!0);return r?4:t?2:1}}var MeshData=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/mesh/MeshData.js"),WGLMeshFactory=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/mesh/factories/WGLMeshFactory.js"),WGLTemplateStore=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLTemplateStore.js"),Matcher=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/util/Matcher.js"),schemaUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/schemaUtils.js"),AttributeStore=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/AttributeStore.js"),ComputedAttributeStorage=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/ComputedAttributeStorage.js"),featureConversionUtils=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/featureConversionUtils.js"),FeatureSetReader=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReader.js"),FeatureSetReaderJSON=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReaderJSON.js");class GraphicsReader_o extends FeatureSetReaderJSON.a{constructor(r,t){super(r,t,null)}static from(s){const n=FeatureSetReader.a.createInstance(),i=[],c=s.filter((r=>!!r.geometry));for(const e of c){const s=Object(jsonUtils.c)(e.geometry);Object(featureConversionUtils.e)(i,[e],s,!1,!1,"uid")}return new GraphicsReader_o(n,i)}get geometryType(){const r=this._current;return r?r.geometryType:null}get insertAfter(){return this._current.insertAfter}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){const r=new GraphicsReader_o(this.instance,this._features);return this.copyInto(r),r}}var screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),rbush=__webpack_require__("./node_modules/@arcgis/core/chunks/rbush.js"),normalizeUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/normalizeUtils.js"),CIMSymbolDrawHelper=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMSymbolDrawHelper.js"),centroid=__webpack_require__("./node_modules/@arcgis/core/geometry/support/centroid.js"),quantizationUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/quantizationUtils.js"),OptimizedGeometry=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/OptimizedGeometry.js"),graphicsUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/graphicsUtils.js");const GraphicStoreItem_d=new OptimizedGeometry.a,z=new OptimizedGeometry.a,b="esriGeometryPolyline";function GraphicStoreItem_j(t){t.coords.length=0,t.lengths.length=0}class GraphicStoreItem_{constructor(){this.bounds=Object(aaBoundingRect.l)(),this.graphic=null}static acquire(t=null,e,s,r,o){let i;return 0===GraphicStoreItem_._pool.length?i=new GraphicStoreItem_:(i=GraphicStoreItem_._pool.pop(),this._set.delete(i)),i.acquire(t,e,s,r,o),i}static release(t){t&&!this._set.has(t)&&(t.release(),this._pool.push(t),this._set.add(t))}static getCentroidQuantized(e,s){if(Object(jsonUtils.g)(e.geometry)){const o=e.symbol;if(Object(maybe.k)(o))return null;if(Object(graphicsUtils.f)(o.type)||Object(graphicsUtils.g)(o.type)){const t=Object(centroid.a)(e.geometry);return Object(quantizationUtils.b)(s,{},{x:t[0],y:t[1]},!1,!1)}}return null}acquire(t=null,e,s,r,o){t&&this.set(t,e,s,r,o)}release(){this.graphic=null,this.symbolResource=null,this.geometry=null}get symbol(){return this.symbolResource.symbol}set(t,e,s,r,o){this.graphic=t,this.geometry=s,this.symbolResource=e,this.bounds=r,o&&(this.size=o)}getGeometryQuantized(t,e,r,h){const g=this.geometry;if(Object(jsonUtils.g)(g)){const e=g.rings;if(1===e.length&&2===e[0].length)return Object(quantizationUtils.a)(t,{paths:[[e[0][0],e[0][1]]]})}else{if(Object(jsonUtils.h)(g))return GraphicStoreItem_j(GraphicStoreItem_d),GraphicStoreItem_j(z),Object(featureConversionUtils.h)(GraphicStoreItem_d,g),Object(featureConversionUtils.q)(z,GraphicStoreItem_d,g.hasZ,g.hasM,b,t.scale[0]),Object(featureConversionUtils.u)(GraphicStoreItem_d,z,g.hasZ,g.hasM,b,t),Object(featureConversionUtils.o)(GraphicStoreItem_d,g.hasZ,g.hasM);if(Object(jsonUtils.e)(g)){const o=.5*h*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]),[i,n]=Object(normalizeUtilsCommon.c)(r),m=n-i,u=g.points.filter((t=>{if(t[0]+o>n||t[0]-o<i){const r=[...t];return t[0]+o>n?r[0]-=m:r[0]+=m,Object(aaBoundingRect.j)(e,t,o)||Object(aaBoundingRect.j)(e,r,o)}return Object(aaBoundingRect.j)(e,t,o)}));return 0===u.length?{points:u}:Object(quantizationUtils.a)(t,{points:u})}}return Object(quantizationUtils.a)(t,this.geometry)}}GraphicStoreItem_._pool=[],GraphicStoreItem_._set=new Set;const GraphicStore_g={minX:0,minY:0,maxX:0,maxY:0},GraphicStore_f=Object(aaBoundingRect.l)();function GraphicStore_b(e,t,r,i,s){return GraphicStore_g.minX=t,GraphicStore_g.minY=r,GraphicStore_g.maxX=i,GraphicStore_g.maxY=s,e.search(GraphicStore_g)}function GraphicStore_y(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}class GraphicStore_I{constructor(e,t,r,s,o,n,h){this._graphics=s,this._onAdd=o,this._onRemove=n,this._hashToCIM=h,this._index=Object(rbush.a)(9,GraphicStore_y),this._itemByGraphic=new Map,this._inflatedSizeHelper=new CIMSymbolHelper.a,this._tileInfoView=e,this._uidFieldName=r;const u=e.getClosestInfoForScale(t);u&&(this._resolution=this._tileInfoView.getTileResolution(u.level))}setResourceManager(e){this._cimResourceManager=e,this._hittestDrawHelper=new CIMSymbolDrawHelper.c(e)}hitTest(e,t,r,i,n){e=Object(normalizeUtils.b)(e,this._tileInfoView.spatialReference);const h=.5*i*window.devicePixelRatio*r;GraphicStore_f[0]=e-h,GraphicStore_f[1]=t-h,GraphicStore_f[2]=e+h,GraphicStore_f[3]=t+h;const a=.5*i*(r+graphicsUtils.a),l=GraphicStore_b(this._index,e-a,t-a,e+a,t+a);if(!l||0===l.length)return[];const c=[],m=Object(aaBoundingRect.l)(),p=Object(aaBoundingRect.l)();for(const s of l){const{geometry:e,symbolResource:t}=s;this._getSymbolBounds(m,t,e,p,n),p[3]=p[2]=p[1]=p[0]=0,Object(aaBoundingRect.w)(m,GraphicStore_f)&&s.graphic.visible&&c.push(s)}if(0===c.length)return[];const g=this._hittestDrawHelper,_=[];for(const s of c){const{geometry:e,symbolResource:t}=s,{hash:r,textInfo:o}=t,h=this._hashToCIM.get(r);h&&g.hitTest(GraphicStore_f,h.symbol,e,o,n,i)&&_.push(s)}return _.sort(GraphicStore_z),_.map((e=>e.graphic))}getGraphicsData(e,t,r){const i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort(((e,t)=>e.zorder-t.zorder)),i[0].insertAfter=-1;for(let l=1;l<i.length;l++)i[l].insertAfter=i[l-1].graphic.uid;i.sort(((e,t)=>e.graphic.uid-t.graphic.uid)),r.sort(((e,t)=>e.uid-t.uid));let s,o=0,n=0;const h=t.resolution,u=[],a={originPosition:"upperLeft",scale:[h,h],translate:[t.bounds[0],t.bounds[3]]};for(const l of r){for(n=-2;o<i.length;)if(s=i[o],o++,l.uid===s.graphic.uid){n=s.insertAfter;break}if(!s.geometry||-2===n)continue;const r=s.getGeometryQuantized(a,t.bounds,this._tileInfoView.spatialReference,h),c={...s.graphic.attributes};c[this._uidFieldName]=l.uid,null==s.groupId&&(s.groupId=e.createTemplateGroup(s.symbol,null)),u.push({centroid:GraphicStoreItem_.getCentroidQuantized(s,a),geometry:r,attributes:c,symbol:s.symbol,groupId:s.groupId,insertAfter:n,zorder:s.zorder})}return u.sort(((e,t)=>e.zorder-t.zorder)),u}queryTileData(e,t){if(0===this._graphics.length)return[];const{bounds:r,resolution:i}=t,s=this._searchForItems(t),o=[];return 0===s.length||this._createTileGraphics(o,e,s,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]},t),o}has(e){return this._itemByGraphic.has(e)}getBounds(e){const t=this._itemByGraphic.get(e);return t?t.bounds:null}getAllBounds(){return Array.from(this._itemByGraphic.values()).filter((e=>e.graphic.visible)).map((e=>e.bounds))}addOrModify(r,i,s){if(!r||Object(maybe.k)(i))return;this.has(r)&&this.remove(r),this._onAdd(r);const o=[0,0,0,0],n=this._getSymbolBounds(null,i,s,o,0),h=GraphicStoreItem_.acquire(r,i,s,Object(maybe.l)(n)?n:null,o);return this._itemByGraphic.set(r,h),s&&this._index.insert(h),h.bounds}remove(e){if(!this._itemByGraphic.has(e))return;this._onRemove(e);const t=this._itemByGraphic.get(e);t.bounds&&this._index.remove(t),this._itemByGraphic.delete(e)}updateZ(){const e=this._graphics.items;let t,r;for(let i=0;i<e.length;i++)r=e[i],t=this._itemByGraphic.get(r),t&&(t.zorder=i)}update(e,r,i){const s=this._itemByGraphic.get(e);s.groupId=null;const o=Object(aaBoundingRect.f)(s.bounds);this._index.remove(s);const h=this._getSymbolBounds(s.bounds,r,i,s.size,0);return Object(maybe.l)(h)&&s.set(e,r,i,h,s.size),i&&this._index.insert(s),{oldBounds:o,newBounds:s.bounds}}updateLevel(e){if(this._resolution===e)return;this._resolution=e,this._index.clear();const r=this._itemByGraphic,i=[];for(const[s,o]of r){const e=this._getSymbolBounds(o.bounds,o.symbolResource,o.geometry,o.size,0);o.geometry&&Object(maybe.l)(e)&&(o.bounds=e,i.push(o))}this._index.load(i)}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,r,i,s){const o=this._uidFieldName,n=this._tileInfoView.spatialReference,{bounds:h,resolution:u}=s;let a,l,c,d;r.sort(((e,t)=>e.zorder-t.zorder));for(let p=0;p<r.length;p++){c=r[p],a=c.graphic,l=c.getGeometryQuantized(i,h,n,u),d=0===p?-1:r[p-1].graphic.uid;const s={...c.graphic.attributes};s[o]=a.uid,null==c.groupId&&(c.groupId=t.createTemplateGroup(c.symbol,null)),e.push({centroid:GraphicStoreItem_.getCentroidQuantized(c,i),geometry:l,attributes:s,symbol:c.symbol,groupId:c.groupId,insertAfter:d,zorder:c.zorder})}}_searchForItems(e){const t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){const[i,o]=Object(normalizeUtilsCommon.c)(t),n=Math.abs(r[2]-o)<1e-5,h=Math.abs(r[0]-i)<1e-5;if((!n||!h)&&(n||h)){const t=e.resolution;let h;h=Object(aaBoundingRect.l)(n?[i,r[1],i+t*graphicsUtils.a,r[3]]:[o-t*graphicsUtils.a,r[1],o,r[3]]);const u=GraphicStore_b(this._index,r[0],r[1],r[2],r[3]),a=GraphicStore_b(this._index,h[0],h[1],h[2],h[3]);return[...new Set([...u,...a])]}}return GraphicStore_b(this._index,r[0],r[1],r[2],r[3])}_getSymbolBounds(e,t,i,o,n){if(!t||!t.symbol||!i)return null;if(e||(e=Object(aaBoundingRect.l)()),Object(boundsUtils.a)(e,i),!o||0===o[0]&&0===o[1]&&0===o[2]&&0===o[3]){const{hash:e,textInfo:i}=t,s=this._hashToCIM.get(e);if(!s)return null;o||(o=[0,0,0,0]);const h=this._inflatedSizeHelper.getSymbolInflateSize(o,s.symbol,this._cimResourceManager,n,i);o[0]=Object(screenUtils.g)(h[0]),o[1]=Object(screenUtils.g)(h[1]),o[2]=Object(screenUtils.g)(h[2]),o[3]=Object(screenUtils.g)(h[3])}const u=this._resolution,a=CIMSymbolHelper.a.SafeSize(o);return e[0]-=a*u,e[1]-=a*u,e[2]+=a*u,e[3]+=a*u,e}}const GraphicStore_z=(e,t)=>{const r=Object(graphicsUtils.d)(e.graphic),i=Object(graphicsUtils.d)(t.graphic);return r===i?t.zorder-e.zorder:r-i};var cimSymbolUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/support/cimSymbolUtils.js"),GraphicsView=__webpack_require__("./node_modules/@arcgis/core/views/layers/GraphicsView.js"),capabilities=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities.js");const tt=Object(has.a)("esri-2d-graphic-debug");function et(t,e,s){if(s.has(t))return s.get(t);const i={tile:e,addedOrModified:[],removed:[]};return s.set(t,i),i}let st=class extends(Object(GraphicsView.a)(Object(HandleOwner.b)(Accessor.a))){constructor(t){super(t),this._storage=new ComputedAttributeStorage.a,this._displayIds=new Map,this._controller=new AbortController,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Promise.resolve(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._highlightIds=new Map,this._updatingGraphicsTimer=null,this._hashToExpandedSymbol=new Map,this._hashToExpandedSymbolPromise=new Map,this._hashToCIMSymbolPromise=new Map,this._hashToCIM=new Map,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={added:new Set,updated:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}_createMatcher(t,e,s){if(t){const i=Object(schemaUtils.createMatcherSchema)({indexCount:0,fields:{}},"feature",t);this._matcher=Object(Matcher.a)(i,e,null,s)}}_createDisplayId(t){return this._displayIds.has(t)||this._displayIds.set(t,this._storage.createDisplayId()),this._displayIds.get(t)}initialize(){this._attributeStore=new AttributeStore.a({type:"local",initialize:t=>Promise.resolve(this.container.attributeView.initialize(t)),update:t=>this.container.attributeView.requestUpdate(t),render:()=>this.container.requestRender()},Object(capabilities.a)()),this.container.hasHighlight=()=>!!this._highlightIds.size;const s=new WGLTemplateStore.a(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new GraphicStore_I(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(t=>{this._createDisplayId(t.uid),this._setFilterState(t.uid,t.visible)}),(t=>{const e=this._displayIds.get(t.uid);this._displayIds.delete(t.uid),this._storage.releaseDisplayId(e)}),this._hashToCIM),this._meshFactory=new WGLMeshFactory.a(null,this.uid,s),this._templateStore=s,this.handles.add([this.watch("renderer",(t=>{this._createMatcher(t,s,this.container.stage.resourceManager);for(const e of this.graphics)this._pendingUpdate.updated.add(e);this.requestUpdate()})),this.view.graphicsTileStore.on("update",(t=>this._onTileUpdate(t))),this.container.on("attach",(()=>{tt&&this.container.enableRenderingBounds((()=>this._graphicStore.getAllBounds())),this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on("change",(t=>this._graphicsChangeHandler(t))),"graphics");const t=this.container.stage.resourceManager;this._createMatcher(this.renderer,s,t),this._graphicStore.setResourceManager(t),this._attached=!0,this.notifyChange("updating")}))]);const i=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:i,removed:[]})}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this._controller.abort(),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null,this._hashToCIM.clear(),this._hashToCIMSymbolPromise.clear(),this._hashToExpandedSymbolPromise.clear()}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(t){if(!this.view||!this.view.position)return null;const{resolution:e,rotation:s}=this.view.state;return this._graphicStore.hitTest(t.x,t.y,2,e,s)}update(t){Object(promiseUtils.w)(this._controller.signal);const e=t.state,{resolution:s}=e;if(this._graphicStore.updateLevel(s),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}graphicUpdateHandler(t){const{graphic:e,property:s,newValue:i}=t;switch(s){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(e),this.requestUpdate();break;case"visible":this._setFilterState(e.uid,i),this._attributeStore.sendUpdates()}}addHighlight(t){for(const e of t)if(this._highlightIds.has(e)){const t=this._highlightIds.get(e);this._highlightIds.set(e,t+1)}else this._highlightIds.set(e,1);this._updateHighlight()}removeHighlight(t){for(const e of t)if(this._highlightIds.has(e)){const t=this._highlightIds.get(e)-1;0===t?this._highlightIds.delete(e):this._highlightIds.set(e,t)}this._updateHighlight()}_updateHighlight(){const t=Array.from(this._highlightIds.keys()),e=t.map((t=>this._displayIds.get(t)));this._attributeStore.setHighlight(t,e)}_getIntersectingTiles(t){const e=this._graphicStore.getBounds(t);if(!e||0===Object(aaBoundingRect.B)(e)||0===Object(aaBoundingRect.u)(e))return[];const s=Object(graphicsUtils.e)(e,this.view.spatialReference);return Object(maybe.l)(s)?[...new Set([...this.view.graphicsTileStore.boundsIntersections(s[0]),...this.view.graphicsTileStore.boundsIntersections(s[1])])]:this.view.graphicsTileStore.boundsIntersections(e)}async _updateTile(t){Object(promiseUtils.w)(this._controller.signal);const e=t.tile,s=this._getGraphicsData(this._templateStore,e,t.addedOrModified),i=await this._processGraphics(e,s);return Object(promiseUtils.w)(this._controller.signal),this._patchTile(e.key,{type:"update",addOrUpdate:i,remove:t.removed,end:!0,clear:!1,sort:!1}),i}_patchTile(t,e){if(!this._tiles.has(t))return;const s=this._tiles.get(t);this.container.onTileData(s,e),this.container.requestRender()}_graphicsChangeHandler(t){const e=this._pendingUpdate;for(const s of t.added)e.added.add(s);for(const s of t.moved)e.updated.add(s);for(const s of t.removed)this._pendingUpdate.added.has(s)?e.added.delete(s):e.removed.add(s);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){const t={added:[],removed:[],updated:[]};if(!this.graphics)return t;const e=this._pendingUpdate;for(const s of this.graphics.items)e.added.has(s)?t.added.push(s):e.updated.has(s)&&t.updated.push(s);for(const s of e.removed)this._graphicStore.has(s)&&t.removed.push(s);return e.added.clear(),e.removed.clear(),e.updated.clear(),t}async _updateGraphics(){this._processing=!0;const{added:t,removed:e,updated:s}=this._getGraphicsToUpdate(),i=this._tilesToUpdate;let r;try{if(!this._graphicStoreUpdate){const t=this.view.state,{resolution:e}=t;this._graphicStore.updateLevel(e)}const o=[],a=new Array(t.length+e.length);for(let t=0;t<s.length;t++){const e=s[t],h=this._getIntersectingTiles(e);for(const t of h)r=t.id,et(r,t,i).removed.push(this._displayIds.get(e.uid));o.push(this._updateGraphic(e,null)),a[t]=e}const h=s.length;for(let e=0;e<t.length;e++){const s=t[e];a[h+e]=s,this._graphicsSet.add(s),o.push(this._addGraphic(s))}for(const t of e){this._abortProcessingGraphic(t.uid);const e=this._getIntersectingTiles(t);for(const s of e)r=s.id,et(r,s,i).removed.push(this._displayIds.get(t.uid));this._graphicsSet.delete(t),this._graphicStore.remove(t)}let n;this._flipUpdatingGraphics(),await Promise.all(o);for(let t=0;t<a.length;t++){n=a[t];const e=this._getIntersectingTiles(n);for(const t of e)r=t.id,et(r,t,i).addedOrModified.push(n)}this._graphicStore.updateZ();const l=[];for(const[t,e]of i)l.push(this._updateTile(e));await Promise.all(l)}catch(o){Object(promiseUtils.m)(o)}for(const a of e)try{const t=await this._getSymbolForGraphic(a,{});if(t){const e=t.hash();this._hashToExpandedSymbol.delete(e)}}catch(o){Object(promiseUtils.m)(o)}i.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(t){const e=(t.attributes?Object.keys(t.attributes):[]).map((e=>({name:e,alias:e,type:"string"==typeof t.attributes[e]?"esriFieldTypeString":"esriFieldTypeDouble"})));return Object(maybe.k)(t.geometry)?null:{geometryType:Object(jsonUtils.c)(t.geometry),spatialReference:SpatialReference.a.fromJSON(t.geometry.spatialReference),fields:e}}_getSymbolForGraphic(t,e){return Object(promiseUtils.w)(this._controller.signal),Object(maybe.l)(t.symbol)?Promise.resolve(t.symbol):Object(maybe.l)(this.renderer)?this.renderer.getSymbolAsync(t,{scale:this.view.scale,abortOptions:e}):Promise.resolve(this._getNullSymbol(t))}_getCIMSymbol(t,e,s){let i=this._hashToCIM.get(e);if(i)return Promise.resolve(i);const r=Object(CIMSymbolHelper.f)(t);if(Object(maybe.l)(r)){if("CIMSymbolReference"===r.type)return i=r,this._hashToCIM.set(e,i),Promise.resolve(i);let t=this._hashToCIMSymbolPromise.get(e);return t||(t=r.fetchCIMSymbol(s).then((t=>(this._hashToCIM.set(e,t.data),this._hashToCIMSymbolPromise.delete(e),t))).catch((t=>(this._hashToCIMSymbolPromise.delete(e),Object(promiseUtils.v)(t),null))),this._hashToCIMSymbolPromise.set(e,t),t)}return Promise.resolve(null)}_expandCIMSymbol(t,e,s,i){const r=this._hashToExpandedSymbol.get(s);if(r)return Promise.resolve(r);let o=this._hashToExpandedSymbolPromise.get(s);if(o)return o;const a=this.container.stage,h=this._getArcadeInfo(e),n=Object(schemaUtils.createSymbolSchema)(t);return o=Object(cimSymbolUtils.b)(n,h,a.resourceManager,i),this._hashToExpandedSymbolPromise.set(s,o),o.then((t=>(this._hashToExpandedSymbol.set(s,t),this._hashToExpandedSymbolPromise.delete(s),t))),o}async _getSymbolResources(t,e){return Object(promiseUtils.w)(this._controller.signal),this.container.stage?this._getSymbolForGraphic(t,e).then((i=>{const r=i.hash();return this._getCIMSymbol(i,r,e).then((i=>Object(maybe.k)(i)?null:this._expandCIMSymbol(i,t,r,e).then((t=>{const e=t.layers.filter((t=>"text"===t.type&&"string"==typeof t.text));if(e&&e.length>0){const i=new Array(e.length);for(let t=0;t<e.length;t++){const r=e[t],o=[],[a]=Object(BidiText.a)(r.text);for(let t=0;t<a.length;t++)o.push(a.charCodeAt(t));i[t]={symbol:r,id:t,glyphIds:o}}const o=new Map;return this.container.getMaterialItems(i).then((s=>{for(let t=0;t<e.length;t++){const i=e[t];o.set(i.cim,{text:i.text,mosaicItem:s[t].mosaicItem})}return{symbol:t,textInfo:o,hash:r}}))}return{symbol:t,hash:r}}))))})).catch((t=>(Object(promiseUtils.v)(t),null))):null}async _projectAndNormalizeGeometry(t,e){if(Object(promiseUtils.w)(this._controller.signal),Object(maybe.k)(t.geometry)||"mesh"===t.geometry.type)return null;let s=t.geometry;if(Object(jsonUtils.g)(s)){const t=s.rings;s.rings=t}else if(Object(jsonUtils.h)(s)){const t=s.paths;s.paths=t}else if(Object(jsonUtils.d)(s)){const i=await this._getSymbolForGraphic(t,e);Object(promiseUtils.w)(this._controller.signal),s=Object(graphicsUtils.f)(i.type)||Object(graphicsUtils.g)(i.type)?s.center:Object(graphicsUtils.h)(s)}await Object(projectionSupport.a)(s.spatialReference,this.view.spatialReference);const i=normalizeUtilsSync_u(s),r=Object(projectionSupport.b)(i,s.spatialReference,this.view.spatialReference);return Object(coordsUtils.a)(r),r}_onTileUpdate(t){const e=Object(spatialReferenceUtils.e)(this.view.spatialReference);if(t.added&&t.added.length>0)for(const s of t.added)this._addNewTile(s,e);if(t.removed&&t.removed.length>0)for(const s of t.removed)this._removeTile(s.key)}async _addGraphic(t){this._abortProcessingGraphic(t.uid),Object(promiseUtils.w)(this._controller.signal);const e=new AbortController;this._graphicIdToAbortController.set(t.uid,e);const s={signal:e.signal};try{await this._addOrUpdateGraphic(t,s),Object(promiseUtils.w)(this._controller.signal),this._graphicIdToAbortController.delete(t.uid)}catch(i){if(this._graphicIdToAbortController.delete(t.uid),!Object(promiseUtils.m)(i))throw i}}_updateGraphic(t,e){Object(promiseUtils.w)(this._controller.signal);const s=this._projectAndNormalizeGeometry(t,e),i=this._getSymbolResources(t,e);return Promise.all([s,i]).then((([e,s])=>{Object(promiseUtils.w)(this._controller.signal),this._graphicStore.addOrModify(t,s,e)}))}_addOrUpdateGraphic(t,e){Object(promiseUtils.w)(this._controller.signal);const s=this._projectAndNormalizeGeometry(t,e),i=this._getSymbolResources(t,e);return Promise.all([s,i]).then((([e,s])=>{Object(promiseUtils.w)(this._controller.signal),this._graphicsSet.has(t)&&this._graphicStore.addOrModify(t,s,e)}))}_addTile(t){const e=this.view.featuresTilingScheme.getTileBounds(Object(aaBoundingRect.l)(),t),s=new GraphicTile_a(t,e[0],e[3]);return this._tiles.set(t,s),this.container.addChild(s),s}async _addNewTile(t,e){const s=this._addTile(t.key),i=this._graphicStore.queryTileData(this._templateStore,t);if(0===i.length)return;if(e){const s=Math.round((e.valid[1]-e.valid[0])/t.resolution);for(const t of i)t.geometry&&(Object(jsonUtils.f)(t.geometry)||Object(jsonUtils.e)(t.geometry))&&this._wrapPoints(t,s)}const r=t.key;this._tileUpdateSet.add(t.key),this.notifyChange("updating");try{const e={type:"update",clear:!1,addOrUpdate:await this._processGraphics(t,i),remove:[],end:!0,sort:!1};s.patch(e),this._tileUpdateSet.delete(r),this.notifyChange("updating")}catch(o){if(this._tileUpdateSet.delete(r),this.notifyChange("updating"),!Object(promiseUtils.m)(o))throw o}}_removeTile(t){if(!this._tiles.has(t))return;const e=this._tiles.get(t);this.container.removeChild(e),e.destroy(),this._tiles.delete(t)}_setFilterState(t,e){const s=this._displayIds.get(t),i=this._attributeStore.getHighlightFlag(t);this._attributeStore.setData(s,0,0,i|(e?definitions.n:0))}_getGraphicsData(t,e,s){const i=this.view,r=Object(spatialReferenceUtils.e)(i.spatialReference),o=this._graphicStore.getGraphicsData(t,e,s);if(r){const t=Math.round((r.valid[1]-r.valid[0])/e.resolution);for(const e of o)e.geometry&&(Object(jsonUtils.f)(e.geometry)||Object(jsonUtils.e)(e.geometry))&&this._wrapPoints(e,t)}return o}_wrapPoints(t,e){const s=t.geometry;Object(jsonUtils.e)(s)?this._wrapMultipoint(s,e):this._wrapPoint(t,e)}_wrapMultipoint(t,e){const s=t.points,i=[];let r=0,o=0;for(const[a,h]of s){if(i.push([a+r,h]),r=0,e===graphicsUtils.b){const t=5*graphicsUtils.a;a+o<t?(i.push([e,0]),r=-e):a+o>graphicsUtils.b-t&&(i.push([-e,0]),r=e)}else a+o<-graphicsUtils.a?(i.push([e,0]),r=-e):a+o>graphicsUtils.b+graphicsUtils.a&&(i.push([-e,0]),r=e);o+=a}t.points=i}_wrapPoint(t,e){const s=t.geometry;if(e===graphicsUtils.b){const i=5*graphicsUtils.a;s.x<i?t.geometry={points:[[s.x,s.y],[e,0]]}:s.x>graphicsUtils.b-i&&(t.geometry={points:[[s.x,s.y],[-e,0]]})}else s.x<-graphicsUtils.a?t.geometry={points:[[s.x,s.y],[e,0]]}:s.x>graphicsUtils.b+graphicsUtils.a&&(t.geometry={points:[[s.x,s.y],[-e,0]]})}_processGraphics(t,e,s){if(!e||!e.length||!this._meshFactory)return null;const i=GraphicsReader_o.from(e),r=this._meshFactory;return this._matcher.then((e=>r.analyzeGraphics(i,this.container.stage.resourceManager,e,null,null,s).then((()=>(this._attributeStore.sendUpdates(),this._processAnalyzedGraphics(t,i))))))}_processAnalyzedGraphics(t,e){const s=this._meshFactory,i=e.getSize(),r=e.getCursor(),o={features:i,records:i,metrics:0},a=new MeshData.a(t.key.id,o,{fill:"default"},!1,!1),h=[];for(;r.next();){const e=r.readGraphic();e.insertAfter=-1===e.insertAfter?-1:this._displayIds.get(e.insertAfter),e.displayId=this._displayIds.get(e.attributes[this.uid]);const i=new WGLDisplayObject_e(e.displayId);i.insertAfter=e.insertAfter,h.push(i),s.writeGraphic(a,r,t.level)}const n=t.tileInfoView.tileInfo.isWrappable,l=a.serialize(n);if(1!==l.length)return new TileData_y;const d=l[0].message;return TileData_y.fromVertexData(d,h)}_abortProcessingGraphic(t){this._graphicIdToAbortController.has(t)&&this._graphicIdToAbortController.get(t).abort()}_getNullSymbol(t){const e=t.geometry;return Object(jsonUtils.h)(e)?defaults.g:Object(jsonUtils.g)(e)||Object(jsonUtils.d)(e)?defaults.f:defaults.e}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((()=>{this._updatingGraphicsTimer=null,this.notifyChange("updating")}),160),this.notifyChange("updating")}};Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],st.prototype,"requestUpdateCallback",void 0),Object(tslib_es6.a)([Object(property.b)()],st.prototype,"container",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],st.prototype,"graphics",void 0),Object(tslib_es6.a)([Object(property.b)()],st.prototype,"updating",null),Object(tslib_es6.a)([Object(property.b)()],st.prototype,"view",void 0),Object(tslib_es6.a)([Object(property.b)()],st.prototype,"updateRequested",void 0),st=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.layers.support.GraphicsView2D")],st);const it=st},"./node_modules/@arcgis/core/views/2d/mapViewDeps.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Stage",(function(){return Stage_S})),__webpack_require__.d(__webpack_exports__,"LabelManager",(function(){return LabelManager_c})),__webpack_require__.d(__webpack_exports__,"GraphicsView2D",(function(){return GraphicsView2D.a})),__webpack_require__.d(__webpack_exports__,"GraphicContainer",(function(){return GraphicContainer.a})),__webpack_require__.d(__webpack_exports__,"MapViewNavigation",(function(){return MapViewNavigation_T})),__webpack_require__.d(__webpack_exports__,"MagnifierView2D",(function(){return MagnifierView2D_b}));var core_Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),events=__webpack_require__("./node_modules/@arcgis/core/core/events.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),scheduling=__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),common=__webpack_require__("./node_modules/@arcgis/core/chunks/common.js"),mat2d=__webpack_require__("./node_modules/@arcgis/core/chunks/mat2d.js"),mat2df64=__webpack_require__("./node_modules/@arcgis/core/chunks/mat2df64.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),vec2=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2.js"),vec2f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f64.js"),CIMResourceManager=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/CIMResourceManager.js"),BufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/BufferObject.js"),FramebufferObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/FramebufferObject.js"),programUtils=(__webpack_require__("./node_modules/@arcgis/core/views/webgl/checkWebGLError.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/enums.js"),__webpack_require__("./node_modules/@arcgis/core/chunks/builtins.js"),__webpack_require__("./node_modules/@arcgis/core/views/webgl/programUtils.js")),Texture=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Texture.js"),VertexArrayObject=__webpack_require__("./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js"),context_util=__webpack_require__("./node_modules/@arcgis/core/views/webgl/context-util.js"),Container=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/Container.js"),webgl_enums=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js"),Renderbuffer=__webpack_require__("./node_modules/@arcgis/core/views/webgl/Renderbuffer.js"),brushes=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/brushes.js"),VTLMaterialManager=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/VTLMaterialManager.js"),resolver=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/sources/resolver.js");const BitBlitPrograms_e={shaders:{vertexShader:Object(resolver.a)("bitBlit/bitBlit.vert"),fragmentShader:Object(resolver.a)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};class BitBlitRenderer_s{constructor(){this._initialized=!1}dispose(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)}render(r,e,t,i){r&&(this._initialized||this._initialize(r),r.setBlendFunctionSeparate(1,771,1,771),r.bindVAO(this._vertexArrayObject),r.useProgram(this._program),e.setSamplingMode(t),r.bindTexture(e,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",i),r.drawArrays(5,0,4),r.bindTexture(null,0),r.bindVAO())}_initialize(s){if(this._initialized)return!0;const o=BitBlitPrograms_e.attributes,a=Object(programUtils.a)(s,BitBlitPrograms_e);if(!a)return!1;const m=new Int8Array(16);m[0]=-1,m[1]=-1,m[2]=0,m[3]=0,m[4]=1,m[5]=-1,m[6]=1,m[7]=0,m[8]=-1,m[9]=1,m[10]=0,m[11]=1,m[12]=1,m[13]=1,m[14]=1,m[15]=1;const p=new VertexArrayObject.a(s,o,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:BufferObject.a.createVertex(s,35044,m)});return this._program=a,this._vertexArrayObject=p,this._initialized=!0,!0}}var ProgramCache=__webpack_require__("./node_modules/@arcgis/core/views/webgl/ProgramCache.js");const MaterialPrograms_e=r=>{let t="";t+=r[0].toUpperCase();for(let e=1;e<r.length;e++){const s=r[e];s===s.toUpperCase()?(t+="_",t+=s):t+=s.toUpperCase()}return t},MaterialPrograms_s=r=>{const s={};for(const t in r)s[MaterialPrograms_e(t)]=r[t];return Object(programUtils.b)(s)},MaterialPrograms_o=(t,e,o)=>{const n=t+t.substring(t.lastIndexOf("/")),a=e+e.substring(e.lastIndexOf("/"));return{attributes:o,shaders:t=>({vertexShader:MaterialPrograms_s(t)+Object(resolver.a)(`${n}.vert`),fragmentShader:MaterialPrograms_s(t)+Object(resolver.a)(`${a}.frag`)})}},MaterialManager_a=r=>r===webgl_enums.c.HITTEST||r===webgl_enums.c.LABEL_ALPHA,MaterialManager_i=({rendererInfo:e,drawPhase:t},o,a,i)=>{return`${o.getVariationHash()}-${i.join(".")}-${r=t,(MaterialManager_a(r)?1:0)|(r===webgl_enums.c.HIGHLIGHT?2:0)}-${e.getVariationHash()}-${Object(maybe.l)(a)&&a.join(".")}`;var r};class MaterialManager_m{constructor(r){this._programByKey=new Map,this._programCache=new ProgramCache.a(r)}dispose(){this._programCache&&this._programCache.dispose()}getProgram(r,e,t=[],a=[]){const s=e.vsPath+"."+e.fsPath+JSON.stringify(t)+a.join(".");if(this._programByKey.has(s))return this._programByKey.get(s);const i=a.reduce(((e,t)=>({...e,[t]:r.context.driverTest[t]})),{}),g={...t.map((r=>"string"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{}),...i},{vsPath:m,fsPath:n,attributes:h}=e,p=this._programCache.getProgram(MaterialPrograms_o(m,n,h),g);if(!p)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(s,p),p}getMaterialProgram(r,e,t,a,s,m=["ignoresSamplerPrecision"]){const n=MaterialManager_i(r,e,s,m);if(this._programByKey.has(n))return this._programByKey.get(n);const h=((e,o,s,i)=>{const g=i.reduce(((r,t)=>({...r,[t]:e.context.driverTest[t]})),{}),m={...o.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===webgl_enums.c.HIGHLIGHT,id:MaterialManager_a(e.drawPhase),...g};if(Object(maybe.l)(s))for(const r of s)m[r]=!0;return m})(r,e,s,m),p=this._programCache.getProgram(MaterialPrograms_o(t,t,a),h);if(!p)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(n,p),p}}var config=__webpack_require__("./node_modules/@arcgis/core/config.js"),request=__webpack_require__("./node_modules/@arcgis/core/request.js"),BidiText=__webpack_require__("./node_modules/@arcgis/core/core/BidiText.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),screenUtils=__webpack_require__("./node_modules/@arcgis/core/core/screenUtils.js"),vec2f32=__webpack_require__("./node_modules/@arcgis/core/chunks/vec2f32.js"),Rasterizer=__webpack_require__("./node_modules/@arcgis/core/symbols/cim/Rasterizer.js"),definitions=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js");var Rect=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Rect.js");class RectangleBinPack_t{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new Rect.a(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new Rect.a;let i=null,s=-1;for(let h=0;h<this._free.length;++h){const r=this._free[h];t<=r.width&&e<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,s=h)}return null===i?new Rect.a:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new Rect.a(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new Rect.a(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new Rect.a(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new Rect.a(i.x,i.y+e,t,i.height-e))),new Rect.a(i.x,i.y,t,e))}release(h){for(let t=0;t<this._free.length;++t){const e=this._free[t];if(e.y===h.y&&e.height===h.height&&e.x+e.width===h.x)e.width+=h.width;else if(e.x===h.x&&e.width===h.width&&e.y+e.height===h.y)e.height+=h.height;else if(h.y===e.y&&h.height===e.height&&h.x+h.width===e.x)e.x=h.x,e.width+=h.width;else{if(h.x!==e.x||h.width!==e.width||h.y+h.height!==e.y)continue;e.y=h.y,e.height+=h.height}this._free.splice(t,1),this.release(h)}this._free.push(h)}}const GlyphMosaic_a=t=>Math.floor(t/256);class GlyphMosaic_l{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=i,this._binPack=new RectangleBinPack_t(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let h=0;h<t.length;h++){const i=t[h];for(let t=0;t<11;t++)e.push(i)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i)}async getGlyphItems(t,e,i){const h=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(h,t,e)))}bind(t,e,i,h){const s=this._getTexture(t,i);s.setSamplingMode(e),this._dirties[i]&&(s.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(s,h)}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){return this._textures[e]||(this._textures[e]=new Texture.a(t,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const h=function GlyphMosaic_n(t){const e=new Set;for(const i of t)e.add(GlyphMosaic_a(i));return e}(e),s=[];h.forEach((e=>{s.push(this._fetchRange(t,e,i))})),await Promise.all(s)}async _fetchRange(t,e,i){if(e>256)return null;const h=t+e;return function GlyphMosaic_c(t,i,h){return t.has(i)||t.set(i,h().then((()=>{t.delete(i)})).catch((h=>{t.delete(i),Object(promiseUtils.x)(h)}))),t.get(i)}(this._rangePromises,h,(()=>this._glyphSource.getRange(t,e,i)))}_getMosaicItem(t,e,i){if(!t[i]){const h=this._glyphSource.getGlyph(e,i);if(!h||!h.metrics)return(t=>({rect:new Rect.a(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}))(i);const s=this._recordGlyph(h),r=this._currentPage,a=h.metrics;t[i]={rect:s,page:r,metrics:a,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(e){const s=e.metrics;let r;if(0===s.width)r=new Rect.a(0,0,0,0);else{const i=3,a=s.width+2*i,n=s.height+2*i;r=this._binPack.allocate(a,n),r.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new RectangleBinPack_t(this.width-4,this.height-4),r=this._binPack.allocate(a,n));const c=this._glyphData[this._currentPage],o=e.bitmap;let l,g;if(o)for(let t=0;t<n;t++){l=a*t,g=this.width*(r.y+t)+r.x;for(let t=0;t<a;t++)c[g+t]=o[l+t]}Object(has.a)("esri-glyph-debug")&&this._showDebugPage(c)}return r}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),h=new ImageData(this.width,this.height),s=h.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let r=0;r<t.length;++r)s[4*r+0]=t[r],s[4*r+1]=0,s[4*r+2]=0,s[4*r+3]=255;i.putImageData(h,0,0),document.body.appendChild(e)}}var pbf=__webpack_require__("./node_modules/@arcgis/core/core/pbf.js");class GlyphSource_s{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let s,a,r,n,i,c,g;for(;t.next();)switch(t.tag()){case 1:s=t.getUInt32();break;case 2:a=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:g=t.getUInt32();break;default:t.skip()}t.release(),s&&(this._metrics[s]={width:r,height:n,left:i,top:c,advance:g},this._bitmaps[s]=a);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class GlyphSource_a{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class GlyphSource_r{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(a,r,n){const i=this._getFontStack(a);if(i.getRange(r))return Promise.resolve();const c=256*r,g=c+255,o=this._baseURL.replace("{fontstack}",a).replace("{range}",c+"-"+g);return Object(request.default)(o,{responseType:"array-buffer",...n}).then((t=>{i.addRange(r,new GlyphSource_s(new pbf.a(new Uint8Array(t.data),new DataView(t.data))))}))}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const a=Math.floor(e/256);if(a>256)return;const r=s.getRange(a);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new GlyphSource_a),e}}var floatRGBA=__webpack_require__("./node_modules/@arcgis/core/core/floatRGBA.js");class SDFConverter_r{constructor(t){this.size=t;const s=document.createElement("canvas");s.width=s.height=t,this._context=s.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(r,h,n=31){this._initSVG();const o=this.createSVGString(r);return new Promise(((r,a)=>{const d=new Image;d.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(o),d.onload=()=>{d.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(d,0,0,this.size,this.size);const s=this._context.getImageData(0,0,this.size,this.size),e=new Uint8Array(this.size*this.size*4);for(let t=0;t<this.size*this.size;t++){const e=s.data[4*t+3]/255;this._gridOuter[t]=1===e?0:0===e?1e20:Math.max(0,.5-e)**2,this._gridInner[t]=1===e?1e20:0===e?0:Math.max(0,e-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let i=0;i<this.size*this.size;i++){const s=this._gridOuter[i]-this._gridInner[i];Object(floatRGBA.a)(.5-s/(2*n),e,4*i)}r(e)};const l=h&&h.signal;l&&Object(promiseUtils.r)(l,(()=>a(Object(promiseUtils.e)())))}))}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}}createSVGString(t){this._initSVG();const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",t),this._svg.appendChild(s);const e=s.getBBox(),i=e.width/e.height,r=this.size/2;let h,n,o,a;if(i>1){n=h=r/e.width;const t=r*(1/i);o=this.size/4,a=r-t/2}else h=n=r/e.height,o=r-r*i/2,a=this.size/4;const d=-e.x*h+o,l=-e.y*n+a;s.setAttribute("style",`transform: matrix(${h}, 0, 0, ${n}, ${d}, ${l})`);const _=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${this._svg.innerHTML}</svg>`;return this._svg.removeChild(s),_}_edt(t,s,e){const i=this._f,r=this._d,h=this._v,n=this._z;for(let o=0;o<s;o++){for(let r=0;r<e;r++)i[r]=t[r*s+o];this._edt1d(i,r,h,n,e);for(let i=0;i<e;i++)t[i*s+o]=r[i]}for(let o=0;o<e;o++){for(let e=0;e<s;e++)i[e]=t[o*s+e];this._edt1d(i,r,h,n,s);for(let e=0;e<s;e++)t[o*s+e]=Math.sqrt(r[e])}}_edt1d(t,s,e,r,h){e[0]=0,r[0]=-1e20,r[1]=1e20;for(let n=1,o=0;n<h;n++){let s=(t[n]+n*n-(t[e[o]]+e[o]*e[o]))/(2*n-2*e[o]);for(;s<=r[o];)o--,s=(t[n]+n*n-(t[e[o]]+e[o]*e[o]))/(2*n-2*e[o]);o++,e[o]=n,r[o]=s,r[o+1]=1e20}for(let i=0,n=0;i<h;i++){for(;r[n+1]<i;)n++;s[i]=(i-e[n])*(i-e[n])+t[e[n]]}}}var GeometryUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/GeometryUtils.js");function SpriteMosaic_h(t){return t&&"static"===t.type}class SpriteMosaic_c{constructor(t,e,i,s=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(e<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=i,this._requestRender=t,s>0&&(this._maxItemSize=s),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new RectangleBinPack_t(this._pageWidth,this._pageHeight);const a=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(a*r)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,a,o){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let c,n,g;if(SpriteMosaic_h(i))[c,n,g]=this._allocateImage(e[0],e[1]);else{c=new Rect.a(0,0,e[0],e[1]),n=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:e,dirty:!0,texture:t})}if(c.width<=0||c.height<=0)return null;const m={rect:c,width:e[0],height:e[1],sdf:a,simplePattern:o,pixelRatio:1,page:n};return this._mosaicRects.set(t,m),SpriteMosaic_h(i)&&this._copy({rect:c,spriteSize:e,spriteData:i.data,page:n,pageSize:g,repeat:s,sdf:a}),m}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const a=e.width,r=e.height,o=definitions.x,h=this._mosaicPages[e.page];return{size:[e.width,e.height],tl:[(i.x+o)/h[0],(i.y+o)/h[1]],br:[(i.x+o+a)/h[0],(i.y+o+r)/h[1]],page:e.page}}bind(t,i,s=0,a=0){const r=this._mosaicPages[s],o=r.mosaicsData;let c=r.texture;if(c||(c=function SpriteMosaic_n(t,e,s){return SpriteMosaic_h(e)?new Texture.a(t,{pixelFormat:6408,dataType:5121,width:s[0],height:s[1]},new Uint8Array(e.data.buffer)):new Texture.a(t,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:s[0],height:s[1]},null)}(t,o,r.size),r.texture=c),c.setSamplingMode(i),SpriteMosaic_h(o))t.bindTexture(c,a),r.dirty&&(c.setData(new Uint8Array(o.data.buffer)),c.generateMipmap());else{const i=o.data,s=i.bindFrame(t,c,a);Object(maybe.l)(this._requestRender)&&s&&i.frameCount>0&&this._requestRender.requestRender(),i.bindFrame(t,c,a)}r.dirty=!1}static _copyBits(t,e,i,s,a,r,o,h,c,n,g){let m=s*e+i,p=h*r+o;if(g){p-=r;for(let o=-1;o<=n;o++,m=((o+n)%n+s)*e+i,p+=r)for(let e=-1;e<=c;e++)a[p+e]=t[m+(e+c)%c]}else for(let u=0;u<n;u++){for(let e=0;e<c;e++)a[p+e]=t[m+e];m+=e,p+=r}}_copy(e){if(e.page>=this._mosaicPages.length)return;const i=this._mosaicPages[e.page],a=i.mosaicsData;if(!SpriteMosaic_h(i.mosaicsData))throw new core_Error.a("mapview-invalid-resource","unsuitable data type!");const r=e.spriteData,o=a.data;o&&r||console.error("Source or target images are uninitialized!"),SpriteMosaic_c._copyBits(r,e.spriteSize[0],0,0,o,e.pageSize[0],e.rect.x+definitions.x,e.rect.y+definitions.x,e.spriteSize[0],e.spriteSize[1],e.repeat),i.dirty=!0}_allocateImage(t,e){t+=2*definitions.x,e+=2*definitions.x;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=2**Math.ceil(Object(GeometryUtils.c)(t)),s=2**Math.ceil(Object(GeometryUtils.c)(e)),o=new Rect.a(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[o,this._mosaicPages.length-1,[i,s]]}const c=this._binPack.allocate(t,e);if(c.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&SpriteMosaic_h(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new RectangleBinPack_t(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[c,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;SpriteMosaic_h(i)||i.data.pause()}this._mosaicPages=null,this._mosaicRects.clear()}}var Utils=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/Utils.js");const apng_r=new Uint32Array(256);for(let b=0;b<256;b++){let t=b;for(let e=0;e<8;e++)t=0!=(1&t)?3988292384^t>>>1:t>>>1;apng_r[b]=t}const apng_i=new core_Error.a("Not a PNG"),apng_s=new core_Error.a("Not an animated PNG"),apng_n=new Uint8Array([137,80,78,71,13,10,26,10]);function apng_h(t){const e=t.constructor===Uint8Array?t:new Uint8Array(t);return!apng_n.some(((t,r)=>t!==e[r]))}class apng_o{constructor(){this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}static async create(r,a){const i=new apng_o;try{await i._load(r,a)}catch(s){if(!Object(promiseUtils.m)(s))return new core_Error.a("invalid-resource",`Could not load PNG: ${s.message}`)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,r){t.bindTexture(e,r);const a=this.frameChanged();if(!a)return!1;const i=this.currentFrame,s=i.frameData,n=e.descriptor;return(i.left||i.top||i.width!==n.width||i.height!==n.height)&&e.setData(null),e.updateData(0,i.left,i.top,i.width,i.height,s),this.updateUsedFrame(),a}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(r,a){try{const t=function apng_d(t,e){const r=new Uint8Array(e);if(apng_n.some(((t,e)=>t!==r[e])))return apng_i;let a=!1;if(apng_p(r,(t=>!(a="acTL"===t))),!a)return apng_s;const h=[],u=[];let l=null,o=null,m=0;if(apng_p(r,((e,r,a,i)=>{const s=new DataView(r.buffer);switch(e){case"IHDR":l=r.subarray(a+8,a+8+i),t.width=s.getUint32(a+8),t.height=s.getUint32(a+12);break;case"acTL":t.numPlays=s.getUint32(a+8+4);break;case"fcTL":{o&&(t.frames.push(o),m++),o=new apng_c,o.width=s.getUint32(a+8+4),o.height=s.getUint32(a+8+8),o.left=s.getUint32(a+8+12),o.top=s.getUint32(a+8+16);const e=s.getUint16(a+8+20);let r=s.getUint16(a+8+22);0===r&&(r=100),o.delay=1e3*e/r,o.delay<=10&&(o.delay=100),t.playTime+=o.delay,o.disposeOp=s.getUint8(a+8+24),o.blendOp=s.getUint8(a+8+25),o.dataParts=[],0===m&&2===o.disposeOp&&(o.disposeOp=1);break}case"fdAT":o&&o.dataParts.push(r.subarray(a+8+4,a+8+i));break;case"IDAT":o&&o.dataParts.push(r.subarray(a+8,a+8+i));break;case"IEND":u.push(apng_w(r,a,12+i));break;default:h.push(apng_w(r,a,12+i))}})),0===t.frames.length)return apng_s;t.frameCount=t.frames.length;const d=new Blob(h),g=new Blob(u);return t.frames.forEach((t=>{let e=[];e.push(apng_n),l.set(U(t.width),0),l.set(U(t.height),4),e.push(apng_y("IHDR",l)),e.push(d),t.dataParts.forEach((t=>e.push(apng_y("IDAT",t)))),e.push(g),t.data=new Blob(e,{type:"image/png"}),delete t.dataParts,e=null})),t}(this,r);if(t!==this)return t;this._resizeCanvas=document.createElement("canvas"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,await Promise.all(this.frames.map((t=>t.createImage(this._resizeCanvas))))}catch(i){if(!Object(promiseUtils.m)(i))return new core_Error.a("invalid-resource","Could not parse PNG")}this.play()}_play(){let t,e;if(0===this.playSpeed)return void this.pause();this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);const r=this.frames[this.currentFrameNumber];this.currentFrame={frameData:r.imageData,top:r.top,left:r.left,width:r.width,height:r.height},this.timerID=window.setTimeout((()=>this._play()),t)}}class apng_c{constructor(){this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}async createImage(t){if(null===this.imageData)return new Promise(((e,r)=>{const a=URL.createObjectURL(this.data),i=document.createElement("img");i.onload=()=>{URL.revokeObjectURL(a),this.imageData=function apng_m(t,e){e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height),i=new Uint8Array(a.data);let s;for(let n=0;n<i.length;n+=4)s=i[n+3]/255,i[n]=i[n]*s,i[n+1]=i[n+1]*s,i[n+2]=i[n+2]*s;return new ImageData(new Uint8ClampedArray(i.buffer),t.width,t.height)}(i,t),e()},i.onerror=()=>{URL.revokeObjectURL(a),this.imageData=null,r(new Error("Image creation error"))},i.src=a}))}}function apng_p(t,e){const r=new DataView(t.buffer);let a,i,s,n=8;do{i=r.getUint32(n),a=apng_g(t,n+4,4),s=e(a,t,n,i),n+=12+i}while(!1!==s&&"IEND"!==a&&n<t.length)}function apng_g(t,e,r){const a=Array.prototype.slice.call(t.subarray(e,e+r));return String.fromCharCode.apply(String,a)}function apng_w(t,e,r){const a=new Uint8Array(r);return a.set(t.subarray(e,e+r)),a}function apng_y(t,e){const r=t.length+e.length,i=new Uint8Array(r+8),s=new DataView(i.buffer);s.setUint32(0,e.length),i.set(function apng_f(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}(t),4),i.set(e,8);const n=function apng_a(t,e=0,a=t.length-e){let i=-1;for(let s=e,n=e+a;s<n;s++)i=i>>>8^apng_r[255&(i^t[s])];return-1^i}(i,4,r);return s.setUint32(r+4,n),i}function U(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}const gif_a_GCExt=249,gif_a_COMMENT=254,gif_a_APPExt=255,gif_a_UNKNOWN=1,gif_a_IMAGE=44,gif_a_EOF=59;function gif_r(t){if(!t||0===t.byteLength)return!1;const e=t.constructor===Uint8Array?t:new Uint8Array(t);return 71===e[0]&&73===e[1]&&70===e[2]&&56===e[3]}class gif_n{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment="",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}static async create(s,i){const a=new gif_n;try{await a._load(s,i)}catch(r){if(!Object(promiseUtils.m)(r))return new core_Error.a("invalid-resource",`Could not load PNG: ${r.message}`)}return a}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,s){t.bindTexture(e,s);const i=this.frameChanged();if(i){const t=this.currentFrame,s=t.frameData;e.updateData(0,0,0,t.width,t.height,s),this.updateUsedFrame()}return i}seekFrame(t){clearTimeout(this.timerID),this.currentFrameNumber=t%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}seek(t){clearTimeout(this.timerID),t<0&&(t=0),t*=1e3,t%=this.length;let e=0;for(;t>this.frames[e].time+this.frames[e].delay&&e<this.frames.length;)e+=1;this.currentFrameNumber=e,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(s,i){try{this.loading=!0,await this._parse(s,i),this.loading=!1,this.play()}catch(a){if(!Object(promiseUtils.m)(a))return new core_Error.a("invalid-resource","Could not parse gif!")}}_parse(t,e){const s=new gif_l(t);s.pos+=6,this.width=s.data[s.pos++]+(s.data[s.pos++]<<8),this.height=s.data[s.pos++]+(s.data[s.pos++]<<8);const i=s.data[s.pos++];return this.globalColourCount=1<<1+(7&i),s.pos++,s.pos++,128&i&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,s)),new Promise(((t,i)=>{setTimeout((()=>this._parseBlock(s,t,i,e)),0)}))}async _parseBlock(t,e,r,h){if(h&&h.signal&&Object(promiseUtils.n)(h.signal))return void r(Object(promiseUtils.e)());const o=t.data[t.pos++];if(o===gif_a_IMAGE){if(this._parseImg(t),this.firstFrameOnly)return this._finishedLoading(),void e()}else{if(o===gif_a_EOF)return this._finishedLoading(),void e();this._parseExt(t)}"function"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((()=>this._parseBlock(t,e,r,h)),0)}_parseColourTable(t,e){const s=[];for(let i=0;i<t;i++)s.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return s}_parseImg(t){const s={};this.frames.push(s),s.disposalMethod=this.disposalMethod,s.time=this.length,s.delay=10*this.delayTime,this.length+=s.delay,this.transparencyGiven?s.transparencyIndex=this.transparencyIndex:s.transparencyIndex=void 0,s.leftPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.topPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.width=t.data[t.pos++]+(t.data[t.pos++]<<8),s.height=t.data[t.pos++]+(t.data[t.pos++]<<8);const i=t.data[t.pos++];s.localColourTableFlag=!!(128&i),s.localColourTableFlag&&(s.localColourTable=this._parseColourTable(1<<1+(7&i),t)),this.pixelBufSize!==s.width*s.height&&(this.pixelBuf=new Uint8Array(s.width*s.height),this.pixelBufSize=s.width*s.height),this._lzwDecode(t.data[t.pos++],t.readSubBlocksB()),64&i?(s.interlaced=!0,(t=>{const e=this.pixelBufSize/t;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let s=0;for(let i=0;i<4;i++)for(let a=this.interlaceOffsets[i];a<e;a+=this.interlaceSteps[i])this.deinterlaceBuf.set(this.pixelBuf.subarray(s,s+t),a*t),s+=t})(s.width)):s.interlaced=!1,this._processFrame(s)}_lzwDecode(t,e){let s,i,a,r,h,o,n,l,d;a=i=0;let p=[];const u=1<<t,m=u+1;for(r=t+1,d=!1;!d;){for(o=h,h=0,s=0;s<r;s++)e[a>>3]&1<<(7&a)&&(h|=1<<s),a++;if(h===u){for(p=[],r=t+1,s=0;s<u;s++)p[s]=[s];p[u]=[],p[m]=null}else{if(h===m)return void(d=!0);for(h>=p.length?p.push(p[o].concat(p[o][0])):o!==u&&p.push(p[o].concat(p[h][0])),n=p[h],l=n.length,s=0;s<l;s++)this.pixelBuf[i++]=n[s];p.length===1<<r&&r<12&&r++}}}_processFrame(t){t.image=document.createElement("canvas"),t.image.width=this.width,t.image.height=this.height,t.ctx=t.image.getContext("2d");const e=t.localColourTableFlag?t.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=t);const s=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;s||t.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const i=t.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),a=t.transparencyIndex,r=i.data,h=t.interlaced?this.deinterlaceBuf:this.pixelBuf,o=h.length;let n,l,d=0;for(let p=0;p<o;p++)n=h[p],l=e[n],a!==n?(r[d++]=l[0],r[d++]=l[1],r[d++]=l[2],r[d++]=255):s?(r[d+3]=0,d+=4):d+=4;t.ctx.putImageData(i,t.leftPos,t.topPos),this.lastFrame=t}_parseExt(t){const e=t.data[t.pos++];e===gif_a_GCExt?this._parseGCExt(t):e===gif_a_COMMENT?this.comment+=t.readSubBlocks():e===gif_a_APPExt?this._parseAppExt(t):(e===gif_a_UNKNOWN&&(t.pos+=13),t.readSubBlocks())}_parseAppExt(t){t.pos+=1,"NETSCAPE"===t.getString(8)?t.pos+=8:(t.pos+=3,t.readSubBlocks())}_parseGCExt(t){t.pos++;const e=t.data[t.pos++];this.disposalMethod=(28&e)>>2,this.transparencyGiven=!!(1&e),this.delayTime=t.data[t.pos++]+(t.data[t.pos++]<<8),this.transparencyIndex=t.data[t.pos++],t.pos++}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}_play(){let t,e;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((()=>this._play()),t)):this.pause()}_setCurrentFrame(t){const e=this.frames[t];this.currentFrame={frameData:e.image,top:0,left:0,width:this.width,height:this.height}}}class gif_l{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}getString(t){let e="";for(;t--;)e+=String.fromCharCode(this.data[this.pos++]);return e}readSubBlocks(){let t,e,s="";do{for(e=t=this.data[this.pos++];e--;)s+=String.fromCharCode(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}readSubBlocksB(){let t,e;const s=[];do{for(e=t=this.data[this.pos++];e--;)s.push(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}}var Result=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/util/Result.js");var QueueProcessor=__webpack_require__("./node_modules/@arcgis/core/views/support/QueueProcessor.js");const TextureManager_O=Object(vec2f32.a)(),N="arial-unicode-ms-regular",E=Logger.a.getLogger("esri.views.2d.engine.webgl.TextureManager");function V(e,t){const i=Math.round(Object(screenUtils.g)(t)*window.devicePixelRatio),s=i>=128?2:4;return Math.min(e,i*s)}const Y=(e,t,i)=>E.error(new core_Error.a(e,t,i));class D{constructor(e,t,i){this.mosaicType=e,this.page=t,this.sdf=i}static fromMosaic(e,t){return new D(e,t.page,t.sdf)}}class TextureManager_J{constructor(i,r){this.resourceManager=r,this._invalidFontsMap=new Map,this._sdfConverter=new SDFConverter_r(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new QueueProcessor.a({concurrency:10,process:async(e,i)=>{Object(promiseUtils.w)(i);try{return await Object(request.default)(e,{responseType:"image",signal:i})}catch(r){if(!Object(promiseUtils.m)(r))throw new core_Error.a("mapview-invalid-resource",`Could not fetch requested resource at ${e}`,r);throw r}}}),this._spriteMosaic=new SpriteMosaic_c(i,2048,2048,500),this._glyphSource=new GlyphSource_r(`${config.a.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new GlyphMosaic_l(1024,1024,this._glyphSource),this._rasterizer=new Rasterizer.a(r)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(e,t,i,s){if(Object(maybe.k)(e))return Y("mapview-null-resource","Unable to rasterize null resource"),null;switch(e.type){case"text":case"esriTS":{const t=await this._rasterizeText(e,i,s);return t.forEach((e=>this._setTextureBinding(webgl_enums.a.GLYPH,e))),{glyphMosaicItems:t}}default:{if(Object(Utils.q)(e))return Y("mapview-invalid-type",`MapView does not support symbol type: ${e.type}`,e),null;const i=await this._rasterizeSpriteSymbol(e,t,s);return Object(Result.a)(i)&&i&&this._setTextureBinding(webgl_enums.a.SPRITE,i),{spriteMosaicItem:i}}}}bindTextures(e,t,i,s=!1){if(0===i.textureBinding)return;const r=this._bindingInfos[i.textureBinding-1],n=r.page,o=s?9987:9729;switch(r.mosaicType){case webgl_enums.a.SPRITE:{const i=this.sprites.getWidth(n),s=this.sprites.getHeight(n),r=Object(vec2.s)(TextureManager_O,i,s);return this._spriteMosaic.bind(e,o,n,definitions.I),t.setUniform1i("u_texture",definitions.I),void t.setUniform2fv("u_mosaicSize",r)}case webgl_enums.a.GLYPH:{const i=this.glyphs.width,s=this.glyphs.height,r=Object(vec2.s)(TextureManager_O,i,s);return this._glyphMosaic.bind(e,o,n,definitions.D),t.setUniform1i("u_texture",definitions.D),void t.setUniform2fv("u_mosaicSize",r)}default:E.error("mapview-texture-manager",`Cannot handle unknown type ${r.mosaicType}`)}}_hashMosaic(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}_setTextureBinding(e,t){const i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){const s=D.fromMosaic(e,t),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(s)}t.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(e,t,s){let r,n;if("cim"in e){const t=e;r=t.fontName,n=t.text}else{const t=e;r=function fontUtils_n(e){const r=function fontUtils_u(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}(e)+function fontUtils_c(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}(e);return function fontUtils_t(e){const r=e.toLowerCase().split(" ").join("-");switch(r){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return r}}(e.family)+(r.length>0?r:"-regular")}(t.font),n=t.text}const o=this._invalidFontsMap.has(r),a=t||Object(Utils.d)(Object(BidiText.a)(n)[0]);try{return await this._glyphMosaic.getGlyphItems(o?N:r,a,s)}catch(h){return Y("mapview-invalid-resource",`Couldn't find font ${r}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(r,!0),this._glyphMosaic.getGlyphItems(N,a,s)}}async _rasterizeSpriteSymbol(e,t,i){if(Object(Utils.y)(e))return null;const r=function symbolUtils_e(e){switch(e.type){case"esriSMS":return`${e.style}.${e.path}`;case"esriSLS":return`${e.style}.${e.cap}`;case"esriSFS":return`${e.style}`;case"esriPFS":case"esriPMS":return e.imageData?`${e.imageData}${e.width}${e.height}`:`${e.url}${e.width}${e.height}`;default:return"mosaicHash"in e?e.mosaicHash:JSON.stringify(e)}}(e);if(this._spriteMosaic.has(r))return this._spriteMosaic.getSpriteItem(r);if(Object(Utils.x)(e)||Object(Utils.t)(e))return this._handleAsyncResource(r,e,i);const o=this._rasterizer.rasterizeJSONResource(e,1);if(o){const{size:t,image:i,sdf:s,simplePattern:n}=o;return this._addItemToMosaic(r,t,{type:"static",data:i},Object(Utils.z)(e),s,n)}return new core_Error.a("TextureManager","unrecognized or null rasterized image")}async _handleAsyncResource(e,t,i){if(this._ongoingRasterizations.has(e))return this._ongoingRasterizations.get(e);let s;s=Object(Utils.x)(t)?this._handleSVG(t,e,i):this._handleImage(t,e,i),this._ongoingRasterizations.set(e,s);try{await s,this._ongoingRasterizations.delete(e)}catch{this._ongoingRasterizations.delete(e)}return s}async _handleSVG(e,t,i){const s=[126,126],r=await this._sdfConverter.draw(e.path,i);return this._addItemToMosaic(t,s,{type:"static",data:new Uint32Array(r.buffer)},!1,!0,!0)}async _handleGIFOrPNG(e,t,i){const r=await async function H(e,i){const r=Object(Utils.o)(e);let n;const o=";base64,";if(r.includes(o)){const e=r.indexOf(o)+o.length,t=r.substring(e),i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<i.length;r++)s[r]=i.charCodeAt(r);n=s.buffer}else try{const{data:e}=await Object(request.default)(r,{responseType:"array-buffer",...i});n=e}catch(a){if(!Object(promiseUtils.m)(a))return new core_Error.a("mapview-invalid-resource",`Could not fetch requested resource at ${r}`)}return n}(e,i);if(Object(Result.a)(r)){const o=gif_r(r),a=apng_h(r);if(!o&&!a)return new core_Error.a("mapview-invalid-resource","Image data is neither GIF nor PNG!");let c;try{o&&function gif_o(t){if(!t||0===t.byteLength)return!1;const e=new Uint8Array(t);if(!gif_r(e))return!1;let s=0;for(let i=0,a=e.length-9;i<a&&(0!==e[i]||33!==e[i+1]||249!==e[i+2]||4!==e[i+3]||0!==e[i+8]||44!==e[i+9]&&33!==e[i+9]||(s++,!(s>1)));++i);return s>1}(r)?c=await gif_n.create(r,i):a&&function apng_l(t){const e=new Uint8Array(t);if(!apng_h(e))return!1;let r=!1;return apng_p(e,(t=>!(r="acTL"===t))),r}(r)&&(c=await apng_o.create(r,i))}catch(n){if(!Object(promiseUtils.m)(n))return new core_Error.a("mapview-invalid-resource","Could not fetch requested resource!")}if(c&&Object(Result.a)(c))return this._addItemToMosaic(t,[c.width,c.height],{type:"animated",data:c},Object(Utils.z)(e),!1,!1);const u=new Blob([r],{type:o?"image/gif":"image/png"}),d=await this._imageFromBlob(u);if(d&&d instanceof HTMLImageElement){let i=d.width,s=d.height;"esriPMS"===e.type&&(i=Math.round(V(d.width,Object(Utils.k)(e))),s=Math.round(d.height*(i/d.width)));const r="cim"in e?e.cim.colorSubstitutions:void 0,{size:n,sdf:o,image:a}=this._rasterizer.rasterizeImageResource(i,s,d,r);return this._addItemToMosaic(t,n,{type:"static",data:a},Object(Utils.z)(e),o,!1)}}return new core_Error.a("mapview-invalid-resource","Could not handle resource!")}async _handleImage(e,t,i){if(Object(Utils.s)(e)||Object(Utils.v)(e))return this._handleGIFOrPNG(e,t,i);const r=Object(Utils.o)(e);try{let s;const a=this.resourceManager.getResource(r);if(Object(maybe.l)(a))s=a;else{const{data:e}=await this._imageRequestQueue.push(r,{...i});s=e}if(Object(Utils.w)(r))if("width"in e&&"height"in e)s.width=Object(screenUtils.g)(e.width),s.height=Object(screenUtils.g)(e.height);else if("cim"in e){var n;const t=e.cim;s.width=Object(screenUtils.g)(null!=(n=t.width)?n:t.scaleX*t.size),s.height=Object(screenUtils.g)(t.size)}if(!s.width||!s.height)return null;let h=s.width,u=s.height;"esriPMS"===e.type&&(h=Math.round(V(s.width,Object(Utils.k)(e))),u=Math.round(s.height*(h/s.width)));const d="cim"in e?e.cim.colorSubstitutions:void 0,{size:l,sdf:m,image:g}=this._rasterizer.rasterizeImageResource(h,u,s,d);return this._addItemToMosaic(t,l,{type:"static",data:g},Object(Utils.z)(e),m,!1)}catch(a){if(!Object(promiseUtils.m)(a))return new core_Error.a("mapview-invalid-resource",`Could not fetch requested resource at ${r}. ${a.message}`)}}async _imageFromBlob(e){const t=window.URL.createObjectURL(e);try{const{data:e}=await this._imageRequestQueue.push(t);return window.URL.revokeObjectURL(t),e}catch(i){if(window.URL.revokeObjectURL(t),!Object(promiseUtils.m)(i))return new core_Error.a("mapview-invalid-resource",`Could not fetch requested resource at ${t}`);throw i}}_addItemToMosaic(e,t,i,s,r,n){return this._spriteMosaic.addSpriteItem(e,t,i,s,r,n)}}var VertexStream=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/webgl/VertexStream.js");class Effect_t{constructor(){this.name=this.constructor.name}}class AnimationEffect_o extends Effect_t{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(r,i){if(!i.size)return;const{context:a,renderingOptions:o}=r;this._quad||(this._quad=new VertexStream.a(a,[0,0,1,0,0,1,1,1]));const n=a.getBoundFramebufferObject(),{x:u,y:m,width:d,height:f}=a.getViewport();i.bindTextures(a);const c=i.getBlock(definitions.a);if(Object(maybe.k)(c))return;const _=c.getFBO(a),l=c.getFBO(a,1);a.setViewport(0,0,i.size,i.size),this._computeDelta(r,l,o.labelsAnimationTime),this._updateAnimationState(r,l,_),a.bindFramebuffer(n),a.setViewport(u,m,d,f)}_computeDelta(e,t,s){const{context:a,painter:o,displayLevel:n}=e,u=o.materialManager.getProgram(e,this._desc,["delta"]);a.bindFramebuffer(t),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),a.useProgram(u),u.setUniform1i("u_maskTexture",definitions.y),u.setUniform1i("u_sourceTexture",definitions.z),u.setUniform1f("u_timeDelta",e.deltaTime),u.setUniform1f("u_animationTime",s),u.setUniform1f("u_zoomLevel",Math.round(10*n)),this._quad.draw()}_updateAnimationState(e,t,r){const{context:i,painter:s}=e,a=s.materialManager.getProgram(e,this._desc,["update"]);i.bindTexture(t.colorTexture,1),i.useProgram(a),a.setUniform1i("u_sourceTexture",1),i.bindFramebuffer(r),i.setClearColor(0,0,0,0),i.clear(i.gl.COLOR_BUFFER_BIT),this._quad.draw()}}const BlendPrograms_a=e=>`#define ${(e=>e.replace("-","_").toUpperCase())(e)}\n`,BlendPrograms_t={attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:r=>({vertexShader:BlendPrograms_a(r)+Object(resolver.a)("blend/blend.vert"),fragmentShader:BlendPrograms_a(r)+Object(resolver.a)("blend/blend.frag")})},BlendEffect_d=Logger.a.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class BlendEffect_u{constructor(){this._size=[0,0]}dispose(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null)}draw(r,t,s,i,a){const{context:u,drawPhase:c}=r;if(this._setupShader(u),i&&"normal"!==i&&c!==webgl_enums.c.LABEL)return void this._drawBlended(r,t,s,i,a);const m=this._programCache.getProgram(BlendPrograms_t,"normal");if(!m)return void BlendEffect_d.error(new core_Error.a("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));u.useProgram(m),t.setSamplingMode(s),u.bindTexture(t,0),m.setUniform1i("u_layerTexture",0),m.setUniform1f("u_opacity",a),u.setBlendingEnabled(!0),u.setBlendFunction(1,771);const f=this._quad;f.draw(),f.unbind()}_drawBlended(r,s,i,o,a){const{context:u,state:c,pixelRatio:m,inFadeTransition:f}=r,{size:h}=c,l=u.getBoundFramebufferObject();let p,g;if(Object(maybe.l)(l)){const e=l.descriptor;p=e.width,g=e.height}else p=Math.round(m*h[0]),g=Math.round(m*h[1]);this._createOrResizeTexture(r,p,g);const b=this._backBufferTexture;l.copyToTexture(0,0,p,g,0,0,b),u.setStencilTestEnabled(!1),u.setStencilWriteMask(0),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setDepthWriteEnabled(!1);const _=this._programCache.getProgram(BlendPrograms_t,o);if(!_)return void BlendEffect_d.error(new core_Error.a("mapview-BlendEffect",`Error creating shader program for blend mode ${o}`));u.useProgram(_),b.setSamplingMode(i),u.bindTexture(b,0),_.setUniform1i("u_backbufferTexture",0),s.setSamplingMode(i),u.bindTexture(s,1),_.setUniform1i("u_layerTexture",1),_.setUniform1f("u_opacity",a),_.setUniform1f("u_inFadeOpacity",f?1:0),u.setBlendFunction(1,0);const x=this._quad;x.draw(),x.unbind(),u.setBlendFunction(1,771)}_setupShader(e){this._programCache||(this._programCache=new ProgramCache.a(e),this._quad||(this._quad=new VertexStream.a(e,[-1,-1,1,-1,-1,1,1,1])))}_createOrResizeTexture(e,r,t){const{context:s}=e;null!==this._backBufferTexture&&r===this._size[0]&&t===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(r,t):this._backBufferTexture=new Texture.a(s,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:r,height:t}),this._size[0]=r,this._size[1]=t)}}class FeatureEffect_t extends Effect_t{constructor(e){super(),this.name=this.constructor.name,this.defines=[e]}dispose(){}bind({context:e,painter:t}){this._prev=e.getBoundFramebufferObject();const{width:r,height:s}=e.getViewport(),o=t.getFbos(r,s).effect0;e.bindFramebuffer(o),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}draw(e,t){const{context:r,painter:s}=e,o=s.getPostProcessingEffects(t),n=r.getBoundFramebufferObject();for(const{postProcessingEffect:c,effect:f}of o)c.draw(e,n,f);r.bindFramebuffer(this._prev),r.setStencilTestEnabled(!1),s.blitTexture(r,n.colorTexture,9728),r.setStencilTestEnabled(!0)}}const parameters_t=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],parameters_i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],parameters_e_outlineWidth=.7,parameters_e_outerHaloWidth=.7,parameters_e_innerHaloWidth=.7,parameters_e_outlinePosition=0,HighlightGradient_n=Logger.a.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");const HighlightGradient_s=[0,0,0,0];class HighlightGradient_a{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:parameters_e_outlinePosition,outlineWidth:parameters_e_outlineWidth,innerHaloWidth:parameters_e_innerHaloWidth,outerHaloWidth:parameters_e_outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}setHighlightOptions(o){const i=this._convertedHighlightOptions;!function HighlightGradient_h(o,i){i.fillColor[0]=o.color.r/255,i.fillColor[1]=o.color.g/255,i.fillColor[2]=o.color.b/255,i.fillColor[3]=o.color.a,o.haloColor?(i.outlineColor[0]=o.haloColor.r/255,i.outlineColor[1]=o.haloColor.g/255,i.outlineColor[2]=o.haloColor.b/255,i.outlineColor[3]=o.haloColor.a):(i.outlineColor[0]=i.fillColor[0],i.outlineColor[1]=i.fillColor[1],i.outlineColor[2]=i.fillColor[2],i.outlineColor[3]=i.fillColor[3]),i.fillColor[3]*=o.fillOpacity,i.outlineColor[3]*=o.haloOpacity,i.fillColor[0]*=i.fillColor[3],i.fillColor[1]*=i.fillColor[3],i.fillColor[2]*=i.fillColor[3],i.outlineColor[0]*=i.outlineColor[3],i.outlineColor[1]*=i.outlineColor[3],i.outlineColor[2]*=i.outlineColor[3],i.outlineWidth=parameters_e_outlineWidth,i.outerHaloWidth=parameters_e_outerHaloWidth,i.innerHaloWidth=parameters_e_innerHaloWidth,i.outlinePosition=parameters_e_outlinePosition}(o,i);const t=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,e=i.outlinePosition-i.outlineWidth/2,a=i.outlinePosition+i.outlineWidth/2,u=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,d=1*Math.sqrt(Math.PI/2),g=Math.abs(t)>d?Math.round(10*(Math.abs(t)-d))/10:0,f=Math.abs(u)>d?Math.round(10*(Math.abs(u)-d))/10:0;let C;g&&!f?HighlightGradient_n.error("The outer rim of the highlight is "+g+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!g&&f?HighlightGradient_n.error("The inner rim of the highlight is "+f+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):g&&f&&HighlightGradient_n.error("The highlight is "+Math.max(g,f)+"px away from the edge of the feature; consider reducing some width values.");const c=[void 0,void 0,void 0,void 0];function m(o,i,t){c[0]=(1-t)*o[0]+t*i[0],c[1]=(1-t)*o[1]+t*i[1],c[2]=(1-t)*o[2]+t*i[2],c[3]=(1-t)*o[3]+t*i[3]}const{texelData:p}=this;for(let r=0;r<256;++r)C=t+r/255*(u-t),C<t?(c[4*r+0]=0,c[4*r+1]=0,c[4*r+2]=0,c[4*r+3]=0):C<e?m(HighlightGradient_s,i.outlineColor,(C-t)/(e-t)):C<a?[c[0],c[1],c[2],c[3]]=i.outlineColor:C<u?m(i.outlineColor,i.fillColor,(C-a)/(u-a)):[c[4*r+0],c[4*r+1],c[4*r+2],c[4*r+3]]=i.fillColor,p[4*r+0]=255*c[0],p[4*r+1]=255*c[1],p[4*r+2]=255*c[2],p[4*r+3]=255*c[3];this.minMaxDistance[0]=t,this.minMaxDistance[1]=u,this.shadeTexChanged=!0}applyHighlightOptions(o,e){this.shadeTex||(this.shadeTex=new Texture.a(o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,256,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,definitions.F),e.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}destroy(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}const HighlightPrograms_t={shaders:{vertexShader:Object(resolver.a)("highlight/textured.vert"),fragmentShader:Object(resolver.a)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},HighlightPrograms_r={shaders:{vertexShader:Object(resolver.a)("highlight/textured.vert"),fragmentShader:Object(resolver.a)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};class HighlightRenderer_n{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(r,e){r.bindTexture(e,definitions.E),r.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",parameters_t),r.bindVAO(this._resources.quadVAO),r.drawArrays(5,0,4),r.bindVAO()}finalBlur(r,e){r.bindTexture(e,definitions.E),r.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",parameters_i),r.bindVAO(this._resources.quadVAO),r.drawArrays(5,0,4),r.bindVAO()}renderHighlight(r,e,s){r.bindTexture(e,definitions.E),r.useProgram(this._resources.highlightProgram),s.applyHighlightOptions(r,this._resources.highlightProgram),r.bindVAO(this._resources.quadVAO),r.setBlendingEnabled(!0),r.setBlendFunction(1,771),r.drawArrays(5,0,4),r.bindVAO()}_initialize(o,u,n){this._width=u,this._height=n;const g=BufferObject.a.createVertex(o,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),d=new VertexArrayObject.a(o,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:g}),l=Object(programUtils.a)(o,HighlightPrograms_t),c=Object(programUtils.a)(o,HighlightPrograms_r);l.setUniform1i("u_texture",definitions.E),l.setUniform1i("u_shade",definitions.F),l.setUniform1f("u_sigma",1),c.setUniform1i("u_texture",definitions.E),c.setUniform1f("u_sigma",1),this._resources={quadGeometry:g,quadVAO:d,highlightProgram:l,blurProgram:c}}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s)}}function HighlightSurfaces_s(s,t,i){const h=new Texture.a(s,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:i,samplingMode:9729});return[h,new FramebufferObject.a(s,{colorTarget:0,depthStencilTarget:2},h)]}class HighlightSurfaces_t{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(e,r,t){this._width=r,this._height=t;const[i,h]=HighlightSurfaces_s(e,r,t),[o,u]=HighlightSurfaces_s(e,r,t);this._resources={sharedBlur1Tex:i,sharedBlur1Fbo:h,sharedBlur2Tex:o,sharedBlur2Fbo:u}}setup(e,r,s){!this._resources||this._width===r&&this._height===s||this.dispose(),this._resources||this._initialize(e,r,s)}get sharedBlur1Tex(){return this._resources.sharedBlur1Tex}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Tex}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}class HighlightEffect_d extends Effect_t{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new HighlightRenderer_n,this._hlGradient=new HighlightGradient_a,this._width=void 0,this._height=void 0,this._hlSurfaces=new HighlightSurfaces_t,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new BitBlitRenderer_s}dispose(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}bind(e){const{context:t,painter:i}=e,{width:s,height:h}=t.getViewport(),r=i.getFbos(s,h).effect0;this.setup(e,s,h),t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:e},t,i){this._width=t,this._height=i;const s=t%4,h=i%4;t+=s<2?-s:4-s,i+=h<2?-h:4-h,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=e.getBoundFramebufferObject();const d=Math.round(1*t),n=Math.round(1*i);this._hlRenderer.setup(e,d,n),this._hlSurfaces.setup(e,d,n)}draw({context:e}){const t=e.getBoundFramebufferObject();e.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,t.colorTexture,9728,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!0),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}setHighlightOptions(e){this._hlGradient.setHighlightOptions(e)}}class HittestEffect_o extends Effect_t{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["id"],this._lastSize=0}dispose(){Object(maybe.l)(this._fbo)&&this._fbo.dispose()}bind({context:t,painter:e}){const{width:s,height:o}=t.getViewport();this._boundFBO=t.getBoundFramebufferObject();const r=e.getFbos(s,o).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind({context:t}){t.bindFramebuffer(this._boundFBO),this._boundFBO=null}draw({context:t,state:s,pixelRatio:o},r,i=definitions.q){const n=t.getBoundFramebufferObject(),f=s.size[1]*o,a=Math.round(i*o),h=a/2,u=a/2;this._ensureBuffer(a),r.forEach(((t,e)=>{const s=new Map,i=Math.floor(e.x*o-a/2),b=Math.floor(f-e.y*o-a/2);n.readPixels(i,b,a,a,6408,5121,this._buf);for(let o=0;o<this._buf32.length;o++){const t=this._buf32[o];if(4294967295!==t&&0!==t){const e=o%a,r=a-Math.floor(o/a),i=(h-e)*(h-e)+(u-r)*(u-r),n=s.has(t)?s.get(t):4294967295;s.set(t,Math.min(i,n))}}const c=Array.from(s).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(c),r.delete(e)}))}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))}}const Bloom_s=[1,0],Bloom_r=[0,1],Bloom_o=[1,.8,.6,.4,.2],Bloom_n=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class Bloom_a{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,a,l){const{width:h,height:u}=a,{context:p,painter:m}=t,{materialManager:c}=m,d=p.gl,_=this._programDesc,{strength:g,radius:f,threshold:b}=l;this._quad||(this._quad=new VertexStream.a(p,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t,h,u),p.setStencilTestEnabled(!1),p.setBlendingEnabled(!0),p.setBlendFunction(1,771),p.setStencilWriteMask(0);const F=this._quad;F.bind(),p.bindFramebuffer(this._intensityFBO);const B=c.getProgram(t,_.luminosityHighPass);p.useProgram(B),p.bindTexture(a.colorTexture,0),B.setUniform1i("u_texture",0),B.setUniform3fv("u_defaultColor",[0,0,0]),B.setUniform1f("u_defaultOpacity",0),B.setUniform1f("u_luminosityThreshold",b),B.setUniform1f("u_smoothWidth",.01);const O=[Math.round(h/2),Math.round(u/2)];p.setViewport(0,0,O[0],O[1]),p.setClearColor(0,0,0,0),p.clear(d.COLOR_BUFFER_BIT),F.draw(),p.setBlendingEnabled(!1);let T=this._intensityFBO.colorTexture;for(let e=0;e<this._nMips;e++){const i=c.getProgram(t,_.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[e]}]);p.useProgram(i),p.bindTexture(T,e+1),i.setUniform1i("u_colorTexture",e+1),i.setUniform2fv("u_texSize",O),i.setUniform2fv("u_direction",Bloom_s),p.setViewport(0,0,O[0],O[1]);const o=this._mipsFBOs[e];p.bindFramebuffer(o.horizontal),F.draw(),T=o.horizontal.colorTexture,p.bindFramebuffer(o.vertical),p.bindTexture(T,e+1),i.setUniform2fv("u_direction",Bloom_r),F.draw(),T=o.vertical.colorTexture,O[0]=Math.round(O[0]/2),O[1]=Math.round(O[1]/2)}p.setViewport(0,0,h,u);const x=c.getProgram(t,_.composite,[{name:"nummips",value:5}]);p.bindFramebuffer(this._compositeFBO),p.useProgram(x),x.setUniform1f("u_bloomStrength",g),x.setUniform1f("u_bloomRadius",f),x.setUniform1fv("u_bloomFactors",Bloom_o),x.setUniform3fv("u_bloomTintColors",Bloom_n),p.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),x.setUniform1i("u_blurTexture1",1),p.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),x.setUniform1i("u_blurTexture2",2),p.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),x.setUniform1i("u_blurTexture3",3),p.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),x.setUniform1i("u_blurTexture4",4),p.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),x.setUniform1i("u_blurTexture5",5),F.draw(),p.bindFramebuffer(a),p.setBlendingEnabled(!0);const w=c.getProgram(t,_.blit);p.useProgram(w),p.bindTexture(this._compositeFBO.colorTexture,6),w.setUniform1i("u_texture",6),p.setBlendFunction(1,1),F.draw(),F.unbind(),p.setBlendFunction(1,771),p.setStencilTestEnabled(!0)}_createOrResizeResources(e,i,s){const{context:r}=e;if(this._compositeFBO&&this._size[0]===i&&this._size[1]===s)return;this._size[0]=i,this._size[1]=s;const o=[Math.round(i/2),Math.round(s/2)];this._compositeFBO?this._compositeFBO.resize(i,s):this._compositeFBO=new FramebufferObject.a(r,{colorTarget:0,depthStencilTarget:0,width:i,height:s}),this._intensityFBO?this._intensityFBO.resize(o[0],o[1]):this._intensityFBO=new FramebufferObject.a(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]});for(let n=0;n<this._nMips;n++)this._mipsFBOs[n]?(this._mipsFBOs[n].horizontal.resize(o[0],o[1]),this._mipsFBOs[n].vertical.resize(o[0],o[1])):this._mipsFBOs[n]={horizontal:new FramebufferObject.a(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),vertical:new FramebufferObject.a(r,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]})},o[0]=Math.round(o[0]/2),o[1]=Math.round(o[1]/2)}}const Blur_r=[1,0],Blur_s=[0,1];class Blur_i{constructor(){this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(e,r,s){const{context:i}=e,{type:a,radius:n}=s;if(0===n)return;this._createOrResizeResources(e),this._quad||(this._quad=new VertexStream.a(i,[-1,-1,1,-1,-1,1,1,1]));const o=this._quad;o.bind(),"blur"===a?this._gaussianBlur(e,r,n):this._radialBlur(e,r),o.unbind()}_gaussianBlur(e,t,i){const{context:a,state:n,painter:o,pixelRatio:u}=e,{size:l}=n,{materialManager:d}=o,b=this._programDesc,p=this._quad,c=[Math.round(u*l[0]),Math.round(u*l[1])],h=this._blurFBO,g=d.getProgram(e,b.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);a.useProgram(g),a.setBlendingEnabled(!1),a.bindFramebuffer(h),a.bindTexture(t.colorTexture,4),g.setUniform1i("u_colorTexture",4),g.setUniform2fv("u_texSize",c),g.setUniform2fv("u_direction",Blur_r),g.setUniform1f("u_sigma",i),p.draw(),a.bindFramebuffer(t),a.setStencilWriteMask(0),a.setStencilTestEnabled(!1),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.bindTexture(h.colorTexture,5),g.setUniform1i("u_colorTexture",5),g.setUniform2fv("u_direction",Blur_s),p.draw(),a.setBlendingEnabled(!0),a.setBlendFunction(1,771),a.setStencilTestEnabled(!0)}_radialBlur(e,t){const{context:r,painter:s}=e,{materialManager:i}=s,a=this._programDesc,n=this._quad,o=this._blurFBO;r.bindFramebuffer(o);const u=i.getProgram(e,a.radialBlur);r.useProgram(u),r.setBlendingEnabled(!1),r.bindTexture(t.colorTexture,4),u.setUniform1i("u_colorTexture",4),n.draw(),r.bindFramebuffer(t),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setBlendingEnabled(!0);const l=i.getProgram(e,a.blit);r.useProgram(l),r.bindTexture(o.colorTexture,5),l.setUniform1i("u_texture",5),r.setBlendFunction(1,771),n.draw()}_createOrResizeResources(t){const{context:r,state:s,pixelRatio:i}=t,{size:a}=s,n=Math.round(i*a[0]),o=Math.round(i*a[1]);this._blurFBO&&this._size[0]===n&&this._size[1]===o||(this._size[0]=n,this._size[1]=o,this._blurFBO?this._blurFBO.resize(n,o):this._blurFBO=new FramebufferObject.a(r,{colorTarget:0,depthStencilTarget:0,width:n,height:o},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:n,height:o}))}}class Colorize_r{constructor(){this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}draw(e,t,r){const{width:s,height:i}=t;this._createOrResizeResources(e,s,i);const{context:o,painter:a}=e,{materialManager:n}=a,l=this._programDesc,c=this._quad,u=r.colorMatrix;c.bind();const h=this._layerFBOTexture;o.bindFramebuffer(t),t.copyToTexture(0,0,s,i,0,0,h),o.setBlendingEnabled(!1),o.setStencilTestEnabled(!1);const p=n.getProgram(e,l);o.useProgram(p),o.bindTexture(h,2),p.setUniformMatrix4fv("u_coefficients",u),p.setUniform1i("u_colorTexture",2),c.draw(),o.setBlendingEnabled(!0),o.setBlendFunction(1,771),o.setStencilTestEnabled(!0),c.unbind()}_createOrResizeResources(r,s,i){const{context:o}=r;this._layerFBOTexture&&this._size[0]===s&&this._size[1]===i||(this._size[0]=s,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(s,i):this._layerFBOTexture=new Texture.a(o,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:s,height:i}),this._quad||(this._quad=new VertexStream.a(o,[-1,-1,1,-1,-1,1,1,1])))}}const DropShadow_s=[1,0],DropShadow_o=[0,1];class DropShadow_a{constructor(){this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/drop-shadow",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}draw(t,r,a){const{context:l,state:n,painter:u}=t,{materialManager:h}=u,p=this._programDesc,d=r.width,c=r.height,m=[Math.round(d/2),Math.round(c/2)],{blurRadius:_,offsetX:f,offsetY:B,color:g}=a,b=[Object(screenUtils.g)(f/2),Object(screenUtils.g)(B/2)];this._createOrResizeResources(t,d,c,m);const F=this._horizontalBlurFBO,w=this._verticalBlurFBO;l.setStencilWriteMask(0),l.setStencilTestEnabled(!1),l.setDepthWriteEnabled(!1),l.setDepthTestEnabled(!1);const x=this._layerFBOTexture;r.copyToTexture(0,0,d,c,0,0,x),this._quad||(this._quad=new VertexStream.a(l,[-1,-1,1,-1,-1,1,1,1])),l.setViewport(0,0,m[0],m[1]);const T=this._quad;T.bind(),l.setBlendingEnabled(!1);const O=h.getProgram(t,p.blur,[{name:"radius",value:Math.ceil(_)}]);l.useProgram(O),l.bindFramebuffer(F),l.bindTexture(r.colorTexture,4),O.setUniformMatrix3fv("u_displayViewMat3",n.displayMat3),O.setUniform2fv("u_offset",b),O.setUniform1i("u_colorTexture",4),O.setUniform2fv("u_texSize",m),O.setUniform2fv("u_direction",DropShadow_s),O.setUniform1f("u_sigma",_),T.draw(),l.bindFramebuffer(w),l.bindTexture(F.colorTexture,5),O.setUniformMatrix3fv("u_displayViewMat3",n.displayMat3),O.setUniform2fv("u_offset",[0,0]),O.setUniform1i("u_colorTexture",5),O.setUniform2fv("u_direction",DropShadow_o),T.draw(),l.bindFramebuffer(r),l.setViewport(0,0,d,c);const v=h.getProgram(t,p.composite);l.useProgram(v),l.bindTexture(w.colorTexture,2),v.setUniform1i("u_blurTexture",2),l.bindTexture(x,3),v.setUniform1i("u_layerFBOTexture",3),v.setUniform4fv("u_shadowColor",[g[3]*(g[0]/255),g[3]*(g[1]/255),g[3]*(g[2]/255),g[3]]),T.draw(),l.setBlendingEnabled(!0),l.setStencilTestEnabled(!0),l.setBlendFunction(1,771),T.unbind()}_createOrResizeResources(e,i,s,o){const{context:a}=e;this._horizontalBlurFBO&&this._size[0]===i&&this._size[1]===s||(this._size[0]=i,this._size[1]=s,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(o[0],o[1]):this._horizontalBlurFBO=new FramebufferObject.a(a,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(o[0],o[1]):this._verticalBlurFBO=new FramebufferObject.a(a,{colorTarget:0,depthStencilTarget:0,width:o[0],height:o[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:o[0],height:o[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(i,s):this._layerFBOTexture=new Texture.a(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i,height:s}))}}class Opacity_t{constructor(){this._size=[0,0]}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}draw(e,t,r){const{width:s,height:i}=t;this._createOrResizeResources(e,s,i);const{context:l,painter:o}=e,{amount:a}=r,h=l.gl,n=this._layerFBOTexture;l.bindFramebuffer(t),t.copyToTexture(0,0,s,i,0,0,n),l.setBlendingEnabled(!0),l.setStencilTestEnabled(!1),l.setDepthTestEnabled(!1),l.setClearColor(0,0,0,0),l.clear(h.COLOR_BUFFER_BIT),o.blitTexture(l,n,9728,a)}_createOrResizeResources(t,r,s){const{context:i}=t;this._layerFBOTexture&&this._size[0]===r&&this._size[1]===s||(this._size[0]=r,this._size[1]=s,this._layerFBOTexture?this._layerFBOTexture.resize(r,s):this._layerFBOTexture=new Texture.a(i,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!1,width:r,height:s}))}}function EffectManager_c(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}const EffectManager_f={colorize:()=>new Colorize_r,blur:()=>new Blur_i,bloom:()=>new Bloom_a,opacity:()=>new Opacity_t,"drop-shadow":()=>new DropShadow_a};class EffectManager_i{constructor(e){this._requestRender=e,this._effectMap=new Map}dispose(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((e=>e.dispose())),this._effectMap.clear()}getPostProcessingEffects(e){if(!e||0===e.length)return[];const t=[];for(const o of e){const e=EffectManager_c(o.type);let s=this._effectMap.get(e);s||(s=EffectManager_f[e](),this._effectMap.set(e,s)),t.push({postProcessingEffect:s,effect:o})}return t}}var arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js");class RenderPass_s{constructor(r,e){var s;this.brushes=r,this.name=e.name,this.drawPhase=e.drawPhase||webgl_enums.c.MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=null!=(s=e.enableDefaultDraw)?s:()=>!0}render(r){const{context:e,profiler:t}=r,s=this._targetFn(),a=this.drawPhase&r.drawPhase;if(t.recordPassStart(this.name),a){this.enableDefaultDraw()&&this._doRender(r,s),t.recordPassEnd();for(const a of this.effects){if(!a.enable())continue;const o=a.apply;t.recordPassStart(this.name+"."+o.name),t.recordBrushStart(o.name);const n=a.args&&a.args(),{x:i,y:d,width:f,height:h}=e.getViewport(),c=e.getBoundFramebufferObject();o.bind(r,n),this._doRender(r,s,o.defines),o.draw(r,n),o.unbind(r,n),e.bindFramebuffer(c),e.setViewport(i,d,f,h),t.recordBrushEnd(),t.recordPassEnd()}}}_doRender(t,s,a){if(!Object(maybe.k)(s))if(Object(arrayUtils.h)(s)){for(const r of s)if(r.visible)for(const e of this.brushes)t.profiler.recordBrushStart(e.name),e.prepareState(t,r,a),e.draw(t,r,a),t.profiler.recordBrushEnd()}else for(const r of this.brushes)t.profiler.recordBrushStart(r.name),r.prepareState(t,s,a),r.draw(t,s,a),t.profiler.recordBrushEnd()}}const Painter_m={[webgl_enums.d.FILL]:brushes.a.fill,[webgl_enums.d.LINE]:brushes.a.line,[webgl_enums.d.MARKER]:brushes.a.marker,[webgl_enums.d.TEXT]:brushes.a.text};class Painter_M{constructor(e,t,s){this.context=e,this._blitRenderer=new BitBlitRenderer_s,this._brushCache=new Map,this._vtlMaterialManager=new VTLMaterialManager.a,this._blendEffect=new BlendEffect_u,this.effects={highlight:new HighlightEffect_d,hittest:new HittestEffect_o,integrate:new AnimationEffect_o,insideEffect:new FeatureEffect_t("inside"),outsideEffect:new FeatureEffect_t("outside")},this.materialManager=new MaterialManager_m(e),this.textureManager=new TextureManager_J(t,s),this._effectsManager=new EffectManager_i(t)}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e}getFbos(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(const s in this._fbos)this._fbos[s].resize(e,t);return this._fbos}const i={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:t},n={colorTarget:0,depthStencilTarget:3},a=new Renderbuffer.a(this.context,{width:e,height:t,internalFormat:34041});this._stencilBuf=a,this._fbos={output:new FramebufferObject.a(this.context,n,i,a),blend:new FramebufferObject.a(this.context,n,i,a),effect0:new FramebufferObject.a(this.context,n,i,a)}}return this._fbos}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(t,s=null){const{width:r,height:i}=t.getViewport();this._prevFBO=t.getBoundFramebufferObject();const n=this.getFbos(r,i);if(t.bindFramebuffer(n.output),t.setColorMask(!0,!0,!0,!0),t.setDepthWriteEnabled(!0),Object(maybe.l)(s)){const{r:e,g:r,b:i,a:n}=s.color;t.setClearColor(n*e/255,n*r/255,n*i/255,n)}else t.setClearColor(0,0,0,0);t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1)}beforeRenderLayer(e,t,s){const{context:r,blendMode:i,effects:n,requireFBO:a,drawPhase:o}=e;if(a||Painter_E(o,i,n,s))r.bindFramebuffer(this._fbos.blend),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setDepthWriteEnabled(!0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);else{const e=this._getOutputFBO();r.bindFramebuffer(e)}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(r.gl.STENCIL_BUFFER_BIT)}compositeLayer(s,r){const{context:i,blendMode:n,effects:a,requireFBO:o,drawPhase:f}=s;if(o||Painter_E(f,n,a,r)){Object(maybe.l)(a)&&a.length>0&&f===webgl_enums.c.MAP&&this._applyEffects(s,a);const o=this._getOutputFBO();i.bindFramebuffer(o),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);const l=Object(maybe.k)(n)||f===webgl_enums.c.HIGHLIGHT?"normal":n;this._blendEffect.draw(s,this._fbos.blend.colorTexture,9728,l,r)}}renderLayers(e){if(e.bindFramebuffer(this._prevFBO),!this._fbos)return;const t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728)}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(const e in this.effects)this.effects[e]&&this.effects[e].dispose();this._effectsManager.dispose(),this._vtlMaterialManager&&(this._vtlMaterialManager.dispose(),this._vtlMaterialManager=null),this._prevFBO=null}getGeometryBrush(e){const t=Painter_m[e];let s=this._brushCache.get(t);return void 0===s&&(s=new t,this._brushCache.set(t,s)),this._brushCache.get(t)}renderObject(e,t,s,r){const n=brushes.a[s];if(!n)return null;let a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.prepareState(e,t,r),a.draw(e,t,r)}renderObjects(e,t,s,r){const n=brushes.a[s];if(!n)return null;let a=this._brushCache.get(n);void 0===a&&(a=new n,this._brushCache.set(n,a)),a.drawMany(e,t,r)}registerRenderPass(e){const t=e.brushes.map((e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e))));return new RenderPass_s(t,e)}setHighlightOptions(e){this.effects.highlight.setHighlightOptions(e)}blitTexture(e,t,s,r=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,s,r)}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(e,t){const{context:s}=e,r=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:i,effect:n}of r)s.bindFramebuffer(this._fbos.blend),i.draw(e,this._fbos.blend,n)}}function Painter_E(t,s,r,i){return t!==webgl_enums.c.HIGHLIGHT&&(1!==i||Object(maybe.l)(s)&&"normal"!==s||Object(maybe.l)(r)&&r.length>0)}var CircularArray=__webpack_require__("./node_modules/@arcgis/core/core/CircularArray.js"),Evented=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),DisjointTimerQuery=__webpack_require__("./node_modules/@arcgis/core/views/webgl/capabilities/DisjointTimerQuery.js");const Profiler_i=Object(has.a)("esri-2d-profiler");class Profiler_o{constructor(t,r){if(this._events=new Evented.a,this._entries=new Map,this._timings=new CircularArray.a(10),!Profiler_i)return;this._ext=Object(DisjointTimerQuery.a)(t.gl,{}),this._debugOutput=r;const o=t.gl;if(this.enableCommandLogging)for(const e in o)if("function"==typeof o[e]){const s=o[e],t=-1!==e.indexOf("draw");o[e]=(...r)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:e,args:r,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),s.apply(o,r))}}get enableCommandLogging(){return!("object"==typeof Profiler_i&&Profiler_i.disableCommands)}recordContainerStart(e){Profiler_i&&(this._currentContainer=e)}recordContainerEnd(){Profiler_i&&(this._currentContainer=null)}recordPassStart(e){Profiler_i&&(this._currentPass=e,this._initSummary())}recordPassEnd(){Profiler_i&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){Profiler_i&&(this._currentBrush=e)}recordBrushEnd(){Profiler_i&&(this._currentBrush=null)}recordStart(e){if(Profiler_i&&Object(maybe.l)(this._ext)){if(this._entries.has(e)){const s=this._entries.get(e),t=this._ext.resultAvailable(s.query),n=this._ext.disjoint();if(t&&!n){const t=this._ext.getResult(s.query)/1e6;let n=0;if(Object(maybe.l)(this._timings.enqueue(t))){const e=this._timings.entries,s=e.length;let t=0;for(const r of e)t+=r;n=t/s}const i=t.toFixed(2),o=n?n.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${i} ms (${o} last 10 avg)\n${s.commandsLen} Commands (${s.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(s.summaries),console.log("Commands: ",s.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${i} ms (${o} last 10 avg)`),this._debugOutput.innerHTML=`${i} (${o})`}for(const e of s.handles)e.remove();this._entries.delete(e)}const s={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(s.handles.push(this._events.on("command",(e=>{s.commandsLen++,s.commands.push(e),e.isDrawCommand&&s.drawCommands++}))),s.handles.push(this._events.on("summary",(e=>{s.summaries.push(e)})))),this._ext.beginTimeElapsed(s.query),this._entries.set(e,s)}}recordEnd(e){Profiler_i&&Object(maybe.l)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}const StencilPrograms_r={shaders:{vertexShader:Object(resolver.a)("stencil/stencil.vert"),fragmentShader:Object(resolver.a)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};var Timeline=__webpack_require__("./node_modules/@arcgis/core/views/2d/support/Timeline.js"),screenshotUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/screenshotUtils.js"),RenderingContext=__webpack_require__("./node_modules/@arcgis/core/views/webgl/RenderingContext.js");class Stage_S extends Container.a{constructor(n,a){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=Object(vec2f64.b)(),this._upperRight=Object(vec2f64.b)(),this._lowerLeft=Object(vec2f64.b)(),this._lowerRight=Object(vec2f64.b)(),this._mat2=Object(mat2df64.b)(),this._clipRendererInitialized=!1,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:o=document.createElement("canvas"),alpha:h=!0,stencil:l=!0,contextOptions:c={}}=a;this._canvas=o;const p=Object(context_util.b)(o,1,{alpha:h,antialias:!1,depth:!0,stencil:l});this.context=new RenderingContext.a(Object(maybe.l)(p)?p:null,c),this.resourceManager=new CIMResourceManager.a,this.painter=new Painter_M(this.context,this,this.resourceManager),Object(has.a)("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),n.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:a.timeline||new Timeline.a,renderingOptions:a.renderingOptions,requireFBO:!1,profiler:new Profiler_o(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=Object(scheduling.a)({render:e=>this.renderFrame(e)}),this._taskHandle.pause(),this._lostWebGLContextHandle=Object(events.c)(o,"webglcontextlost",(()=>{this.emit("webgl-error",{error:new core_Error.a("webgl-context-lost")})})),o.setAttribute("style","width: 100%; height:100%; display:block;"),n.appendChild(o)}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=Object(watchUtils.a)(this._highlightOptions,"version",(()=>{this.painter.setHighlightOptions(e),this.requestRender()})))}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender()}get state(){return this._state}set state(e){this._state=e,this.requestRender()}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}trashDisplayObject(e){this._trash.add(e),this.requestRender()}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._renderRemainingTime=2e3,this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}renderFrame(e){const t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}_createTransforms(){return{dvs:Object(mat3f32.b)()}}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._renderChildren(this.children,e);for(const t of this.children)t.afterRender(e)}_renderChildren(e,t){const r=this.context;t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,this._beforeRenderChildren(t),t.drawPhase=webgl_enums.c.MAP,this.painter.beforeRenderLayers(r,this.background);for(const i of e)i.processRender(t);this.painter.renderLayers(r),t.drawPhase=webgl_enums.c.HIGHLIGHT,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);if(this.painter.renderLayers(r),this._isLabelDrawPhaseRequired(e)){t.drawPhase=webgl_enums.c.LABEL,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);this.painter.renderLayers(r)}if(Object(has.a)("esri-tiles-debug")){t.drawPhase=webgl_enums.c.DEBUG,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);this.painter.renderLayers(r)}t.profiler.recordEnd("drawLayers"),this._afterRenderChildren()}_beforeRenderChildren(e){const{context:t}=this,{state:i,pixelRatio:r}=e;t.enforceState(),t.setClearDepth(1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT);const{size:s,rotation:n}=i,d=Math.round(s[0]*r),c=Math.round(s[1]*r);if(this._boundFBO=t.getBoundFramebufferObject(),!i.spatialReference||!(i.spatialReference._isWrappable?i.spatialReference._isWrappable():i.spatialReference.isWrappable))return void(this._clipFrame=!1);const u=Object(common.d)(n),_=Math.abs(Math.cos(u)),g=Math.abs(Math.sin(u)),b=Math.round(d*_+c*g),R=Math.round(i.worldScreenWidth);if(b<=R)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===d&&this._clipFBO.height===c||(this._clipFBO=new FramebufferObject.a(t,{colorTarget:0,depthStencilTarget:3,width:d,height:c}));const w=(this.state.padding.left-this.state.padding.right)/2,O=(this.state.padding.bottom-this.state.padding.top)/2,y=.5*d,F=.5*c,x=1/d,C=1/c,T=R*r*.5,j=.5*(d*g+c*_),B=this._upperLeft,P=this._upperRight,v=this._lowerLeft,k=this._lowerRight;Object(vec2.s)(B,-T,-j),Object(vec2.s)(P,T,-j),Object(vec2.s)(v,-T,j),Object(vec2.s)(k,T,j),Object(mat2d.d)(this._mat2),Object(mat2d.h)(this._mat2,this._mat2,[y+w,F-O]),0!==n&&Object(mat2d.f)(this._mat2,this._mat2,u),Object(vec2.t)(B,B,this._mat2),Object(vec2.t)(P,P,this._mat2),Object(vec2.t)(v,v,this._mat2),Object(vec2.t)(k,k,this._mat2);const S=this._clipData;S.set([2*v[0]*x-1,2*(c-v[1])*C-1,2*k[0]*x-1,2*(c-k[1])*C-1,2*B[0]*x-1,2*(c-B[1])*C-1,2*P[0]*x-1,2*(c-P[1])*C-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(S),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}_afterRenderChildren(){const e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.useProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:t,g:i,b:r,a:s}=this.background.color;e.setClearColor(s*t/255,s*i/255,s*r/255,s)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1)}}doRender(e){const t=this.context,{state:i,pixelRatio:r}=e;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,r*i.size[0],r*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),super.doRender(e)}async takeScreenshot(e){const{framebufferWidth:t,framebufferHeight:i}={framebufferWidth:Math.round(this._renderParameters.state.size[0]*e.resolutionScale),framebufferHeight:Math.round(this._renderParameters.state.size[1]*e.resolutionScale)},s=this.context,n=this._state.clone();if(null!=e.rotation){const t=n.viewpoint;n.viewpoint.rotation=e.rotation,n.viewpoint=t}const a={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:n,pixelRatio:1,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1},o=new FramebufferObject.a(s,{colorTarget:0,depthStencilTarget:3,width:t,height:i}),h=s.getBoundFramebufferObject(),l=s.getViewport();s.bindFramebuffer(o),s.setViewport(0,0,t,i),this._renderChildren(e.children,a);const d=this._readbackScreenshot({...e.cropArea,y:i-(e.cropArea.y+e.cropArea.height)});let c;return s.bindFramebuffer(h),s.setViewport(l.x,l.y,l.width,l.height),this.requestRender(),1===e.outputScale?c=d:(c=new ImageData(Math.round(d.width*e.outputScale),Math.round(d.height*e.outputScale)),Object(screenshotUtils.e)(d,c,!0)),Object(screenshotUtils.b)(c,{format:e.format,quality:e.quality,rotation:0,disableDecorations:!1},document.createElement("canvas"),{flipY:!0,premultipliedAlpha:!0})}_readbackScreenshot(e){const t=this.context.gl,i=Object(screenshotUtils.a)(e.width,e.height,document.createElement("canvas"));return t.readPixels(e.x,e.y,e.width,e.height,6408,5121,new Uint8Array(i.data.buffer)),i}_resizeCanvas(e){const t=this._canvas,i=t.style,{state:{size:r},pixelRatio:s}=e,n=r[0],a=r[1],o=Math.round(n*s),h=Math.round(a*s);t.width===o&&t.height===h||(t.width=o,t.height=h),i.width=n+"px",i.height=a+"px"}_initializeClipRenderer(e){if(this._clipRendererInitialized)return!0;const t=StencilPrograms_r.attributes,i=Object(programUtils.a)(e,StencilPrograms_r);if(!i)return!1;const r=BufferObject.a.createVertex(e,35040,32),s=new Uint16Array([0,1,2,2,1,3]),n=BufferObject.a.createIndex(e,35044,s),a=new VertexArrayObject.a(e,t,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:r},n);return this._clipStencilProgram=i,this._clipVBO=r,this._clipVAO=a,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach()}}_isLabelDrawPhaseRequired(e){let t=!1;for(const i of e){if(!(i instanceof Container.a)){t=t||!1;break}if(i.hasLabels)return!0;t=t||this._isLabelDrawPhaseRequired(i.children)}return t}}var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),HandleOwner=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),throttle=__webpack_require__("./node_modules/@arcgis/core/core/throttle.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),StaticBitSet=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/features/support/StaticBitSet.js");class CollisionGrid_c{constructor(t,s){this.width=t,this.height=s;const i=Math.ceil(t/1),h=Math.ceil(s/1);this._cols=i,this._rows=h,this._cells=StaticBitSet.a.create(i*h)}insertMetrics(t){const s=this._hasCollision(t);return 0===s&&this._markMetrics(t),s}getCellId(t,s){return t+s*this._cols}has(t){return this._cells.has(t)}hasRange(t,s){return this._cells.hasRange(t,s)}set(t){this._cells.set(t)}setRange(t,s){this._cells.setRange(t,s)}_hasCollision(t){const s=t.id;let e=0,o=0;t.save();do{const s=t.boundsCount;e+=s;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),h=t.boundsComputedAnchorY(e),c=t.boundsWidth(e)+2,l=t.boundsHeight(e)+2;switch(this._collide(s,h,c,l)){case 2:return 2;case 1:o++}}}while(t.peekId()===s&&t.next());return t.restore(),e===o?1:0}_collide(s,e,i,c){const l=s-i/2,_=e-c/2,a=l+i,u=_+c;if(a<0||u<0||l>this.width||_>this.height)return 1;const d=Object(mathUtils.f)(Math.floor(l/1),0,this._cols),g=Object(mathUtils.f)(Math.floor(_/1),0,this._rows),f=Object(mathUtils.f)(Math.ceil(a/1),0,this._cols),m=Object(mathUtils.f)(Math.ceil(u/1),0,this._rows);for(let t=g;t<=m;t++)for(let s=d;s<=f;s++){const e=this.getCellId(s,t);if(this.has(e))return 2}return 0}_mark(s,e,i,h){const r=s-i/2,n=e-h/2,c=r+i,l=n+h,_=Object(mathUtils.f)(Math.floor(r/1),0,this._cols),a=Object(mathUtils.f)(Math.floor(n/1),0,this._rows),u=Object(mathUtils.f)(Math.ceil(c/1),0,this._cols),d=Object(mathUtils.f)(Math.ceil(l/1),0,this._rows);for(let t=a;t<=d;t++)for(let s=_;s<=u;s++){const e=this.getCellId(s,t);this.set(e)}return!1}_markMetrics(t){const s=t.id;do{const s=t.boundsCount;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),o=t.boundsComputedAnchorY(e),h=t.boundsWidth(e)+2,r=t.boundsHeight(e)+2;this._mark(s,o,h,r)}}while(t.peekId()===s&&t.next())}}var lengthUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/lengthUtils.js");const visualVariableSimpleUtils_e=Math.PI;function visualVariableSimpleUtils_r(t,n){switch(n.transformationType){case"additive":return function visualVariableSimpleUtils_i(t,n){return t+(visualVariableSimpleUtils_a(n.minSize,t)||n.minDataValue)}(t,n);case"constant":return function visualVariableSimpleUtils_s(t,n){const e=t.stops;let r=e&&e.length&&e[0].size;return null==r&&(r=t.minSize),visualVariableSimpleUtils_a(r,n)}(n,t);case"clamped-linear":return function visualVariableSimpleUtils_u(t,n){const e=(t-n.minDataValue)/(n.maxDataValue-n.minDataValue),r=visualVariableSimpleUtils_a(n.minSize,t),i=visualVariableSimpleUtils_a(n.maxSize,t);return t<=n.minDataValue?r:t>=n.maxDataValue?i:r+e*(i-r)}(t,n);case"proportional":return function visualVariableSimpleUtils_o(n,e){const r=n/e.minDataValue,i=visualVariableSimpleUtils_a(e.minSize,n),s=visualVariableSimpleUtils_a(e.maxSize,n);let u=null;return u=r*i,Object(mathUtils.f)(u,i,s)}(t,n);case"stops":return function visualVariableSimpleUtils_c(t,n){const[e,r,i]=function visualVariableSimpleUtils_m(t,n){if(!n)return;let e=0,r=n.length-1;return n.some(((n,a)=>t<n?(r=a,!0):(e=a,!1))),[e,r,(t-n[e])/(n[r]-n[e])]}(t,n.cache.ipData);if(e===r)return visualVariableSimpleUtils_a(n.stops[e].size,t);{const s=visualVariableSimpleUtils_a(n.stops[e].size,t);return s+(visualVariableSimpleUtils_a(n.stops[r].size,t)-s)*i}}(t,n);case"real-world-size":return function visualVariableSimpleUtils_l(r,i){const s=lengthUtils.a[i.valueUnit],u=visualVariableSimpleUtils_a(i.minSize,r),o=visualVariableSimpleUtils_a(i.maxSize,r),{valueRepresentation:c}=i;let l=null;return l="area"===c?2*Math.sqrt(r/visualVariableSimpleUtils_e)/s:"radius"===c||"distance"===c?2*r/s:r/s,Object(mathUtils.f)(l,u,o)}(t,n);case"identity":return t;case"unknown":return null}}function visualVariableSimpleUtils_a(t,n){return"number"==typeof t?t:visualVariableSimpleUtils_r(n,t)}function CollisionEngine_b(t,i){const o=[];t.forEachTile((e=>o.push(e))),o.sort(((e,t)=>e.instanceId-t.instanceId)),o.forEach((t=>{Object(maybe.l)(t.labelMetrics)&&t.isReady&&i(t,t.labelMetrics.getCursor())}))}function CollisionEngine_y(e){return t=>Object(screenUtils.g)(visualVariableSimpleUtils_r(t,e))}function CollisionEngine_M(e,i){if(!function CollisionEngine_p(e){return"feature"===e.layer.type||"csv"===e.layer.type||"geojson"===e.layer.type||"ogc-feature"===e.layer.type||"stream"===e.layer.type||"subtype-group"===e.layer.type||"wfs"===e.layer.type}(i))return;const o="subtype-group"===i.layer.type?i.layer.sublayers.items:[i.layer],r=i.layer.geometryType,n=!function CollisionEngine_h(e){for(const i of e){var t;const e="featureReduction"in i&&"cluster"===(null==(t=i.featureReduction)?void 0:t.type)&&i.featureReduction,o=[...i.labelingInfo||[],...e.labelingInfo||[]];if(i.labelsVisible&&o.length&&o.some((e=>"none"===e.deconflictionStrategy)))return!0}return!1}(o),s={};if("subtype-group"!==i.layer.type){if("heatmap"===i.layer.renderer.type)return;const e=function CollisionEngine_m(e){const t="visualVariables"in e&&e.visualVariables;if(!t)return null;for(const i of t)if("size"===i.type)return CollisionEngine_y(i);return null}(i.layer.renderer);s[0]=e}const a=i.tileRenderer;if(Object(maybe.k)(a))return;const l=i.layer.visible&&!i.suspended;e.push({tileRenderer:a,vvEvaluators:s,deconflictionEnabled:n,geometryType:r,visible:l})}class CollisionEngine_g{run(e,t,i){const o=[];for(let r=e.length-1;r>=0;r--)CollisionEngine_M(o,e[r]);this._transformMetrics(o,t),this._runCollision(o,t,i)}_runCollision(e,t,i){const[o,r]=t.state.size,s=new CollisionGrid_c(o*t.pixelRatio,r*t.pixelRatio);for(const{tileRenderer:n,deconflictionEnabled:a,visible:l}of e){const e=n.featuresView.attributeView;a?l?(this._prepare(n),this._collideVisible(s,n,i),this._collideInvisible(s,n)):CollisionEngine_b(n,((t,i)=>{for(;i.nextId();)e.setLabelMinZoom(i.id,255)})):CollisionEngine_b(n,((t,i)=>{for(;i.nextId();)e.setLabelMinZoom(i.id,0)}))}}_isFiltered(t,i,n){const s=i.getFilterFlags(t),a=!n.hasFilter||!!(s&definitions.n),l=!Object(maybe.l)(n.featureEffect)||n.featureEffect.excludedLabelsVisible||!!(s&definitions.m);return!(a&&l)}_prepare(e){const t=e.featuresView.attributeView,i=new Set;CollisionEngine_b(e,((o,r)=>{for(;r.nextId();)i.has(r.id)||(i.add(r.id),this._isFiltered(r.id,t,e.layerView)?t.setLabelMinZoom(r.id,254):0!==t.getLabelMinZoom(r.id)?t.setLabelMinZoom(r.id,255):t.setLabelMinZoom(r.id,0))}))}_collideVisible(e,t,i){const o=t.featuresView.attributeView,r=new Set;CollisionEngine_b(t,((t,n)=>{for(;n.nextId();)if(!r.has(n.id))if(t.key.level===i){if(0===o.getLabelMinZoom(n.id))switch(e.insertMetrics(n)){case 1:break;case 2:o.setLabelMinZoom(n.id,254),r.add(n.id);break;case 0:o.setLabelMinZoom(n.id,0),r.add(n.id)}}else o.setLabelMinZoom(n.id,254)}))}_collideInvisible(e,t){const i=t.featuresView.attributeView,o=new Set;CollisionEngine_b(t,((t,r)=>{for(;r.nextId();)if(!o.has(r.id)&&255===i.getLabelMinZoom(r.id))switch(e.insertMetrics(r)){case 1:break;case 2:i.setLabelMinZoom(r.id,255),o.add(r.id);break;case 0:i.setLabelMinZoom(r.id,0),o.add(r.id)}}))}_transformMetrics(t,i){for(const{tileRenderer:o,geometryType:r,vvEvaluators:n}of t)CollisionEngine_b(o,((t,s)=>{const a=o.featuresView.attributeView,l=t.transforms.labelMat2d;l[4]=Math.round(l[4]),l[5]=Math.round(l[5]);const d=l[4],c=l[5],u="polyline"===r;for(;s.next();){const t=s.boundsCount,o=s.anchorX,r=s.anchorY;let f=s.size;const b=n[0];if(Object(maybe.l)(b)){const e=b(a.getVVSize(s.id));f=isNaN(e)||null==e||e===1/0?f:e}const p=s.directionX*(f/2),y=s.directionY*(f/2);for(let e=0;e<t;e++){let t=o,n=s.anchorY;if(u){let o=t+s.boundsX(e)+p,r=n+s.boundsY(e)+y;i.state.rotation?(o=l[0]*o+l[2]*r+l[4],r=l[1]*o+l[3]*r+l[5]):(o+=d,r+=c),s.setBoundsComputedAnchorX(e,Math.floor(o)),s.setBoundsComputedAnchorY(e,Math.floor(r))}else{i.state.rotation?(t=l[0]*o+l[2]*r+l[4],n=l[1]*o+l[3]*r+l[5]):(t+=d,n+=c);const a=t+s.boundsX(e)+p,u=n+s.boundsY(e)+y;s.setBoundsComputedAnchorX(e,a),s.setBoundsComputedAnchorY(e,u)}}}}))}}const LabelManager_d=Logger.a.getLogger("esri.views.2d.layers.labels.LabelManager");let LabelManager_u=class extends(Object(HandleOwner.b)(Accessor.a)){constructor(e){super(e),this._applyVisibilityPassThrottled=Object(throttle.a)(this._applyVisibilityPass,32,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new CollisionEngine_g}destroy(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}get updating(){return this.updateRequested}update(e){this._applyVisibilityPassThrottled(e)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}processUpdate(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}_applyVisibilityPass(e){try{const t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,e,t)}catch(t){LabelManager_d.error(new core_Error.a("mapview-labeling","Encountered an error during label decluttering",t))}}};Object(tslib_es6.a)([Object(property.b)()],LabelManager_u.prototype,"updateRequested",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],LabelManager_u.prototype,"updateParameters",void 0),Object(tslib_es6.a)([Object(property.b)()],LabelManager_u.prototype,"updating",null),Object(tslib_es6.a)([Object(property.b)()],LabelManager_u.prototype,"view",void 0),LabelManager_u=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.layers.labels.LabelManager")],LabelManager_u);const LabelManager_c=LabelManager_u;var GraphicsView2D=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"),GraphicContainer=__webpack_require__("./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicContainer.js"),Viewpoint=__webpack_require__("./node_modules/@arcgis/core/Viewpoint.js"),Point=__webpack_require__("./node_modules/@arcgis/core/geometry/Point.js"),viewpointUtils=__webpack_require__("./node_modules/@arcgis/core/views/2d/viewpointUtils.js"),InputManager=__webpack_require__("./node_modules/@arcgis/core/views/input/InputManager.js");const ZoomBox_a_container="esri-zoom-box__container",ZoomBox_a_overlay="esri-zoom-box__overlay",ZoomBox_a_background="esri-zoom-box__overlay-background",ZoomBox_a_box="esri-zoom-box__outline",ZoomBox_n_zoom="Shift",ZoomBox_n_counter="Ctrl";let ZoomBox_h=class extends Accessor.a{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[ZoomBox_n_zoom],(t=>this._handleDrag(t,1)),InputManager.b.INTERNAL),t.on("drag",[ZoomBox_n_zoom,ZoomBox_n_counter],(t=>this._handleDrag(t,-1)),InputManager.b.INTERNAL))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,r,i){this._box.x=t,this._box.y=e,this._box.width=r,this._box.height=i,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,o,s){const a=this.view,n=a.toMap(Object(screenUtils.e)(t+.5*i,e+.5*o));let h=Math.max(i/a.width,o/a.height);-1===s&&(h=1/h),this._destroyOverlay(),this.navigation.end(),a.goTo({center:n,scale:a.scale*h})}_updateBox(t,e,r,i){const o=this._boxShape;o.setAttributeNS(null,"x",""+t),o.setAttributeNS(null,"y",""+e),o.setAttributeNS(null,"width",""+r),o.setAttributeNS(null,"height",""+i),o.setAttributeNS(null,"class",ZoomBox_a_box)}_updateBackground(t,e,r,i){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,r,i,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=ZoomBox_a_container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),r.setAttributeNS(null,"class",ZoomBox_a_background);const i=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.setAttributeNS(null,"class",ZoomBox_a_overlay),o.appendChild(r),o.appendChild(i),this._container.appendChild(o),this._backgroundShape=r,this._boxShape=i,this._overlay=o}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,r,i,o,s){const a=t+r,n=e+i;return"M 0 0 L "+o+" 0 L "+o+" "+s+" L 0 "+s+" ZM "+t+" "+e+" L "+t+" "+n+" L "+a+" "+n+" L "+a+" "+e+" Z"}_handleDrag(t,e){const r=t.x,i=t.y,o=t.origin.x,s=t.origin.y;let a,n,h,l;switch(r>o?(a=o,h=r-o):(a=r,h=o-r),i>s?(n=s,l=i-s):(n=i,l=s-i),t.action){case"start":this._start();break;case"update":this._update(a,n,h,l);break;case"end":this._end(a,n,h,l,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:r,height:i}=this._box;this._updateBox(t,e,r,i),this._updateBackground(t,e,r,i),this._rafId=requestAnimationFrame(this._redraw)}};Object(tslib_es6.a)([Object(property.b)()],ZoomBox_h.prototype,"navigation",void 0),Object(tslib_es6.a)([Object(property.b)()],ZoomBox_h.prototype,"view",null),ZoomBox_h=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.navigation.ZoomBox")],ZoomBox_h);const ZoomBox_l=ZoomBox_h;__webpack_require__("./node_modules/@arcgis/core/geometry.js");var vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),PanPlanarMomentumEstimator=__webpack_require__("./node_modules/@arcgis/core/views/navigation/PanPlanarMomentumEstimator.js");let Pan_c=class extends Accessor.a{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new PanPlanarMomentumEstimator.a(500,6,.92),this.momentum=null,this.tmpMomentum=Object(vec3f64.f)(),this.momentumFinished=!1,this.viewpoint=new Viewpoint.a({targetGeometry:new Point.a,scale:0,rotation:0}),this.watch("momentumFinished",(t=>{t&&this.navigation.stop()}))}begin(t,i){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(i),this.previousDrag=i}update(t,i){this.addToEstimator(i);let o=i.center.x,m=i.center.y;const s=this.previousDrag;o=s?s.center.x-o:-o,m=s?m-s.center.y:m,t.viewpoint=Object(viewpointUtils.w)(this.viewpoint,t.viewpoint,[o||0,m||0]),this.previousDrag=i}end(t,i){this.addToEstimator(i);const o=t.navigation.momentumEnabled;this.momentum=o?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()}addToEstimator(t){const i=t.center.x,o=t.center.y,s=Object(screenUtils.f)(-i,o),e=Object(vec3f64.h)(-i,o,0);this.momentumEstimator.add(s,e,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((i,o)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const m=.001*o;if(!this.momentumFinished){const o=this.momentum.valueDelta(this.animationTime,m);Object(vec3.g)(this.tmpMomentum,this.momentum.direction,o),Object(viewpointUtils.w)(i,i,this.tmpMomentum),t.constraints.constrainByGeometry(i)}this.animationTime+=m}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};Object(tslib_es6.a)([Object(property.b)()],Pan_c.prototype,"momentumFinished",void 0),Object(tslib_es6.a)([Object(property.b)()],Pan_c.prototype,"viewpoint",void 0),Object(tslib_es6.a)([Object(property.b)()],Pan_c.prototype,"navigation",void 0),Pan_c=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.navigation.actions.Pan")],Pan_c);const Pan_d=Pan_c;var RotationMomentumEstimator=__webpack_require__("./node_modules/@arcgis/core/views/navigation/RotationMomentumEstimator.js"),ZoomMomentumEstimator=__webpack_require__("./node_modules/@arcgis/core/views/navigation/ZoomMomentumEstimator.js");let Pinch_l=class extends Accessor.a{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new RotationMomentumEstimator.a(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new ZoomMomentumEstimator.a,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new Viewpoint.a({targetGeometry:new Point.a,scale:0,rotation:0}),this.watch("_momentumFinished",(t=>{t&&this.navigation.stop()}))}begin(t,o){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=o.angle,this._previousRadius=this._startRadius=o.radius,this._previousCenter=o.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,o.timestamp),this.addToZoomEstimator(o,1)}update(t,o){null===this._updateTimestamp&&(this._updateTimestamp=o.timestamp);const i=o.angle,s=o.radius,e=o.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),m=Math.abs(s-this._startRadius),a=this._startRadius/s;if(this._previousRadius){const r=s/this._previousRadius;let h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=r>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&o.timestamp-this._updateTimestamp>200&&(this._zoomOnly=m-n>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,o.timestamp)):h=0,this.addToZoomEstimator(o,a),this.navigation.setViewpoint([e.x,e.y],1/r,h,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=e}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,o){this._rotationMomentumEstimator.add(t,.001*o)}addToZoomEstimator(t,o){this._zoomMomentumEstimator.add(o,.001*t.timestamp)}canZoomIn(t){const o=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||o>i}canZoomOut(t){const o=t.scale,i=t.constraints.effectiveMinScale;return 0===i||o<i}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((o,i)=>{const s=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,e=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),u=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),p=.001*i;if(this._momentumFinished=e&&u,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,p))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,p)):1;const e=Object(vec2f64.b)(),u=Object(vec2f64.b)();if(this._previousCenter){Object(vec2.s)(e,this._previousCenter.x,this._previousCenter.y),Object(viewpointUtils.j)(u,t.size,t.padding),Object(vec2.m)(e,e,u);const{constraints:a,scale:p}=t,c=p*s;s<1&&!a.canZoomInTo(c)?(s=p/a.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!a.canZoomOutTo(c)&&(s=p/a.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),Object(viewpointUtils.t)(o,t.viewpoint,s,i,e,t.size),t.constraints.constrainByGeometry(o)}}this._animationTime+=p}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};Object(tslib_es6.a)([Object(property.b)()],Pinch_l.prototype,"_momentumFinished",void 0),Object(tslib_es6.a)([Object(property.b)()],Pinch_l.prototype,"viewpoint",void 0),Object(tslib_es6.a)([Object(property.b)()],Pinch_l.prototype,"navigation",void 0),Pinch_l=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.navigation.actions.Pinch")],Pinch_l);const Pinch_=Pinch_l,Rotate_u=Object(vec2f64.b)(),Rotate_d=Object(vec2f64.b)();let Rotate_j=class extends Accessor.a{constructor(t){super(t),this._previousCenter=Object(vec2f64.b)(),this.viewpoint=new Viewpoint.a({targetGeometry:new Point.a,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),Object(vec2.s)(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:o,padding:r}}=t;Object(vec2.s)(Rotate_u,e.center.x,e.center.y),Object(viewpointUtils.g)(Rotate_d,o,r),t.viewpoint=Object(viewpointUtils.r)(this.viewpoint,t.state.paddedViewState.viewpoint,Object(viewpointUtils.b)(Rotate_d,this._previousCenter,Rotate_u)),Object(vec2.c)(this._previousCenter,Rotate_u)}end(){this.navigation.end()}};Object(tslib_es6.a)([Object(property.b)()],Rotate_j.prototype,"viewpoint",void 0),Object(tslib_es6.a)([Object(property.b)()],Rotate_j.prototype,"navigation",void 0),Rotate_j=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.actions.Rotate")],Rotate_j);const Rotate_h=Rotate_j,MapViewNavigation_v=new Viewpoint.a({targetGeometry:new Point.a}),MapViewNavigation_g=[0,0];let MapViewNavigation_=class extends Accessor.a{constructor(t){super(t),this._endTimer=null,this.animationManager=null}initialize(){this.pan=new Pan_d({navigation:this}),this.rotate=new Rotate_h({navigation:this}),this.pinch=new Pinch_({navigation:this}),this.zoomBox=new ZoomBox_l({view:this.view,navigation:this})}destroy(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(t,i=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(i):this.zoomOut(i);this.setViewpoint(i,t,0,[0,0])}async zoomIn(t){const i=this.view,o=i.constraints.snapToNextScale(i.scale);return this._zoomToScale(o,t)}async zoomOut(t){const i=this.view,o=i.constraints.snapToPreviousScale(i.scale);return this._zoomToScale(o,t)}setViewpoint(t,i,o,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,n),this.end()}setViewpointImmediate(t,i=0,o=[0,0],n=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,i,o)}continousRotateClockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{Object(viewpointUtils.r)(t,t,-1)}))}continousRotateCounterclockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{Object(viewpointUtils.r)(t,t,1)}))}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}stop(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const i=this.get("view.viewpoint");this.animationManager.animateContinous(i,(i=>{Object(viewpointUtils.w)(i,i,t),this.view.constraints.constrainByGeometry(i)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-this._lastEventTimestamp;t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:i,right:o,top:n,bottom:e}}=this.view;return MapViewNavigation_g[0]=.5*(t[0]-o+i),MapViewNavigation_g[1]=.5*(t[1]-e+n),MapViewNavigation_g}async _zoomToScale(t,i=this._getDefaultAnchor()){const{view:o}=this,{constraints:n,scale:e,viewpoint:s,size:a,padding:r}=o,m=n.canZoomInTo(t),h=n.canZoomOutTo(t);if(!(t<e&&!m||t>e&&!h))return Object(viewpointUtils.p)(MapViewNavigation_v,s,t/e,0,i,a,r),n.constrainByGeometry(MapViewNavigation_v),o.goTo(MapViewNavigation_v,{animate:!0})}_scaleRotateTranslateViewpoint(t,i,o,n,e){const{view:s}=this,{size:a,padding:m,constraints:h,scale:p,viewpoint:u}=s,l=p*o,w=h.canZoomInTo(l),v=h.canZoomOutTo(l);return(o<1&&!w||o>1&&!v)&&(o=1),Object(viewpointUtils.w)(u,u,e),Object(viewpointUtils.p)(t,u,o,n,i,a,m),h.constrainByGeometry(t)}};Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"animationManager",void 0),Object(tslib_es6.a)([Object(property.b)({type:Boolean,readOnly:!0})],MapViewNavigation_.prototype,"interacting",void 0),Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"pan",void 0),Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"pinch",void 0),Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"rotate",void 0),Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"view",void 0),Object(tslib_es6.a)([Object(property.b)()],MapViewNavigation_.prototype,"zoomBox",void 0),MapViewNavigation_=Object(tslib_es6.a)([Object(subclass.a)("esri.views.2d.navigation.MapViewNavigation")],MapViewNavigation_);const MapViewNavigation_T=MapViewNavigation_;var Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),DisplayObject=__webpack_require__("./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js");const MagnifierPrograms_t={shaders:{vertexShader:Object(resolver.a)("magnifier/magnifier.vert"),fragmentShader:Object(resolver.a)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};var resources=__webpack_require__("./node_modules/@arcgis/core/views/magnifier/resources.js");class MagnifierView2D_b extends DisplayObject.a{constructor(){super(),this._handles=new Handles.a,this._resourcePixelRatio=1,this.visible=!1}destroy(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(e){this._magnifier=e,this._handles.removeAll(),this._handles.add([Object(watchUtils.a)(e,"version",(()=>{this.visible=e.visible&&Object(maybe.l)(e.position)&&e.size>0,this.requestRender()})),e.watch(["mask","overlay"],(()=>this._reloadResources())),e.watch("size",(()=>{this._disposeRenderResources(),this.requestRender()}))])}_createTransforms(){return{dvs:Object(mat3f32.b)()}}doRender(e){var r;const i=e.context;if(!this._resourcesTask)return void this._reloadResources();if(e.drawPhase!==webgl_enums.c.MAP||!this._canRender())return;this._updateResources(e);const a=this._magnifier;if(Object(maybe.k)(a.position))return;const o=e.pixelRatio,n=a.size*o,l=1/a.factor,h=Math.ceil(l*n);this._readbackTexture.resize(h,h);const{size:m}=e.state,c=o*m[0],u=o*m[1],d=.5*h,_=.5*h,f=Object(mathUtils.f)(o*a.position.x,d,c-d-1),g=Object(mathUtils.f)(u-o*a.position.y,_,u-_-1);i.setBlendingEnabled(!0);const b=f-d,x=g-_,y=this._readbackTexture;i.bindTexture(y,0),i.gl.copyTexImage2D(y.descriptor.target,0,y.descriptor.pixelFormat,b,x,h,h,0);const k=null==(r=this.background)?void 0:r.color,T=k?[k.a*k.r/255,k.a*k.g/255,k.a*k.b/255,k.a]:[1,1,1,1],v=(f+a.offset.x*o)/c*2-1,R=(g-a.offset.y*o)/u*2-1,j=n/c*2,w=n/u*2,A=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.useProgram(A),A.setUniform4fv("u_background",T),A.setUniform1i("u_readbackTexture",0),A.setUniform1i("u_overlayTexture",6),A.setUniform1i("u_maskTexture",7),A.setUniform4f("u_drawPos",v,R,j,w),A.setUniform1i("u_maskEnabled",a.maskEnabled?1:0),A.setUniform1i("u_overlayEnabled",a.overlayEnabled?1:0),i.setStencilTestEnabled(!1),i.setColorMask(!0,!0,!0,!0),i.drawArrays(5,0,4),i.bindVAO()}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const r=Object(maybe.l)(this._magnifier)?this._magnifier.maskUrl:null,s=Object(maybe.l)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=Object(promiseUtils.h)((async a=>{const o=Object(maybe.k)(r)||Object(maybe.k)(s)?Object(resources.a)(a):null,n=Object(maybe.l)(r)?Object(request.default)(r,{responseType:"image",signal:a}).then((e=>e.data)):o.then((e=>e.mask)),l=Object(maybe.l)(s)?Object(request.default)(s,{responseType:"image",signal:a}).then((e=>e.data)):o.then((e=>e.overlay)),[h,m]=await Promise.all([n,l]);this.mask=h,this.overlay=m,this._disposeRenderResources(),this.requestRender()}))}_disposeRenderResources(){this._readbackTexture=Object(maybe.f)(this._readbackTexture),this._overlayTexture=Object(maybe.f)(this._overlayTexture),this._maskTexture=Object(maybe.f)(this._maskTexture),this._vertexArrayObject=Object(maybe.f)(this._vertexArrayObject),this._program=Object(maybe.f)(this._program)}_updateResources(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const r=e.context;this._resourcePixelRatio=e.pixelRatio;const s=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function MagnifierPrograms_i(e){return Object(programUtils.a)(e,MagnifierPrograms_t)}(r);const i=new Uint16Array([0,1,0,0,1,1,1,0]),a=MagnifierPrograms_t.attributes;this._vertexArrayObject=new VertexArrayObject.a(r,a,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:BufferObject.a.createVertex(r,35044,i)}),this.overlay.width=s,this.overlay.height=s,this._overlayTexture=new Texture.a(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,preMultiplyAlpha:!Object(urlUtils.x)(this.overlay.src)||!e.context.driverTest.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=s,this.mask.height=s,this._maskTexture=new Texture.a(r,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);const o=1/this._magnifier.factor;this._readbackTexture=new Texture.a(r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(o*s),height:Math.ceil(o*s)})}}},"./node_modules/@arcgis/core/views/layers/GraphicsView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return t}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Identifiable_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Identifiable.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"));const t=t=>{let p=class extends(Object(_core_Identifiable_js__WEBPACK_IMPORTED_MODULE_1__.a)(t)){constructor(){super(...arguments),this.graphics=null,this.renderer=null}};return Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)()],p.prototype,"graphics",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)()],p.prototype,"renderer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)()],p.prototype,"updating",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)()],p.prototype,"view",void 0),p=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.a)("esri.views.layers.GraphicsView")],p),p}},"./node_modules/@arcgis/core/views/webgl/ProgramCache.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return t}));var _programUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/views/webgl/programUtils.js");class t{constructor(r){this._programCacheByTemplate=new Map,this._rctx=r}dispose(){this._programCacheByTemplate.forEach((r=>r.programs.forEach((r=>r.dispose())))),this._programCacheByTemplate=null}getProgram(t,a){return this._programCacheByTemplate.has(t)||this.addProgramTemplate(t,(a=>Object(_programUtils_js__WEBPACK_IMPORTED_MODULE_0__.a)(this._rctx,t,a))),this.getProgramTemplateInstance(t,a)}addProgramTemplate(r,t){this._programCacheByTemplate.set(r,{constructor:t,programs:new Map})}getProgramTemplateInstance(r,t){const a=this._programCacheByTemplate.get(r);if(a){const r=t?JSON.stringify(t):"default";if(!a.programs.has(r)){const e=a.constructor(t);a.programs.set(r,e)}return a.programs.get(r)}return null}}}}]);