(window.webpackJsonp=window.webpackJsonp||[]).push([[76,215],{"./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return persistable_g}));var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),multiOriginJSONSupportUtils=__webpack_require__("./node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),uuid=__webpack_require__("./node_modules/@arcgis/core/core/uuid.js"),metadata=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/metadata.js"),PropertyOrigin=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/PropertyOrigin.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js");function resourceExtension_p(i){return resourceExtension_o[function resourceExtension_n(i){return i instanceof Blob?i.type:function resourceExtension_t(p){const n=Object(urlUtils.n)(p);return resourceExtension_g[n]||resourceExtension_a}(i.url)}(i)]||resourceExtension_e}const resourceExtension_o={},resourceExtension_a="text/plain",resourceExtension_e=resourceExtension_o[resourceExtension_a],resourceExtension_g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const l in resourceExtension_g)resourceExtension_o[resourceExtension_g[l]]=l;var persistableUrlUtils=__webpack_require__("./node_modules/@arcgis/core/chunks/persistableUrlUtils.js");function persistable_g(r){const e=Object(maybe.l)(r)&&r.origins?r.origins:[void 0];return(t,o)=>{const i=function w(r,e,o){if(Object(maybe.l)(r)&&"resource"===r.type)return function v(e,s,u){const p=Object(metadata.b)(s,u);return{type:String,read:(t,r,e)=>{const o=Object(persistableUrlUtils.d)(t,r,e);return p.type===String?o:"function"==typeof p.type?new p.type({url:o}):void 0},write:{writer(s,a,l,f){if(!f||!f.resources)return"string"==typeof s?void(a[l]=Object(persistableUrlUtils.e)(s,f)):void(a[l]=s.write({},f));const m=function P(t){return Object(maybe.k)(t)?null:"string"==typeof t?t:t.url}(s),d=m?Object(persistableUrlUtils.e)(m,{...f,verifyItemRelativeUrls:f&&f.verifyItemRelativeUrls?{writtenUrls:f.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,g=p.type!==String&&(!Object(multiOriginJSONSupportUtils.a)(this)||f&&f.origin&&this.originIdOf(u)>Object(PropertyOrigin.d)(f.origin));f&&f.portalItem&&Object(maybe.l)(d)&&!Object(urlUtils.s)(d)?g?function j(t,r,e,o,i,n,s,p){const a=s.portalItem.resourceFromPath(o),c=S(e,o,s);resourceExtension_p(c)===Object(urlUtils.n)(a.path)?(O(t,r,a,c,s.resources.toUpdate),i[n]=o):U(t,r,e,o,i,n,s,p)}(this,u,s,d,a,l,f,e):function I(t,r,e,o){o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(t)}),r[e]=t}(d,a,l,f):f&&f.portalItem&&(Object(maybe.k)(d)||Object(maybe.l)(Object(persistableUrlUtils.b)(d))||Object(urlUtils.t)(d)||g)?U(this,u,s,d,a,l,f,e):a[l]=d}}}}(r,e,o);switch(Object(maybe.l)(r)&&r.type?r.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:r}=persistableUrlUtils.c;return{read:t,write:r}}}}(r,t,o);for(const r of e){const e=Object(property.c)(t,r,o);for(const t in i)e[t]=i[t]}}}function U(t,r,o,i,u,a,c,l){const m=Object(uuid.a)(),y=S(o,i,c),h=Object(urlUtils.z)(Object(maybe.j)(l,"prefix"),m),d=`${h}.${resourceExtension_p(y)}`,g=c.portalItem.resourceFromPath(d);Object(urlUtils.t)(i)&&c.resources.pendingOperations.push(async function b(t){const r=(await Promise.resolve().then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/request.js"))).default,{data:e}=await r(t,{responseType:"blob"});return e}(i).then((t=>{g.path=`${h}.${resourceExtension_p(t)}`,u[a]=g.itemRelativeUrl})).catch((()=>{}))),O(t,r,g,y,c.resources.toAdd),u[a]=g.itemRelativeUrl}function O(t,r,e,o,i){i.push({resource:e,content:o,finish:e=>{!function R(t,r,e){"string"==typeof t[r]?t[r]=e.url:t[r].url=e.url}(t,r,e)}})}function S(t,r,e){return"string"==typeof t?{url:r}:new Blob([JSON.stringify(t.toJSON(e))],{type:"application/json"})}},"./node_modules/@arcgis/core/layers/graphics/centroid.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return e}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js");function n(t,n){return t?n?4:3:n?3:2}function e(e,o,u,l,N){if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(o)||!o.lengths.length)return null;const s="upperLeft"===(null==N?void 0:N.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const c=e.coords,f=[],i=u?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:T,coords:h}=o,g=n(u,l);let E=0;for(const t of T){const n=r(i,h,E,t,u,l,s);n&&f.push(n),E+=t*g}if(f.sort(((t,n)=>{let e=s*t[2]-s*n[2];return 0===e&&u&&(e=t[4]-n[4]),e})),f.length){let t=6*f[0][2];c[0]=f[0][0]/t,c[1]=f[0][1]/t,u&&(t=6*f[0][4],c[2]=0!==t?f[0][3]/t:0),(c[0]<i[0]||c[0]>i[1]||c[1]<i[2]||c[1]>i[3]||u&&(c[2]<i[4]||c[2]>i[5]))&&(c.length=0)}if(!c.length){const t=o.lengths[0]?I(h,0,T[0],u,l):null;if(!t)return null;c[0]=t[0],c[1]=t[1],u&&t.length>2&&(c[2]=t[2])}return e}function r(t,e,r,I,o,u,l=1){const N=n(o,u);let s=r,c=r+N,f=0,i=0,T=0,h=0,g=0;for(let n=0,m=I-1;n<m;n++,s+=N,c+=N){const n=e[s],r=e[s+1],I=e[s+2],u=e[c],l=e[c+1],N=e[c+2];let E=n*l-u*r;h+=E,f+=(n+u)*E,i+=(r+l)*E,o&&(E=n*N-u*I,T+=(I+N)*E,g+=E),n<t[0]&&(t[0]=n),n>t[1]&&(t[1]=n),r<t[2]&&(t[2]=r),r>t[3]&&(t[3]=r),o&&(I<t[4]&&(t[4]=I),I>t[5]&&(t[5]=I))}if(h*l>0&&(h*=-1),g*l>0&&(g*=-1),!h)return null;const E=[f,i,.5*h];return o&&(E[3]=T,E[4]=.5*g),E}function I(t,e,r,I,s){const c=n(I,s);let f=e,i=e+c,T=0,h=0,g=0,E=0;for(let n=0,m=r-1;n<m;n++,f+=c,i+=c){const n=t[f],e=t[f+1],r=t[f+2],s=t[i],c=t[i+1],m=t[i+2],b=I?u(n,e,r,s,c,m):o(n,e,s,c);if(b)if(T+=b,I){const t=N(n,e,r,s,c,m);h+=b*t[0],g+=b*t[1],E+=b*t[2]}else{const t=l(n,e,s,c);h+=b*t[0],g+=b*t[1]}}return T>0?I?[h/T,g/T,E/T]:[h/T,g/T]:r>0?I?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function o(t,n,e,r){const I=e-t,o=r-n;return Math.sqrt(I*I+o*o)}function u(t,n,e,r,I,o){const u=r-t,l=I-n,N=o-e;return Math.sqrt(u*u+l*l+N*N)}function l(t,n,e,r){return[t+.5*(e-t),n+.5*(r-n)]}function N(t,n,e,r,I,o){return[t+.5*(r-t),n+.5*(I-n),e+.5*(o-e)]}},"./node_modules/@arcgis/core/layers/support/SceneModification.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return f}));var m,_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/@arcgis/core/geometry.js"),__webpack_require__("./node_modules/@arcgis/core/core/JSONSupport.js")),_core_lang_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_Warning_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/Warning.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/writer.js"),_core_accessorSupport_decorators_persistable_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/geometry/Polygon.js");let y=m=class extends _core_JSONSupport_js__WEBPACK_IMPORTED_MODULE_2__.a{constructor(e){super(e),this.geometry=null,this.type="clip"}writeGeometry(e,r,o,s){if(s.layer&&s.layer.spatialReference&&!s.layer.spatialReference.equals(this.geometry.spatialReference)){if(!Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_10__.b)(e.spatialReference,s.layer.spatialReference))return void(s&&s.messages&&s.messages.push(new _core_Warning_js__WEBPACK_IMPORTED_MODULE_4__.a("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:s.layer.spatialReference,context:s})));const p=new _geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_11__.a;Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_10__.v)(e,p,s.layer.spatialReference),r[o]=p.toJSON(s)}else r[o]=e.toJSON(s);delete r[o].spatialReference}clone(){return new m({geometry:Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_3__.a)(this.geometry),type:this.type})}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({type:_geometry_Polygon_js__WEBPACK_IMPORTED_MODULE_11__.a}),Object(_core_accessorSupport_decorators_persistable_js__WEBPACK_IMPORTED_MODULE_9__.a)()],y.prototype,"geometry",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_writer_js__WEBPACK_IMPORTED_MODULE_8__.a)(["web-scene","portal-item"],"geometry")],y.prototype,"writeGeometry",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_5__.b)({type:["clip","mask","replace"],nonNullable:!0}),Object(_core_accessorSupport_decorators_persistable_js__WEBPACK_IMPORTED_MODULE_9__.a)()],y.prototype,"type",void 0),y=m=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.a)("esri.layers.support.SceneModification")],y);const f=y},"./node_modules/@arcgis/core/views/3d/layers/I3SMeshView3D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return $e}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Color=__webpack_require__("./node_modules/@arcgis/core/Color.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Collection=__webpack_require__("./node_modules/@arcgis/core/core/Collection.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),MapUtils=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),PooledArray=__webpack_require__("./node_modules/@arcgis/core/core/PooledArray.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),scheduling=__webpack_require__("./node_modules/@arcgis/core/core/scheduling.js"),typedArrayUtil=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),unitUtils=__webpack_require__("./node_modules/@arcgis/core/core/unitUtils.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),mat3=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),mat3f32=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f32.js"),mat4=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),mat4f64=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),vec4=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),aaBoundingBox=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),I3SOnDemandController=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/controllers/I3SOnDemandController.js"),fieldUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),layerUtils=__webpack_require__("./node_modules/@arcgis/core/layers/support/layerUtils.js"),SceneModification=__webpack_require__("./node_modules/@arcgis/core/layers/support/SceneModification.js"),visualVariableUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"),arcadeOnDemand=__webpack_require__("./node_modules/@arcgis/core/support/arcadeOnDemand.js"),Symbol3D=__webpack_require__("./node_modules/@arcgis/core/symbols/Symbol3D.js"),unitConversionUtils=__webpack_require__("./node_modules/@arcgis/core/symbols/support/unitConversionUtils.js"),Accessor=(__webpack_require__("./node_modules/@arcgis/core/symbols.js"),__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js")),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),diffUtils=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/diffUtils.js"),dehydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js"),Graphics3DCore=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DCore.js"),Graphics3DScaleVisibility=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DScaleVisibility.js"),I3SGeometryUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SGeometryUtil.js"),Evented=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),GraphicsMap=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/GraphicsMap.js");class LimitGraphicsMap_i extends Evented.a{constructor(e){super(),this._limit=e,this._all=new GraphicsMap.a,this._active=new LimitGraphicsMap_a(this),this._pending=new Map,this._handle=this._all.on("change",(e=>this._handleChanges(e)))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(e){return this._active.find(e)}forEach(e){this._active.forEach(e)}addMany(e){this._all.addMany(e)}removeManyByObjectId(e){this._all.removeManyByObjectId(e)}_handleChanges(e){let t=e.removed;if(this._pending.size>0){t=new Array;for(const s of e.removed)this._pending.delete(s.objectId)||t.push(s)}let s=this._limit-this._active.length+t.length;s<e.added.length&&(this._active.removeMany(t),t=[],LimitGraphicsMap_h.reset(1-this._limit/(this._active.length+e.added.length)),this._active.forEach((e=>{LimitGraphicsMap_h.sample()&&(t.push(e),this._pending.set(e.objectId,e))})),s=this._limit-this._active.length+t.length);let i=e.added;if(s<e.added.length){i=new Array,LimitGraphicsMap_h.reset(s/e.added.length);for(const t of e.added)LimitGraphicsMap_h.sample()?i.push(t):this._pending.set(t.objectId,t)}const n=s-i.length;n>0&&this._pending.size>0&&(LimitGraphicsMap_h.reset(n/this._pending.size),this._pending.forEach((e=>{LimitGraphicsMap_h.sample()&&(i.push(e),this._pending.delete(e.objectId))}))),this._active.addAndRemove(i,t)}}const LimitGraphicsMap_h=new class LimitGraphicsMap_n{constructor(){this.percentage=1,this.last=-1,this.index=0}reset(e){this.percentage=e,this.last=-1}sample(){const e=Math.floor(this.index*this.percentage);return++this.index,e!==this.last&&(this.last=e,!0)}};class LimitGraphicsMap_a{constructor(e){this._parent=e,this._map=new Map}get length(){return this._map.size}forEach(e){this._map.forEach((t=>e(t)))}find(e){let s;return Object(MapUtils.c)(this._map,(t=>!!e(t)&&(s=t,!0))),s}toArray(){return[...this._map.values()]}addAndRemove(e,t){for(const s of e)this._map.set(s.objectId,s);for(const s of t)this._map.delete(s.objectId);(e.length>0||t.length>0)&&this._parent.emit("change",{added:e,removed:t})}removeMany(e){for(const t of e)this._map.delete(t.objectId);e.length>0&&this._parent.emit("change",{added:[],removed:e})}}var PointSymbol3D=__webpack_require__("./node_modules/@arcgis/core/symbols/PointSymbol3D.js");let I3SMeshViewLabeler_u=class extends Accessor.a{constructor(e){super(e),this.loadedGraphics=new LimitGraphicsMap_i(5e4),this.slicePlaneEnabled=!1,this._renderingInfo={symbol:new PointSymbol3D.a},this._handles=new Handles.a,this._graphicsByNode=new Map,this._scaleVisibility=null}initialize(){this._graphicsCore=new Graphics3DCore.a({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});const e=this.view.basemapTerrain;this._scaleVisibility=new Graphics3DScaleVisibility.a({layerScaleEnabled:!1}),this._scaleVisibility.setup(this,this.layer,((e,i,s)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,i,s)),this._graphicsCore,e);const i=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),s=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:i,deconflictor:s,scaleVisibility:this._scaleVisibility}).then((()=>{this._graphicsCore.startCreateGraphics()})).catch((()=>{})),this._handles.add([this.layer.watch("labelingInfo",((e,i)=>{Object(diffUtils.a)(e,i)&&this._graphicsCore.updateLabelingInfo()}))])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null),null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=null),null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null),this.loadedGraphics.destroy(),this.view=null}addNodeMeta(e,s){let r=0;const o=e.filteredIds,a=e.featureIds.map(((a,l)=>{Object(I3SGeometryUtil.b)(l,this.collection,e.objectHandle,I3SMeshViewLabeler_f);const p=Object(dehydratedFeatures.j)(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(I3SMeshViewLabeler_f,p);const h=s(l,e);let n=!1;return Object(maybe.k)(o)?n=!0:r<o.length&&a===o[r]&&(n=!0,r++),{objectId:a,uid:Graphic.a.generateUID(),attributes:h,visible:n,geometry:p}}));this.loadedGraphics.addMany(a),this._graphicsByNode.set(e.node.index,a)}setNodeMetaAttributes(e,i){const s=this._graphicsByNode.get(e.node.index),r=new Array(s.length);for(let t=0;t<s.length;t++){const o=s[t];o.attributes=i(t,e),r[t]=o.uid}this._graphicsCore.updateLabelingInfo(r)}applyFilterChange(e){const i=this._graphicsByNode.get(e.node.index);if(i)if(Object(maybe.k)(e.filteredIds))for(const s of i)s.visible||(s.visible=!0,I3SMeshViewLabeler_m.graphic=s,I3SMeshViewLabeler_m.property="visible",I3SMeshViewLabeler_m.oldValue=!1,I3SMeshViewLabeler_m.newValue=!0,this._graphicsCore.graphicUpdateHandler(I3SMeshViewLabeler_m));else{let s=0;for(const r of i){const i=r.visible;s<e.filteredIds.length&&r.objectId===e.filteredIds[s]?(r.visible=!0,s++):r.visible=!1,i!==r.visible&&(I3SMeshViewLabeler_m.graphic=r,I3SMeshViewLabeler_m.property="visible",I3SMeshViewLabeler_m.oldValue=i,I3SMeshViewLabeler_m.newValue=r.visible,this._graphicsCore.graphicUpdateHandler(I3SMeshViewLabeler_m))}}}removeNodeMeta(e){this.loadedGraphics.removeManyByObjectId(e.featureIds)}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){return{graphicsCore:this._graphicsCore}}};Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"view",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"layer",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"collection",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"loadedGraphics",void 0),Object(tslib_es6.a)([Object(property.b)({aliasOf:"_graphicsCore.updating"})],I3SMeshViewLabeler_u.prototype,"updating",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"slicePlaneEnabled",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SMeshViewLabeler_u.prototype,"_graphicsCore",void 0),I3SMeshViewLabeler_u=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.I3SMeshViewLabeler")],I3SMeshViewLabeler_u);const I3SMeshViewLabeler_m={graphic:null,property:null,oldValue:null,newValue:null},I3SMeshViewLabeler_f=Object(vec3f64.f)(),I3SMeshViewLabeler_b=I3SMeshViewLabeler_u;var WorkerHandle=__webpack_require__("./node_modules/@arcgis/core/core/workers/WorkerHandle.js");const I3SMeshWorkerHandle_h=Logger.a.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");class I3SMeshWorkerHandle_u extends WorkerHandle.a{constructor(s){super("SceneLayerWorker","process",s,{hasInitialize:!0})}getTransferList(s){return[s.geometryBuffer]}setModifications(s,e,t,o){const r={context:s,modifications:I3SMeshWorkerHandle_a(e,t,o),isGeodetic:o.isGeographic};this.broadcast(r,"setModifications")}setLegacySchema(s,e){const t=JSON.stringify(e);this.broadcast({context:s,jsonSchema:t},"setLegacySchema")}destroyContext(s){return this.broadcast(s,"destroyContext")}}const I3SMeshWorkerHandle_n=new PooledArray.a({deallocator:null}),I3SMeshWorkerHandle_i=[0,0,0];function I3SMeshWorkerHandle_a(s,t,o){I3SMeshWorkerHandle_n.clear();let u=1/0,a=1/0,c=-1/0,f=-1/0,l=!1;for(const e of t){const s="clip"===e.type?2:"mask"===e.type?1:0,t=e.geometry;let m=s=>s;if(t.spatialReference){if(!Object(projection.b)(t.spatialReference,o)){I3SMeshWorkerHandle_h.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}m=s=>(Object(projection.y)(s,t.spatialReference,I3SMeshWorkerHandle_i,o),I3SMeshWorkerHandle_i)}else t.hasZ||(I3SMeshWorkerHandle_i[2]=0,m=s=>(I3SMeshWorkerHandle_i[0]=s[0],I3SMeshWorkerHandle_i[1]=s[1],I3SMeshWorkerHandle_i));l=l||1===s,I3SMeshWorkerHandle_n.push(s),I3SMeshWorkerHandle_n.push(t.rings.length);for(const e of t.rings){I3SMeshWorkerHandle_n.push(e.length);for(const s of e){const e=m(s);I3SMeshWorkerHandle_n.push(e[0]),I3SMeshWorkerHandle_n.push(e[1]),I3SMeshWorkerHandle_n.push(e[2]),u=Math.min(u,e[0]),a=Math.min(a,e[1]),c=Math.max(c,e[0]),f=Math.max(f,e[1])}}}if(Object(maybe.l)(s))if(l){const e=1e-4;I3SMeshWorkerHandle_n.push(2),I3SMeshWorkerHandle_n.push(2),I3SMeshWorkerHandle_n.push(4),I3SMeshWorkerHandle_n.push(u-e),I3SMeshWorkerHandle_n.push(a-e),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(c+e),I3SMeshWorkerHandle_n.push(a-e),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(c+e),I3SMeshWorkerHandle_n.push(f+e),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(u-e),I3SMeshWorkerHandle_n.push(f+e),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(4),I3SMeshWorkerHandle_n.push(s[0]),I3SMeshWorkerHandle_n.push(s[1]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[2]),I3SMeshWorkerHandle_n.push(s[1]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[2]),I3SMeshWorkerHandle_n.push(s[3]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[0]),I3SMeshWorkerHandle_n.push(s[3]),I3SMeshWorkerHandle_n.push(0)}else I3SMeshWorkerHandle_n.push(1),I3SMeshWorkerHandle_n.push(1),I3SMeshWorkerHandle_n.push(4),I3SMeshWorkerHandle_n.push(s[0]),I3SMeshWorkerHandle_n.push(s[1]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[2]),I3SMeshWorkerHandle_n.push(s[1]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[2]),I3SMeshWorkerHandle_n.push(s[3]),I3SMeshWorkerHandle_n.push(0),I3SMeshWorkerHandle_n.push(s[0]),I3SMeshWorkerHandle_n.push(s[3]),I3SMeshWorkerHandle_n.push(0);I3SMeshWorkerHandle_n.push(3);const m=new Float64Array(I3SMeshWorkerHandle_n.length);for(let e=0;e<I3SMeshWorkerHandle_n.length;++e)m[e]=I3SMeshWorkerHandle_n.getItemAt(e);return m}var SceneLayerWorker=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"),graphicUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/graphicUtils.js");class Highlights_t{constructor(){this.ids=new Set,this.paused=!1}}class Highlights_s{constructor({collection:e,forAllFeatures:t,forAllFeaturesOfNode:s}){this.highlights=[],this.collection=e,this.forAllFeatures=t,this.forAllFeaturesOfNode=s}destroy(){this.highlights.forEach((e=>this.releaseSet(e))),this.highlights=null}acquireSet(){const s=new Highlights_t;this.highlights.push(s);const i={remove:()=>{this.releaseSet(s),Object(arrayUtils.k)(this.highlights,s)},pause:()=>{this.releaseSet(s),s.paused=!0},resume:()=>{s.paused=!1,this.initializeSet(s)}};return{set:s,handle:i}}setFeatureIds(e,t){t.forEach((t=>e.ids.add(t))),this.initializeSet(e)}initializeSet(e){this.forAllFeatures(((t,s,i)=>(e.ids.has(t)&&this.collection.addComponentHighlight(i.objectHandle,s),1)))}releaseSet(e){this.forAllFeatures(((t,s,i)=>(e.ids.has(t)&&this.collection.removeComponentHighlight(i.objectHandle,s),1)))}objectCreated(e){this.highlights.forEach((t=>{t.paused||this.forAllFeaturesOfNode(e,((s,i)=>(t.ids.has(s)&&this.collection.addComponentHighlight(e.objectHandle,i),1)))}))}objectDeleted(e){this.collection.clearHighlights(e.objectHandle)}}var I3SAttributeOverrides=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SAttributeOverrides.js");class I3SCrossfadeHelper_i{constructor(e){this.view=e,this._preRenderFrameTaskHandle=null,this._currentFrameStartTime=null,this._numFadingNodes=0}get updating(){return this._numFadingNodes>0}stopNodeFading(s){null!=s.lodCrossfadeProgress&&(this._numFadingNodes--,s.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=Object(maybe.t)(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))}_startNodeFading(e,s,d){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=Object(scheduling.a)({preRender:e=>this._updateAllNodeFading(e)}),this.view.notifyLODUpdate()),null==e.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate()),e.lodCrossfadeSignedDuration=d,e.lodCrossfadeProgress=s}_updateAllNodeFading(e){const o=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode(((d,i)=>{if(Object(maybe.l)(i)&&Object(maybe.l)(i.lodCrossfadeProgress)){const s=i.lodCrossfadeSignedDuration,t=s>0?this.view.fullOpacity:0,a=e.deltaTime/s,r=i.lodCrossfadeProgress+Math.abs(a),n=!o||r>=1||0===s,l=t-(n?0:s>0?1:-1)*(1-r);n?(this.stopNodeFading(i),s<0&&this.view.markNodeToRemove(d)):i.lodCrossfadeProgress=r,this.view.setNodeOpacityByIndex(d,l)}})),this.view.removeMarkedNodes()}stopAllNodeFading(){this.view.foreachCrossfadeNode(((e,o)=>{if(Object(maybe.l)(o)&&Object(maybe.l)(o.lodCrossfadeProgress)){this.stopNodeFading(o);const s=o.lodCrossfadeSignedDuration;s<0&&this.view.markNodeToRemove(e);const d=s>0?this.view.fullOpacity:0;this.view.setNodeOpacityByIndex(e,d)}})),this.view.removeMarkedNodes()}fadeNode(e,s,o,d){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());const i=this.view,a=i.nodeCrossfadingEnabled,r=0===o?i.fullOpacity:0,n=a?d?0===o?i.lodCrossfadeinDuration:i.lodCrossfadeoutDuration:i.lodCrossfadeUncoveredDuration:0,l=this.view.getNodeOpacityByIndex(e);if(a&&l!==r&&n>0){const e=1-Math.abs(r-l);this._startNodeFading(s,e,function I3SCrossfadeHelper_t(e){return 0===e?1:-1}(o)*n)}else this.stopNodeFading(s),this.view.setNodeOpacityByIndex(e,r),1===o&&this.view.removeNode(e)}isNodeFullyFadedIn(e){const o=this.view.getNodeCrossfadeMetaData(e);return Object(maybe.l)(o)&&null==o.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(e)===this.view.fullOpacity}}var Intersector=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Intersector.js");const I3SElevationProvider_v=Object(aaBoundingRect.n)(),I3SElevationProvider_y=Object(mat4f64.d)(),x=Object(vec3f64.f)(),I3SElevationProvider_E=Object(vec3f64.f)(),I3SElevationProvider_g=Object(vec3f64.f)(),j=Logger.a.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");let I3SElevationProvider_b=class extends(Evented.a.EventedMixin(Accessor.a)){constructor(e){super(e),this.tmpEvent={spatialReference:null,extent:I3SElevationProvider_v,context:"scene"}}initialize(){this.view=this.layerView.view,this.renderCoordsHelper=this.view.renderCoordsHelper,this.intersector=Object(Intersector.b)(this.view.state.viewingMode),this.intersector.options.store=0;const e=this.layerView.i3slayer.fullExtent;Object(maybe.k)(e)?j.error("I3SElevationProvider expected fullExtent on I3SLayer."):(this.zmin=e.zmin,this.zmax=e.zmax),this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}getElevation(e,t,r,s){if(x[0]=e,x[1]=t,x[2]=r,!this.renderCoordsHelper.toRenderCoords(x,s,x))return j.error("could not project point to compute elevation"),null;const i=this.layerView.elevationOffset,o=this.zmin+i,n=this.zmax+i;return this.renderCoordsHelper.setAltitude(I3SElevationProvider_E,n,x),this.renderCoordsHelper.setAltitude(I3SElevationProvider_g,o,x),this.intersector.reset(I3SElevationProvider_E,I3SElevationProvider_g,null),this.intersectionHandler.intersect(this.intersector,null,I3SElevationProvider_E,I3SElevationProvider_g),this.intersector.results.min.getIntersectionPoint(x)?this.renderCoordsHelper.getAltitude(x):null}layerChanged(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))}objectChanged(e){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(e),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))}computeObjectExtent(e){return Object(aaBoundingRect.n)(I3SElevationProvider_v),this._expandExtent(e,I3SElevationProvider_v),I3SElevationProvider_v}computeLayerExtent(){Object(aaBoundingRect.n)(I3SElevationProvider_v);for(const e of this.layerView.getVisibleNodes())this._expandExtent(e,I3SElevationProvider_v);return I3SElevationProvider_v}_expandExtent(e,t){const r=e.visibilityObb||e.serviceObbInRenderSR;if(Object(maybe.l)(r)){Object(mat4.g)(I3SElevationProvider_y,r.quaternion),I3SElevationProvider_y[12]=r.center[0],I3SElevationProvider_y[13]=r.center[1],I3SElevationProvider_y[14]=r.center[2];for(let e=0;e<8;++e)x[0]=1&e?r.halfSize[0]:-r.halfSize[0],x[1]=2&e?r.halfSize[1]:-r.halfSize[1],x[2]=4&e?r.halfSize[2]:-r.halfSize[2],Object(vec3.s)(x,x,I3SElevationProvider_y),this.renderCoordsHelper.fromRenderCoords(x,x,this.spatialReference),Object(aaBoundingRect.p)(t,x,t)}else{const r=e.renderMbs[3],s=Object(vec3.m)(I3SElevationProvider_E,e.renderMbs);s[0]-=r,s[1]-=r,s[2]-=r;const i=Object(vec3.m)(I3SElevationProvider_g,e.renderMbs);i[0]+=r,i[1]+=r,i[2]+=r;for(let e=0;e<8;++e)x[0]=1&e?s[0]:i[0],x[1]=2&e?s[1]:i[1],x[2]=4&e?s[2]:i[2],this.renderCoordsHelper.fromRenderCoords(x,x,this.spatialReference),Object(aaBoundingRect.p)(t,x,t)}}};Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],I3SElevationProvider_b.prototype,"layerView",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],I3SElevationProvider_b.prototype,"intersectionHandler",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SElevationProvider_b.prototype,"view",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],I3SElevationProvider_b.prototype,"spatialReference",void 0),I3SElevationProvider_b=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.i3s.I3SElevationProvider")],I3SElevationProvider_b);const R=I3SElevationProvider_b;var orientedBoundingBox=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js"),verticalOffsetUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/verticalOffsetUtils.js");class I3SIntersectionHandler_s{constructor(e){this.type=4,this.layerUid=e.layerUid,this.sublayerUid=e.sublayerUid,this.collection=e.collection,this.traverseNodeHierarchy=e.traverseNodeHierarchy,this.slicePlaneEnabled=e.slicePlaneEnabled,this.isGround=e.isGround}intersect(s,o,l,d){const c=s.results,a=2===s.options.store,b=s.ray.direction,u=s.tolerance;let y=e=>e,m=e=>e;const h=Object(verticalOffsetUtils.c)(s.verticalOffset);Object(maybe.l)(h)&&(y=e=>h.applyToMbs(e),m=e=>h.applyToObb(e)),this.traverseNodeHierarchy(((t,p)=>!(Object(maybe.l)(t.serviceObbInRenderSR)&&!Object(orientedBoundingBox.f)(m(t.serviceObbInRenderSR),l,b,u)||(!p||Object(maybe.l)(t.geometryObb)&&!Object(orientedBoundingBox.f)(m(t.geometryObb),l,b,u)||!Object(maybe.l)(t.serviceObbInRenderSR)&&!function I3SIntersectionHandler_n(e,i,r,t=0){const s=e[3]+t,n=i[0]-e[0],o=i[1]-e[1],l=i[2]-e[2],d=r[0],c=r[1],a=r[2],b=d*n+c*o+a*l;return b*b-(d*d+c*c+a*a)*(n*n+o*o+l*l-s*s)>=0}(y(t.renderMbs),l,b,u)||this.collection.intersect(p,l,d,u,h,((e,i,n,b)=>{if(i>=0){if(null!=o&&!o(l,d,i))return;const u=r=>{const s={layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:t.index,componentIndex:e,triangleNr:b};r.set(this.type,s,i,n)};if(this.isGround&&(null==c.ground.dist||i<c.ground.dist)&&u(c.ground),s.options.isFiltered)return;if((null==c.min.dist||i<c.min.dist)&&u(c.min),(null==c.max.dist||i>c.max.dist)&&u(c.max),a){const e=Object(Intersector.c)(s.ray);u(e),s.results.all.push(e)}}})),0))))}}var I3SMaterialUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js"),I3SProjectionUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SProjectionUtil.js"),I3SUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js"),Error=__webpack_require__("./node_modules/@arcgis/core/core/Error.js");class IDBCache_o{constructor(e,t,s=14){this._version=s,this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t}init(){return Promise.resolve().then((()=>{const e=indexedDB.open(this._dbName,this._version);return e.onupgradeneeded=t=>{const s=e.result,r=e.transaction,i=s.objectStoreNames.contains(this._storeName)?r.objectStore(this._storeName):s.createObjectStore(this._storeName),o=s.objectStoreNames.contains("last_access")?r.objectStore("last_access"):s.createObjectStore("last_access");o.indexNames.contains("date")||o.createIndex("date","date",{unique:!1}),o.indexNames.contains("byteSize")||o.createIndex("byteSize","byteSize",{unique:!1}),t.oldVersion<this._version&&(i.clear(),o.clear())},IDBCache_c(e)})).then((e=>{this._destroyed?e.close():this._db=e}))}destroy(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0}get initialized(){return null!=this._db}getHitRate(){return this._hit/(this._hit+this._miss)}put(t,s){return null==this._db?Promise.reject(new Error.a("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then((()=>this._put(t,s))).catch((e=>{if(e&&"QuotaExceededError"===e.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then((e=>this._removeLeastRecentlyAccessed(s.byteSize+Math.ceil(e*this.quotaReductionFactor)))),this._quotaReductionPromise.then((()=>this._quotaReductionPromise=null),(()=>this._quotaReductionPromise=null))),this._quotaReductionPromise.then((()=>this._put(t,s)));throw e})).then((()=>{this._gcCounter--,this._gcCounter<0&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then((e=>this._removeLeastRecentlyAccessed(e-this.maxByteSize))))}))}get(e,i){if(null==this._db)return Promise.resolve(null);let o=null;return Promise.resolve().then((()=>{const t=this._db.transaction(this._storeName,"readonly");return o=Object(promiseUtils.r)(i,(()=>{t.abort()})),IDBCache_c(t.objectStore(this._storeName).get(e))})).then((s=>(null==s?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:s.byteSize},e)),Object(maybe.l)(o)&&o.remove(),s))).catch((()=>(++this._miss,Object(promiseUtils.w)(i),Object(maybe.l)(o)&&o.remove(),null)))}remove(e){return null==this._db?Promise.resolve():Promise.resolve().then((async()=>{const t=this._db.transaction([this._storeName,"last_access"],"readwrite"),s=t.objectStore(this._storeName),r=t.objectStore("last_access"),i=s.delete(e),o=r.delete(e);await Promise.all([IDBCache_c(i),IDBCache_c(o),IDBCache_n(t)])}))}_put(e,t){const s=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=s.objectStore(this._storeName),i=s.objectStore("last_access"),o=r.put(t,e),a=i.put({date:Date.now(),byteSize:t.byteSize},e);return Promise.all([IDBCache_c(o),IDBCache_c(a),IDBCache_n(s)])}_removeLeastRecentlyAccessed(e){if(e<=0)return;const t=this._db.transaction([this._storeName,"last_access"],"readwrite"),s=t.objectStore(this._storeName),r=t.objectStore("last_access");let i=0;const o=r.index("date").openCursor(null,"next");return o.onsuccess=()=>{const t=o.result;null!=t&&(null!=t.value.byteSize&&(i+=t.value.byteSize),s.delete(t.primaryKey),r.delete(t.primaryKey),i<e&&t.continue())},IDBCache_n(t)}_getCacheSize(){const e=this._db.transaction("last_access"),t=e.objectStore("last_access");let s=0;const r=t.index("byteSize").openKeyCursor();return r.onsuccess=()=>{const e=r.result;if(!e)return;const t=e.key;null!=t&&(s+=t),e.continue()},IDBCache_n(e).then((()=>s))}}function IDBCache_n(e){return new Promise(((t,s)=>{e.oncomplete=()=>t(),e.onerror=()=>s(e.error),e.onabort=()=>s(e.error)}))}function IDBCache_c(e){return new Promise(((t,s)=>{"done"===e.readyState?null!=e.error?s(e.error):t(e.result):(e.onsuccess=()=>t(e.result),e.onerror=()=>s(e.error))}))}var attributeUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js"),debugFlags=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/debugFlags.js"),extentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/extentUtils.js"),updatingProperties=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/updatingProperties.js"),glUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/buffer/glUtil.js"),SourceGeometry=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/SourceGeometry.js"),BasisUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/BasisUtil.js");const Be=Logger.a.getLogger("esri.views.3d.layers.SceneLayerView3D"),ke=[1,1,1,1];class I3SMeshView3D_qe extends class I3SCrossfadeHelper_d{constructor(){this.lodCrossfadeSignedDuration=0}}{constructor(e,t,i,s,r,o,a){super(),this.node=e,this.featureIds=t,this.objectHandle=i,this.cachedRendererVersion=s,this.attributeInfo=r,this.material=o,this.textures=a,this.cachedEdgeMaterials=new Array,this.cachedSymbology=null}}const $e=t=>{let o=class extends t{constructor(...e){super(e),this._elevationProvider=null,this._intersectionHandler=null,this._nodeId2Meta=new Map,this._nodeId2MetaReloading=new Map,this._i3sWasmLoaded=!1,this._hasLoadedPBRTextures=!1,this._asyncModuleLoading=0,this._addTasks=new Map,this._rendererVersion=0,this._colorVariable=null,this._opacityVariable=null,this._rendererFields=null,this._symbologyFields=null,this._symbologyOverride=null,this._symbologyOverrideFields=null,this._symbolInfos=new Map,this._idbCache=new IDBCache_o("esri-scenelayer-cache","geometries"),this.holeFilling="auto",this._hasColors=!1,this._hasTextures=!1,this._hasData=!1,this.slicePlaneEnabled=!1,this._modifications=new Array,this._layerUrl="",this._cacheKeySuffix=null,this._arcade=null,this._tmpAttributeOnlyGraphic=new Graphic.a(null,null,{}),this._crossfadeHelper=new I3SCrossfadeHelper_i(this)}get lodCrossfadeoutDuration(){return 0}get lodCrossfadeinDuration(){return 0}get lodCrossfadeUncoveredDuration(){return 0}get layerUid(){return this.i3slayer&&this.i3slayer.uid}get sublayerUid(){return null}get hasTexturesOrVertexColors(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}get rendererTextureUsage(){return Object(I3SUtil.u)(this._currentRenderer)?this._usePBR()||this._hasLoadedPBRTextures?63:37:this._usePBR()||this._hasLoadedPBRTextures?44:36}get elevationOffset(){const e=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){const t=Object(unitUtils.g)(this.i3slayer.spatialReference),i=Object(unitConversionUtils.a)(e.unit);return Object(maybe.v)(e.offset,0)*i/t}return 0}get supportedTextureEncodings(){return Object(I3SMaterialUtil.e)(this.view._stage.renderView.capabilities)}get uncompressedTextureDownsamplingEnabled(){var e;const t=null==(e=this.view)?void 0:e.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled,i=0==(4&this.supportedTextureEncodings);return t&&i}initialize(){this.preLoadBasis(),this.addResolvingPromise(this.i3slayer.indexInfo);const e=this.view.resourceController;if(this.attributeOverrides=new I3SAttributeOverrides.a(this.i3slayer,e.memoryController),this._worker=new I3SMeshWorkerHandle_u((t=>e.schedule(t))),this.addResolvingPromise(this._worker.promise),this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema),Object(I3SUtil.e)(this.i3slayer),Object(I3SUtil.d)(this.i3slayer,this.view),this._layerUrl=this.i3slayer.parsedUrl.path,this._controller=new I3SOnDemandController.a({layerView:this}),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._collection=this._stage.renderView.componentObjectCollection,this._highlights=new Highlights_s({collection:this._collection,forAllFeatures:e=>this._forAllFeatures(e,null,1),forAllFeaturesOfNode:(e,t)=>this._forAllFeaturesOfNode(e,t)}),this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{const e=this.i3slayer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(e&&e.faceRange&&e.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color),this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());const t=this.view.resourceController.memoryController.newCache(this.i3slayer.uid,(e=>this._deleteComponentObject(e)));this._memCache=t;this._intersectionHandler=new I3SIntersectionHandler_s({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:e=>Object(maybe.l)(this._controller.index)&&Object(maybe.l)(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,(t=>{const i=t.index,s=this._nodeId2Meta.get(i)||this._nodeId2MetaReloading.get(i);return e(t,Object(maybe.l)(s)?s.objectHandle:null)})):()=>{}}),this._elevationProvider=new R({layerView:this,intersectionHandler:this._intersectionHandler}),this._hasLoadedPBRTextures=this._usePBR(),this.updatingHandles.add(this,"view.clippingArea",(()=>this._clippingAreaChanged()),2),this.updatingHandles.add(this,"fullOpacity",(e=>this._opacityChange(e))),this.updatingHandles.add(this,"slicePlaneEnabled",(e=>this._slicePlaneEnabledChange(e))),this.updatingHandles.add(this,"elevationOffset",((e,t)=>{this._reloadAll(t),this._controller.invalidateVisibilityObbs()})),this.updatingHandles.add(this,"filter",(()=>this._filterChange()),2),this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",(()=>this._updatePBR()));const s=()=>{this._reloadAll(),this.clearMemCache()};this.updatingHandles.add(this,"rendererTextureUsage",s),this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",s),this.updatingHandles.add(this,"suspended",(e=>this._suspendedChange(e)),2),this.updatingHandles.add(this.i3slayer,"labelsVisible",(()=>this._labelingChanged()),2),this.updatingHandles.add(this.i3slayer,"labelingInfo",(()=>this._labelingChanged()),2),this.updatingHandles.add(this,"_modifications",(()=>this._modificationsChanged()),2),this.handles.add([Object(watchUtils.a)(debugFlags.a,"I3S_TREE_SHOW_TILES",(e=>{if(e&&!this._treeDebugger){const e=this._controller.crsIndex;__webpack_require__.e(39).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/3d/layers/support/I3STreeDebugger.js")).then((({I3STreeDebugger:t})=>{!this._treeDebugger&&debugFlags.a.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new t({lv:this,view:this.view,nodeSR:e}))}))}else e||debugFlags.a.I3S_TREE_SHOW_TILES||(this._treeDebugger=Object(maybe.e)(this._treeDebugger))})),Object(watchUtils.a)(debugFlags.a,"I3S_SHOW_MODIFICATIONS",(()=>this._showModifications()))]),this._cacheKeySuffix=Object(I3SUtil.m)(this.i3slayer.spatialReference,this.view.renderSpatialReference),this._idbCache.init().catch((e=>Be.warn(`Failed to initialize IndexedDB cache: ${e}`)))}destroy(){this._clearAddTasks(),this.attributeOverrides=Object(maybe.e)(this.attributeOverrides),this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const e=this._worker;e&&(e.destroyContext(this.i3slayer.uid).then((()=>e.destroy())),this._worker=null),this._removeAllNodeDataFromStage(),this._memCache=Object(maybe.e)(this._memCache),this._collection=null,this._stage=null,this._edgeView=null,this._labeler=Object(maybe.e)(this._labeler),this._treeDebugger=Object(maybe.e)(this._treeDebugger),this._controller=Object(maybe.e)(this._controller),this._highlights.destroy(),this._nodeId2Meta.clear(),this._nodeId2MetaReloading.clear(),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)}memEstimateTextureAdded(e){const t=e.estimatedTexMemRequired;return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t}memEstimateTextureRemoved(e){if(Object(maybe.l)(e)){const t=e.estimatedTexMemRequired;this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t}}memEstimateGeometryAdded(e){const t=this._collection.getObjectGPUMemoryUsage(e);return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t}memEstimateGeometryRemoved(e){const t=this._collection.getObjectGPUMemoryUsage(e);this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t}isNodeLoaded(e){return this._nodeId2Meta.has(e)}isNodeReloading(e){return this._nodeId2MetaReloading.has(e)}getUsedMemory(){let e=Object(maybe.l)(this._labeler)?this._labeler.usedMemory:0;return this._nodeId2Meta.forEach((t=>e+=Object(maybe.l)(t)?t.node.memory:0)),this._nodeId2MetaReloading.forEach((t=>e+=Object(maybe.l)(t)?t.node.memory:0)),e}getUnloadedMemory(){return(Object(maybe.l)(this._controller)?this._controller.unloadedMemoryEstimate:0)+(Object(maybe.l)(this._labeler)?this._labeler.unloadedMemoryEstimate:0)}ignoresMemoryFactor(){return!1}_labelingChanged(){if(!Object(layerUtils.a)(this.i3slayer)||!this._supportsLabeling)return void(Object(maybe.l)(this._labeler)&&(this._labeler.destroy(),this._labeler=null));if(Object(maybe.l)(this._labeler))return;const e=new I3SMeshViewLabeler_b({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach((t=>Object(maybe.l)(t)&&this._addMetaToLabeler(e,t))),this._labeler=e}_loadAsyncModule(e){return++this._asyncModuleLoading,e.then((e=>(--this._asyncModuleLoading,e)),(e=>{throw--this._asyncModuleLoading,e}))}_modificationsChanged(){if(!this._i3sWasmLoaded&&this.hasModifications)return this._i3sWasmLoaded=Object(SceneLayerWorker.initialize)().then((()=>{this._i3sWasmLoaded=!0,this._modificationsChanged(),this.notifyUpdate()})),void this.notifyUpdate();if(!0!==this._i3sWasmLoaded)return;const e=this.i3slayer.uid,t=this.i3slayer.spatialReference;this._worker.setModifications(e,this._layerClippingArea,this._modifications,t);const i=I3SMeshWorkerHandle_a(this._layerClippingArea,this._modifications,t);Object(SceneLayerWorker.setModificationsSync)({context:e,modifications:i,isGeodetic:t.isGeographic}),this._controller.modificationsChanged();const s=this.hasModifications?new PooledArray.a:null;this._nodeId2Meta.forEach(((e,t)=>{Object(maybe.k)(e)?this._nodeId2Meta.delete(t):e.node.hasModifications?(this._nodeId2Meta.delete(t),this._nodeId2MetaReloading.set(t,e)):Object(maybe.l)(s)&&s.push(e.node)})),Object(maybe.l)(s)&&this._nodeId2MetaReloading.forEach((e=>s.push(e.node))),Object(maybe.l)(s)&&s.length>0&&(this.updateNodeModificationStatus(s),s.forAll((e=>{if(2!==e.imModificationImpact){const t=this._nodeId2Meta.get(e.index);this._controller.invalidateGeometryVisibility(e.index),this._nodeId2Meta.delete(e.index),Object(maybe.l)(t)&&this._nodeId2MetaReloading.set(e.index,t)}}))),this.clearMemCache(),this._controller.restartNodeLoading(),this._showModifications()}_showModifications(){if(Object(maybe.l)(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null),!debugFlags.a.I3S_SHOW_MODIFICATIONS||0===this._modifications.length)return;const e={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},t={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=new Array;for(const s of this._modifications){s.geometry.spatialReference=this.i3slayer.spatialReference;const r={...t,color:e[s.type]};this._modificationGraphics.push(new Graphic.a({geometry:s.geometry,symbol:r}))}this.view.graphics.addMany(this._modificationGraphics)}_addMetaToLabeler(e,t){e.addNodeMeta(t,((e,t)=>this._createAttributes(e,t)))}_suspendedChange(e){e?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))}getLoadedAttributes(e){const t=this._nodeId2Meta.get(e);if(Object(maybe.l)(t)&&Object(maybe.l)(t.attributeInfo))return t.attributeInfo.loadedAttributes}getAttributeData(e){const t=this._nodeId2Meta.get(e);if(Object(maybe.l)(t)&&Object(maybe.l)(t.attributeInfo))return t.attributeInfo.attributeData}setAttributeData(e,t){const i=this._nodeId2Meta.get(e);Object(maybe.l)(i)&&Object(maybe.l)(i.attributeInfo)&&(i.attributeInfo.attributeData=t,this._attributeValuesChanged(i))}async updateAttributes(e,t,i){const s=this._nodeId2Meta.get(e);Object(maybe.l)(s)&&(await this.attributeOverrides.apply(s.featureIds,t,i),s.attributeInfo=t,this._attributeValuesChanged(s))}_attributeValuesChanged(e){e.cachedRendererVersion=this._getInvalidRendererVersion(),e.filteredIds=null,Object(maybe.l)(this._labeler)&&this._labeler.setNodeMetaAttributes(e,((e,t)=>this._createAttributes(e,t))),this._updateEngineObject(e)}clearMemCache(){Object(maybe.l)(this._memCache)&&this._memCache.clear()}getVisibleNodes(){const e=new Array;return this._nodeId2Meta.forEach((t=>Object(maybe.l)(t)&&e.push(t.node))),e}getLoadedNodeIndices(e){this._nodeId2Meta.forEach(((t,i)=>e.push(i))),this._nodeId2MetaReloading.forEach(((t,i)=>e.push(i)))}preLoadBasis(){!Object(has.a)("disable-feature:i3s-basis")&&0!=(2&this.supportedTextureEncodings)&&Object(maybe.c)(this.i3slayer.textureSetDefinitions,(e=>e.some((e=>e.formats.some((e=>"basis"===e.format||"ktx2"===e.format))))))&&Object(BasisUtil.e)()}_getVertexBufferLayout(e,t){const i={hasTexture:tt(e.params.material),hasNormals:t.normal,hasRegions:t.uvRegion};return Object(glUtil.a)(Object(SourceGeometry.a)(this._getGeometryParameters(i)))}_getObjectIdField(){return this.i3slayer.objectIdField||"OBJECTID"}_findGraphicNodeAndIndex(e){const t=Object(attributeUtils.a)(this.i3slayer.fieldsIndex,e.attributes,this._getObjectIdField());let i=null;return Object(MapUtils.c)(this._nodeId2Meta,(e=>{if(Object(maybe.k)(e))return!1;const s=e.featureIds.indexOf(t);return-1!==s&&(i={node:e.node,index:s},!0)})),i}_getGraphicIndices(e,t){const i=this._nodeId2Meta.get(e.index);if(Object(maybe.k)(i))return[];const s=[],r=this._getObjectIdField(),o=this.i3slayer.fieldsIndex;for(const a of t){const e=Object(attributeUtils.a)(o,a.attributes,r),t=i.featureIds.indexOf(e);-1!==t&&s.push(t)}return s}whenGraphicBounds(e){const t=this._findGraphicNodeAndIndex(e);if(!t)return Promise.reject();const i=this._nodeId2Meta.get(t.node.index);if(Object(maybe.k)(i))return Promise.reject();const s=i.objectHandle,r=Object(I3SGeometryUtil.a)(t.index,this._collection,s,new Float64Array(24)),o=this.view.renderSpatialReference,a=this.view.spatialReference;if(Object(projection.p)(r,o,0,r,a,0,8)){const e=Object(aaBoundingBox.k)();return Object(aaBoundingBox.n)(e,r,0,8),Promise.resolve({boundingBox:e,screenSpaceObjects:[]})}}whenGraphicAttributes(e,t){return Object(I3SUtil.x)(this.i3slayer,e,this._getObjectIdField(),t,(()=>[...this._nodeId2Meta.values()].filter(maybe.l)))}getGraphicFromIntersectorTarget(e){if(null==e.nodeIndex||null==e.componentIndex)return null;const t=this._nodeId2Meta.get(e.nodeIndex);return Object(maybe.k)(t)||null==t.featureIds||e.componentIndex>=t.featureIds.length?null:this._createGraphic(e.componentIndex,t)}_getCacheKey(e){return`${this._layerUrl}/v19/${e.id}${this._cacheKeySuffix}`}_getMemCacheKey(e,t=this.elevationOffset){return e+"#"+t}get _idbCacheEnabled(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}loadCachedGPUData(e){return Object(maybe.l)(this._memCache)?this._memCache.pop(this._getMemCacheKey(e.index)):null}deleteCachedGPUData(e){Object(maybe.l)(e)&&this._deleteComponentObject(e)}_cacheGPUData(e,t=this.elevationOffset){if(Object(maybe.k)(this._memCache))return void this._deleteComponentObject(e);const i=this._controller.indexDepth-e.node.level;this._memCache.put(this._getMemCacheKey(e.node.index,t),e,e.node.memory,i)}loadMissingTextures(e,t,i,s){const r=e.filter(((e,i)=>{if(0==(e.usage&this.rendererTextureUsage))return!1;if(Object(maybe.k)(t))return!0;const s=Object(I3SMaterialUtil.f)(e.encodings,this.supportedTextureEncodings),r=t[i];return!!(Object(maybe.k)(r)||null==r.data||s&&r.encoding!==s.encoding)}));return 0===r.length?Promise.resolve(!1):i(r,s).then((i=>{let s=0;for(let r=0;r<e.length;r++)s<i.length&&i[s].id===e[r].id&&(t[r]=i[s],s++);return!0}))}loadCachedNodeData(e,t,i){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(e),t).then((s=>null==s?null:s.nodeVersion!==e.version?(this._idbCache.remove(this._getCacheKey(e)),null):(e.geometryObb=s.geometryObb,this.loadMissingTextures(s.requiredTextures,s.textureData,i,t).then((i=>(i&&this._idbCache.initialized&&Object(maybe.l)(s.textureData)&&(s.byteSize=rt(s.transformedGeometry,s.textureData),s.textureData.every(st)&&ot(e,s)&&this._idbCache.put(this._getCacheKey(e),s).catch((t=>Be.warn(`Failed to update node with textures in IndexedDB cache: ${e.id}: ${t}`)))),Object(promiseUtils.w)(t),s)))))):Promise.resolve(null)}addNode(e,t,i){return function it(e){return"geometryData"in e}(t)?this._addData(e,t.attributeDataInfo,(()=>this._transformNode(e,t,i).then((s=>this._safeReschedule((()=>{if(Object(maybe.k)(s))return e.hasModifications=!1,this._addCachedNodeData(e,null,i);e.hasModifications=s.transformedGeometry.hasModifications;const{obb:r,componentOffsets:o,featureIds:a,transformedGeometry:n}=s,l=this._controller.crsIndex,c=this.view.renderSpatialReference,u=Object(I3SProjectionUtil.a)(e.mbs,this.elevationOffset,l,c);e.geometryObb=Object(orientedBoundingBox.e)([r.center.x,r.center.y,r.center.z],[r.extents.x,r.extents.y,r.extents.z],[r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w]),Object(vec3.s)(e.geometryObb.center,e.geometryObb.center,u),t.geometryData.componentOffsets=o,a&&(t.geometryData.featureIds=Array.prototype.slice.call(a));const _={nodeVersion:e.version,geometryData:t.geometryData,requiredTextures:t.requiredTextures,textureData:t.textureData,transformedGeometry:n,globalTrafo:u,geometryObb:e.geometryObb,byteSize:rt(n,t.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&ot(e,_)){const t=Object(maybe.l)(_.textureData)?_.textureData.map((e=>st(e)?e:null)):null;this._idbCache.put(this._getCacheKey(e),{..._,textureData:t}).catch((t=>Be.warn(`Failed to store node in IndexedDB cache: ${e.id}: ${t}`)))}return this._addCachedNodeData(e,_,i)}),i))))):Promise.reject()}computeVisibilityObb(e){return Object(I3SUtil.h)(e,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)}_transformNode(e,t,i){const s=t.geometryData.geometries,r=new Array(s.length);for(let h=0;h<s.length;++h)r[h]=this._getVertexBufferLayout(s[h],t.geometryDescriptor);const o=e.mbs,a=this.elevationOffset,n=this._controller.crsIndex,l=this._controller.crsVertex,d=this.view.renderSpatialReference,c=Object(I3SProjectionUtil.b)(o,a,n),u=Object(I3SProjectionUtil.a)(o,a,n,d),_=Object(projection.e)(n,l),m=Object(projection.e)(l,d);if(Object(maybe.k)(_)||Object(maybe.k)(m))return Promise.resolve(null);const g={context:this.i3slayer.uid,geometryBuffer:t.geometryBuffer,geometryData:t.geometryData,geometryDescriptor:t.geometryDescriptor,layouts:r,localOrigin:c,globalTrafo:u,mbs:o,obb:e.serviceObb,elevationOffset:a,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:_,vertexToRenderProjector:m};return this._worker.invoke(g,i)}get supportsNodeCrossFading(){var e,t;return!(null!=(e=this.view)&&null!=(t=e._stage)&&t.renderView.hasShadowsEnabled)}get nodeCrossfadingEnabled(){return this.supportsNodeCrossFading&&(this.lodCrossfadeinDuration>0||this.lodCrossfadeoutDuration>0||this.lodCrossfadeUncoveredDuration>0)}get nodeFadeoutEnabled(){return this.supportsNodeCrossFading&&this.lodCrossfadeoutDuration>0}_setNewNodeOpacity(e){const t=this.nodeCrossfadingEnabled?0:this.fullOpacity;this._setNodeOpacity(e,t)}addCachedGPUData(e,t,i){if(e.geometryObb=Object(orientedBoundingBox.b)(this._collection.getComponentObb(t.objectHandle)),!this._controller.isGeometryVisible(e))return void this._cacheGPUData(t);Object(maybe.l)(this._labeler)&&this._addMetaToLabeler(this._labeler,t);const s=e.index;this._addNodeMeta(s,t),this.updateNodeState(s,i),this._collection.setObjectVisibility(t.objectHandle,1),this._updateMaterial(t),this._setNewNodeOpacity(t),this._updateEngineObject(t),this._highlights.objectCreated(t),Object(maybe.l)(this._treeDebugger)&&this._treeDebugger.update()}addCachedNodeData(e,t,i,s){return this._addData(e,i,(()=>this._addCachedNodeData(e,t,s)))}async _addCachedNodeData(e,t,i){if(this.suspended||!this._controller.isGeometryVisible(e))return void this._removeNodeStageData(e.index,this.elevationOffset,this._nodeId2MetaReloading);if(Object(maybe.k)(t))return void this._addNodeMeta(e.index,null);const s=this._addTasks.get(e.index),{geometryData:o,transformedGeometry:a,globalTrafo:n}=t;await this.attributeOverrides.apply(o.featureIds,s.attributeInfo,i);const l=Object(maybe.l)(t.textureData)?t.textureData.filter((e=>Object(maybe.l)(e)&&0!=(e.usage&this.rendererTextureUsage))):[];!Object(has.a)("disable-feature:i3s-basis")&&l.some((e=>Object(maybe.l)(e)&&(2===e.encoding||1===e.encoding)))&&await Object(BasisUtil.e)(),e.memory=0;const{componentOffsets:c,geometries:_,featureIds:m}=o,g=this._collection,p=_[0],{layout:f,indices:y,interleavedVertexData:b,positionData:v,hasColors:I}=a,S=this._materialParameters(p,f),E=c||new Uint32Array([0,y?y.length:b.byteLength/f[0].stride]),D={vertices:{data:b,count:b.byteLength/f[0].stride,layoutParameters:S.geometryParams},positionData:{positions:v.data,indices:v.indices},indices:y,componentOffsets:E},F=p.transformation?Object(mat4f64.c)(p.transformation):Object(mat4f64.d)();Object(mat4.m)(F,n,F);const N=Object(mat4.x)(Object(vec3f64.f)(),F),P=Object(mat3.f)(Object(mat3f32.b)(),F),A=this.view.renderSpatialReference,H=this.view.basemapTerrain.spatialReference,U=Object(vec3f64.f)(),G=[1,1,1];Object(projection.j)(N,A,G,H)||Be.errorOnce("Unsupported coordinate system for IM overlay"),Object(projection.y)(N,A,U,H);const L=g.createObject({toMapSpace:[U[0],U[1],G[0],G[1]],geometry:D,obb:Object(maybe.u)(e.geometryObb),transform:{position:N,rotationScale:P}}),B=2===S.geometryParams.textureCoordinates,{textures:k,texturePromise:q}=this._initMaterialAndTextures(L,S.material,l,B);e.memory+=this.memEstimateGeometryAdded(L),e.memory+=k.reduce(((e,t)=>e+(Object(maybe.l)(t)?this.memEstimateTextureAdded(t):0)),0);const z=!!S.material.hasParametersFromSource,W="blend"!==S.material.alphaMode&&S.material.metallicRoughness.baseColorFactor[3]>=1,$=new I3SMeshView3D_qe(e,m,L,this._getInvalidRendererVersion(),s.attributeInfo,{hasParametersFromSource:z,isOpaque:W},k);s.meta=$,!this._hasTextures&&t.requiredTextures.some((({usage:e})=>0!=(19&e)))&&(this._hasTextures=!0),this._hasData=!0,this._hasColors=this._hasColors||I,this._hasTextures=this._hasTextures||!!e.resources.texture,this.notifyChange("hasTexturesOrVertexColors");const K=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering($),q]).then((([t,s])=>(Object(maybe.l)(t)&&t.updateObjectVisibility($.objectHandle,!1),this._safeReschedule((()=>{const i=this._addTasks.get(e.index);if(!i)return;if(Object(maybe.l)(this._labeler)&&this._addMetaToLabeler(this._labeler,$),this._addNodeMeta(e.index,$),i.meta=null,this.suspended)return void this._removeNodeStageData(e.index,this.elevationOffset);g.setObjectVisibility(L,1),Object(maybe.l)(t)&&t.updateObjectVisibility($.objectHandle,!0),$.attributeInfo=i.attributeInfo;const s=$.cachedRendererVersion!==this._rendererVersion,r=K!==this.slicePlaneEnabled;this._setObjectSymbolColors($);const o=this._applyFiltersToNode($);(s||Object(maybe.l)(t)&&(r||o))&&this._addOrUpdateEdgeRendering($),this._visibleGeometryChanged($),this._highlights.objectCreated($),this._updateMaterial($),this._setNewNodeOpacity($),Object(maybe.l)(this._treeDebugger)&&this._treeDebugger.update()}),i)))).catch((e=>{throw Object(maybe.l)(s.meta)&&(this._cacheGPUData(s.meta),s.meta=null),e}))}_addNodeMeta(e,t){if(this._removeNodeStageData(e,this.elevationOffset,this._nodeId2MetaReloading),this._nodeId2Meta.has(e)){Be.error("Removing duplicated node");const t=this._nodeId2Meta.get(e);Object(maybe.l)(t)&&this._deleteComponentObject(t)}Object(maybe.l)(t)&&(t.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&lt(t.cachedEdgeMaterials,0)),this._nodeId2Meta.set(e,t)}_safeReschedule(e,t){return Object(promiseUtils.w)(t),this._controller.reschedule(e,t)}_materialParameters(e,t){const i=e.params.material,s=t.some((e=>"uvRegion"===e.name)),r=t.some((e=>"normalCompressed"===e.name)),o=tt(i);return{geometryParams:this._getGeometryParameters({hasTexture:o,hasNormals:r,hasRegions:s}),material:i}}_initMaterialAndTextures(e,t,i,s){const r=this._stage.renderView,o=i.map((e=>Object(I3SMaterialUtil.b)(e,t,s,r)));this._stage.addMany(o);let a=null;return this._collection.updateMaterial(e,(e=>{a=Object(I3SMaterialUtil.a)(e,t,o,i,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference}),this._updateMaterialOverlay(e)})),{textures:o,texturePromise:a}}_getGeometryParameters(e){return{textureCoordinates:e.hasTexture?e.hasRegions?2:1:0,colors:this._hasVertexColors,normals:e.hasNormals&&!this._isIntegratedMesh}}_addData(e,t,i){let s=this._addTasks.get(e.index);return s?s.attributeInfo=t:(s={...Object(promiseUtils.g)(),attributeInfo:t,meta:null},this._addTasks.set(e.index,s),i().then(s.resolve,s.reject).then((()=>this._addTasks.delete(e.index))).catch((t=>{throw this._addTasks.delete(e.index),t}))),s.promise}_clearAddTasks(){this._addTasks.forEach((e=>{Object(maybe.l)(e.meta)&&(this._cacheGPUData(e.meta),e.meta=null)})),this._addTasks.clear()}_clippingAreaChanged(){const e=this.view.renderSpatialReference,t=this.i3slayer.spatialReference,i=Object(aaBoundingRect.l)();this._renderClippingArea=Object(extentUtils.b)(this.view.clippingArea,i,e)?i:null;const s=Object(aaBoundingRect.l)();this._layerClippingArea=Object(extentUtils.b)(this.view.clippingArea,s,t)?s:null,this._filterChange(),this._controller&&this._controller.updateClippingArea(this.view.clippingArea),this._isIntegratedMesh&&this._modificationsChanged()}_geometryFilterChange(){this._controller.geometryFilterChanged(this.hasGeometryFilter)}get hasGeometryFilter(){return!1}_filterChange(){this._applyFilters(!1)}_applyFilters(e){this._filters=this.getFilters(),e?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach((e=>{Object(maybe.l)(e)&&this._applyFiltersToNode(e)&&(this._addOrUpdateEdgeRendering(e),this._visibleGeometryChanged(e))}))}getFilters(){const e=[],t=this._renderClippingArea;return Object(maybe.l)(t)&&e.push(((e,i)=>this._boundingRectFilter(e,i,t))),e}addSqlFilter(e,t,i){if(Object(maybe.l)(t)){const s=t.fieldNames;e.push(((e,r)=>this._sqlFilter(e,r,t,s,i)))}}_sqlFilter(e,t,i,s,r){const o={},a=this._createLayerGraphic(o),n=this.i3slayer.objectIdField,l=t.featureIds,h=Object(maybe.l)(t.attributeInfo)&&t.attributeInfo.attributeData;s.every((e=>null!=h[e]||e===n))&&Object(I3SUtil.j)(e,l,(e=>{o[n]=l[e];for(const i of s)i!==n&&(o[i]=Object(I3SUtil.n)(h[i],e));try{return i.testFeature(a)}catch(t){return r(t),!1}}))}_boundingRectNodeTest(e,t){return Object(projection.o)(e.node.mbs,this._controller.crsIndex,et,this.view.renderSpatialReference),Object(I3SUtil.s)(t,et)}_boundingRectFeatureTest(e,t,i){return this._collection.getComponentAabb(e.objectHandle,t,Ke),Object(aaBoundingBox.F)(Ke,Je),Object(aaBoundingRect.w)(i,Je)}_boundingRectFilter(e,t,i){const s=this._collection,r=this._boundingRectNodeTest(t,i);if(3===r)return;if(0===r)return void(e.length=0);const o=s.getComponentCount(t.objectHandle);if(o.invisible+o.visible!==t.featureIds.length)return;const a=this._transformClippingArea(Qe,i,t.objectHandle);Object(I3SUtil.j)(e,t.featureIds,(e=>this._boundingRectFeatureTest(t,e,a)))}_transformClippingArea(e,t,i){const s=this._collection.getObjectTransform(i),r=s.position,o=s.rotationScale;return e[0]=(t[0]-r[0])/o[0],e[1]=(t[1]-r[1])/o[4],e[2]=(t[2]-r[0])/o[0],e[3]=(t[3]-r[1])/o[4],e}_addOrUpdateEdgeRendering(e,t=!0){if(Object(maybe.k)(this._edgeView))return Promise.resolve(null);const i=e.objectHandle,s=this._edgeView.hasObject(i),{hasEdges:r,perFeatureEdgeMaterials:o}=this._getFilteredEdgeMaterials(e),a={slicePlaneEnabled:this.slicePlaneEnabled};return r?s?(this.nodeCrossfadingEnabled&&lt(o,this.getNodeOpacity(e)),this._edgeView.updateAllComponentMaterials(i,o,a,t),this._edgeView.updateObjectVisibility(i,!0),Promise.resolve(this._edgeView)):this._collection.addEdges(i,this._edgeView,o,a).then((()=>this._edgeView)):(s&&this._edgeView.removeObject(i),Promise.resolve(null))}_removeEdgeRendering(e){Object(maybe.l)(this._edgeView)&&this._edgeView.hasObject(e.objectHandle)&&this._edgeView.removeObject(e.objectHandle)}_applyFiltersToNode(e){return!!this._applyFiltersToNodeComponents(e)&&(Object(maybe.l)(this._labeler)&&this._labeler.applyFilterChange(e),!0)}_applyFiltersToNodeComponents(e){const t=this._collection,i=0===t.getComponentCount(e.objectHandle).invisible;if(t.setAllComponentVisibilities(e.objectHandle,"all"),0===this._filters.length)return e.filteredIds=null,!i;if(this._updateCachedFilteredIds(e),e.filteredIds===e.featureIds)return!i;const s=this._computeFilteredComponentIndices(e);return t.setAllComponentVisibilities(e.objectHandle,s),!0}_updateCachedFilteredIds(e){null!=e.filteredIds&&e.appliedFilters===this._filters||(e.filteredIds=this._computeFilteredIds(e),e.appliedFilters=this._filters)}_computeFilteredIds(e){const t=e.featureIds.slice();for(const i of this._filters)if(i(t,e),0===t.length)break;return t.length===e.featureIds.length?e.featureIds:t}_computeFilteredComponentIndices(e){const t=new Array;return e.featureIds.forEach(((i,s)=>{e.filteredIds[t.length]===i&&t.push(s)})),t}_removeAllNodeDataFromStage(e=this.elevationOffset){this._nodeId2Meta.forEach(((t,i)=>this._removeNodeStageData(i,e))),this._nodeId2MetaReloading.forEach(((t,i)=>this._removeNodeStageData(i,e,this._nodeId2MetaReloading)))}removeNode(e){const t=this.elevationOffset;this._removeNodeStageData(e,t),this._removeNodeStageData(e,t,this._nodeId2MetaReloading)}_removeNodeStageData(e,t,i=this._nodeId2Meta){const s=i.get(e);Object(maybe.k)(s)?i.delete(e):(this._collection.setObjectVisibility(s.objectHandle,0),this._visibleGeometryChanged(s),this._removeEdgeRendering(s),Object(maybe.l)(this._labeler)&&this._labeler.removeNodeMeta(s),i.delete(e),this._highlights.objectDeleted(s),i===this._nodeId2Meta?(this._cacheGPUData(s,t),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(s)):this._deleteComponentObject(s),Object(maybe.l)(this._treeDebugger)&&this._treeDebugger.update())}_deleteComponentObject(e){if(Object(maybe.l)(this._edgeView)&&this._edgeView.removeObject(e.objectHandle),this.memEstimateGeometryRemoved(e.objectHandle),this._collection.destroyObject(e.objectHandle),e.textures)for(const t of e.textures)this.memEstimateTextureRemoved(t),this._stage.remove(t)}updateNodeState(e,t){const i=this._nodeId2Meta.get(e);Object(maybe.l)(i)&&this._collection.updateMaterial(i.objectHandle,(e=>e.polygonOffsetEnabled=0===t))}_invalidateAllSymbols(){this._rendererVersion=Object(I3SUtil.a)(this._rendererVersion,1),this._controller&&this._controller.requestUpdate()}_getInvalidRendererVersion(){return Object(I3SUtil.a)(this._rendererVersion,-1)}async _rendererChange(e){if(this._currentRenderer=e,this.notifyChange("rendererTextureUsage"),this._rendererVersion=Object(I3SUtil.a)(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,this._invalidateAllSymbols(),e&&(this._rendererFields=await e.getRequiredFields(this.i3slayer.fieldsIndex)),this._updateSymbologyFields(),!this._arcade&&e&&"arcadeRequired"in e&&e.arcadeRequired&&(this._arcade=await Object(arcadeOnDemand.e)()),e&&"visualVariables"in e&&e.visualVariables)for(const t of e.visualVariables)"color"===t.type?this._colorVariable=t:"opacity"===t.type?this._opacityVariable=t:Be.warn(`Unsupported visual variable type for 3D Object Scene Services: ${t.type}`);if(e)for(const t of e.getSymbols())"mesh-3d"!==t.type&&Be.error(`Symbols of type '${t.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()}_getCachedEdgeMaterials(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedEdgeMaterials}_getSymbolColors(e){this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e);const t=e.cachedSymbology;return(e,i)=>{const s=5*e;Object(vec4.l)(i.externalColor,t[s+0]/255,t[s+1]/255,t[s+2]/255,t[s+3]/255),i.externalColorMixMode=15&t[s+4],i.castShadows=0!=(16&t[s+4]),i.pickable=0!=(32&t[s+4])}}_getSymbolInfo(e,t){const i=e&&e.getSymbol(t,{arcade:this._arcade});if(!(i instanceof Symbol3D.a))return null;const s=i.id;if(this._symbolInfos.has(s))return this._symbolInfos.get(s);const r=Object(I3SUtil.q)(i);return this._symbolInfos.set(s,r),r}_setSymbologyOverride(e,t){this._symbologyOverride!==e&&(this._symbologyOverride=e,this._symbologyOverrideFields=t,this._invalidateAllSymbols(),this._updateSymbologyFields())}_updateSymbologyFields(){this._symbologyFields=Object(maybe.l)(this._symbologyOverrideFields)&&this._symbologyOverrideFields.length>0?Object(maybe.l)(this._rendererFields)&&this._rendererFields.length>0?Object(fieldUtils.j)(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields}_updateCachedRendererData(e){if(e.cachedRendererVersion=this._rendererVersion,!this._hasSymbolColors)return;const t=this._tmpAttributeOnlyGraphic,i={};t.attributes=i;const s=this._currentRenderer,r=Object(maybe.l)(e.attributeInfo)&&e.attributeInfo.attributeData,o=null!=e.featureIds?this.i3slayer.objectIdField:null,a=null!=r&&Object(maybe.l)(this._symbologyFields)&&this._symbologyFields.length>0,n=a?[]:null,l=a?[]:null;if(a&&Object(maybe.l)(this._symbologyFields))for(const d of this._symbologyFields){const e=r[d];e&&(n.push(d),l.push(e))}e.cachedSymbology||(e.cachedSymbology=new Uint8Array(5*e.featureIds.length));const c={color:Ye,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null},u=this.fullOpacity,_=this.nodeCrossfadingEnabled?this.getNodeOpacity(e):u;let m=null,g=2,p=I3SUtil.w,f=0;for(let y=0;y<e.featureIds.length;y++){if(null!=o&&(i[o]=e.featureIds[y]),a)for(let e=0;e<n.length;e++)i[n[e]]=Object(I3SUtil.n)(l[e],y);const r=this._getSymbolInfo(s,t);let u=null,b=null;if(s&&"visualVariables"in s){if(this._colorVariable){const e=Object(visualVariableUtils.getColor)(this._colorVariable,t,{color:Ze,arcade:this._arcade});e&&(u=Ye,u[0]=e.r/255,u[1]=e.g/255,u[2]=e.b/255,this._opacityVariable||null===e.a||(b=e.a))}this._opacityVariable&&(b=Object(visualVariableUtils.getOpacity)(this._opacityVariable,t,{arcade:this._arcade}))}if(r&&r.material){const e=r.material;u=Object(maybe.k)(u)||Object(maybe.k)(b)?Object(graphicUtils.i)(u,b,e.color,e.alpha,ke,Ye):Object(graphicUtils.i)(u,b,null,null,ke,Ye)}if(Object(maybe.k)(u)&&(u=Ye,u[0]=1,u[1]=1,u[2]=1,u[3]=1),c.pickable=!0,c.castShadows=!r||r.castShadows,c.colorMixMode=r&&r.material?r.material.colorMixMode:1,c.edgeMaterial=r?r.edgeMaterial:null,Object(maybe.l)(this._symbologyOverride)&&(c.color=u,this._symbologyOverride(t,c),u=c.color),Object(maybe.l)(c.edgeMaterial)){const t=u[3]<=0?0:u[3]>=1&&(e.material.isOpaque||3===c.colorMixMode)?2:1;c.edgeMaterial===m&&t===g||(p={...c.edgeMaterial,opacity:_,objectTransparency:t},m=c.edgeMaterial,g=t),e.cachedEdgeMaterials[y]=p}else e.cachedEdgeMaterials[y]=I3SUtil.w;e.cachedSymbology[f+0]=Math.round(255*u[0]),e.cachedSymbology[f+1]=Math.round(255*u[1]),e.cachedSymbology[f+2]=Math.round(255*u[2]),e.cachedSymbology[f+3]=Math.round(255*u[3]),e.cachedSymbology[f+4]=c.colorMixMode|+c.castShadows<<4|+c.pickable<<5,f+=5}}_getFilteredEdgeMaterials(e){const t=this._getCachedEdgeMaterials(e);if(this.nodeCrossfadingEnabled||lt(t,this.fullOpacity),Object(maybe.k)(e.filteredIds))return{hasEdges:t.some((e=>e!==I3SUtil.w)),perFeatureEdgeMaterials:t};let i=0,s=!1;const r=t.map(((t,r)=>e.featureIds[r]!==e.filteredIds[i]?I3SUtil.w:(s=s||t!==I3SUtil.w,i++,t)));return{hasEdges:s,perFeatureEdgeMaterials:r}}_setObjectSymbolColors(e){if(!this._hasSymbolColors)return;const t=e.objectHandle,i=this._getSymbolColors(e);this._collection.setComponentData(t,i),this._stage.renderView.requestRender()}_reloadAll(e=this.elevationOffset){this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()}_opacityChange(e){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading(),this._nodeId2Meta.forEach((t=>{Object(maybe.k)(t)||(this._collection.updateMaterial(t.objectHandle,(t=>t.objectOpacity=e)),lt(t.cachedEdgeMaterials,e),this._updateEdgeRendering(t))}))}_updateMaterial(e){this._collection.updateMaterial(e.objectHandle,(e=>{e.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled,e.usePBR=this._usePBR(),this._updateMaterialOverlay(e)}))}_updateMaterialOverlay(e){}_updateEngineObject(e){this._setObjectSymbolColors(e),this._applyFiltersToNode(e),this._addOrUpdateEdgeRendering(e),this._visibleGeometryChanged(e)}_slicePlaneEnabledChange(e){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=e),Object(maybe.l)(this._labeler)&&(this._labeler.slicePlaneEnabled=e),this._nodeId2Meta.forEach((t=>{Object(maybe.k)(t)||(this._collection.updateMaterial(t.objectHandle,(t=>{t.commonMaterialParameters.slicePlaneEnabled=e})),this._updateEdgeRendering(t,!1))}))}_updatePBR(){this._nodeId2Meta.forEach((e=>{Object(maybe.k)(e)||this._collection.updateMaterial(e.objectHandle,(e=>{e.usePBR=this._usePBR()}))})),this._hasLoadedPBRTextures=!0}_usePBR(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}_updateEdgeRendering(e,t=!0){Object(maybe.l)(this._edgeView)&&this._edgeView.hasObject(e.objectHandle)&&this._addOrUpdateEdgeRendering(e,t)}_forAllNodes(e){this._nodeId2Meta.forEach(e)}_forAllFeatures(e,t,i=0){Object(MapUtils.c)(this._nodeId2Meta,(s=>{if(Object(maybe.k)(s))return!1;if(Object(maybe.l)(t))switch(t(s)){case 0:return!0;case 2:return!1}let r=1;switch(i){case 1:r=this._forAllFeaturesOfNode(s,e);break;case 0:r=this._forVisibleFeaturesOfNode(s,e);break;case 2:r=this._forAllFeaturesOfNodeInClippingArea(s,e)}return 0===r}))}_forAllFeaturesOfNode(e,t){let i=1;const s=e.featureIds;for(let r=0;r<s.length;r++)if(i=t(s[r],r,e),0===i)return i;return i}_forVisibleFeaturesOfNode(e,t){let i=1;const s=e.featureIds;return this._collection.forEachVisibleComponent(e.objectHandle,(r=>(i=t(s[r],r,e),1===i))),i}_forAllFeaturesOfNodeInClippingArea(e,t){if(Object(maybe.k)(this._renderClippingArea))return this._forAllFeaturesOfNode(e,t);const i=this._boundingRectNodeTest(e,this._renderClippingArea);if(0===i)return 1;if(3===i)return this._forAllFeaturesOfNode(e,t);const r=e.featureIds,o=e.objectHandle,a=Object(I3SUtil.o)(this._renderClippingArea,this._collection.getObjectTransform(o));for(let n=0;n<r.length;n++){if(!this._boundingRectFeatureTest(e,n,a))continue;const i=t(r[n],n,e);if(0===i)return i}return 1}_createAttributes(e,t){const i={};null!=t.featureIds&&(i[this._getObjectIdField()]=t.featureIds[e]);const s=Object(maybe.l)(t.attributeInfo)&&t.attributeInfo.attributeData;if(Object(maybe.l)(s))for(const r of Object.keys(s))i[r]=Object(I3SUtil.n)(s[r],e);return i}_createGraphic(e,t){return this._createLayerGraphic(this._createAttributes(e,t))}highlight(e){const t=this._highlights;if("number"==typeof e||e instanceof Graphic.a?e=[e]:e instanceof Collection.a&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof Graphic.a){const i=e,s=this.i3slayer.fieldsIndex,r=this._getObjectIdField(),o=i.map((e=>Object(attributeUtils.a)(s,e.attributes,r))),{set:a,handle:n}=t.acquireSet();return t.setFeatureIds(a,o),n}if("number"==typeof e[0]){const i=e,{set:s,handle:r}=t.acquireSet();return t.setFeatureIds(s,i),r}}return nt}_visibleGeometryChanged(e){this._elevationProvider&&(this._elevationProvider.objectChanged(e.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=Object(scheduling.b)((()=>{this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle=null}))))}get performanceInfo(){const e={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB"};return Object(maybe.l)(this._memCache)&&(e.MemCache=Math.round(100*this._memCache.hitRate)+"% hit"),this._controller&&(this._idbCacheEnabled&&(e.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e}get test(){const e=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const t=[];return e._forAllFeatures((e=>(t.push(e),1)),null,0),t.sort(((e,t)=>e-t)),t},get numNodes(){return e._nodeId2Meta.size}}}getNodeOpacityByIndex(e){const t=this._nodeId2Meta.get(e);return this.getNodeOpacity(t)}getNodeOpacity(e){return Object(maybe.l)(e)?this._collection.getMaterial(e.objectHandle).objectOpacity:0}isNodeFullyFadedIn(e){return this._crossfadeHelper.isNodeFullyFadedIn(e)}getNodeCrossfadeMetaData(e){return this._nodeId2Meta.get(e)}markNodeToRemove(e){this._controller&&this._controller.markNodeToRemove(e)}removeMarkedNodes(){this._controller&&this._controller.removeMarkedNodes()}foreachCrossfadeNode(e){this._nodeId2Meta.forEach(((t,i)=>e(i,t)))}fadeNode(e,t,i){if(!this.nodeCrossfadingEnabled)return;const s=this._nodeId2Meta.get(e);Object(maybe.l)(s)&&this._crossfadeHelper.fadeNode(e,s,t,i)}setNodeOpacityByIndex(e,t){const i=this._nodeId2Meta.get(e);Object(maybe.l)(i)&&this._setNodeOpacity(i,t)}_setNodeOpacity(e,t){this._collection.updateMaterial(e.objectHandle,(e=>e.objectOpacity=t)),this._setNodeEdgeOpacity(e,t)}_setNodeEdgeOpacity(e,t){if(!Object(maybe.l)(this._edgeView)||!e.cachedEdgeMaterials)return;lt(e.cachedEdgeMaterials,t);const i=e.objectHandle;this._edgeView.hasObject(i)&&this._edgeView.updateAllComponentOpacities(i,t)}get hasModifications(){return this._isIntegratedMesh&&Object(maybe.l)(this._layerClippingArea)||this._modifications&&this._modifications.length>0}updateNodeModificationStatus(e){const t=e.length;if(!this.hasModifications||t<=0||!0!==this._i3sWasmLoaded)return;const i=this.i3slayer.uid,s=function at(e){if(0===e.length)return null;const t=10*e.length,i=new Float64Array(t);return e.forAll(((e,t)=>{let s=e.serviceObb;Object(maybe.k)(s)&&(s=Xe,Object(vec3.m)(s.center,e.mbs),s.halfSize[0]=s.halfSize[1]=s.halfSize[2]=e.mbs[3]);const r=10*t;i[r+0]=s.center[0],i[r+1]=s.center[1],i[r+2]=s.center[2],i[r+3]=s.halfSize[0],i[r+4]=s.halfSize[1],i[r+5]=s.halfSize[2],i[r+6]=s.quaternion[0],i[r+7]=s.quaternion[1],i[r+8]=s.quaternion[2],i[r+9]=s.quaternion[3]})),i}(e);if(Object(maybe.l)(s)){const t={context:i,buffer:s.buffer};Object(SceneLayerWorker.filterObbsForModificationsSync)(t);const r=new Float64Array(s.buffer);e.forAll(((e,t)=>{const i=r[t],s=Object(SceneLayerWorker.interpretObbModificationResults)(i);e.imModificationImpact=s,0!==s&&this._controller.invalidateGeometryVisibility(e.index)}))}}notifyUpdate(){this.notifyChange("updating")}notifyLODUpdate(){this._controller.notifyLODUpdate()}isUpdating(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||Object(maybe.l)(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||this._asyncModuleLoading>0}};return Object(tslib_es6.a)([Object(property.b)()],o.prototype,"_hasLoadedPBRTextures",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"_asyncModuleLoading",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"view",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"i3slayer",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"_controller",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"_labeler",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"updating",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"suspended",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"holeFilling",void 0),Object(tslib_es6.a)([Object(property.b)(updatingProperties.a)],o.prototype,"updatingProgress",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],o.prototype,"updatingProgressValue",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],o.prototype,"hasTexturesOrVertexColors",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],o.prototype,"rendererTextureUsage",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],o.prototype,"elevationOffset",null),Object(tslib_es6.a)([Object(property.b)({type:Boolean})],o.prototype,"slicePlaneEnabled",void 0),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"supportedTextureEncodings",null),Object(tslib_es6.a)([Object(property.b)()],o.prototype,"uncompressedTextureDownsamplingEnabled",null),Object(tslib_es6.a)([Object(property.b)({type:[SceneModification.a]})],o.prototype,"_modifications",void 0),o=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.I3SMeshView3D")],o),o},Ke=Object(aaBoundingBox.h)(),Je=Object(aaBoundingRect.l)(),Qe=Object(aaBoundingRect.l)(),Xe=Object(orientedBoundingBox.e)(),Ye=[0,0,0,0],Ze=new Color.a([0,0,0,0]),et=[0,0,0,0];function tt(e){const t=e.metallicRoughness;return t&&t.baseColorTextureId>=0||t&&t.metallicRoughnessTextureId>=0||e.normalTextureId>=0||e.emissiveTextureId>=0||e.occlusionTextureId>=0}function st(e){return Object(maybe.l)(e)&&Object(typedArrayUtil.c)(e.data)}function rt(e,t){let i=1024+e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)+e.positionData.data.byteLength+e.positionData.indices.byteLength;if(Object(maybe.l)(t))for(const s of t)Object(maybe.l)(s)&&Object(typedArrayUtil.c)(s.data)&&(i+=s.data.byteLength);return i}function ot(e,t){return t.byteSize>104857600?(Be.warn(`Node is too big to store in IndexedDB cache: ${e.id} (${t.byteSize} bytes)`),!1):t.byteSize>0}const nt={remove(){},pause(){},resume(){}};function lt(e,t){e.forEach((e=>e.opacity=t))}},"./node_modules/@arcgis/core/views/3d/layers/IntegratedMeshLayerView3D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return f}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_Graphic_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_I3SMeshView3D_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/I3SMeshView3D.js"),_LayerView3D_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/LayerView3D.js"),_support_updatingProperties_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/updatingProperties.js"),_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js");let v=class extends(Object(_I3SMeshView3D_js__WEBPACK_IMPORTED_MODULE_10__.a)(Object(_LayerView3D_js__WEBPACK_IMPORTED_MODULE_11__.a)(_layers_LayerView_js__WEBPACK_IMPORTED_MODULE_13__.a))){constructor(){super(...arguments),this.type="integrated-mesh-3d",this.lodFactor=1,this._elevationContext="im",this._isIntegratedMesh=!0,this._supportsLabeling=!1,this.drapeTargetType=1,this._overlayTexOffset=Object(_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_8__.g)(-1,-1,-1,-1),this._overlayTexScale=Object(_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_8__.e)(),this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}get progressiveLoadFactor(){return this.lodFactor>=1?.2:1}setDrapingTextures(e){this._clearDrapingTexture(0),this._clearDrapingTexture(1);for(const t of e){const e=t.index,o=t.extent,a=t.needsColorWithoutRasterImage?t.getValidTarget(1):t.hasDrapedFeatureSource?t.getValidTarget(0):null;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(a)&&Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.d)(o)>0){this._overlayTexOffset[2*e]=-o[0]/Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.B)(o),this._overlayTexOffset[2*e+1]=-o[1]/Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.u)(o),this._overlayTexScale[2*e]=1/Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.B)(o),this._overlayTexScale[2*e+1]=1/Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_9__.u)(o);const r=t.getValidTarget(2),i=t.getValidTarget(3);this._overlayColor=a.getTexture(),this._overlayHighlight=r?r.getTexture():null,this._overlayNormal=i?i.getTexture():null}}this._forAllNodes((e=>Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(e)&&this._collection.updateMaterial(e.objectHandle,(e=>this._updateMaterialOverlay(e)))))}_clearDrapingTexture(e){this._overlayTexOffset[2*e]=-1,this._overlayTexOffset[2*e+1]=-1,this._overlayTexScale[2*e]=0,this._overlayTexScale[2*e+1]=0,this._overlayColor=null,this._overlayHighlight=null,this._overlayNormal=null}_updateMaterialOverlay(e){e.overlayColor=this._overlayColor,e.overlayHighlight=this._overlayHighlight,e.overlayNormal=this._overlayNormal,e.overlayTexOffset=this._overlayTexOffset,e.overlayTexScale=this._overlayTexScale}initialize(){this.updatingHandles.add(this.layer,"modifications",(()=>this._loadModifications()),2)}_createLayerGraphic(){const e=new _Graphic_js__WEBPACK_IMPORTED_MODULE_1__.a;return e.layer=this.layer,e.sourceLayer=this.layer,e}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}_loadModifications(){if(this.handles.remove("modifications"),Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.k)(this.layer.modifications))return void(this._modifications=[]);const e=this.layer.modifications;this.handles.add(this.updatingHandles.addOnCollectionChange(e,(()=>this._modifications=e.toArray()),2),"modifications")}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)()],v.prototype,"layer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)({aliasOf:"layer"})],v.prototype,"i3slayer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)()],v.prototype,"suspended",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)(_support_updatingProperties_js__WEBPACK_IMPORTED_MODULE_12__.a)],v.prototype,"updatingProgress",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)({readOnly:!0,aliasOf:"_controller.updatingProgress"})],v.prototype,"updatingProgressValue",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.integratedMesh.lodFactor"})],v.prototype,"lodFactor",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_3__.b)({readOnly:!0})],v.prototype,"progressiveLoadFactor",null),v=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_7__.a)("esri.views.3d.layers.SceneLayerView3D")],v);const f=v},"./node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"destroyContext",(function(){return SceneLayerWorker_a})),__webpack_require__.d(__webpack_exports__,"dracoDecompressPointCloudData",(function(){return SceneLayerWorker_o})),__webpack_require__.d(__webpack_exports__,"filterObbsForModifications",(function(){return SceneLayerWorker_s})),__webpack_require__.d(__webpack_exports__,"filterObbsForModificationsSync",(function(){return SceneLayerWorker_m})),__webpack_require__.d(__webpack_exports__,"initialize",(function(){return SceneLayerWorker_h})),__webpack_require__.d(__webpack_exports__,"interpretObbModificationResults",(function(){return SceneLayerWorker_b})),__webpack_require__.d(__webpack_exports__,"process",(function(){return SceneLayerWorker_n})),__webpack_require__.d(__webpack_exports__,"setLegacySchema",(function(){return SceneLayerWorker_i})),__webpack_require__.d(__webpack_exports__,"setModifications",(function(){return SceneLayerWorker_f})),__webpack_require__.d(__webpack_exports__,"setModificationsSync",(function(){return SceneLayerWorker_l})),__webpack_require__.d(__webpack_exports__,"test",(function(){return SceneLayerWorker_p}));var maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),typedArrayUtil=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),assets=__webpack_require__("./node_modules/@arcgis/core/assets.js");function I3SModule_i(t){return Object(assets.b)(`esri/libs/i3s/${t}`)}let I3SModule_n,SceneLayerWorker_u,c;async function SceneLayerWorker_n(e){await SceneLayerWorker_h();const t=[e.geometryBuffer];return{result:SceneLayerWorker_y(e,t),transferList:t}}async function SceneLayerWorker_o(e){var r;await SceneLayerWorker_h();const n=[e.geometryBuffer],{geometryBuffer:o}=e,s=o.byteLength,f=c._malloc(s),i=new Uint8Array(c.HEAPU8.buffer,f,s);i.set(new Uint8Array(o));const a=c.dracoDecompressPointCloudData(f,i.byteLength);if(c._free(f),a.error.length>0)throw`i3s.wasm: ${a.error}`;const u=(null==(r=a.featureIds)?void 0:r.length)>0?Object(typedArrayUtil.m)(a.featureIds):null,l=Object(typedArrayUtil.m)(a.positions);return u&&n.push(u.buffer),n.push(l.buffer),{result:{positions:l,featureIds:u},transferList:n}}async function SceneLayerWorker_s(e){await SceneLayerWorker_h(),SceneLayerWorker_m(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function SceneLayerWorker_f(e){await SceneLayerWorker_h(),SceneLayerWorker_l(e)}async function SceneLayerWorker_i(e){await SceneLayerWorker_h(),c.setLegacySchema(e.context,e.jsonSchema)}function SceneLayerWorker_a(e){SceneLayerWorker_d(e)}function SceneLayerWorker_l(e){const t=e.modifications,r=c._malloc(8*t.length),n=new Float64Array(c.HEAPU8.buffer,r,t.length);for(let o=0;o<t.length;++o)n[o]=t[o];c.setModifications(e.context,r,t.length,e.isGeodetic),c._free(r)}function SceneLayerWorker_y(r,n){if(!c)return null;const{context:o,localOrigin:s,globalTrafo:f,mbs:i,obb:a,elevationOffset:u,geometryBuffer:l,geometryDescriptor:y,indexToVertexProjector:b,vertexToRenderProjector:m}=r,d=c._malloc(l.byteLength),p=c._malloc(33*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(c.HEAPU8.buffer,d,l.byteLength);g.set(new Uint8Array(l));const w=new Float64Array(c.HEAPU8.buffer,p,33);E(w,s);let A=w.byteOffset+3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A);E(_,f),A+=16*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,i),A+=4*w.BYTES_PER_ELEMENT,Object(maybe.l)(a)&&(_=new Float64Array(w.buffer,A),E(_,a.center),A+=3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,a.halfSize),A+=3*w.BYTES_PER_ELEMENT,_=new Float64Array(w.buffer,A),E(_,a.quaternion));const L=y,T={isDraco:!1,isLegacy:!1,color:r.layouts.some((e=>e.some((e=>"color"===e.name)))),normal:r.needNormals&&r.layouts.some((e=>e.some((e=>"normalCompressed"===e.name)))),uv0:r.layouts.some((e=>e.some((e=>"uv0"===e.name)))),uvRegion:r.layouts.some((e=>e.some((e=>"uvRegion"===e.name)))),featureIndex:L.featureIndex},I=c.process(o,!!r.obb,d,g.byteLength,L,T,p,u,b,m,r.normalReferenceFrame);if(c._free(p),c._free(d),I.error.length>0)throw`i3s.wasm: ${I.error}`;if(I.discarded)return null;const P=I.componentOffsets.length>0?Object(typedArrayUtil.m)(I.componentOffsets):null,U=I.featureIds.length>0?Object(typedArrayUtil.m)(I.featureIds):null,B=Object(typedArrayUtil.m)(I.interleavedVertedData).buffer,F=1===I.indicesType?Object(typedArrayUtil.m)(new Uint16Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/2)):Object(typedArrayUtil.m)(new Uint32Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/4)),v=Object(typedArrayUtil.m)(I.positions),x=1===I.positionIndicesType?Object(typedArrayUtil.m)(new Uint16Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/2)):Object(typedArrayUtil.m)(new Uint32Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/4)),M={layout:r.layouts[0],interleavedVertexData:B,indices:F,hasColors:I.hasColors,hasModifications:I.hasModifications,positionData:{data:v,indices:x}};return U&&n.push(U.buffer),P&&n.push(P.buffer),n.push(B),n.push(F.buffer),n.push(v.buffer),n.push(x.buffer),{componentOffsets:P,featureIds:U,transformedGeometry:M,obb:I.obb}}function SceneLayerWorker_b(e){return 0===e?0:1===e?1:2===e?2:3}function SceneLayerWorker_m(e){const{context:t,buffer:r}=e,n=c._malloc(r.byteLength),o=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(c.HEAPU8.buffer,n,o),f=new Float64Array(r);s.set(f),c.filterOBBs(t,n,o),f.set(s),c._free(n)}function SceneLayerWorker_d(e){c&&c.destroy(e)}function E(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}function SceneLayerWorker_h(){return c?Promise.resolve():(SceneLayerWorker_u||(SceneLayerWorker_u=function I3SModule_t(){return I3SModule_n||(I3SModule_n=new Promise((e=>__webpack_require__.e(162).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/chunks/i3s.js")).then((e=>e.i)).then((({default:t})=>{const n=t({locateFile:I3SModule_i,onRuntimeInitialized:()=>e(n)});delete n.then})))).catch((e=>Promise.reject(e)))),I3SModule_n}().then((e=>{c=e,SceneLayerWorker_u=null}))),SceneLayerWorker_u)}const SceneLayerWorker_p={transform:SceneLayerWorker_y,destroy:SceneLayerWorker_d}},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SGeometryUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return i})),__webpack_require__.d(__webpack_exports__,"b",(function(){return l})),__webpack_require__.d(__webpack_exports__,"c",(function(){return u}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingBox.js");function i(t,r,n,a){const m=r.getComponentAabb(n,t,p),s=r.getObjectTransform(n);for(let c=0;c<8;++c)b[0]=1&c?m[0]:m[3],b[1]=2&c?m[1]:m[4],b[2]=4&c?m[2]:m[5],Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_1__.z)(b,b,s.rotationScale),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_1__.h)(b,b,s.position),a[3*c]=b[0],a[3*c+1]=b[1],a[3*c+2]=b[2];return a}function u(e,o,r){const a=new Float64Array(24);return u=>{let l=u.meta.featureExtents;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.k)(l)){l=new Float64Array(6*u.meta.featureIds.length),u.meta.featureExtents=l;for(let t=0;t<l.length;t+=6)l[t]=Number.POSITIVE_INFINITY}const p=new Float64Array(l.buffer,6*u.index*Float64Array.BYTES_PER_ELEMENT,6);return p[0]===Number.POSITIVE_INFINITY&&(i(u.index,r,u.meta.objectHandle,a),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_3__.p)(a,o,0,a,e,0,8)?(Object(_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.B)(p,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.a),Object(_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.n)(p,a,0,8)):Object(_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.B)(p,_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.c)),p}}function l(t,r,n,a){const m=r.getComponentAabb(n,t,p),s=r.getObjectTransform(n);a[0]=0,a[1]=0,a[2]=0;for(let c=0;c<8;++c)b[0]=1&c?m[0]:m[3],b[1]=2&c?m[1]:m[4],b[2]=m[5],Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_1__.z)(b,b,s.rotationScale),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_1__.h)(b,b,s.position),a[0]+=b[0],a[1]+=b[1],a[2]+=b[2];return a[0]/=8,a[1]/=8,a[2]/=8,a}const p=Object(_geometry_support_aaBoundingBox_js__WEBPACK_IMPORTED_MODULE_4__.h)(),b=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_2__.f)()}}]);