(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"./node_modules/@arcgis/core/layers/graphics/controllers/I3SOnDemandController.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return K}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),PooledArray=__webpack_require__("./node_modules/@arcgis/core/core/PooledArray.js"),core_Promise=__webpack_require__("./node_modules/@arcgis/core/core/Promise.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),dehydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js"),PromiseQueue=__webpack_require__("./node_modules/@arcgis/core/layers/support/PromiseQueue.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");class I3SFrameTask_r{constructor(t){this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=t.registerTask(Scheduler.b.I3S_CONTROLLER,this)}destroy(){this.handle&&(this.handle.remove(),this.handle=null)}get running(){for(const t of this.callbacks)if(t.needsUpdate())return!0;return!1}runTask(t){this.sort();const e=this.callbacks,r={numIndexLoading:0,numNodesLoading:0};for(let s=0;s<e.length&&!t.done;++s)e[s].priority=e[s].update(t,r),this.runIndex=s}sort(){const t=this.callbacks;let e=t.length;for(let r=this.runIndex;r>0;r--){const s=t[r-1];let n=r;for(;n<t.length&&s.priority<=t[n].priority&&(n!==e||s.priority<t[n].priority);)t[n-1]=t[n],n++;t[n-1]=s,e=n-1}this.runIndex=0}add(t){this.sort(),t.priority=1/0,this.callbacks.unshift(t)}remove(e){Object(arrayUtils.k)(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()}}const I3SFrameTask_s=new Map;function I3SFrameTask_n(t,e){let n=I3SFrameTask_s.get(t);return null==n&&(n=new I3SFrameTask_r(t),I3SFrameTask_s.set(t,n)),n.add(e),{remove:()=>{null!=n&&(n.remove(e),n.callbacks.length>0||(I3SFrameTask_s.delete(t),n.destroy()),n=null)}}}var vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec4f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js");class I3SNode_t{constructor(t,i){this.id=t,this.mbs=i,this.renderMbs=Object(vec4f64.f)([0,0,0,-1]),this.imModificationImpact=4}}class I3SNode_i extends I3SNode_t{constructor(s,t,i,e,h,o,r,c,n,a){super(s,i),this.index=t,this.childCount=e,this.level=h,this.resources=o,this.version=r,this.lodMetric=c,this.maxError=n,this.numFeatures=a,this.failed=!1,this.hasModifications=!1,this.cacheState=0,this.vertexCount=0,this.memory=0}}class I3SNode_e{constructor(s,t,i,e){this.nodeHasLOD=s,this.isChosen=t,this.lodLevel=i,this.version=e}}var I3SUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js"),orientedBoundingBox=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js");class I3SIndex_c{constructor(e,t,i,s,r){this.childOffset=e,this.childCount=t,this.visibilityCache=i,this.ref=s,this.node=r,this.useAsHole=0,this.filterImpact=2}}class I3SIndex_g{constructor(e,t,i,r,n,o,a,d,l,h,u,c,g,m){this.streamDataController=i,this.viewportQueries=r,this.logger=n,this.holeFilling=o,this._isLoaded=a,this._isReloading=d,this._isSelected=l,this._enable=h,this._needsUpdate=u,this._canRequest=c,this._computeVisibilityObb=g,this._computeNodeFiltering=m,this._dirty=!0,this._nodePages=[],this.nodeCount=0,this.nodesPerPage=0,this.rootIndex=0,this.lodMetric=0,this.lodConversion=e=>e,this.urlPrefix="",this._loading=new Set,this._failedNodes=new Set,this._failedPages=new Set,this._indexMissing=1,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState=new Map,this._version=I3SIndex_b(0),this._visibilityCacheVersion=I3SIndex_b(0),this._maxLevel=1,this._featureEstimate={estimate:0,leavesReached:!1},this._unloadedMemoryEstimate=0,this._missing=new PooledArray.a({deallocator:null}),this._prefetch=new PooledArray.a({deallocator:null}),this._updates=new I3SIndex_f(this._missing),this._imModificationUncategorized=new PooledArray.a({deallocator:null}),this.ignoreServiceObb=!1,this.progressiveLoadPenalty=0,this.layerHasModifications=!1,this._layerHasFilter=!1,this.logLayer=e,e.serviceUpdateTimeStamp&&e.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${e.serviceUpdateTimeStamp.lastUpdate}`),this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1,this.init(t)}init(e){if("page"===e.type){switch(this.urlPrefix=e.urlPrefix,this.nodesPerPage=e.pageSize,this.rootIndex=e.rootIndex,e.lodMetric){case"maxScreenThreshold":this.lodMetric=1;break;case"maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=I3SIndex_M}this.addPage(I3SIndex_N(this.rootIndex,this.nodesPerPage),e.rootPage)}else if("node"===e.type){this.urlPrefix=e.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode(new I3SNode_t(e.rootNode.id,null),-1);const t=this._validateNode(e.rootNode.id,e.rootNode);t&&this.addNode(t,0)}}loadPage(e){this._loading.add(e);const t=this.urlPrefix+e;this.streamDataController.request(t,"json").then((t=>{this._loading.delete(e),this.addPage(e,t)})).catch((t=>{this._loading.delete(e),Object(promiseUtils.m)(t)||(this._failedPages.add(e),this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${e}`,t))}))}addPage(e,t){for(let n=this._nodePages.length;n<e;n++)this._nodePages[n]=null;const i=[],s=[],r=t.nodes.map(((t,r)=>{const a=i.length,l=t.children?t.children.length:0;s.push(-1);for(let e=0;e<l;e++)i.push(t.children[e]);const h=`${t.index}`,g=Object(orientedBoundingBox.b)(t.obb),m=Object(vec4f64.f)([g.center[0],g.center[1],g.center[2],Object(vec3.r)(g.halfSize)]),f=t.mesh&&t.mesh.attribute,_=t.mesh&&t.mesh.geometry,b=t.mesh&&t.mesh.material,p={hasSharedResource:!1,hasFeatureData:!!_,attributes:f&&null!=f.resource?`${f.resource}`:null,geometry:_&&null!=_.resource?`${_.resource}`:null,texture:b&&null!=b.resource?`${b.resource}`:null,geometryDefinition:_?_.definition:-1,materialDefinition:b?b.definition:-1},y=new I3SNode_i(h,e*this.nodesPerPage+r,m,l,0,p,this.lastUpdate,this.lodMetric,this.lodConversion(t.lodThreshold),_?_.featureCount:null);return y.serviceObb=g,y.visibilityObb=this._computeVisibilityObb(y),y.vertexCount=_?_.vertexCount:0,new I3SIndex_c(a,l,I3SIndex_v(this._visibilityCacheVersion),null,y)}));this._nodePages[e]={nodes:r,children:i,parents:s},this.nodeCount+=r.length,this.updateParentsAndLevel()}updateParentsAndLevel(){const t=new Array,i=(i,s,r)=>{const n=this.getPage(i);if(Object(maybe.l)(n)){const o=I3SIndex_x(i,this.nodesPerPage);n.parents[o]=s;const a=n.nodes[o].node;Object(maybe.l)(a)&&(a.level=r,t.push(i))}};for(i(this.rootIndex,-1,0);t.length;){const s=t.pop(),r=this.getNode(s);if(Object(maybe.l)(r))for(let e=0;e<r.childCount;e++)i(this.getChildIndex(r,e),s,r.level+1),this._maxLevel=Math.max(this._maxLevel,r.level+1)}}getPage(e){return this._nodePages[I3SIndex_N(e,this.nodesPerPage)]}getNodeInternal(e){const i=this.getPage(e);return Object(maybe.k)(i)?null:i.nodes[I3SIndex_x(e,this.nodesPerPage)]}addNode(t,s){null!=t.children&&this.populateChildren(s,t.children);const r=this.getParent(s),n=Object(maybe.l)(r)?r.level+1:0;this._maxLevel=Math.max(this._maxLevel,t.children?n+1:n);const{lodMetric:a,maxError:l}=function I3SIndex_w(e){if(e)for(let t=0;t<e.length;t++)for(const i of I3SIndex_I)if(i[0]===e[t].metricType)return{lodMetric:i[1],maxError:e[t].maxError};return{lodMetric:0,maxError:0}}(t.lodSelection),h=Object(maybe.u)(this.getNodeInternal(s));return h.node=new I3SNode_i(t.id,s,Object(vec4f64.f)(t.mbs),h.childCount,n,t.resources,t.version,a,l,t.numFeatures),t.obb&&(h.node.serviceObb=Object(orientedBoundingBox.b)(t.obb)),h.node.visibilityObb=this._computeVisibilityObb(h.node),Object(maybe.l)(h.ref)&&(null==h.ref.mbs&&(h.ref.mbs=t.mbs),h.node.renderMbs=h.ref.renderMbs,h.node.serviceObbInRenderSR=h.ref.serviceObbInRenderSR,h.ref.visibilityObb=h.node.visibilityObb),h.node}makeRefNode(t,i){const s=this._nodePages[0],r=s.nodes.length;return s.nodes.push(new I3SIndex_c(0,0,I3SIndex_v(this._visibilityCacheVersion),t,null)),this.nodeCount++,s.parents.push(i),t.renderMbs[3]=-1,Object(maybe.l)(t.serviceObbInRenderSR)&&(t.serviceObbInRenderSR.halfSize[0]=-1),r}populateChildren(e,t){const s=Object(maybe.u)(this.getNodeInternal(e)),r=Object(maybe.u)(this.getPage(e));s.childOffset=r.children.length,s.childCount=t.length;for(let i=0;i<t.length;i++){const s=this.makeRefNode(t[i],e);r.children.push(s)}}getNode(t){const i=this.getNodeInternal(t);return Object(maybe.l)(i)?i.node:null}getIndexById(t){let i;return this.forAllNodes(((s,r)=>{(Object(maybe.l)(s.node)&&s.node.id===t||Object(maybe.l)(s.ref)&&s.ref.id===t)&&(i=r)})),i}getNodeById(e){const t=this.getIndexById(e);return t>=0?this.getNode(t):null}getChildIndex(e,i){const s=this.getPage(e.index);if(Object(maybe.k)(s))return-1;const r=s.nodes[I3SIndex_x(e.index,this.nodesPerPage)];return s.children[r.childOffset+i]}getParentIndex(t){const i=this.getPage(t);return Object(maybe.l)(i)?i.parents[I3SIndex_x(t,this.nodesPerPage)]:-1}getParent(e){return(e=this.getParentIndex(e))>=0?this.getNode(e):null}isLeaf(t){const i=this.getNodeInternal(t);return Object(maybe.l)(i)&&0===i.childCount}get rootNode(){return this.getNode(this.rootIndex)}get size(){return this.nodeCount}invalidateVisibilityCache(){this._visibilityCacheVersion=I3SIndex_b(this._visibilityCacheVersion)}invalidateNodeVisibilityCache(t){const i=this.getNodeInternal(t);Object(maybe.l)(i)&&this.invalidateNodeVisibilityCacheInternal(i)}invalidateNodeVisibilityCacheInternal(e){e.visibilityCache=I3SIndex_v(this._visibilityCacheVersion)}invalidateBoundingVolumeCache(t){const i=this.getNodeInternal(t);Object(maybe.l)(i)&&(I3SIndex_(i),this.invalidateNodeVisibilityCacheInternal(i))}invalidateGeometryVisibility(t){const i=this.getNodeInternal(t);Object(maybe.l)(i)&&Object(maybe.l)(i.node)&&(i.node.geometryObb=null,i.node.renderMbs[3]=-1,Object(maybe.l)(i.node.serviceObbInRenderSR)&&(i.node.serviceObbInRenderSR.halfSize[0]=-1))}invalidateVisibilityObbs(){Object(maybe.k)(this.rootNode)||this.traverse(this.rootNode,(e=>(e.visibilityObb=this._computeVisibilityObb(e),e.geometryObb=null,!0)))}isNodeVisible(i){const s=this.getNodeInternal(i);if(Object(maybe.k)(s)||Object(maybe.l)(s.ref)&&!s.ref.mbs)return!0;if(!I3SIndex_y(s.visibilityCache,this._visibilityCacheVersion)){const i=s.node,r=Object(maybe.l)(i)&&(Object(maybe.k)(s.ref)||Object(maybe.l)(i.visibilityObb))?i:Object(maybe.l)(s.ref)?s.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(Object(maybe.l)(i)||Object(maybe.l)(s.ref))&&2===s.filterImpact){const t=Object(maybe.l)(i)?i.mbs:Object(maybe.l)(s.ref)?s.ref.mbs:null;s.filterImpact=null!=t?this._computeNodeFiltering(t):0}const n=Object(maybe.l)(i)&&1===s.filterImpact,o=!(Object(maybe.l)(i)&&2===i.imModificationImpact)&&(!r||this.viewportQueries.isNodeVisible(r))&&!n;return s.visibilityCache=I3SIndex_p(o,this._visibilityCacheVersion),o}return I3SIndex_P(s.visibilityCache)}isGeometryVisible(t){if(!this.isNodeVisible(t))return!1;const i=this.getNodeInternal(t);return!(Object(maybe.l)(i)&&Object(maybe.l)(i.node)&&Object(maybe.l)(i.node.geometryObb)&&(!this.layerHasModifications||4!==i.node.imModificationImpact))||this.viewportQueries.isGeometryVisible(i.node)}_traverseCoverage(s,r,n,o,a){const d=this.getPage(s);if(Object(maybe.k)(d)||0===r.childCount)return;const l=r.childOffset+r.childCount,h=new Array;for(let t=r.childOffset;t<l;++t){const i=d.children[t],s=this.getNodeInternal(i);Object(maybe.l)(s)&&Object(maybe.l)(s.node)&&this.isGeometryVisible(i)&&h.push(s)}o/=h.length;for(const e of h){const t=Object(maybe.u)(e.node).index;this._isLoaded(t)||this._isReloading(t)?(a.delta=Math.max(a.delta,n),a.coverage+=o):this._traverseCoverage(t,e,n+1,o,a)}}useNodeAsHole(e){if("off"===this.holeFilling)return!1;const i=this.getNodeInternal(e);if(Object(maybe.k)(i))return!1;if("always"===this.holeFilling)return!0;if(I3SIndex_y(i.useAsHole,this._version))return I3SIndex_P(i.useAsHole);const s={delta:0,coverage:0};this._traverseCoverage(e,i,0,1,s);const r=s.delta*s.coverage<=.5;return i.useAsHole=I3SIndex_p(r,this._version),r}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune(),this._updates.update.prune()}requestUpdate(){this._dirty=!0,this._indexMissing=1,this._version=I3SIndex_b(this._version)}imModificationsChanged(t){this.layerHasModifications=t,this.forAllNodes((({node:t})=>{Object(maybe.l)(t)&&(t.imModificationImpact=4,t.visibilityObb=this._computeVisibilityObb(t),t.hasModifications&&this.invalidateGeometryVisibility(t.index))})),this.invalidateVisibilityCache()}layerFilterChanged(t){this._layerHasFilter=t,this.forAllNodes((t=>{if(Object(maybe.l)(t)){t.filterImpact=2;const i=t.node;Object(maybe.l)(i)&&this.invalidateNodeVisibilityCache(i.index)}})),this.invalidateVisibilityCache()}update(s,r,n){if(!this._dirty)return;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(s),I3SIndex_m.clear();let o=!0;const a=new C,d=new C,l=this._imModificationUncategorized;l.clear();const h=new Set;this.traverseVisible(((u,c,g)=>{if(Object(maybe.k)(c)){let e=this.entryPriority(u);e===1/0&&(e=this.entryPriority(g));const t=I3SIndex_N(u,this.nodesPerPage);return I3SIndex_m.set(t,Math.max(e,I3SIndex_m.get(t)||0)),this._loading.has(t)||this._failedPages.has(t)||this._missing.push(t),void(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e))}const f=c.node;if(this._updateNodeFeatureEstimate(f,d),Object(maybe.k)(f)){const e=this.entryPriority(u);return this._loading.has(u)||this._failedNodes.has(u)||(this._missing.push(u),I3SIndex_m.set(u,e)),void(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e))}const _=Object(maybe.u)(this.getPage(u));if(0===this._missing.length&&0===this.nodesPerPage)for(let t=0;t<c.childCount;t++){const i=_.children[c.childOffset+t],s=this.getNodeInternal(i);!Object(maybe.l)(s)||s.node||this._loading.has(i)||this._failedNodes.has(i)||(I3SIndex_m.set(i,this.entryPriority(i)),this._prefetch.push(i))}if(f.failed||!f.resources.hasFeatureData)return;if(h.add(f.id),this._isLoaded(u)){if(a.known+=f.memory,++a.knownNodes,this._isSelected(f)?c.childCount>0&&(o=!1):(a.unremoved+=f.memory,o=!1),this._needsUpdate(f)){const e=this.entryPriority(u);I3SIndex_m.set(u,e),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,e),this._updates.update.push(u)}return}if(f.memory&&(a.known+=f.memory,++a.knownNodes),!this._isSelected(f))return void(this._isReloading(u)&&this._updates.remove.push(u));if(c.childCount>0&&(o=!1),f.memory?(a.missing+=f.memory,a.known+=f.memory,++a.knownNodes):++a.missingNodes,s.indexOf(f.index)>=0)return this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this.entryPriority(u)),void(this._updates.cancel=this._updates.cancel.filter((e=>e!==f.index)));if(!r.done&&this._enable(f))return void r.madeProgress();const v=this.entryPriority(u);I3SIndex_m.set(u,v),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,v),this._updates.add.push(u),this.layerHasModifications&&n&&Object(maybe.l)(f)&&4===f.imModificationImpact&&l.push(u)}));const c=this._updates.add;c.length>0&&this.layerHasModifications&&(l.length>0&&n(l),c.filterInPlace((e=>{const i=this.getNodeInternal(e),s=Object(maybe.k)(i)||Object(maybe.k)(i.node)||2!==i.node.imModificationImpact;return s||this.invalidateNodeVisibilityCache(e),s}))),this._unloadedMemoryEstimate=a.missing-a.unremoved,a.knownNodes>3&&a.missingNodes>0&&(this._unloadedMemoryEstimate+=a.known/a.knownNodes*a.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(d),this._featureEstimate.leavesReached=o,this._missing.sort(((e,t)=>e-t)),this._missing.filterInPlace(((e,t)=>t<1||this._missing.data[t-1]!==e)),this._missing.sort(((e,t)=>I3SIndex_m.get(e)-I3SIndex_m.get(t))),this._missing.length>0&&(this._maxUnloadedPrio=I3SIndex_m.get(this._missing.back()),this._prefetch.clear()),this._updates.add.filterInPlace((e=>I3SIndex_m.get(e)>=this._maxUnloadedPrio)).sort(((e,t)=>I3SIndex_m.get(e)-I3SIndex_m.get(t))),this._updates.update.sort(((e,t)=>I3SIndex_m.get(e)-I3SIndex_m.get(t))),this._indexMissing=this._loading.size+this._missing.length,this._dirty=this._indexMissing>0,I3SIndex_m.clear()}checkFeatureTarget(e,t){const i=this.viewportQueries.updateScreenSpaceErrorBias(t);let s=t,r=t,n=i,o=10;for(;o--;){const i=new C;if(this._updateFeatureEstimate(s,i),this._computeFeatureEstimate(i)<=e){if(s>=t||i.missingNodes>0||0===o)break;n=s,s=.5*(s+r)}else r=s,s=.5*(s+n)}return this._version=I3SIndex_b(this._version),this.viewportQueries.updateScreenSpaceErrorBias(i),Math.min(t,s)}_updateFeatureEstimate(t,i){this._version=I3SIndex_b(this._version),this.viewportQueries.updateScreenSpaceErrorBias(t),this.traverseVisible(((t,s)=>this._updateNodeFeatureEstimate(Object(maybe.l)(s)&&s.node,i)))}_updateNodeFeatureEstimate(i,s){if(!(Object(maybe.k)(i)||i.failed||Object(maybe.k)(i.numFeatures)))return this._isLoaded(i.index)?(s.known+=i.numFeatures,++s.knownNodes,void(this._isSelected(i)||(s.unremoved+=i.numFeatures))):void(this._isSelected(i)&&(Object(maybe.l)(i.numFeatures)?(s.missing+=i.numFeatures,s.known+=i.numFeatures,++s.knownNodes):++s.missingNodes))}_computeFeatureEstimate(e){let t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)}load(){return this._load(this._missing)}prefetch(){return this._prefetch.sort(((e,t)=>I3SIndex_m.get(e)-I3SIndex_m.get(t))),this._load(this._prefetch)}_load(e){if(0===e.length||!this._canRequest())return!1;for(;e.length>0&&this._canRequest();)0===this.nodesPerPage?this._loadNode(e.pop()):this.loadPage(e.pop());return!0}isLoading(){return this._indexMissing>0}getIndexLoading(){return this._loading.size}getIndexMissing(){return this._indexMissing}getUnloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}nodeTraversalState(e){if(Object(maybe.k)(e))return null;let i=this._nodeTraversalState.get(e.index);if(i&&I3SIndex_y(i.version,this._version))return i;const s=this.viewportQueries.getLodLevel(e),r=this.viewportQueries.hasLOD(e);let n=!0;if(r){const t=this.getParentIndex(e.index);if(t>=0){const e=this._nodeTraversalState.get(t);n=e&&s>e.lodLevel}else n=s>0}else n=0===e.childCount;return i?(i.lodLevel=s,i.isChosen=n,i.version=I3SIndex_p(!0,this._version),i):(i=new I3SNode_e(r,n,s,I3SIndex_p(!0,this._version)),this._nodeTraversalState.set(e.index,i),i)}_loadNode(e){this._loading.add(e);const s=Object(maybe.u)(this.getNodeInternal(e)).ref;if(Object(maybe.k)(s))return void this._failedNodes.add(e);const n=s.id,o=this.urlPrefix+n,a=()=>{this._loading.delete(e),0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(o,"json").then((t=>{a();const i=this._validateNode(n,t);if(null==i)return;i.obb&&this.invalidateNodeVisibilityCache(e);const s=this.addNode(i,e);this.nodeTraversalState(s)}),(t=>{a(),Object(promiseUtils.m)(t)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+o),this._failedNodes.add(e))}))}_validateNode(e,t){if(null==t||"object"!=typeof t||t.id!==e)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${e}"`),null;if(!Array.isArray(t.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${e}.`),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${e}"`),null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${e}"`),null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some(((e,t)=>e.href!==`./attributes/f_${t}/0`))||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${e}"`),t.featureData&&t.featureData.length>1&&this.logger.warn("#validateNode()",this.logLayer,`Node ${e} has ${t.featureData.length} bundles. Only the first bundle will be loaded.`);const i=t.hasOwnProperty("obb")&&!this.ignoreServiceObb?t.obb:null,s=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null,n=Array.isArray(t.children)?t.children.map((t=>{if(null==t)return null;const i=t=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${e}: ${t}`);if("number"==typeof t.id)i(`id ${t.id} is a number instead of a string.`);else if("string"!=typeof t.id||!Array.isArray(t.mbs))return i("Missing or invalid id."),null;if(!Array.isArray(t.mbs))return i(`Invalid bounding volume on reference ${t.id}.`),null;t.href&&t.href!=="../"+t.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${e}"`);const s=t.hasOwnProperty("obb")&&!this.ignoreServiceObb?t.obb:null,r=new I3SNode_t(`${t.id}`,t.mbs);return r.serviceObb=s,r.visibilityObb=this._computeVisibilityObb(r),r})).filter((e=>null!=e)):null;return{id:e,mbs:t.mbs,obb:i,children:n,resources:{hasFeatureData:t.featureData&&t.featureData.length>0,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?e:null,texture:t.textureData&&t.textureData.length>0?e:null,geometry:null!=t.geometryData?e:null},version:"string"==typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:s}}resetFailedNodes(){this._failedNodes.clear(),this._failedPages.clear(),this.forAllNodes((t=>{Object(maybe.l)(t.node)&&(t.node.failed=!1)}))}entryPriority(i){const s=this.getNodeInternal(i),r=this.getParentIndex(i);if(Object(maybe.k)(s)||r<0&&null==s.node)return r<0?1/0:this.entryPriority(r);let n=0;if(s.node&&r>=0){const e=this._nodeTraversalState.get(r);null!=e&&(n=e.lodLevel)}let o=this.progressiveLoadPenalty;for(let e=i;e>=0;e=this.getParentIndex(e))if(this._isLoaded(e)){o=0;break}const a=Object(maybe.l)(s.ref)?this.viewportQueries.distToPOI(s.ref):Object(maybe.l)(s.node)?this.viewportQueries.distToPOI(s.node):0;return-a-n*(a+this.progressiveLoadPenalty)+o}traverseVisible(e){const i=this.getNodeInternal(this.rootIndex);Object(maybe.k)(i)?e(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,i,e)}_traverseVisible(t,s,r,n){if(r.node&&0===r.childCount)return void(this.isGeometryVisible(t)&&n(t,r,s));if(!this.isNodeVisible(t))return;if(n(t,r,s),null==r.node)return;const o=this.nodeTraversalState(r.node);if(o.nodeHasLOD&&o.lodLevel===this._maxLodLevel)return;const a=Object(maybe.u)(this.getPage(t));for(let i=0;i<r.childCount;i++){const s=a.children[r.childOffset+i],o=this.getNodeInternal(s);Object(maybe.l)(o)?this._traverseVisible(s,t,o,n):n(s,null,t)}}traverse(e,t){t(e)&&this.traverseChildren(e,t)}traverseChildren(t,i){const s=t.index,r=this.getNodeInternal(s);Object(maybe.l)(r)&&this._traverseChildren(s,r,i)}_traverseChildren(i,s,r){const n=this.getPage(i);if(Object(maybe.k)(n))return;const o=s.childOffset+s.childCount;for(let t=s.childOffset;t<o;++t){const i=n.children[t],s=this.getNodeInternal(i);Object(maybe.l)(s)&&Object(maybe.l)(s.node)&&r(s.node)&&this._traverseChildren(i,s,r)}}updateStats(e){if(this._updates.add.length>0&&(e.nodes+=" + "+this._updates.add.length),(this._indexMissing||this._prefetch.length>0)&&(e.index+=" + "+this._indexMissing||!1),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){const t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}}getPriority(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)}updateElevationInfo(e){this.forAllNodes(I3SIndex_),this.viewportQueries.updateElevationInfo(e)}forAllNodes(e){for(let t=0;t<this._nodePages.length;t++){const i=this._nodePages[t];if(i){const s=t*this.nodesPerPage;for(let t=0;t<i.nodes.length;t++)e(i.nodes[t],s+t)}}}get test(){return{addNode:(e,t)=>this.addNode(e,t)}}}const I3SIndex_m=new Map;class I3SIndex_f{constructor(e){this.missing=e,this.update=new PooledArray.a({deallocator:null}),this.add=new PooledArray.a({deallocator:null}),this.remove=new PooledArray.a({deallocator:null}),this.cancel=[]}reset(e){this.add.clear(),this.update.clear(),this.cancel=e}}function I3SIndex_(t){Object(maybe.l)(t.node)&&(t.node.renderMbs[3]=-1,Object(maybe.l)(t.node.serviceObbInRenderSR)&&(t.node.serviceObbInRenderSR.halfSize[0]=-1)),Object(maybe.l)(t.ref)&&(t.ref.renderMbs[3]=-1,Object(maybe.l)(t.ref.serviceObbInRenderSR)&&(t.ref.serviceObbInRenderSR.halfSize[0]=-1))}function I3SIndex_v(e){return Object(I3SUtil.a)(e,-2)}function I3SIndex_b(e){return Object(I3SUtil.a)(e,2)}function I3SIndex_p(e,t){return t+(e?1:0)}function I3SIndex_y(e,t){return(-2&e)===t}function I3SIndex_P(e){return 1==(1&e)}function I3SIndex_N(e,t){return 0===t?0:e/t|0}function I3SIndex_x(e,t){return 0===t?e:e%t}const I3SIndex_I=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];class C{constructor(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}function I3SIndex_M(e){return Math.sqrt(e*(4/Math.PI))}class I3SLodHandling_o{constructor(e){this.layerView=e,this._lodGlobalDirty=!1}startNodeLoading(e,i,s,o){this._maxLodLevel=o.maxLodLevel,this._index=s,this._isNodeInScaleBounds=e,this._removeNodes=i}shouldLoadNode(i){if(Object(maybe.k)(i))return!1;const s=this._index.nodeTraversalState(i);return!!this.isChosenMaxLOD(s)||!!s.isChosen&&this._childrenRequireLoading(i)}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;const i=this.layerView.view.resourceController.memoryController.usedMemory,s=Math.max(0,Math.floor(10*(i-1)));I3SLodHandling_t.clear(),this._lodGlobalHandling(this._index.rootNode,s,!1);const o=I3SLodHandling_t.length;this._removeNodes(I3SLodHandling_t,e);const d=I3SLodHandling_t.length<o;return 0!==I3SLodHandling_t.length&&(this._lodGlobalDirty=!0),I3SLodHandling_t.clear(),d}_lodGlobalHandling(s,o,d){if(Object(maybe.k)(s))return!1;const l=s.index,n=this._index,r=this.layerView,a=n.nodeTraversalState(s),h=this.isChosenMaxLOD(a),u=r.isNodeLoaded(l),c=r.nodeCrossfadingEnabled;if(c&&u&&h){const e=!d&&this.hasNoVisibleChildren(s);r.fadeNode(l,0,!e)}const x=u&&(!r.isNodeFullyFadedIn||r.isNodeFullyFadedIn(l));if(u&&(r.updateNodeState(l,h?1:0),h))return x&&this._removeChildrenRecursive(s),x;const _=s.childCount>0;let L=_;if(_)for(let e=0;e<s.childCount;e++){const t=n.getChildIndex(s,e),l=n.getNode(t);Object(maybe.l)(l)?n.isGeometryVisible(t)&&!this._lodGlobalHandling(l,o,d||x)&&this._isNodeInScaleBounds(l)&&(L=!1):n.isNodeVisible(t)&&(L=!1)}const N=u&&!h&&(L||I3SLodHandling_t.length<o);N&&I3SLodHandling_t.push(l),!c||N||!u||d||L||r.fadeNode(l,0,!1);const b=!s.resources.hasFeatureData;return L||x&&!N||b}_removeChildrenRecursive(e){this._index.traverseChildren(e,(e=>((this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&I3SLodHandling_t.push(e.index),!0)))}hasNoVisibleChildren(e){let i=!0;return this._index.traverseChildren(e,(e=>!(!i||!this._index.isNodeVisible(e.index)||this.layerView.isNodeLoaded(e.index)&&(i=!1,1)))),i}_childrenRequireLoading(e){let i=!1,s=!0;return this._index.traverseChildren(e,(e=>{if(!s||!this._index.isNodeVisible(e.index))return!1;const o=this._index.nodeTraversalState(e);return this.isChosenMaxLOD(o)&&this._index.isGeometryVisible(e.index)&&(i=!0),!this.layerView.isNodeLoaded(e.index)||(s=!1,!1)})),s&&i}isChosenMaxLOD(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)}}const I3SLodHandling_t=new PooledArray.a({deallocator:null});var asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),lang=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),urlUtils=__webpack_require__("./node_modules/@arcgis/core/core/urlUtils.js"),I3SBinaryReader=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js"),I3SMaterialUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js");class I3SNodeLoader_h{constructor(e,t,r,i,o,n){if(this.streamDataController=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=o,this.options=n,this.logLayer=e,this.layerUrl=e.parsedUrl.path,this.geometryDefinitions=e.geometryDefinitions,e.materialDefinitions){const t=e.textureSetDefinitions;this.materialAndTextures=e.materialDefinitions.map((e=>Object(I3SMaterialUtil.c)(t,e)))}}load(e,t,r){return this.streamDataController.request(e,t,r)}loadAttribute(e,t,r){const i=`${this.layerUrl}/nodes/${e.resources.attributes}/attributes/${t.key}/0`;return this.load(i,"binary",r).then((e=>Object(I3SBinaryReader.d)(t,e)))}loadAttributes(e,t,r){return Object(promiseUtils.j)(t.map((t=>this.loadAttribute(e,t.attributeStorageInfo,r)))).then((r=>{const i={};for(let o=0;o<t.length;++o)if(r[o].value)i[t[o].name]=r[o].value;else{if(Object(promiseUtils.m)(r[o].error))throw r[o].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${t[o].name}' on node '${e.id}'`,r[o].error)}return i}))}async loadNodeData(r,i){const s=null!=this.requiredAttributes&&r.resources.attributes?Object(asyncUtils.d)(this.loadAttributes(r,this.requiredAttributes,i)):null,{bufferDefinition:a,bufferIndex:u}=function I3SNodeLoader_p(e,t){const i={bufferDefinition:null,bufferIndex:0};if(null==e||t.resources.geometryDefinition<0)return i;const o=t.resources.geometryDefinition>=0?e[t.resources.geometryDefinition].geometryBuffers:null;if(null==o)return i;for(let n=0;n<o.length;n++){const e=o[n];if(null==e.compressedAttributes)i.bufferIndex=n,i.bufferDefinition=o[n];else if("draco"===e.compressedAttributes.encoding&&!Object(has.a)("disable-feature:i3s-draco"))return i.bufferIndex=n,i.bufferDefinition=e,i}return i}(this.geometryDefinitions,r),l=!!r.resources.geometry,d=l?Object(asyncUtils.d)(this.loadGeometry(r.resources.geometry,u,i)):null,m=r.resources.hasSharedResource?await this.loadShared(r,i):null,h=this.materialAndTextures&&r.resources.materialDefinition>=0?this.materialAndTextures[r.resources.materialDefinition]:null!=m?Object(I3SMaterialUtil.d)(m):null,x=h&&h.material,A=h&&h.textures,$=`${r.id}`,w=!l&&this.options.loadFeatureData,T=w?await this.loadFeatureData($,i):null,j=w?function I3SNodeLoader_y(e){for(const t of e.featureData){const e=t.geometries;if(null!=e)for(const r of e)return{featureIds:[t.id],featureDataPosition:t.position,geometries:[r]}}return null}(T):function I3SNodeLoader_g(e){return{featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:e}}],featureDataPosition:[0,0,0]}}(x),I=Object(maybe.k)(j)&&function I3SNodeLoader_b(e){const t=new Array;for(const r of e.featureData)null!=r.position&&t.push({featureIds:[r.id],featureDataPosition:r.position,geometries:null});return t}(T),U=null!=A&&A.length>0?Object(asyncUtils.d)(this.loadTextures(r,A,i)):null;let S=null,q=null;if(d){S=Object(asyncUtils.a)(await d);const e=function D(e,t){if(!e||!t||!t.materialDefinitions)return e;const r=Object.keys(t.materialDefinitions)[0];return!t.materialDefinitions[r].params.vertexRegions&&e.vertexAttributes.region&&delete(e=Object(lang.a)(e)).vertexAttributes.region,e}(this.defaultGeometrySchema,m);q=Object(I3SBinaryReader.a)(a,e)}const v=U?Object(asyncUtils.a)(await U):null,P=s?Object(asyncUtils.a)(await s):{},k=P?{attributeData:P,loadedAttributes:this.requiredAttributes}:null;return Object(maybe.l)(j)?{geometryData:j,attributeDataInfo:k,geometryBuffer:S,geometryDescriptor:q,requiredTextures:A,textureData:v}:Object(maybe.l)(I)?{pointData:I,attributeDataInfo:k,geometryBuffer:S,geometryDescriptor:q,requiredTextures:A,textureData:v}:Promise.reject()}static addAbsoluteHrefTexture(e,t){const r=e.textureDefinitions;if(null!=r)for(const i of Object.keys(r))for(const e of r[i].images)Array.isArray(e.href)?e.hrefConcat=e.href.map((e=>Object(urlUtils.A)(e,t))):e.hrefConcat=Object(urlUtils.A)(e.href,t)}static fixTextureEncodings(e){const t=e.textureDefinitions;if(null!=t)for(const r in t){const e=t[r];if(Array.isArray(e.encoding))for(let t=0;t<e.encoding.length;t++){const r=e.encoding[t];"data:"===r.substring(0,5)&&(e.encoding[t]=r.substring(5))}else{const t=e.encoding;"data:"===t.substring(0,5)&&(e.encoding=t.substring(5))}}}loadShared(e,t){const r=`${this.layerUrl}/nodes/${e.resources.geometry}/shared`;return this.load(r,"json",t).then((e=>(I3SNodeLoader_h.fixTextureEncodings(e),I3SNodeLoader_h.addAbsoluteHrefTexture(e,r),e)))}loadTexture(e,t,r,i,o,n){let s=!1;return 4===o||1===o||2===o?this.load(e,"binary",n).then((e=>({id:t,usage:r,data:e,encoding:o,downsampled:s}))):this.load(e,"image",n).then((e=>{let n=e;if(i&&e.width*e.height>=4096){const t=Math.ceil(e.width/2),r=Math.ceil(e.height/2),i=document.createElement("canvas");i.width=t,i.height=r,i.getContext("2d").drawImage(e,0,0,t,r),n=i,s=!0}return{id:t,usage:r,data:n,encoding:o,downsampled:s}}))}loadTextures(e,t,r){const i=this.options.uncompressedTextureDownsamplingEnabled,o=this.options.textureUsageMask;return Promise.all(t.map((t=>{if(0==(t.usage&o))return null;const n=Object(I3SMaterialUtil.f)(t.encodings,this.options.textureEncodings);if(null==n)return this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${e.id}`),Promise.reject();const s=e.resources.texture||e.id,a=`${this.layerUrl}/nodes/${s}/textures/${n.name}`;return this.loadTexture(a,t.id,t.usage,i,n.encoding,r)})))}loadFeatureData(e,t){const r=`${this.layerUrl}/nodes/${e}/features/0`;return this.load(r,"json",t)}loadGeometry(e,t,r){const i=`${this.layerUrl}/nodes/${e}/geometries/${t}`;return this.load(i,"binary",r)}}class I3SStreamDataController_r{constructor(e,t){this.requester=e,this.apiKey=t,this.activeRequests=new Set}get busy(){return this.requester.busy}request(r,s,l){const o=new AbortController,a=Object(promiseUtils.s)(l,(()=>o.abort())),n={signal:o.signal,query:{token:this.apiKey}},u=this.requester.request(r,s,n),i={response:u,abortController:o,abortHandle:a};return this.activeRequests.add(i),Object(promiseUtils.c)(u,(()=>{var e;i.abortController=null,null==(e=i.abortHandle)||e.remove(),i.abortHandle=null,this.activeRequests.delete(i)})),u}cancelAll(){this.activeRequests.forEach((e=>{var t,r;null==(t=e.abortController)||t.abort(),e.abortController=null,null==(r=e.abortHandle)||r.remove()})),this.activeRequests.clear()}}var vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),vec4=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4.js"),projectionEllipsoid=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js"),frustum=__webpack_require__("./node_modules/@arcgis/core/geometry/support/frustum.js"),sphere=__webpack_require__("./node_modules/@arcgis/core/chunks/sphere.js"),elevationAlignmentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/elevationAlignmentUtils.js"),ElevationContext=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/ElevationContext.js"),featureExpressionInfoUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/featureExpressionInfoUtils.js");class I3SViewportQueries_E{constructor(t,e,s,i,r,n,a,o={}){this._indexSR=t,this._renderCoordsHelper=e,this.clippingArea=r,this._elevationProvider=n,this._options=o,this._frustum=Object(frustum.c)(),this._useFrustumCulling=!1,this._poi=Object(vec3f64.f)(),this.minDistance=1/0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=Object(vec3f64.f)(),this._tmp2=Object(vec3f64.f)(),this._tmp3=Object(vec3f64.f)(),this._tmp0=Object(vec3f64.f)(),this._screenspaceErrorBias=o.screenspaceErrorBias||1,this._progressiveLoadFactor=o.progressiveLoadFactor||1,this.updateCamera(s,i),this.engineSR=this._renderCoordsHelper.spatialReference,this.updateElevationInfo(a),this._tmpPoint=Object(dehydratedFeatures.j)(0,0,0,t)}updateElevationInfo(t){null!=t?(this._elevationContext=ElevationContext.a.fromElevationInfo(t),this._elevationContext.updateFeatureExpressionInfoContext(Object(featureExpressionInfoUtils.c)(Object(featureExpressionInfoUtils.f)(t,!1)))):this._elevationContext=null}updateCamera(t,e){this._useFrustumCulling=e,e&&Object(frustum.e)(t.viewMatrix,t.projectionMatrix,this._frustum),this._screenSizeFactor=1/(t.perScreenPixelRatio/2),this._camPos=t.eye,this.minDistance=1/0,this.maxDistance=0}setPointOfInterest(t){this._poi=t}updateScreenSpaceErrorBias(t){const e=this._screenspaceErrorBias;return this._screenspaceErrorBias=t,e}updateClippingArea(t){this.clippingArea=t}getRenderMbs(t){const e=t.renderMbs;return e[3]<0&&(Object(vec4.c)(e,t.mbs),this._elevationContext&&e[3]<1e5&&(this._tmpPoint.x=e[0],this._tmpPoint.y=e[1],this._tmpPoint.z=e[2],e[2]=Object(elevationAlignmentUtils.f)(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)),Object(projection.o)(e,this._indexSR,e,this.engineSR)),e}getVisibilityObb(s){if(Object(maybe.l)(s.visibilityObb))return s.visibilityObb;const i=s.serviceObb;return Object(maybe.k)(i)||i.halfSize[0]<0?void 0:(s.serviceObbInRenderSR=this._computeRenderObb(i,s.serviceObbInRenderSR,s.mbs[3]),s.serviceObbInRenderSR)}_computeRenderObb(t,s,i){if(Object(maybe.k)(s)&&(s=Object(orientedBoundingBox.e)()),s.halfSize[0]<0){let e=0;this._elevationContext&&i<1e5&&(this._tmpPoint.x=t.center[0],this._tmpPoint.y=t.center[1],this._tmpPoint.z=t.center[2],e=Object(elevationAlignmentUtils.f)(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-t.center[2]),Object(I3SUtil.v)(t,this._indexSR,s,this.engineSR,e)}return s}isNodeVisible(e){const s=this.getRenderMbs(e);if(!this._isMBSinClippingArea(s))return!1;if(!this._useFrustumCulling)return!0;const i=this.getVisibilityObb(e);return Object(maybe.l)(i)?Object(orientedBoundingBox.h)(i,this._frustum):Object(frustum.j)(this._frustum,Object(sphere.n)(s))}isGeometryVisible(e){if(!this._useFrustumCulling)return!0;const s=e.geometryObb;return Object(maybe.l)(s)?Object(orientedBoundingBox.h)(s,this._frustum):this.isNodeVisible(e)}_isMBSinClippingArea(t){return!!Object(maybe.k)(this.clippingArea)||0!==Object(I3SUtil.s)(this.clippingArea,t)}screenSpaceDiameterMbs(t,e){const i=this.getRenderMbs(t),r=Math.sqrt(Object(vec3.n)(i,this._camPos)),n=r-i[3];return this._updateMinMaxDistance(r),n<0?.5*Number.MAX_VALUE:e/n*this._screenSizeFactor}calcCameraDistance(t){return this.calcCameraDistanceToCenter(t)-this.getRenderMbs(t)[3]}calcCameraDistanceToCenter(t){const e=this.getRenderMbs(t),s=Object(vec3.o)(e,this._camPos);return this._updateMinMaxDistance(s),s}calcAngleDependentLoD(t){const e=this.getRenderMbs(t),s=e[3],n=(Math.abs(e[0]*(e[0]-this._camPos[0])+e[1]*(e[1]-this._camPos[1])+e[2]*(e[2]-this._camPos[2]))/Object(vec3.r)(e)+s)/Object(vec3.o)(e,this._camPos);return Math.min(1,n)}hasLOD(t){return 0!==t.lodMetric}getDistancePlanarMode(t,e){const s=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],n=s*s+i*i,a=e[3];if(n<=a*a)return Math.abs(r);const o=Math.sqrt(n)-a;return Math.sqrt(r*r+o*o)}getDistanceGlobeMode(t,e){const m=Object(vec3.r)(e),p=Object(vec3.r)(t)-m;Object(vec3.g)(this._tmp0,t,Object(vec3.j)(t,e)/Object(vec3.v)(t));const u=Object(vec3.n)(e,this._tmp0),l=e[3];if(u<=l*l)return Math.abs(p);{const s=Object(vec3.g)(this._tmp0,e,1/m),o=m,u=l*l/2/o,_=Object(vec3.g)(this._tmp1,s,o-u),d=t,b=Object(vec3.l)(this._tmp2,d,_),g=Object(vec3.l)(this._tmp2,b,Object(vec3.g)(this._tmp3,s,Object(vec3.j)(s,b))),f=Object(vec3.h)(this._tmp2,_,Object(vec3.g)(this._tmp2,g,l/Object(vec3.r)(g)));let M=Object(vec3.o)(d,f);if(p>=2e5){const t=Object(vec3.l)(this._tmp1,d,f);let e=Object(vec3.j)(t,s)/Object(vec3.r)(t);e<.08&&(e=1e-4),M/=e}return M}}getDistance(t,e){return this.engineSR===Object(projectionEllipsoid.g)(this.engineSR)?this.getDistanceGlobeMode(t,e):this.getDistancePlanarMode(t,e)}_updateMinMaxDistance(t){t>0?(this.minDistance=Math.min(this.minDistance,t),this.maxDistance=Math.max(this.maxDistance,t)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-t))}getLodLevel(t){if(0===t.lodMetric||!t.resources.hasFeatureData)return 0;if(0===t.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&this._progressiveLoadFactor<1){const e=this._progressiveLoadFactor*this._screenspaceErrorBias,s=this._screenspaceErrorBias;return this.evaluateLODmetric(t,e)?this.evaluateLODmetric(t,s)?2:1:0}return this.evaluateLODmetric(t,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(t,e){switch(t.lodMetric){case 2:{const s=this.getRenderMbs(t),i=this.getDistance(this._camPos,s),r=2*i/this._screenSizeFactor,n=i+s[3];return this._updateMinMaxDistance(n),t.maxError*e<=r}case 1:{let s=this.screenSpaceDiameterMbs(t,t.mbs[3]*e);return this._options.angleDependentLoD&&(s*=this.calcAngleDependentLoD(t)),s<t.maxError}case 3:return this.screenSpaceDiameterMbs(t,t.maxError)*e<10;case 4:return this.calcCameraDistance(t)>t.maxError*e}return!1}distToPOI(t){const e=this.getRenderMbs(t);return Object(vec3.o)(e,this._poi)-e[3]}distCameraToPOI(){return Object(vec3.o)(this._camPos,this._poi)}}var extentUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/extentUtils.js"),support=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/index.js"),layerViewUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/layerViewUtils.js");const I3SOnDemandController_P=Logger.a.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");let I3SOnDemandController_T=class extends(Object(core_Promise.b)(Accessor.a)){constructor(e){super(e),this.screenSizeFactor=0,this.featureTarget=5e4,this.fixedFeatureTarget=!1,this.updating=!0,this.updatingProgress=1,this.leavesReached=!1,this.scaleVisibilityEnabled=!0,this._featureLOD=1,this._stableFeatureLOD=!1,this._isIdle=!1,this._cameraDirty=!0,this._invisibleDirty=!1,this._newLoadingNodes=new PooledArray.a({deallocator:null}),this._loadedNodeScales=new Map,this._modificationsNodeFilteringArray=new PooledArray.a,this._downloadingCount=0,this._loadingNodes=new Map,this._updatingNodes=new Map,this._progressMaxNumNodes=1,this._requiredAttributes=new Array,this._requiredAttributesDirty=!0,this._updatesDisabled=!1,this.disableIDBCache=!1,this._disableMemCache=!1,this._restartNodeLoading=!1,this._fields=null,this._attributeStorageInfo=null,this._handles=new Handles.a,this._idleQueue=new PromiseQueue.a,this._elevationUpdateNodes=new PooledArray.a({deallocator:null}),this._errorCount=0}get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}get isGraphics3D(){return"points"===this.layer.profile}get indexStreamController(){const e=this.layerView.view.resourceController.createStreamDataRequester(2);return new I3SStreamDataController_r(e,this.layer.apiKey)}get dataStreamController(){const e=this.layerView.view.resourceController.createStreamDataRequester(3);return new I3SStreamDataController_r(e,this.layer.apiKey)}get crsVertex(){return Object(I3SUtil.r)(this.layer)}get crsIndex(){return Object(I3SUtil.p)(this.layer)}get rootNodeVisible(){if(Object(maybe.l)(this._index)){const e=this._index.rootNode;if(Object(maybe.l)(e))return this._updateViewData(),this._index.isNodeVisible(e.index)}return!0}get index(){return this._index}initialize(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData,this._lodHandling=new I3SLodHandling_o(this.layerView);const e=this.layerView.i3slayer;this.layer=e,this._defaultGeometrySchema=e.store.defaultGeometrySchema,this.disableIDBCache=Object(has.a)("disable-feature:idb-cache"),"fields"in e&&(this._fields=e.fields,this._attributeStorageInfo=e.attributeStorageInfo),this.addResolvingPromise(Promise.all([this.layer.indexInfo,this.layer.when(),this.layerView.when()]).then((([t])=>{var i;if(this.destroyed||!this.layerView||this.layerView.destroyed)return;const s=this.layerView.view;this._setClippingArea(s.clippingArea);const a=this.layerView.view.resourceController;this._handles.add([Object(watchUtils.a)(s,"pointsOfInterest.focus.renderLocation",(e=>this._pointOfInterestChanged(e))),a.memoryController.events.on("quality-changed",(()=>this._setCameraDirty())),Object(watchUtils.a)(this.layerView,"suspended",(e=>{const t=e?()=>this._updateViewData():()=>this._updateIdleState(!0),i=e?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(e&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=t,this._idleStateCallbacks.idleEnd=i):this._idleStateCallbacks=a.scheduler.registerIdleStateCallbacks(t,i)})),I3SFrameTask_n(this.layerView.view.resourceController.scheduler,{update:(e,t)=>this._frame(e,t),needsUpdate:()=>this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",(()=>this.restartNodeLoading())),this.watch(["featureTarget","fixedFeatureTarget"],(()=>{this._setCameraDirty(),this._stableFeatureLOD=!1})),s.state.watch("contentCamera",(()=>this._setCameraDirty())),this.layer.watch("elevationInfo",(()=>this._elevationInfoChanged())),this.layer.watch(["minScale","maxScale"],(()=>this._scaleBoundsChanged())),this.layerView.watch("lodFactor",(()=>this._setCameraDirty())),this.layerView.watch("availableFields?",(()=>this._requiredFieldsChange())),this.layerView.watch("holeFilling",(e=>Object(maybe.l)(this._index)&&(this._index.holeFilling=e)))]),this._updateScaleHandles(),this._viewportQueries=new I3SViewportQueries_E(this.crsIndex,s.renderCoordsHelper,s.state.contentCamera,!s.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,s.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:this.lod<.5}),this._index=new I3SIndex_g(e,t,this.indexStreamController,this._viewportQueries,I3SOnDemandController_P,this.layerView.holeFilling,(e=>this.layerView.isNodeLoaded(e)),(e=>this.layerView.isNodeReloading(e)),(e=>this._shouldLoadNode(e)),(e=>this._enableFromGPUCache(e,1)),(e=>this._needsUpdate(e)),(()=>!this.indexStreamController.busy),(e=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(e):null),null!=(i=this.layerView)&&i.computeNodeFiltering?e=>this.layerView.computeNodeFiltering(e):void 0),this._index.imModificationsChanged(!!this.layerView.hasModifications),this._startNodeLoading()}))),this._tmpPoint=Object(dehydratedFeatures.j)(0,0,0,this.crsIndex)}updateNodeModificationStatus(e){const t=this._index,i=this.layerView;Object(maybe.l)(t)&&i&&i.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),e.forAll((e=>{const i=t.getNode(e);Object(maybe.l)(i)&&this._modificationsNodeFilteringArray.push(i)})),i.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)}destroy(){this.cancelNodeLoading(),this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null),this._handles.destroy(),this._nodeLoader=null,B.prune(),Object(maybe.l)(I3SOnDemandController_E)&&(I3SOnDemandController_E.hide(),I3SOnDemandController_E=null)}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const e=this._attributeStorageInfo,t=this._fields,i=this.layer.objectIdField;return this.layerView.availableFields.map((i=>{const s=I3SOnDemandController_k(e,i),a=I3SOnDemandController_k(t,i);return s>=0&&a>=0?{index:s,name:t[a].name,field:t[a],attributeStorageInfo:e[s]}:null})).filter((e=>null!=e&&e.name!==i))}_requiredFieldsChange(){const e=this._getRequiredAttributes();H(this._requiredAttributes,e)||(this._requiredAttributes=e,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0,this.restartNodeLoading()}_setClippingArea(e){const t=Object(aaBoundingRect.l)();Object(extentUtils.b)(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null}_pointOfInterestChanged(e){Object(maybe.l)(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(e),Object(maybe.l)(this._index)&&(this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(e){this._setClippingArea(e),Object(maybe.l)(this._viewportQueries)&&Object(maybe.l)(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache()),this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=!0,this.notifyChange("rootNodeVisible"),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()}updateElevationChanged(e,t){const i=this._index;if(Object(maybe.k)(i))return;const s=i.rootNode;if(Object(maybe.k)(s))return;const a=this._elevationUpdateNodes;a.clear(),Object(I3SUtil.l)(e,t,s,this.crsIndex,i,(e=>a.push(e.index))),a.forAll((e=>{i.invalidateBoundingVolumeCache(e),e===s.index&&this.notifyChange("rootNodeVisible")})),a.length&&this.restartNodeLoading()}getParentIndex(e){return Object(maybe.l)(this._index)&&this._index.getParentIndex(e)}_elevationInfoChanged(){Object(maybe.l)(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo),this._setCameraDirty()}_updateScaleHandles(){const e="scale-bounds";this._handles.remove(e),this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",(e=>this._scaleUpdateHandler(e))),e)}_scaleBoundsChanged(){this.areScaleBoundsActive||this._loadedNodeScales.clear(),this._updateScaleHandles(),this._setCameraDirty()}_scaleUpdateHandler(e){this._updateScaleInBoundingRect(e.extent,e.spatialReference),this._setCameraDirty()}_updateScaleInBoundingRect(e,t){const i=this._index;if(Object(maybe.k)(i))return;const s=i.rootNode;!Object(maybe.k)(s)&&Object(projection.n)(e,t,z,this.crsIndex)&&this._loadedNodeScales.forEach(((e,t)=>{const s=i.getNode(t);Object(maybe.l)(s)&&Object(aaBoundingRect.x)(z,s.mbs)&&this._loadedNodeScales.set(t,this._computeScale(s))}))}restartNodeLoading(){this._restartNodeLoading=!0,this.cancelNodeLoading(),this._evaluateUpdating()}schedule(e,t){return this._idleQueue.push(e,t)}reschedule(e,t){return this._idleQueue.unshift(e,t)}get isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get areScaleBoundsActive(){const{minScale:e,maxScale:t}=Object(layerViewUtils.a)(this.layer);return this.scaleVisibilityEnabled&&(e>0||t>0)}get unloadedMemoryEstimate(){return Object(maybe.k)(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}get indexDepth(){return Object(maybe.l)(this._index)?this._index.maxLevel:0}set disableMemCache(e){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0),this._disableMemCache=e}_frame(e,t){return this.layerView.suspended?(this._updateViewData(),this._evaluateUpdating(),-1/0):!this.layerView.visible||Object(maybe.k)(this._index)?-1/0:(this._processLogError(e,t),this._index.getPriority())}_processLogError(e,t){try{this._process(e,t)}catch(i){this._errorCount<50?I3SOnDemandController_P.error("Error during processing: "+i):50===this._errorCount&&I3SOnDemandController_P.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(e,t){this._restartNodeLoading&&this._startNodeLoading(),null==this._nodeLoader||Object(maybe.k)(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(e)&&(this._invisibleDirty=!1),this.isIntegratedMesh&&(e.enabled=!1),e.run((()=>this._processIndex(e))),this._updateFeatureLOD(),e.run((()=>this._processCache(e))),this.isIntegratedMesh&&(e.enabled=!0),e.run((()=>this._processNodes(e,t))),this._idleQueue.runTask(e),e.run((()=>this._prefetchIndex())),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingCount,e.run((()=>this._lodHandling.lodGlobalHandling(e))),this._evaluateUpdating())}_processIndex(e){if(Object(maybe.k)(this._index))return!1;if(this._index.dirty){this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],e,(e=>this.updateNodeModificationStatus(e))),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length));const t=this._index.featureEstimate.leavesReached;this._index.isLoading()||t===this._get("leavesReached")||this._set("leavesReached",t)}return this._index.load()}_prefetchIndex(){return!(Object(maybe.k)(this._index)||this._loadingNodes.size>0||this._index.updates.add.length>0)&&this._index.prefetch()}_updateFeatureLOD(){if(!this.isGraphics3D||Object(maybe.k)(this._index)||Object(maybe.k)(this._viewportQueries))return;const e=!this._index.isLoading(),t=this.featureTarget*this.baseLOD,i=this._index.featureEstimate;if(i.estimate=i.estimate||t/2,this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(e&&i.estimate<t){if(i.leavesReached||this._featureLOD>=1e4||this._stableFeatureLOD)return;const e=Math.min(10,Math.max(t/i.estimate,1.001));this._featureLOD*=e;const s=this.lod,a=this._index.checkFeatureTarget(t,s);a!==s&&(this._featureLOD=a/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(i.estimate>1.2*t||e&&i.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(i.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestUpdate()}_processCache(e){const t=this._index;if(Object(maybe.k)(t))return!1;for(;this._newLoadingNodes.length>0&&!e.done;){const i=this._newLoadingNodes.pop();for(let s=t.getParent(i);Object(maybe.l)(s)&&!this.layerView.isNodeLoaded(s.index)&&this._isNodeInScaleBounds(s);s=t.getParent(s.index))if(this._enableFromGPUCache(s,0)){e.madeProgress();break}}return e.hasProgressed}_processNodes(e,t){if(Object(maybe.k)(this._index))return!1;let i=(this._isIdle?100:2)-this._loadingNodes.size;const s=this._index.updates;for(s.cancel.forEach(this._cancelNode,this),s.cancel=[];s.remove.length>0&&!e.done;)this.layerView.removeNode(s.remove.pop()),e.madeProgress();for(;s.update.length>0&&!e.done;){const t=this._index.getNode(s.update.pop());Object(maybe.l)(t)&&(this._updateLoadedNode(t),e.madeProgress())}for(;s.add.length>0&&!e.done&&i>0;){--i;const a=this._index.getNode(s.add.back());if(Object(maybe.k)(a)||2!==a.cacheState&&!this._hasNodeLoadToken(t))break;s.add.pop(),this._loadNode(a),e.madeProgress()}return e.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach((e=>e.abort())),this._loadingNodes.clear(),this._updatingNodes.forEach((e=>e.abort())),this._updatingNodes.clear()}_cancelNode(e){const t=this._loadingNodes.get(e);t&&(t.abort(),this._loadingNodes.delete(e))}_hasNodeLoadToken(e){return!(!this._isIdle&&e.numNodesLoading+this._loadingNodes.size>=2)&&this._downloadingCount<support.b&&!this.dataStreamController.busy}_evaluateUpdating(){let e=!1,t=0;if(this.layerView.suspended)e=this._cameraDirty,t=e?0:1;else{const i=(Object(maybe.l)(this._index)?this._index.getIndexMissing():0)+3*(Object(maybe.l)(this._index)?this._index.updates.add.length:0)+2*this._loadingNodes.size;e=!!(i>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===i&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(i,this._progressMaxNumNodes),t=1-i/this._progressMaxNumNodes}this.updating=e,this.updatingProgress=t}_updateViewData(){if(!this._cameraDirty||Object(maybe.k)(this._index)||Object(maybe.k)(this._viewportQueries))return;const e=this.layerView.view,{contentCamera:t,fixedContentCamera:i}=e.state;this.screenSizeFactor=1/(t.perScreenPixelRatio/2),this._viewportQueries.updateCamera(t,!i||this.isGraphics3D),this._viewportQueries.setPointOfInterest(e.pointsOfInterest.focus.renderLocation),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.invalidateVisibilityCache(),this._index.progressiveLoadPenalty=R.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate(),this._stableFeatureLOD=!1,this._invisibleDirty=!0,this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}_getProgressiveLoadFactor(){return this.layerView.view.resourceController.memoryController.memoryFactor<1?1:this.layerView.progressiveLoadFactor}get lod(){return this._featureLOD*this.baseLOD}get baseLOD(){const e=this.layerView.lodFactor,t=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(e>0?e:1)*t}get lodDropFactor(){if(this.fixedFeatureTarget)return 1;const e=this.layerView.view.resourceController.memoryController;return(Math.min(e.memoryFactor,.5)-e.minQuality)/(.5-e.minQuality)}isGeometryVisible(e){return Object(maybe.l)(this._index)&&this._index.isGeometryVisible(e.index)}updateVisibility(e){Object(maybe.l)(this._index)&&this._index.invalidateNodeVisibilityCache(e)}updateBoundingVolume(e){Object(maybe.l)(this._index)&&this._index.invalidateBoundingVolumeCache(e)}invalidateGeometryVisibility(e){Object(maybe.l)(this._index)&&this._index.invalidateGeometryVisibility(e)}invalidateVisibilityObbs(){Object(maybe.l)(this._index)&&this._index.invalidateVisibilityObbs()}modificationsChanged(){Object(maybe.l)(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications),this._invisibleDirty=!0}_shouldLoadNode(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e))&&!(!Object(maybe.l)(this._index)||!this._index.isGeometryVisible(e.index))&&this._isNodeInScaleBounds(e)}_shouldDropNode(e){if(Object(maybe.k)(this._viewportQueries))return!1;const t=this.lodDropFactor;return!(t>=1||!this._lodHandling.hasNoVisibleChildren(e))&&Math.abs(this._viewportQueries.calcCameraDistanceToCenter(e))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*t}_startNodeLoading(){this._restartNodeLoading=!1;const e=this._index;if(this._updatesDisabled||Object(maybe.k)(e)||Object(maybe.k)(this._viewportQueries))return;this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);const t={textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid};this._nodeLoader=new I3SNodeLoader_h(this.layer,this.dataStreamController,I3SOnDemandController_P,this._defaultGeometrySchema,this._requiredAttributes,t),e.requestUpdate(),this._lodHandling.startNodeLoading((e=>this._isNodeInScaleBounds(e)),((e,t)=>this._removeNodes(e,t,1)),e,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating()}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(e){const t=this._index;if(Object(maybe.k)(t)||Object(maybe.k)(this._viewportQueries))return!1;B.clear(),this.layerView.getLoadedNodeIndices(B);const i=0===this._viewportQueries.maxDistance,s=i?()=>!1:e=>this._shouldDropNode(e);return B.filterInPlace((e=>{const i=t.getNode(e);return Object(maybe.k)(i)||!t.isGeometryVisible(e)||s(i)||!this._isNodeInScaleBounds(i)})),B.length>0&&this._lodHandling.setLodGlobalDirty(),this._removeNodes(B,e,0),!(i&&this.lodDropFactor<1||0!==B.length&&(B.clear(),1))}markNodeToRemove(e){B.push(e)}removeMarkedNodes(){this._removeNodes(B,Scheduler.d,0)}_removeNodes(e,t,i){const s=e.length;if(0!==s&&!t.done){for(Object(maybe.l)(this._index)&&this._index.requestUpdate();e.length>0&&!t.done;){const s=e.pop(),a=this._index;1===i&&this.layerView.nodeFadeoutEnabled&&Object(maybe.l)(a)&&a.isGeometryVisible(s)?this.layerView.fadeNode(s,1,!0):this.layerView.removeNode(s),t.madeProgress()}if(this._loadedNodeScales.size>0)for(let t=e.length;t<s;t++){const i=e.data[t];this._loadedNodeScales.delete(i)}}}_needsUpdate(e){if(!e.resources.hasFeatureData||this._updatingNodes.has(e.index))return!1;const t=this.layerView.getLoadedAttributes(e.index);return null!=t&&t!==this._requiredAttributes}_updateLoadedNode(e){const t=new AbortController;this._updatingNodes.set(e.index,t),(H(this.layerView.getLoadedAttributes(e.index),this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(e.index)):this._nodeLoader.loadAttributes(e,this._requiredAttributes,t.signal)).then((i=>this.schedule((()=>this.layerView.updateAttributes(e.index,{loadedAttributes:this._requiredAttributes,attributeData:i},t.signal)),t.signal))).catch((i=>{if(!Object(promiseUtils.m)(i))return this.layerView.updateAttributes(e.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},t.signal)})).catch((()=>{})).then((()=>{this._updatingNodes.delete(e.index),this._evaluateUpdating()})),this._evaluateUpdating()}_loadNode(e){if(this._loadingNodes.has(e.index))return void I3SOnDemandController_P.error("already loading node "+e.index);const t=new AbortController;this._loadingNodes.set(e.index,t),this._evaluateUpdating(),this._loadAndAddNode(e,t.signal).then((e=>{e&&Object(maybe.l)(this._index)&&this._index.requestUpdate()})).catch((e=>{if(!Object(promiseUtils.m)(e))throw e})).finally((()=>{this._loadingNodes.get(e.index)===t&&this._loadingNodes.delete(e.index),this._evaluateUpdating()}))}_loadAndAddNode(e,t){return 1===e.cacheState?this._loadUncached(e,t).then((()=>!1)):this._loadCached(e,t).then((t=>!t&&(e.cacheState=1,!0))).catch((t=>!Object(promiseUtils.m)(t)&&(e.cacheState=1,!0)))}_enableFromGPUCache(e,t){if(this._disableMemCache||Object(maybe.k)(this._index))return!1;if(0===t&&!this._index.useNodeAsHole(e.index))return!0;const i=this._loadCachedGPUData(e);return!!i&&(this.layerView.addCachedGPUData(e,i,t),this._nodeAdded(),!0)}_loadCachedGPUData(e){const t=this.layerView.loadCachedGPUData(e);return Object(maybe.l)(t)&&Object(maybe.l)(t.attributeInfo)&&H(t.attributeInfo.loadedAttributes,this._requiredAttributes)?t:(this.layerView.deleteCachedGPUData(t),null)}_nodeAdded(){Object(maybe.l)(this._index)&&this._index.requestUpdate(),this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating()}_loadCached(e,t){if(this._enableFromGPUCache(e,1))return Promise.resolve(!0);const i=this.layerView;return!this.disableIDBCache&&i.loadCachedNodeData&&i.addCachedNodeData?this.schedule((()=>i.loadCachedNodeData(e,t,((t,i)=>this._nodeLoader.loadTextures(e,t,i)))),t).then((s=>{if(Object(maybe.k)(s))return!1;const a=this._requiredAttributes;return this.reschedule((()=>this._nodeLoader.loadAttributes(e,a,t)),t).then((r=>this.reschedule((()=>i.addCachedNodeData(e,s,{loadedAttributes:a,attributeData:r},t)),t))).then((()=>(this._nodeAdded(),!0)))})):Promise.resolve(!1)}_loadUncached(e,t){return this._downloadingCount++,this._nodeLoader.loadNodeData(e,t).catch((e=>{throw this._downloadingCount--,e})).then((i=>(this._downloadingCount--,this.schedule((()=>this.layerView.addNode(e,i,t)),t)))).then((()=>{this._nodeAdded(),e.cacheState=2})).catch((t=>{if(!Object(promiseUtils.m)(t))throw I3SOnDemandController_P.error("#loadNodeData()",this.layer,`Failed to load node '${e.id}'`,t),e.failed=!0,Object(maybe.l)(this._index)&&this._index.requestUpdate(),t}))}_updateIdleState(e){e!==this._isIdle&&(this._isIdle=e,this._evaluateUpdating(),e&&this._index&&Object(maybe.l)(this._index)&&this._index.resetFailedNodes())}_getScale(e){if(this._loadedNodeScales.has(e.index))return this._loadedNodeScales.get(e.index);const t=this._computeScale(e);return this.layerView.isNodeLoaded(e.index)&&this._loadedNodeScales.set(e.index,t),t}_computeScale(e){this._tmpPoint.x=e.mbs[0],this._tmpPoint.y=e.mbs[1],this._tmpPoint.z=e.mbs[2];const t=e.mbs[3];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,t)}_isNodeInScaleBounds(e){if(!this.areScaleBoundsActive)return!0;const t=this._getScale(e),{minScale:i,maxScale:s}=Object(layerViewUtils.a)(this.layer);return Object(layerViewUtils.d)(t,i,s)}updateStats(e){e.index=Object(maybe.l)(this._index)?this._index.size:0,this.isGraphics3D&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),Object(maybe.l)(this._index)&&this._index.updateStats(e)}get test(){const e=this;return{index:this._index,set disableUpdates(t){e._updatesDisabled=t,t?e.cancelNodeLoading():e.requestUpdate()},set disableIDBCache(t){e.disableIDBCache=t},set ignoreServiceObb(t){Object(maybe.l)(e._index)&&(e._index.ignoreServiceObb=t)},shouldLoadNode:t=>e._shouldLoadNode(t)}}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty(),this._evaluateUpdating(),Object(maybe.l)(this._index)&&this._index.requestUpdate()}geometryFilterChanged(e){const t=this._index;Object(maybe.l)(t)&&t.layerFilterChanged(e),this.requestUpdate()}};Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"isMeshPyramid",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"isGraphics3D",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"indexStreamController",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"dataStreamController",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"crsVertex",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"crsIndex",null),Object(tslib_es6.a)([Object(property.b)()],I3SOnDemandController_T.prototype,"screenSizeFactor",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SOnDemandController_T.prototype,"featureTarget",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SOnDemandController_T.prototype,"fixedFeatureTarget",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SOnDemandController_T.prototype,"layerView",void 0),Object(tslib_es6.a)([Object(property.b)()],I3SOnDemandController_T.prototype,"layer",void 0),Object(tslib_es6.a)([Object(property.b)({})],I3SOnDemandController_T.prototype,"updating",void 0),Object(tslib_es6.a)([Object(property.b)({})],I3SOnDemandController_T.prototype,"updatingProgress",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],I3SOnDemandController_T.prototype,"leavesReached",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],I3SOnDemandController_T.prototype,"scaleVisibilityEnabled",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,dependsOn:[]})],I3SOnDemandController_T.prototype,"rootNodeVisible",null),I3SOnDemandController_T=Object(tslib_es6.a)([Object(subclass.a)("esri.layers.graphics.controllers.I3SOnDemandController")],I3SOnDemandController_T);const B=new PooledArray.a({deallocator:null});let I3SOnDemandController_E;function H(e,t){return Object(maybe.l)(e)&&e.length===t.length&&e.every((e=>I3SOnDemandController_k(t,e.name)>=0))}function I3SOnDemandController_k(e,t){const i=t.toLowerCase();for(let s=0;s<e.length;s++)if(e[s].name.toLowerCase()===i)return s;return-1}const R={factorIM:.2,factor3dObject:.05,distancePenalty:10},z=Object(aaBoundingRect.l)(),K=I3SOnDemandController_T},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SAttributeOverrides.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return I3SAttributeOverrides_f}));var request=__webpack_require__("./node_modules/@arcgis/core/request.js"),arrayUtils=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),asyncUtils=__webpack_require__("./node_modules/@arcgis/core/core/asyncUtils.js"),byteSizeEstimations=__webpack_require__("./node_modules/@arcgis/core/core/byteSizeEstimations.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),number=__webpack_require__("./node_modules/@arcgis/core/intl/number.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js");async function featureQueryAll_t(r,t,o){t=t.clone(),r.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=featureQueryAll_u(r));const i=featureQueryAll_a(r),n=r.capabilities.query.supportsPagination;t.start=0,t.num=i;let s=null;for(;;){const a=await r.source.queryFeaturesJSON(t,o);if(Object(maybe.k)(s)?s=a:s.features=s.features.concat(a.features),s.exceededTransferLimit=a.exceededTransferLimit,!n||!a.exceededTransferLimit)break;t.start+=i}return s}function featureQueryAll_a(e){return featureQueryAll_u(e)*function featureQueryAll_o(e){return e.capabilities.query.maxRecordCount||2e3}(e)}function featureQueryAll_u(e){return e.capabilities.query.supportsMaxRecordCountFactor?Query.a.MAX_MAX_RECORD_COUNT_FACTOR:1}const p=Logger.a.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");class I3SAttributeOverrides_f{constructor(e,t){this.layer=e,this.warnMaximumChangedObjectsExceeded=!1,this.changedObjectIds=new Set,this.pendingFetchAbortController=new AbortController,this.interactiveEditingSessions=null,this._maximumNumberOfEditOVerrides=j,this.memCache=t.newCache(`${e.uid}-attribute-overrides`),this.pendingFetchChangedObjectIds=this.fetchChangedObjectIds(this.pendingFetchAbortController.signal),this.pendingFetchChangedObjectIds.then((()=>this.pendingFetchAbortController=null))}destroy(){this.layer=null,this.memCache.destroy(),this.memCache=null,this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null),this.pendingFetchChangedObjectIds=null}createInteractiveEditSession(e){this.changedObjectIds.add(e),Object(maybe.k)(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const t=this.interactiveEditingSessions,i=new y(e,{rollback:()=>{Object(arrayUtils.j)(t,i),0===t.length&&(this.interactiveEditingSessions=null)},commit:t=>{for(const[s,i]of t)this.updateValue(e,s,i)}});return t.unshift(i),i}async apply(e,t,s){if(Object(maybe.k)(t))return;const{loadedAttributes:i,attributeData:r}=t;if(Object(maybe.k)(i)||0===i.length||Object(maybe.k)(r))return;if(await Object(promiseUtils.A)(this.pendingFetchChangedObjectIds,s),0===this.changedObjectIds.size)return;const a={loadedAttributes:i,attributeData:r},n=this.getOverridesFromCache(e,a,this.changedObjectIds),{objectIds:o,fieldNames:d}=n,h=await this.queryOverridesFromAssociatedLayer(o,d,s);Object(maybe.k)(h)||this.processOverridesFromAssociatedLayer(e,h,d,a)}updateValue(e,t,s){this.changedObjectIds.add(e),this.cacheValue(e,t,s)}cacheValue(e,t,s){this.memCache.put(this.getCacheKey(e,t),s,this.memCacheValueSize(s))}getOverridesFromCache(e,{loadedAttributes:t,attributeData:s},i){const r=new Set,a=new Array;for(const o of t)a[o.index]=s[o.name];const n=new Set;for(let o=0;o<e.length;o++){const s=e[o];if(i.has(s))for(const e of t){const t=this.fromCache(s,e.index);void 0===t?(r.add(s),n.add(e.name)):a[e.index][o]=t}}return{objectIds:Array.from(r),fieldNames:Array.from(n)}}fromCache(e,t){const s=this.fromInteractiveEditingSession(e,t);if(void 0!==s)return s;const i=this.getCacheKey(e,t);return this.memCache.get(i)}fromInteractiveEditingSession(e,t){if(!Object(maybe.k)(this.interactiveEditingSessions))for(const s of this.interactiveEditingSessions){if(s.objectId!==e)continue;const i=s.get(t);if(void 0!==i)return i}}getCacheKey(e,t){return`${e}-${t}`}async queryOverridesFromAssociatedLayer(e,s,r){if(0===e.length||0===s.length)return null;e=e.sort(((e,t)=>e-t)),this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this.logMaximumObjectsExceededWarning());const a=Object(maybe.u)(this.layer.associatedLayer),n=a.createQuery();n.where="1=1",n.returnGeometry=!1,n.outFields=[a.objectIdField,...s],n.cacheHint=!0,n.objectIds=e;const o=featureQueryAll_a(a),c=e.length>o?Object(arrayUtils.n)(e,o).map((e=>{const t=n.clone();return t.objectIds=e,Object(asyncUtils.e)(featureQueryAll_t(a,t,{signal:r}))})):[Object(asyncUtils.e)(featureQueryAll_t(a,n,{signal:r}))];return(await Promise.all(c)).reduce(((e,t)=>e.concat(t.ok?t.value.features:[])),[])}logMaximumObjectsExceededWarning(){let e=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${Object(number.b)(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;const t=this.layer.portalItem;t&&t.loaded?e+=` (${t.portal.url}/home/item.html?id=${t.id}#settings)`:e+=` (${this.layer.parsedUrl.path})`,p.warn("#queryOverrides()",this.layer.title,`${e}.`)}processOverridesFromAssociatedLayer(e,t,s,{loadedAttributes:i,attributeData:r}){const a=Object(maybe.u)(this.layer.associatedLayer).objectIdField,n=s.map((e=>r[e])),o=new Map(i.map((e=>[e.name,e.index]))),c=s.map((e=>o.get(e))),h=new Map(Array.from(e,((e,t)=>[e,t])));for(const d of t){const e=d.attributes[a];for(let t=0;t<s.length;t++){const i=c[t],r=h.get(e),a=d.attributes[s[t]];n[t][r]=a,this.cacheValue(e,i,a)}}}memCacheValueSize(e){return"string"==typeof e?Object(byteSizeEstimations.d)(e):Object(byteSizeEstimations.c)()}async fetchChangedObjectIds(t){var s,i,a;const n=this.layer;if(await n.load({signal:t}),this.changedObjectIds.clear(),Object(maybe.k)(n.associatedLayer)||null==(s=n.associatedLayer.capabilities)||null==(i=s.operations)||!i.supportsChangeTracking)return;const o=this.getFetchChangedObjectIdsServerGen();if(Object(maybe.k)(o))return null;const d=n.associatedLayer.layerId,m=await Object(asyncUtils.d)(Object(request.default)(`${n.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${d}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:d,serverGen:o}])},timeout:O,signal:t})),u=m.ok&&null!=(a=m.value.data)&&a.edits?Object(maybe.j)(m.value.data.edits[0],"objectIds","updates"):null;if(Object(maybe.l)(u)){const e=Math.min(this._maximumNumberOfEditOVerrides,u.length);e<u.length&&(this.warnMaximumChangedObjectsExceeded=!0);const t=u.sort(((e,t)=>e-t));for(let s=0;s<e;s++)this.changedObjectIds.add(t[s])}}getFetchChangedObjectIdsServerGen(){const e=this.layer;if(Object(maybe.l)(e.serviceUpdateTimeStamp)&&Object(maybe.l)(e.serviceUpdateTimeStamp.lastUpdate))return e.serviceUpdateTimeStamp.lastUpdate;const t=e.associatedLayer;return Object(maybe.l)(t)&&Object(maybe.l)(t.serverGens)&&Object(maybe.l)(t.serverGens.minServerGen)?t.serverGens.minServerGen:null}get test(){const e=Array.from(this.changedObjectIds),t=this.pendingFetchChangedObjectIds,s=this;return{changedObjectIds:e,pendingFetchChangedObjectIds:t,get maximumNumberOfEditOVerrides(){return s._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(e){s._maximumNumberOfEditOVerrides=e}}}}class y{constructor(e,t){this.objectId=e,this.options=t,this.updates=new Map,this.state=0}get(e){return this.updates.get(e)}set(e,t){this.isActive&&this.updates.set(e,t)}rollback(){this.isActive&&(this.state=2,this.options.rollback())}commit(){this.isActive&&(this.state=1,this.options.commit(this.updates),this.updates.clear())}get isActive(){return 0===this.state}}const O=1e4,j=5e4},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return g})),__webpack_require__.d(__webpack_exports__,"b",(function(){return y})),__webpack_require__.d(__webpack_exports__,"c",(function(){return c})),__webpack_require__.d(__webpack_exports__,"d",(function(){return C}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_lang_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_LEPCC_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/LEPCC.js");const i=_core_Logger_js__WEBPACK_IMPORTED_MODULE_2__.a.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function u(t,n,r){let o="",i=0;for(;i<r;){const u=t[n+i];if(u<128)o+=String.fromCharCode(u),i++;else if(u>=192&&u<224){if(i+1>=r)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const a=(31&u)<<6|63&t[n+i+1];o+=String.fromCharCode(a),i+=2}else if(u>=224&&u<240){if(i+2>=r)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(15&u)<<12|(63&t[n+i+1])<<6|63&t[n+i+2];o+=String.fromCharCode(a),i+=3}else{if(!(u>=240&&u<248))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(i+3>=r)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(7&u)<<18|(63&t[n+i+1])<<12|(63&t[n+i+2])<<6|63&t[n+i+3];if(a>=65536){const e=55296+(a-65536>>10),t=56320+(1023&a);o+=String.fromCharCode(e,t)}else o+=String.fromCharCode(a);i+=4}}}return o}function a(e,t){const n={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let o=0;o<t.length;o++){const i=t[o],u=i.valueType||i.type,a=I[u];n.fields[i.property]=a(e,r),r+=m[u].BYTES_PER_ELEMENT}return n.byteCount=r,n}function s(t,n,r){const o=[];let i,a,s=0;for(a=0;a<t;a+=1){if(i=n[a],i>0){if(o.push(u(r,s,i-1)),0!==r[s+i-1])throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("string-array-error","Invalid string array: missing null termination.")}else o.push(null);s+=i}return o}function c(e,t){return new(0,m[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function l(n,r,o){const i=null!=r.header?a(n,r.header):{byteOffset:0,byteCount:0,fields:{count:o}},u={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let a=0;a<r.ordering.length;a++){const n=r.ordering[a],o=Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_1__.a)(r[n]);if(o.count=i.fields.count,"String"===o.valueType){if(o.byteOffset=s,o.byteCount=i.fields[n+"ByteCount"],"UTF-8"!==o.encoding)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("unsupported-encoding","Unsupported String encoding.",{encoding:o.encoding})}else{if(!h(o.valueType))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("unsupported-value-type","Unsupported binary valueType",{valueType:o.valueType});{const e=A(o.valueType);s+=s%e!=0?e-s%e:0,o.byteOffset=s,o.byteCount=e*o.valuesPerElement*o.count}}s+=o.byteCount,u.entries[n]=o}return u.byteCount=s-u.byteOffset,u}function b(t,n,r){if(n!==t&&i.error(`Invalid ${r} buffer size\n expected: ${t}, actual: ${n})`),n<t)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:n})}function y(e,t){const n=a(e,t&&t.header);let r=n.byteCount;const o={isDraco:!1,header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:{}},i=n.fields,u=null!=i.vertexCount?i.vertexCount:i.count;for(const a of t.ordering){if(!t.vertexAttributes[a])continue;const e={...t.vertexAttributes[a],byteOffset:r,count:u},n=p[a]?p[a]:"_"+a;o.vertexAttributes[n]=e,r+=A(e.valueType)*e.valuesPerElement*u}const s=i.faceCount;if(t.faces&&s){o.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const n={...t.faces[e],byteOffset:r,count:s};o.faces[e]=n,r+=A(n.valueType)*n.valuesPerElement*s}}const c=i.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&c){o.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const n={...t.featureAttributes[e],byteOffset:r,count:c};o.featureAttributes[e]=n,r+=("UInt64"===n.valueType?8:A(n.valueType))*n.valuesPerElement*c}}return b(r,e.byteLength,"geometry"),o.byteCount=r-o.byteOffset,o}function g(e,t){return e&&e.compressedAttributes&&"draco"===e.compressedAttributes.encoding?function v(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e)switch(n){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}(e.compressedAttributes.attributes):e?function d(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}(e):function w(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e.ordering)if(e.vertexAttributes[n])switch(n){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}(t)}const p={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"};function C(t,n,u){if("lepcc-rgb"===t.encoding)return Object(_LEPCC_js__WEBPACK_IMPORTED_MODULE_3__.b)(n);if("lepcc-intensity"===t.encoding)return Object(_LEPCC_js__WEBPACK_IMPORTED_MODULE_3__.a)(n);if(null!=t.encoding&&""!==t.encoding)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(i.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),"ObjectIds"===t.ordering[0]&&t.hasOwnProperty("objectIds")&&(i.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const a=l(n,t,u);b(a.byteOffset+a.byteCount,n.byteLength,"attribute");const d=a.entries.attributeValues||a.entries.objectIds;if(d){if("String"===d.valueType){const e=a.entries.attributeByteCounts,t=c(n,e),r=function f(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}(n,d);return s(e.count,t,r)}return c(n,d)}throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const m={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},I={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function h(e){return m.hasOwnProperty(e)}function A(e){return h(e)?m[e].BYTES_PER_ELEMENT:0}},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SMaterialUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return I3SMaterialUtil_F})),__webpack_require__.d(__webpack_exports__,"b",(function(){return I3SMaterialUtil_f})),__webpack_require__.d(__webpack_exports__,"c",(function(){return I3SMaterialUtil_c})),__webpack_require__.d(__webpack_exports__,"d",(function(){return I3SMaterialUtil_p})),__webpack_require__.d(__webpack_exports__,"e",(function(){return I3SMaterialUtil_T})),__webpack_require__.d(__webpack_exports__,"f",(function(){return C}));var has=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),mathUtils=__webpack_require__("./node_modules/@arcgis/core/core/mathUtils.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js");class RenderTexture_s{constructor(t,s){this._textureRep=t,this._disposed=!1;const i=this._textureRep.acquire(s);i.then((t=>{this._disposed?Object(maybe.s)(t):this._textureRef=t})),this.loadPromise=i}dispose(){this._textureRef=Object(maybe.s)(this._textureRef),this._disposed=!0}bind(e,s,i){const r=Object(maybe.l)(this._textureRef)?this._textureRef.glTexture:null;Object(maybe.l)(r)&&(e.bindTexture(r,s),e.setUniform2f(i,r.descriptor.width,r.descriptor.height))}}var PhysicallyBasedRenderingParameters_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl.js"),AlphaDiscard_glsl=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js"),spatialReferenceUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js");var Texture=__webpack_require__("./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js");function I3SMaterialUtil_c(e,a){const r=new Map,t=(e,a)=>{if(Object(maybe.k)(e))return-1;if(r.has(e.id)){const o=r.get(e.id);return o.usage|=a,o.id}const o=r.size;return r.set(e.id,{id:o,usage:a}),o},l=a.pbrMetallicRoughness,i=l&&l.baseColorFactor,u=a.emissiveFactor,c=null==a.normalTexture&&null==a.emissiveTexture&&null==a.occlusionTexture&&(!l||null==l.metallicRoughnessTexture&&1===l.roughnessFactor&&(1===l.metallicFactor||0===l.metallicFactor)),g=c?PhysicallyBasedRenderingParameters_glsl.a[0]:l?l.metallicFactor:1,p=c?PhysicallyBasedRenderingParameters_glsl.a[1]:l?l.roughnessFactor:1,h="mask"===a.alphaMode?33:1,f={baseColorFactor:i?[i[0],i[1],i[2],i[3]]:[1,1,1,1],baseColorTextureId:t(l&&l.baseColorTexture,h),metallicRoughnessTextureId:t(l&&l.metallicRoughnessTexture,2),metallicFactor:g,roughnessFactor:p},x={alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,cullFace:"none"===a.cullFace?0:"back"===a.cullFace?2:"front"===a.cullFace?1:void 0,normalTextureId:t(a.normalTexture,4),emissiveTextureId:t(a.emissiveTexture,16),occlusionTextureId:t(a.occlusionTexture,8),emissiveFactor:u?[u[0],u[1],u[2]]:[0,0,0],metallicRoughness:f,wrapTextures:!1,hasParametersFromSource:c},b=[];return r.forEach((({usage:a},r)=>{const s=Object(maybe.l)(e)&&e[r]&&e[r].formats,t=s?I3SMaterialUtil_m(s.map((({name:e,format:a})=>({name:e,encoding:I3SMaterialUtil_d[a]})))):[];b.push({id:r,usage:a,encodings:t})})),{material:x,textures:b}}function I3SMaterialUtil_m(e){return e.sort(((e,a)=>e.encoding-a.encoding))}const I3SMaterialUtil_d={ktx2:1,basis:2,dds:4,png:8,jpg:16,"ktx-etc2":32},I3SMaterialUtil_g={[Texture.a.KTX2_ENCODING]:2,[Texture.a.BASIS_ENCODING]:2,[Texture.a.DDS_ENCODING]:4,"image/png":8,"image/jpg":16,"image/jpeg":16,"image/ktx":32};function I3SMaterialUtil_p(e){const r=e&&e.materialDefinitions?Object.keys(e.materialDefinitions)[0]:null,o=e&&e.textureDefinitions?Object.keys(e.textureDefinitions)[0]:null,s=r&&e.materialDefinitions[r],t=o&&e.textureDefinitions[o],n=I3SMaterialUtil_h();if(null!=s){const e=s.params;e.diffuse&&(n.metallicRoughness.baseColorFactor=[e.diffuse[0],e.diffuse[1],e.diffuse[2],1]),null!=e.doubleSided&&(n.doubleSided=e.doubleSided,n.cullFace=e.doubleSided?0:2),"none"!==e.cullFace&&"front"!==e.cullFace&&"back"!==e.cullFace||(n.cullFace="none"===e.cullFace?0:"back"===e.cullFace?2:1),e.transparency&&(n.metallicRoughness.baseColorFactor[3]=Object(mathUtils.f)(1-e.transparency,0,1)),(e.useVertexColorAlpha||n.metallicRoughness.baseColorFactor[3]<1)&&(n.alphaMode="blend")}const l=[];if(null!=t){const e=0;!t.wrap||"repeat"!==t.wrap[0]&&"repeat"!==t.wrap[1]||(n.wrapTextures=!0);let a=1;"rgba"===t.channels&&(n.alphaMode="blend",a|=32);const r=t.images.length-1,o=t.images[r],s=e=>e&&e.split("/").pop(),i=Array.isArray(t.encoding)?I3SMaterialUtil_m(t.encoding.map(((e,a)=>({name:s(o.href[a]),encoding:I3SMaterialUtil_g[e]||0})))):[{name:s(o.href),encoding:I3SMaterialUtil_g[t.encoding]||0}];l.push({id:e,usage:a,encodings:i}),n.metallicRoughness.baseColorTextureId=e}return{material:n,textures:l}}const I3SMaterialUtil_h=()=>({alphaMode:"opaque",alphaCutoff:AlphaDiscard_glsl.b,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0});function I3SMaterialUtil_f(e,a,o,t){if(Object(maybe.k)(e)||null==e.data)return null;const n=e.data,l=!(n instanceof HTMLImageElement)||Object(mathUtils.k)(n.width)&&Object(mathUtils.k)(n.height),i=t.renderingContext.parameters.maxMaxAnisotropy,c=o&&!t.capabilities.shaderTextureLOD?1:i,m=l&&!e.downsampled&&c>1,d=o||!a.wrapTextures?I3SMaterialUtil_x:I3SMaterialUtil_b,g=function I(e){switch(e){case 1:return Texture.a.KTX2_ENCODING;case 2:return Texture.a.BASIS_ENCODING;case 4:return Texture.a.DDS_ENCODING;case 8:return"image/png";case 16:return"image/jpeg";case 32:return"image/ktx";default:return""}}(e.encoding),p=1&e.usage?"opaque"===a.alphaMode?3:4:3;return new Texture.a(n,{mipmap:m,maxAnisotropy:c,encoding:g,wrap:d,components:p,noUnpackFlip:!0})}const I3SMaterialUtil_x={s:33071,t:33071},I3SMaterialUtil_b={s:10497,t:10497};function I3SMaterialUtil_F(e,r,s,n,u,c){const m=c.rendererTextureUsage,d=e=>function w(e,a,r){if(Object(maybe.k)(e)||0===r)return null;for(let s=0;s<e.length;s++){const t=e[s];if(Object(maybe.l)(t)&&0!=(t.usage&r)){const e=a[s];return Object(maybe.l)(e)?e.id:null}}return null}(n,s,e&m),g=r.metallicRoughness.baseColorFactor,p=Object(mathUtils.f)(r.metallicRoughness.baseColorFactor[3],0,1);e.baseColor=[g[0],g[1],g[2],p],e.hasParametersFromSource=!!r.hasParametersFromSource,e.usePBR=c.usePBR,e.mrrFactors=[r.metallicRoughness.metallicFactor,r.metallicRoughness.roughnessFactor,r.hasParametersFromSource?.2:.5],e.emissiveFactor=r.emissiveFactor,e.isIntegratedMesh=c.isIntegratedMesh,e.alphaCutoff="mask"===r.alphaMode?r.alphaCutoff:AlphaDiscard_glsl.b,e.alphaDiscardMode="opaque"===r.alphaMode?1:"mask"===r.alphaMode?2:3;const h=[],f=d(33);Object(maybe.l)(f)&&(e.baseColorTexture=new RenderTexture_s(u,f),h.push(e.baseColorTexture.loadPromise));const x=d(2);Object(maybe.l)(x)&&(e.metallicRoughnessTexture=new RenderTexture_s(u,x),h.push(e.metallicRoughnessTexture.loadPromise));const b=d(16);Object(maybe.l)(b)&&(e.emissionTexture=new RenderTexture_s(u,b),h.push(e.emissionTexture.loadPromise));const F=d(8);Object(maybe.l)(F)&&(e.occlusionTexture=new RenderTexture_s(u,F),h.push(e.occlusionTexture.loadPromise));const T=d(4);return Object(maybe.l)(T)&&(e.normalTexture=new RenderTexture_s(u,T),h.push(e.normalTexture.loadPromise)),e.commonMaterialParameters.slicePlaneEnabled=c.slicePlaneEnabled,e.commonMaterialParameters.doubleSided=r.doubleSided,e.commonMaterialParameters.cullFace=r.cullFace,e.ellipsoidMode=function EllipsoidMode_t(t){return t&&Object(spatialReferenceUtils.i)(t)?2:t&&Object(spatialReferenceUtils.j)(t)?3:1}(c.viewSpatialReference),Promise.all(h)}function I3SMaterialUtil_T(a){const r=!!a.compressedTextureS3TC,o=!!a.compressedTextureETC,s=Object(has.a)("disable-feature:i3s-basis")?0:3;return 24|(r?4|s:0)|(o?s:0)}function C(e,a){return e.find((e=>0!=(e.encoding&a)))}},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SProjectionUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return a})),__webpack_require__.d(__webpack_exports__,"b",(function(){return h}));var _chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js");function a(o,n,a,s){const c=h(o,n,a),i=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_0__.d)();return Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_2__.d)(a,c,i,s),i}function h(t,r,a){const h=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_1__.f)(),i=t[3],e=2**(4*Math.ceil(Math.log(i)*Math.LOG2E/4)+1);if(a.isGeographic){const o=e/Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_3__.e)(a).radius*180/Math.PI,r=Math.round(t[1]/o),s=Math.max(-90,Math.min(90,r*o)),c=o/Math.cos((Math.abs(s)-o/2)/180*Math.PI),i=Math.round(t[0]/c)*c;h[0]=i,h[1]=s}else{const o=Math.round(t[0]/e),r=Math.round(t[1]/e);h[0]=o*e,h[1]=r*e}const M=t[2]+r,m=Math.round(M/e);return h[2]=m*e,h}},"./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Ie})),__webpack_require__.d(__webpack_exports__,"b",(function(){return Re})),__webpack_require__.d(__webpack_exports__,"c",(function(){return qe})),__webpack_require__.d(__webpack_exports__,"d",(function(){return xe})),__webpack_require__.d(__webpack_exports__,"e",(function(){return Me})),__webpack_require__.d(__webpack_exports__,"f",(function(){return ge})),__webpack_require__.d(__webpack_exports__,"g",(function(){return Se})),__webpack_require__.d(__webpack_exports__,"h",(function(){return Ze})),__webpack_require__.d(__webpack_exports__,"i",(function(){return X})),__webpack_require__.d(__webpack_exports__,"j",(function(){return _})),__webpack_require__.d(__webpack_exports__,"k",(function(){return se})),__webpack_require__.d(__webpack_exports__,"l",(function(){return Y})),__webpack_require__.d(__webpack_exports__,"m",(function(){return be})),__webpack_require__.d(__webpack_exports__,"n",(function(){return he})),__webpack_require__.d(__webpack_exports__,"o",(function(){return re})),__webpack_require__.d(__webpack_exports__,"p",(function(){return de})),__webpack_require__.d(__webpack_exports__,"q",(function(){return Ae})),__webpack_require__.d(__webpack_exports__,"r",(function(){return ye})),__webpack_require__.d(__webpack_exports__,"s",(function(){return ne})),__webpack_require__.d(__webpack_exports__,"t",(function(){return ee})),__webpack_require__.d(__webpack_exports__,"u",(function(){return We})),__webpack_require__.d(__webpack_exports__,"v",(function(){return Ce})),__webpack_require__.d(__webpack_exports__,"w",(function(){return ze})),__webpack_require__.d(__webpack_exports__,"x",(function(){return ie}));var _request_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/request.js"),_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_has_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/has.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@arcgis/core/core/typedArrayUtil.js"),_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3.js"),_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat3f64.js"),_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4.js"),_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/chunks/mat4f64.js"),_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/chunks/quat.js"),_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/chunks/quatf32.js"),_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@arcgis/core/chunks/vec4f64.js"),_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js"),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@arcgis/core/geometry/SpatialReference.js"),_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/spatialReferenceUtils.js"),_rest_support_Query_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js"),_I3SProjectionUtil_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SProjectionUtil.js"),_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/edgeUtils.js"),_support_symbolColorUtils_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/symbolColorUtils.js"),_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js");function V(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function X(e){if(Object(_core_has_js__WEBPACK_IMPORTED_MODULE_3__.a)("disable-feature:i3s-draco")||!e)return!1;for(const r of e)for(const e of r.geometryBuffers){var t;if("draco"===(null==(t=e.compressedAttributes)?void 0:t.encoding))return!0}return!1}function Y(e,t,r,o,n,a){n.traverse(r,(r=>{let n=r.mbs;t!==o&&(n=oe,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.o)(r.mbs,o,n,t));const s=ne(e,n);return 0!==s&&(a(r,s),!0)}))}function _(e,t,r){let o=0,n=0;for(let a=0;a<t.length&&o<e.length;a++)e[o]===t[a]&&(r(a)&&(e[n]=e[o],n++),o++);e.length=n}function ee(e,r,o){let n=0,a=0;for(;n<o.length;)Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.b)(e,o[n])>=0===r&&(o[a]=o[n],a++),n++;o.length=a}const te=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)();function re(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return te[0]=(e[0]-t.position[0])/t.rotationScale[0],te[1]=(e[1]-t.position[1])/t.rotationScale[4],te[2]=(e[2]-t.position[0])/t.rotationScale[0],te[3]=(e[3]-t.position[1])/t.rotationScale[4],te}const oe=Object(_chunks_vec4f64_js__WEBPACK_IMPORTED_MODULE_15__.e)();function ne(e,t){const r=t[0],o=t[1],n=t[3],a=e[0]-r,s=r-e[2],i=e[1]-o,c=o-e[3],l=Math.max(a,s,0),f=Math.max(i,c,0),u=l*l+f*f;return u>n*n?0:u>0?1:-Math.max(a,s,i,c)>n?3:2}function se(e,t,r){const o=[],n=r&&r.missingFields,a=r&&r.originalFields;for(const s of e){const e=s.toLowerCase();let r=!1;for(const n of t)if(e===n.name.toLowerCase()){o.push(n.name),r=!0,a&&a.push(s);break}!r&&n&&n.push(s)}return o}async function ie(e,t,o,a,c){if(0===t.length)return[];const l=e.attributeStorageInfo;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e.associatedLayer))try{return await async function le(e,t,r,o){t.sort(((e,t)=>e.attributes[r]-t.attributes[r]));const n=t.map((e=>e.attributes[r])),a=[],s=se(o,e.fields,{originalFields:a}),i=await fe(e,n,s);for(let c=0;c<t.length;c++){const e=t[c],r=i[c],o={};if(e.attributes)for(const t in e.attributes)o[t]=e.attributes[t];for(let t=0;t<a.length;t++)o[a[t]]=r[s[t]];e.attributes=o}return t}(e.associatedLayer,t,o,a)}catch(f){if(e.associatedLayer.loaded)throw f}if(l){const s=function ce(e,t,r){const o=new Map,n=[],a=r();for(const s of e){const e=s.attributes[t];for(let t=0;t<a.length;t++){const r=a[t],i=r.featureIds.indexOf(e);if(i>=0){let e=o.get(r.node);e||(e={node:r.node,indices:[],graphics:[]},n.push(e),o.set(r.node,e)),e.indices.push(i),e.graphics.push(s);for(let r=t;r>0;r--)a[r]=a[r-1];a[0]=r;break}}}return n}(t,o,c);if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(s))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const f=e.parsedUrl.path,u=await Promise.all(s.map((e=>function ue(t,r,o,n,a){const s=[];for(const e of r)if(e&&-1!==a.indexOf(e.name)){const r=`${t}/nodes/${o.resources.attributes}/attributes/${e.key}/0`;s.push({url:r,storageInfo:e})}return Object(_core_promiseUtils_js__WEBPACK_IMPORTED_MODULE_5__.j)(s.map((t=>Object(_request_js__WEBPACK_IMPORTED_MODULE_0__.default)(t.url,{responseType:"array-buffer"}).then((e=>Object(_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_22__.d)(t.storageInfo,e.data)))))).then((e=>{const t=[];for(const r of n){const o={};for(let t=0;t<e.length;t++)null!=e[t].value&&(o[s[t].storageInfo.name]=he(e[t].value,r));t.push(o)}return t}))}(f,l,e.node,e.indices,a).then((t=>{for(let r=0;r<e.graphics.length;r++){const o=e.graphics[r],n=t[r];if(o.attributes)for(const e in o.attributes)e in n||(n[e]=o.attributes[e]);o.attributes=n}return e.graphics})))));return Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.f)(u)}throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function fe(e,t,a){const s=e.capabilities.query.maxRecordCount;if(null!=s&&t.length>s){const n=Object(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.n)(t,s);return Promise.all(n.map((t=>fe(e,t,a)))).then(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_1__.f)}const i=new _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_21__.a({objectIds:t,outFields:a,orderByFields:[e.objectIdField]});return e.queryFeatures(i).then((e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map((e=>e.attributes));throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")}))}function he(e,t){if(!e)return null;const r=e[t];return Object(_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__.f)(e)?-32768===r?null:r:Object(_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_6__.g)(e)?-2147483648===r?null:r:r!=r?null:r}function de(e){const t=e.store.indexCRS||e.store.geographicCRS,r=void 0===t?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const o=t?new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__.a(V(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function ye(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=void 0===t?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const o=t?new _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_18__.a(V(t)):e.spatialReference;return o.equals(e.spatialReference)?e.spatialReference:o}function be(e,t){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(t)?"@null":t===Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function ge(e,t,r){if(!Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.b)(e,t))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&!function we(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}(e,t))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function Se(e,t,r){const o=de(e),n=ye(e);ge(o,t,r),ge(n,t,r)}function Me(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function ve(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function xe(e,t){Se(e,t.spatialReference,t.viewingMode)}function qe(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function je(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_2__.a("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Re(e,t){ge(e.spatialReference,t.spatialReference,t.viewingMode)}function Te(e){return"mesh-3d"===e.type}function We(e){if(null==e||!function ke(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const r of t){if(!Te(r)||0===r.symbolLayers.length)return!0;for(const e of r.symbolLayers.items)if("fill"!==e.type||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e.material)||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(e.material.color)||"replace"!==e.material.colorMixMode)return!0}return!1}const ze=Object(_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__.c)({color:[0,0,0,0],opacity:0});class Fe{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Ae(e){const t=new Fe;let r=!1,o=!1;for(const n of e.symbolLayers.items)if("fill"===n.type&&n.enabled){const e=n.material,a=n.edges;if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e)&&!r){const o=e.color,a=Object(_support_symbolColorUtils_js__WEBPACK_IMPORTED_MODULE_25__.b)(e.colorMixMode);Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(o)?t.material={color:[o.r/255,o.g/255,o.b/255],alpha:o.a,colorMixMode:a}:t.material={color:[1,1,1],alpha:1,colorMixMode:1},t.castShadows=n.castShadows,r=!0}Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(a)&&!o&&(t.edgeMaterial=Object(_support_edgeUtils_js__WEBPACK_IMPORTED_MODULE_24__.b)(a,{}),o=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:1}),t}function Ie(e,t){return(0|e)+(0|t)|0}function Ce(e,t,r,o,n=0){o===Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(o)?t.isGeographic?function Qe(e,t,r,o){const n=Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.e)(r),a=1+Math.max(0,o)/(n.radius+e.center[2]);Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,e.center[0],e.center[1],e.center[2]+o),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(t.center,r,0,t.center,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r),0,1),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.a)(t.quaternion,e.quaternion),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.b)(He,e.quaternion),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(Ye,0,0,1),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.w)(Ye,Ye,He),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(Ye,e.halfSize[0]*Math.abs(Ye[0]),e.halfSize[1]*Math.abs(Ye[1]),e.halfSize[2]*Math.abs(Ye[2])),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.g)(Ye,Ye,n.inverseFlattening),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.h)(t.halfSize,e.halfSize,Ye),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.g)(t.halfSize,t.halfSize,a)}(e,r,t,n):function $e(e,t,r,o){Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.d)(e,Je),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,e.center[0],e.center[1],e.center[2]+o),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.d)(r,t.center,De,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r)),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.center,De[12],De[13],De[14]);const n=2*Math.sqrt(1+De[0]+De[5]+De[10]);He[0]=(De[6]-De[9])/n,He[1]=(De[8]-De[2])/n,He[2]=(De[1]-De[4])/n,He[3]=.25*n,Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.g)(t.quaternion,He,e.quaternion),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.b)(He,t.quaternion);let a=0,s=0,i=0;for(const c of Je)c[2]+=o,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(c,r,0,c,Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r),0,1),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.B)(Ye,c,t.center),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.w)(Ye,Ye,He),a=Math.max(a,Math.abs(Ye[0])),s=Math.max(s,Math.abs(Ye[1])),i=Math.max(i,Math.abs(Ye[2]));Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(t.halfSize,a,s,i)}(e,r,t,n):t.isWGS84&&(o.isWebMercator||Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__.k)(o))?function Ue(e,t,r,o,n){Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(Be,t.center),Be[2]+=n;const a=Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_17__.g)(r);Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(Be,e,0,Be,a,0,1),Pe(a,t,Be,r,o)}(t,e,o,r,n):t.isWebMercator&&Object(_geometry_support_spatialReferenceUtils_js__WEBPACK_IMPORTED_MODULE_20__.k)(o)?function Oe(e,t,r,o,n){Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(Be,t.center),Be[2]+=n,Pe(e,t,Be,r,o)}(t,e,o,r,n):e===r?(r.center[2]+=n,Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(r.center,t,0,r.center,o,0,1)):(Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.y)(r.center,e.center[0],e.center[1],e.center[2]+n),Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(r.center,t,0,r.center,o,0,1),Object(_chunks_quat_js__WEBPACK_IMPORTED_MODULE_11__.a)(r.quaternion,e.quaternion),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(r.halfSize,e.halfSize))}const Ge=new Float64Array(24),Ke={data:Ge,size:3},Le=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__.f)(),Be=Object(_chunks_vec3f64_js__WEBPACK_IMPORTED_MODULE_14__.f)(),Ee=Object(_chunks_mat3f64_js__WEBPACK_IMPORTED_MODULE_8__.b)();function Pe(e,t,r,o,n){const a=Object(_chunks_mat3_js__WEBPACK_IMPORTED_MODULE_7__.h)(Ee,t.quaternion);for(let s=0;s<8;++s){for(let e=0;e<3;++e)Le[e]=t.halfSize[e]*(0!=(s&1<<e)?-1:1);for(let e=0;e<3;++e){let t=r[e];for(let r=0;r<3;++r)t+=Le[r]*a[3*r+e];Ge[3*s+e]=t}}Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.p)(Ge,e,0,Ge,o,0,8),Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.c)(Ke,n)}function Ze(e,t,r,o,n,a){if(!a||0===a.length||Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.k)(t))return null;const c=Object(_I3SProjectionUtil_js__WEBPACK_IMPORTED_MODULE_23__.a)(e.mbs,n,r,t);let l;Object(_chunks_mat4_js__WEBPACK_IMPORTED_MODULE_9__.b)(et,c);const f=()=>{if(!l)if(l=Je,Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.n)(Ve),Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_4__.l)(e.serviceObb)){Ce(e.serviceObb,r,Xe,t,n),Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.d)(Xe,l);for(const e of l)Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(e,e,et),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ve,e)}else{const o=e.mbs,a=o[3];Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.y)(o,r,Ye,t),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,Ye,et),Ye[2]+=n;for(let e=0;e<8;++e){const t=1&e?a:-a,r=2&e?a:-a,o=4&e?a:-a,n=l[e];Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.m)(n,[Ye[0]+t,Ye[1]+r,Ye[2]+o]),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ve,n)}}};let u=1/0,p=-1/0;if(a.forEach((e=>(e=>{if("replace"!==e.type)return;const r=e.geometry;if(!r.hasZ)return;Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.n)(Ne);const n=r.spatialReference||o,a=r.rings.reduce(((e,r)=>r.reduce(((e,r)=>(Object(_geometry_projection_js__WEBPACK_IMPORTED_MODULE_16__.y)(r,n,Ye,t),Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,Ye,et),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.q)(Ne,Ye),Math.min(Ye[2],e))),e)),1/0);f(),Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.w)(Ve,Ne)&&(u=Math.min(u,a),p=Math.max(p,a))})(e))),u===1/0)return null;const d=(e,t,r)=>{Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2],t+=24,r[2]=u,Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2],t+=24,r[2]=p,Object(_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_13__.s)(Ye,r,c),e[t+0]=Ye[0],e[t+1]=Ye[1],e[t+2]=Ye[2]};for(let s=0;s<8;++s)d(_e.data,3*s,l[s]);return Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.c)(_e)}const De=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__.d)(),He=Object(_chunks_quatf32_js__WEBPACK_IMPORTED_MODULE_12__.b)(),Je=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ne=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)(),Ve=Object(_geometry_support_aaBoundingRect_js__WEBPACK_IMPORTED_MODULE_19__.l)(),Xe=Object(_support_orientedBoundingBox_js__WEBPACK_IMPORTED_MODULE_26__.e)(),Ye=[0,0,0],_e={data:new Array(72),size:3},et=Object(_chunks_mat4f64_js__WEBPACK_IMPORTED_MODULE_10__.d)()},"./node_modules/@arcgis/core/views/3d/layers/i3s/LEPCC.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return w})),__webpack_require__.d(__webpack_exports__,"b",(function(){return u})),__webpack_require__.d(__webpack_exports__,"c",(function(){return c}));var _core_Error_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js");const t=!0,o_identifierOffset=0,o_identifierLength=10,o_versionOffset=10,o_checksumOffset=12,o_byteCount=16;function r(e,r,n){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,n+o_identifierOffset,o_identifierLength)),version:r.getUint16(n+o_versionOffset,t),checksum:r.getUint32(n+o_checksumOffset,t)}}const n_sizeLo=0,n_sizeHi=4,n_minX=8,n_minY=16,n_minZ=24,n_maxX=32,n_maxY=40,n_maxZ=48,n_errorX=56,n_errorY=64,n_errorZ=72,n_count=80,n_reserved=84,n_byteCount=88;function i(e,o){return{sizeLo:e.getUint32(o+n_sizeLo,t),sizeHi:e.getUint32(o+n_sizeHi,t),minX:e.getFloat64(o+n_minX,t),minY:e.getFloat64(o+n_minY,t),minZ:e.getFloat64(o+n_minZ,t),maxX:e.getFloat64(o+n_maxX,t),maxY:e.getFloat64(o+n_maxY,t),maxZ:e.getFloat64(o+n_maxZ,t),errorX:e.getFloat64(o+n_errorX,t),errorY:e.getFloat64(o+n_errorY,t),errorZ:e.getFloat64(o+n_errorZ,t),count:e.getUint32(o+n_count,t),reserved:e.getUint32(o+n_reserved,t)}}function c(t){const c=new DataView(t,0);let d=0;const{identifier:l,version:a}=r(t,c,d);if(d+=o_byteCount,"LEPCC     "!==l)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad identifier");if(a>1)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Unknown version");const u=i(c,d);if(d+=n_byteCount,u.sizeHi*2**32+u.sizeLo!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");const f=new Float64Array(3*u.count),h=[],w=[],g=[],p=[];if(d=s(t,d,h),d=s(t,d,w),d=s(t,d,g),d=s(t,d,p),d!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad length");let m=0,U=0;for(let e=0;e<h.length;e++){U+=h[e];let t=0;for(let o=0;o<w[e];o++){t+=g[m];const e=p[m];f[3*m]=Math.min(u.maxX,u.minX+2*u.errorX*t),f[3*m+1]=Math.min(u.maxY,u.minY+2*u.errorY*U),f[3*m+2]=Math.min(u.maxZ,u.minZ+2*u.errorZ*e),m++}}return{errorX:u.errorX,errorY:u.errorY,errorZ:u.errorZ,result:f}}function s(e,t,o){const r=[];t=d(e,t,r);const n=[];for(let i=0;i<r.length;i++){n.length=0,t=d(e,t,n);for(let e=0;e<n.length;e++)o.push(n[e]+r[i])}return t}function d(o,r,n){const i=new DataView(o,r),c=i.getUint8(0),s=31&c,d=!!(32&c),l=(192&c)>>6;let a=0;if(0===l)a=i.getUint32(1,t),r+=5;else if(1===l)a=i.getUint16(1,t),r+=3;else{if(2!==l)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad count type");a=i.getUint8(1),r+=2}if(d)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","LUT not implemented");const u=Math.ceil(a*s/8),f=new Uint8Array(o,r,u);let h=0,w=0,g=0;const p=-1>>>32-s;for(let e=0;e<a;e++){for(;w<s;)h|=f[g]<<w,w+=8,g+=1;n[e]=h&p,h>>>=s,w-=s,w+s>32&&(h|=f[g-1]>>8-w)}return r+g}const l_sizeLo=0,l_sizeHi=4,l_count=8,l_colorMapCount=12,l_lookupMethod=14,l_compressionMethod=15,l_byteCount=16;function a(e,o){return{sizeLo:e.getUint32(o+l_sizeLo,t),sizeHi:e.getUint32(o+l_sizeHi,t),count:e.getUint32(o+l_count,t),colorMapCount:e.getUint16(o+l_colorMapCount,t),lookupMethod:e.getUint8(o+l_lookupMethod),compressionMethod:e.getUint8(o+l_compressionMethod)}}function u(t){const n=new DataView(t,0);let i=0;const{identifier:c,version:s}=r(t,n,i);if(i+=o_byteCount,"ClusterRGB"!==c)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad identifier");if(s>1)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Unknown version");const d=a(n,i);if(i+=l_byteCount,d.sizeHi*2**32+d.sizeLo!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");if((2===d.lookupMethod||1===d.lookupMethod)&&0===d.compressionMethod){if(3*d.colorMapCount+d.count+i!==t.byteLength||d.colorMapCount>256)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad count");const o=new Uint8Array(t,i,3*d.colorMapCount),r=new Uint8Array(t,i+3*d.colorMapCount,d.count),n=new Uint8Array(3*d.count);for(let e=0;e<d.count;e++){const t=r[e];n[3*e]=o[3*t],n[3*e+1]=o[3*t+1],n[3*e+2]=o[3*t+2]}return n}if(0===d.lookupMethod&&0===d.compressionMethod){if(3*d.count+i!==t.byteLength||0!==d.colorMapCount)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad count");return new Uint8Array(t,i).slice()}if(d.lookupMethod<=2&&1===d.compressionMethod){if(i+3!==t.byteLength||1!==d.colorMapCount)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad count");const o=n.getUint8(i),r=n.getUint8(i+1),c=n.getUint8(i+2),s=new Uint8Array(3*d.count);for(let e=0;e<d.count;e++)s[3*e]=o,s[3*e+1]=r,s[3*e+2]=c;return s}throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad method "+d.lookupMethod+","+d.compressionMethod)}const f_sizeLo=0,f_sizeHi=4,f_count=8,f_scaleFactor=12,f_bitsPerPoint=14,f_reserved=15,f_byteCount=16;function h(e,o){return{sizeLo:e.getUint32(o+f_sizeLo,t),sizeHi:e.getUint32(o+f_sizeHi,t),count:e.getUint32(o+f_count,t),scaleFactor:e.getUint16(o+f_scaleFactor,t),bitsPerPoint:e.getUint8(o+f_bitsPerPoint),reserved:e.getUint8(o+f_reserved)}}function w(t){const n=new DataView(t,0);let i=0;const{identifier:c,version:s}=r(t,n,i);if(i+=o_byteCount,"Intensity "!==c)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad identifier");if(s>1)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Unknown version");const l=h(n,i);if(i+=f_byteCount,l.sizeHi*2**32+l.sizeLo!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");const a=new Uint16Array(l.count);if(8===l.bitsPerPoint){if(l.count+i!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");const o=new Uint8Array(t,i,l.count);for(let e=0;e<l.count;e++)a[e]=o[e]*l.scaleFactor}else if(16===l.bitsPerPoint){if(2*l.count+i!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");const o=new Uint16Array(t,i,l.count);for(let e=0;e<l.count;e++)a[e]=o[e]*l.scaleFactor}else{const o=[];if(d(t,i,o)!==t.byteLength)throw new _core_Error_js__WEBPACK_IMPORTED_MODULE_0__.a("lepcc-decode-error","Bad size");for(let e=0;e<l.count;e++)a[e]=o[e]*l.scaleFactor}return a}},"./node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";function n(n,t,e){if(!e||null==t)return null;if(!n)return function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}(t,e);const o=n.get(e);return o?t[o.name]:null}__webpack_require__.d(__webpack_exports__,"a",(function(){return n}))},"./node_modules/@arcgis/core/views/3d/support/GraphicsMap.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return s}));var _core_Evented_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),_core_MapUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/MapUtils.js");class s extends _core_Evented_js__WEBPACK_IMPORTED_MODULE_0__.a{constructor(){super(...arguments),this._map=new Map}clear(){if(this._map.size>0){const e=this.toArray();this._map.clear(),this.emit("change",{added:[],removed:e})}}get length(){return this._map.size}get(e){return this._map.get(e)}addMany(e){if(0===e.length)return;const t=new Set;for(let r=0;r<e.length;r++){const s=e[r],o=s.objectId,n=this._map.get(o);n?(t.add(o),s!==n&&(e[r]=n),++n.refCount):(s.refCount=1,this._map.set(o,s))}const s=t.size>0?e.filter((e=>!t.has(e.objectId))):e;s.length>0&&this.emit("change",{added:s,removed:[]})}removeMany(e){const t=[];for(const s of e){const e=s.objectId,r=this._map.get(e);null!=r&&--r.refCount<=0&&(this._map.delete(e),t.push(s))}t.length>0&&this.emit("change",{added:[],removed:t})}removeManyByObjectId(e){const t=[];for(const s of e){const e=this._map.get(s);null!=e&&--e.refCount<=0&&(this._map.delete(s),t.push(e))}t.length>0&&this.emit("change",{added:[],removed:t})}toArray(){return[...this._map.values()]}find(e){let s;return Object(_core_MapUtils_js__WEBPACK_IMPORTED_MODULE_1__.c)(this._map,(t=>!!e(t)&&(s=t,!0))),s}forEach(e){this._map.forEach((t=>e(t)))}}}}]);