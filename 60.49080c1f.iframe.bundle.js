(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"./node_modules/@arcgis/core/views/3d/layers/SceneLayerGraphicsView3D.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return Y}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),vec3=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3.js"),vec3f64=__webpack_require__("./node_modules/@arcgis/core/chunks/vec3f64.js"),projection=__webpack_require__("./node_modules/@arcgis/core/geometry/projection.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),contains=__webpack_require__("./node_modules/@arcgis/core/geometry/support/contains.js"),zscale=__webpack_require__("./node_modules/@arcgis/core/geometry/support/zscale.js"),dehydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/dehydratedFeatures.js"),hydratedFeatures=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/hydratedFeatures.js"),I3SOnDemandController=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/controllers/I3SOnDemandController.js"),FeatureFilter=__webpack_require__("./node_modules/@arcgis/core/layers/support/FeatureFilter.js"),renderingInfoUtils=__webpack_require__("./node_modules/@arcgis/core/renderers/support/renderingInfoUtils.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),WorkerHandle=__webpack_require__("./node_modules/@arcgis/core/core/workers/WorkerHandle.js");class I3SPointsWorkerHandle_e extends WorkerHandle.a{constructor(r){super("SceneLayerWorker","dracoDecompressPointCloudData",r,{hasInitialize:!0})}getTransferList(r){return[r.geometryBuffer]}}var LayerView3D=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/LayerView3D.js"),Graphics3DFeatureLikeLayerView=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js"),QueryEngine=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js"),attributeEditing=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/attributeEditing.js"),I3SAttributeOverrides=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SAttributeOverrides.js"),I3SUtil=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js"),DefinitionExpressionSceneLayerView=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/DefinitionExpressionSceneLayerView.js"),fieldProperties=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/fieldProperties.js"),PopupSceneLayerView=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js"),SceneLayerViewRequiredFields=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/SceneLayerViewRequiredFields.js"),debugFlags=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/debugFlags.js"),GraphicsMap=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/GraphicsMap.js"),orientedBoundingBox=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/orientedBoundingBox.js"),updatingProperties=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/updatingProperties.js"),SceneLayerView=__webpack_require__("./node_modules/@arcgis/core/views/layers/SceneLayerView.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");const K=Logger.a.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),Z=Object(fieldProperties.a)();let J=class extends(Object(DefinitionExpressionSceneLayerView.a)(Object(PopupSceneLayerView.a)(Object(LayerView3D.a)(SceneLayerView.a)))){constructor(){super(...arguments),this.type="scene-layer-graphics-3d",this._nodesAddedToStage=new Map,this.drapeSourceType=1,this._queryEngine=null,this._memCache=null,this._interactiveEditingSessions=new Map,this.loadedGraphics=new GraphicsMap.a,this.holeFilling="always",this.progressiveLoadFactor=1,this.supportsHeightUnitConversion=!0,this._coordinatesOutsideExtentErrors=0,this._maxCoordinatesOutsideExtentErrors=20}initialize(){var e,t;const r=this.layer;this.addResolvingPromise(r.indexInfo),this._attributeOverrides=new I3SAttributeOverrides.a(this.layer,null==(e=this.view.resourceController)?void 0:e.memoryController),Object(I3SUtil.g)(r,this.view.spatialReference,this.view.viewingMode),this.fieldsHelper=new SceneLayerViewRequiredFields.a({layerView:this}),this.updatingHandles.add(r,"rangeInfos",(e=>this._rangeInfosChanged(e)),2),this.updatingHandles.add(r,"renderer",((e,t)=>this._rendererChange(e,t))),this.updatingHandles.add(this,"parsedDefinitionExpression",(()=>this._filterChange())),this.updatingHandles.add(this,"view.floors",(()=>this.graphics3d.filterVisibility.filterChanged())),this.handles.add(Object(watchUtils.a)(debugFlags.a,"I3S_TREE_SHOW_TILES",(e=>{if(e&&!this._treeDebugger){const e=this._controller.crsIndex;__webpack_require__.e(39).then(__webpack_require__.bind(null,"./node_modules/@arcgis/core/views/3d/layers/support/I3STreeDebugger.js")).then((({I3STreeDebugger:t})=>{!this._treeDebugger&&debugFlags.a.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new t({lv:this,view:this.view,nodeSR:e}))}))}else e||!this._treeDebugger||debugFlags.a.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}))),this._set("graphics3d",new Graphics3DFeatureLikeLayerView.a({owner:this,layer:r,preferredUpdatePolicy:0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:r.fullExtent,updateClippingExtent:e=>this._updateClippingExtent(e)})),null==(t=this.graphics3d.elevationAlignment)||t.events.on("invalidate-elevation",(e=>this._invalidateElevation(e))),this.supportsHeightUnitConversion&&(this._verticalScale=Object(zscale.a)("point",r.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.graphics3d.setup()),this._memCache=this.view.resourceController.memoryController.newCache(r.uid),this._controller=new I3SOnDemandController.a({layerView:this,scaleVisibilityEnabled:!1}),Object(I3SUtil.i)(this.layer.geometryDefinitions)&&(this._worker=new I3SPointsWorkerHandle_e((e=>this.view.resourceController.schedule(e)))),this.handles.add(this.layer.on("apply-edits",(e=>this.updatingHandles.addPromise(e.result)))),this.handles.add(this.layer.on("edits",(e=>this._handleEdits(e)))),this.when((()=>{this._queryEngine=new QueryEngine.a({layerView:this,priority:Scheduler.b.FEATURE_QUERY_ENGINE}),this.updatingHandles.add(this,"maximumNumberOfFeatures",(e=>this._controller.featureTarget=e),2),this.updatingHandles.add(this,"suspended",(e=>{e&&this._removeAllNodeData()}))}))}destroy(){this._treeDebugger=Object(maybe.e)(this._treeDebugger),this._attributeOverrides=Object(maybe.e)(this._attributeOverrides),this._set("graphics3d",Object(maybe.e)(this.graphics3d)),this._controller=Object(maybe.e)(this._controller),this._queryEngine=Object(maybe.e)(this._queryEngine),this._worker=Object(maybe.e)(this._worker),this._memCache=Object(maybe.e)(this._memCache),this._nodesAddedToStage.clear(),this.fieldsHelper=Object(maybe.e)(this.fieldsHelper)}get requiredFields(){var e,t;return null!=(e=null==(t=this.fieldsHelper)?void 0:t.requiredFields)?e:[]}get maximumNumberOfFeatures(){const e=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return e?e.maximumNumberOfFeatures:0}set maximumNumberOfFeatures(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return!this.suspended&&!!this._controller&&!this._controller.leavesReached}get hasM(){return!1}get hasZ(){return!0}notifyGraphicGeometryChanged(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}async whenGraphicAttributes(e,t){return Object(I3SUtil.x)(this.layer,e,this._getObjectIdField(),t,(()=>[...this._nodesAddedToStage.values()]))}getGraphicFromGraphicUid(e){if(!this.loadedGraphics)return null;const t=Object(hydratedFeatures.c)(this.loadedGraphics.find((t=>t.uid===e)),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,t):null}whenGraphicBounds(e,t){return this.graphics3d.graphicsCore.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t)}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}isUpdating(){var e,t,r;return!!(null!=(e=this._controller)&&e.updating||null!=(t=this.graphics3d)&&t.updating||null!=(r=this.fieldsHelper)&&r.updating)}getRenderingInfo(e,t,r){const i=Object(renderingInfoUtils.c)(e,{renderer:t,arcade:r});if(Object(maybe.l)(i)&&i.color){const e=i.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return i}async getRenderingInfoAsync(e,t,r,i){return Object(renderingInfoUtils.d)(e,{renderer:t,arcade:r,...i})}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}highlight(e){return this.graphics3d.highlight(e,this.layer.objectIdField)}get updatePolicy(){return this.graphics3d.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(e){return Object(attributeEditing.a)(this.attributeEditingContext,e)}async extractBinaryPointData(e,t){const r={geometryBuffer:e.geometryBuffer};return Object(maybe.k)(this._worker)&&(this._worker=new I3SPointsWorkerHandle_e((e=>this.view.resourceController.schedule(e)))),this._worker.invoke(r,t).then((e=>{if(Object(maybe.l)(e))return{positionData:e.positions,featureIds:e.featureIds};throw new Error("Failed to decompress Draco point data")}))}checkExtent(e,t){e&&!Object(contains.b)(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&K.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&K.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)}async addNode(e,t,r){if(!X(t)&&!$(t))return Promise.reject();if(this._nodesAddedToStage.has(e.index))return void K.error("I3S node "+e.id+" already added");const i=Object(maybe.l)(this.layer.fullExtent)?function te(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}(this.layer.fullExtent.clone(),.5):null,o=this._controller.crsVertex,a=[],n={graphics:null,featureIds:null,attributeInfo:t.attributeDataInfo,node:e};if(X(t)?await this._addNodeBinaryPointData(e,n,t,i,a,r):$(t)&&this._addNodeLegacyPointData(e,n,t,i,a),await this._attributeOverrides.apply(n.featureIds,t.attributeDataInfo,r),e.numFeatures=n.graphics.length,this._updateNodeMemory(e),ee(n),a.length>0&&(this.computeObb(e,a,o),this._controller.updateVisibility(e.index)),!this._controller.isGeometryVisible(e))return this._cacheNodeData(n),Promise.resolve();if(Object(maybe.l)(this._verticalScale))for(const s of n.graphics)this._verticalScale(s.geometry);return this._nodesAddedToStage.set(e.index,n),this.loadedGraphics.addMany(n.graphics),this._filterNode(n),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve()}computeObb(e,t,r){const i=this._controller.crsIndex,s=i.isGeographic?this.view.renderSpatialReference:i;Object(projection.p)(t,r,0,t,s,0,t.length/3);const o={data:t,size:3};e.serviceObb=Object(orientedBoundingBox.c)(o),i.isGeographic&&Object(projection.y)(e.serviceObb.center,s,e.serviceObb.center,i)}isNodeLoaded(e){return this._nodesAddedToStage.has(e)}isNodeReloading(){return!1}updateNodeState(){}async _addNodeBinaryPointData(e,r,i,o,n,d){const l=await this.extractBinaryPointData(i,d);if(null==l)return Promise.reject();const c=this._getObjectIdField(),g=this._controller.crsVertex,m=this.view.spatialReference,y=this.graphics3d.graphicsCore,{positionData:f,featureIds:_}=l,E=f.length/3,x=new Array;for(let I=0;I<E;I++){const r=Object(maybe.l)(e.serviceObb)?e.serviceObb.center:[0,0,0],i=3*I,d=Object(vec3f64.h)(f[i+0],f[i+1],f[i+2]);Object(vec3.h)(d,d,r),e.serviceObb||n.push(d[0],d[1],d[2]),Object(maybe.l)(o)&&this.checkExtent(o,d);const l=_[I],E={};null!=l&&(E[c]=l);const w=null==l?Graphic.a.generateUID():l;Object(projection.p)(d,g,0,ie,m,0,1);const S=Object(dehydratedFeatures.j)(ie[0],ie[1],ie[2],m),C=this.loadedGraphics.get(w);if(Object(maybe.l)(C))C.level<e.level&&(se.property="geometry",se.graphic=C,se.oldValue=Object(maybe.u)(C.geometry),se.newValue=S,C.geometry=S,y.graphicUpdateHandler(se)),x.push(C);else{const r=Graphic.a.generateUID();x.push({objectId:w,uid:r,geometry:S,attributes:E,visible:!0,level:e.level})}}r.graphics=x,r.featureIds=_}_addNodeLegacyPointData(e,r,i,o,a){const n=this._getObjectIdField(),d=this._controller.crsVertex,l=this.view.spatialReference,h=[0,0,0],u=new Array,c=new Array;for(const g of i.pointData){const r=g.featureDataPosition,i=r.length,m=g.geometries&&g.geometries[0]||re[i],y=g.featureIds[0];if("points"!==m.params.type)continue;Object(maybe.l)(o)&&this.checkExtent(o,r);const f={};null!=y&&(f[n]=y);const _=null==y?Graphic.a.generateUID():y;let v;"Embedded"===m.type&&(v=m.params.vertexAttributes.position);for(let o=0;o<v.length;o+=i){for(let e=0;e<i;e++)h[e]=r[e]+v[o+e];const n=3===i;e.serviceObb||a.push(h[0],h[1],n?h[2]:0),Object(projection.p)(h,d,0,ie,l,0,1);const u=Object(dehydratedFeatures.j)(ie[0],ie[1],n?ie[2]:void 0,l),g=this.loadedGraphics.get(_);Object(maybe.l)(g)?c.push(g):c.push({objectId:_,uid:Graphic.a.generateUID(),geometry:u,attributes:f,visible:!0})}u.push(y)}r.graphics=c,r.featureIds=u}_updateNodeMemory(e){e.memory=4096+(Object(maybe.l)(e.numFeatures)?e.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(e){const t=e.graphics.reduce(((e,t)=>Object(dehydratedFeatures.e)(t)+e),512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}_getMemCacheKey(e){return`${e.index}`}_removeAllNodeData(){this._nodesAddedToStage.forEach((e=>{if(e){const t=e.node;this._updateNodeMemory(t),this._cacheNodeData(e)}})),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}removeNode(e){const t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}_removeNodeStageData(e){const t=this._nodesAddedToStage.get(e);return t?(this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}async loadCachedNodeData(e){return this._memCache.pop(this._getMemCacheKey(e))}async addCachedNodeData(e,t,r,i){if(!this._nodesAddedToStage.has(e.index))return this.loadedGraphics.addMany(t.graphics),this._nodesAddedToStage.set(e.index,t),this._updateNodeMemory(e),await this.updateAttributes(e.index,r,i),this._filterNode(t),this._treeDebugger&&this._treeDebugger.update(),Promise.resolve();K.error("I3S node "+e.id+" already added")}getLoadedNodeIds(){const e=[];return this._nodesAddedToStage.forEach((t=>e.push(t.node.id))),e.sort()}getVisibleNodes(){const e=new Array;return this._nodesAddedToStage.forEach((t=>e.push(t.node))),e}getLoadedNodeIndices(e){this._nodesAddedToStage.forEach(((t,r)=>e.push(r)))}getLoadedAttributes(e){const t=this._nodesAddedToStage.get(e);if(t&&Object(maybe.l)(t.attributeInfo))return t.attributeInfo.loadedAttributes}getAttributeData(e){const t=this._nodesAddedToStage.get(e);if(t&&Object(maybe.l)(t.attributeInfo))return t.attributeInfo.attributeData}setAttributeData(e,t){const r=this._nodesAddedToStage.get(e);r&&!Object(maybe.k)(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}async updateAttributes(e,t,r){const i=this._nodesAddedToStage.get(e);i&&(await this._attributeOverrides.apply(i.featureIds,t,r),i.attributeInfo=t,this._attributeValuesChanged(i))}_attributeValuesChanged(e){if(ee(e),this._filterNode(e),this.graphics3d.graphicsCore.labelsEnabled){const t=e.graphics.map((e=>e.uid));this.graphics3d.graphicsCore.updateLabelingInfo(t)}}_updateClippingExtent(e){return this._controller&&this._controller.updateClippingArea(e),!1}_getObjectIdField(){return this.layer.objectIdField||"OBJECTID"}async _rendererChange(e,t){const{layer:{fieldsIndex:r}}=this,i=new Set;let s,o;e?(await e.collectRequiredFields(i,r),s=Array.from(i).sort()):s=[],i.clear(),t?(await t.collectRequiredFields(i,r),o=Array.from(i).sort()):o=[],s.length===o.length&&s.every(((e,t)=>s[t]===o[t]))||this._reloadAllNodes()}_rangeInfosChanged(e){null!=e&&e.length>0&&K.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this._nodesAddedToStage.forEach((e=>this._filterNode(e)))}_reloadAllNodes(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}_filterNode(e){const t=this.parsedDefinitionExpression;for(const r of e.graphics){const e=r.visible;r.visible=!t||this._evaluateClause(t,r),e!==r.visible&&(se.graphic=r,se.property="visible",se.oldValue=e,se.newValue=r.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(se))}}_invalidateElevation(e){const t=this._controller.crsIndex;Object(projection.n)(e.extent,e.spatialReference,oe,t),this._controller.updateElevationChanged(oe,t)}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return Object(maybe.l)(this.filter)?this.filter.createQuery(e):new Query.a(e)}queryFeatures(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null==t?void 0:t.signal)}queryObjectIds(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryExtent(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQuery(e){return this._addDefinitionExpressionToQuery(Object(maybe.k)(e)?this.createQuery():Query.a.from(e))}getUsedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return e?e.usedMemory:0}getUnloadedMemory(){const e=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(e?e.unprocessedMemoryEstimate:0))}ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}_handleEdits(e){Object(attributeEditing.b)(this.attributeEditingContext,e)}get attributeEditingContext(){const e=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:e,forEachNode:e=>this._nodesAddedToStage.forEach((t=>e(t.node,t.featureIds))),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(t,r,i)=>{this.setAttributeData(t,r);const o=this._nodesAddedToStage.get(t);if(Object(maybe.l)(i)){const t=this.loadedGraphics.get(i.attributes[e]);Object(maybe.l)(t)&&this.graphics3d.graphicsCore.recreateGraphics([t])}else Object(maybe.l)(o)&&this.graphics3d.graphicsCore.recreateGraphics(o.graphics)},clearMemCache:()=>{}}}get performanceInfo(){const e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}get test(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}};Object(tslib_es6.a)([Object(property.b)()],J.prototype,"graphics3d",void 0),Object(tslib_es6.a)([Object(property.b)({type:FeatureFilter.a})],J.prototype,"filter",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"loadedGraphics",void 0),Object(tslib_es6.a)([Object(property.b)({aliasOf:"layer"})],J.prototype,"i3slayer",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"_controller",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"updating",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"suspended",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"holeFilling",void 0),Object(tslib_es6.a)([Object(property.b)(updatingProperties.a)],J.prototype,"updatingProgress",void 0),Object(tslib_es6.a)([Object(property.b)({aliasOf:"_controller.updatingProgress"})],J.prototype,"updatingProgressValue",void 0),Object(tslib_es6.a)([Object(property.b)(Z.requiredFields)],J.prototype,"requiredFields",null),Object(tslib_es6.a)([Object(property.b)(Z.availableFields)],J.prototype,"availableFields",void 0),Object(tslib_es6.a)([Object(property.b)()],J.prototype,"fieldsHelper",void 0),Object(tslib_es6.a)([Object(property.b)({type:Number})],J.prototype,"maximumNumberOfFeatures",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],J.prototype,"maximumNumberOfFeaturesExceeded",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],J.prototype,"lodFactor",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],J.prototype,"hasM",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],J.prototype,"hasZ",null),J=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.SceneLayerGraphicsView3D")],J);const Y=J;function $(e){return"pointData"in e}function X(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function ee(e){const t=e.attributeInfo;for(let r=0;r<e.graphics.length;r++){const i=e.graphics[r];if(i.attributes||(i.attributes={}),Object(maybe.l)(t)&&Object(maybe.l)(t.loadedAttributes))for(const{name:e}of t.loadedAttributes)t.attributeData[e]&&(i.attributes[e]=Object(I3SUtil.n)(t.attributeData[e],r))}}const re={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ie=Object(vec3f64.f)(),se={graphic:null,property:null,oldValue:null,newValue:null},oe=Object(aaBoundingRect.l)()},"./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Graphics3DElevationAlignment_d}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),Evented=__webpack_require__("./node_modules/@arcgis/core/core/Evented.js"),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),PooledArray=__webpack_require__("./node_modules/@arcgis/core/core/PooledArray.js"),aaBoundingRect=__webpack_require__("./node_modules/@arcgis/core/geometry/support/aaBoundingRect.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");class ExtentSet_c{constructor(){this._extents=new PooledArray.a({allocator:t=>t||Object(aaBoundingRect.l)()}),this._tmpExtent=Object(aaBoundingRect.l)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),Object(aaBoundingRect.k)(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=Scheduler.d){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=Object(aaBoundingRect.d)(h),g=Object(aaBoundingRect.d)(i),m=this._tmpExtent;Object(aaBoundingRect.p)(h,i,m);const d=c+g;(Object(aaBoundingRect.d)(m)-d)/d<.05&&(Object(aaBoundingRect.k)(h,m),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this._dirty=!1}contains(t){return this._extents.some((e=>Object(aaBoundingRect.g)(e,t)))}removeContained(t){this._extents.filterInPlace((e=>!Object(aaBoundingRect.g)(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>Object(aaBoundingRect.h)(t,e)))}}}let p=class extends Accessor.a{constructor(){super(...arguments),this.dirtyExtents=new ExtentSet_c,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new Handles.a,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new Evented.a}setup(t,e,i,s){this.layerView=t,this.queryGraphicUIDsInExtent=e,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on("elevation-change",(t=>this._elevationChanged(t))),this.layerView.watch("suspended",(()=>this.suspendedChange())),r.registerTask(Scheduler.b.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(t){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,t.madeProgress()),t.run((()=>this.dirtyExtents.merge(t)));this.running&&!t.done;)this._updateDirtyGraphics(t),this._updateDirtyExtents(t);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(t){const e=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),Object(maybe.l)(a)&&(a.alignWithElevation(this.elevationProvider,e,i),t.madeProgress()),t.done)return}}_updateDirtyExtents(t){for(;!this.dirtyExtents.empty&&!t.done;){const e=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:e,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(e,i,(t=>{const e=this.graphicsCore.getGraphics3DGraphicById(t);Object(maybe.l)(e)&&e.needsElevationUpdates()&&this.dirtyGraphicsSet.add(t)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,t.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((t,e)=>this.dirtyGraphicsSet.add(e)))}_elevationChanged(t){if("scene"===t.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:e,spatialReference:i}=t;if(this.layerView.suspended){if(!this.updateElevation){const t=this.graphicsCore.computedExtent;t&&e[2]>t.xmin&&e[0]<t.xmax&&e[3]>t.ymin&&e[1]<t.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:e,spatialReference:i})}else e[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(e),this.notifyChange("updating")}};Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],p.prototype,"updating",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],p.prototype,"updatingRemaining",null),p=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],p);const Graphics3DElevationAlignment_d=p},"./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return v}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Graphic=__webpack_require__("./node_modules/@arcgis/core/Graphic.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),compilerUtils=__webpack_require__("./node_modules/@arcgis/core/core/compilerUtils.js"),Handles=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),promiseUtils=__webpack_require__("./node_modules/@arcgis/core/core/promiseUtils.js"),watchUtils=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),diffUtils=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/diffUtils.js"),webMercatorUtils=__webpack_require__("./node_modules/@arcgis/core/geometry/support/webMercatorUtils.js"),Query=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),constants=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/constants.js"),Graphics3DCore=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DCore.js"),Graphics3DElevationAlignment=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),FeatureFilter=__webpack_require__("./node_modules/@arcgis/core/layers/support/FeatureFilter.js"),QueryEngine=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js"),floorFilterUtils=__webpack_require__("./node_modules/@arcgis/core/views/support/floorFilterUtils.js"),Scheduler=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");const p=Logger.a.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");let _=class extends Accessor.a{constructor(...e){super(...e),this._dirty=!1,this._querying=!1,this._handles=new Handles.a}get updating(){return this._dirty||this._querying||Object(maybe.l)(this._queryResult)}setup(e,i){this._layerView=e,this._core=i,this._objectIdField=e.layer.objectIdField,this._queryEngine=new QueryEngine.a({layerView:this._layerView,priority:Scheduler.b.FILTER_VISIBILITY});const t=this._layerView.view.resourceController.scheduler;this._handles.add(t.registerTask(Scheduler.b.FILTER_VISIBILITY,this)),this._handles.add(Object(watchUtils.b)(i.owner,"loadedGraphics","after-changes",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this._filter&&(this._filter=e,this.dirty=!0)}get active(){return this._filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e="filter"in this._layerView?this._layerView.filter:null,i="timeExtent"in this._layerView?this._layerView.timeExtent:null,t=Object(floorFilterUtils.b)(this._layerView);if(Object(maybe.k)(i)&&Object(maybe.k)(t))return e;const r=Object(maybe.l)(e)?e.clone():new FeatureFilter.a;if(Object(maybe.l)(i)&&(r.timeExtent=Object(maybe.l)(r.timeExtent)?r.timeExtent.intersection(i):i),Object(maybe.l)(t)){const e=null==r.where||""===r.where;r.where=e?t:`(${r.where}) AND (${t})`}return r}get running(){return this._dirty&&!this._querying||Object(maybe.l)(this._queryResult)}runTask(e){if(!this.active)return void this.clear();!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{if(!Object(promiseUtils.m)(e)){p.warn("FeatureFilter query failed: "+e,{error:e});const i=new Set;this._core.graphics3DGraphics.forEach((e=>i.add(this._getFeatureId(e.graphic)))),this._queryResult=i,this._querying=!1}})),e.madeProgress());const i=this._queryResult;Object(maybe.l)(i)&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((t=>{if(e.done)return!1;const r=i.has(this._getFeatureId(t.graphic));return!!t.setVisibilityFlag(2,r,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null))}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty=e}};Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],_.prototype,"updating",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],_.prototype,"running",null),Object(tslib_es6.a)([Object(property.b)()],_.prototype,"_dirty",void 0),Object(tslib_es6.a)([Object(property.b)()],_.prototype,"_querying",void 0),Object(tslib_es6.a)([Object(property.b)()],_.prototype,"_queryResult",void 0),_=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],_);var Graphics3DFrustumVisibility=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"),Graphics3DObjectStates=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js"),Graphics3DScaleVisibility=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DScaleVisibility.js"),graphicUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/graphics/graphicUtils.js"),attributeUtils=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js"),WatchUpdatingTracking=__webpack_require__("./node_modules/@arcgis/core/views/support/WatchUpdatingTracking.js");let V=class extends Accessor.a{constructor(t){super(t),this._handles=new Handles.a,this.watchUpdatingTracking=new WatchUpdatingTracking.a,this.suspendResumeExtentMode="computed",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new Graphics3DFrustumVisibility.a:null,i=t.scaleVisibilityEnabled?new Graphics3DScaleVisibility.a:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&"multipatch"!==t.layer.geometryType?new _:null,r=t.elevationAlignmentEnabled?new Graphics3DElevationAlignment.a:null,n=new Graphics3DCore.a({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,"timeExtent",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",((t,e)=>{Object(diffUtils.a)(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,"labelingInfo",((t,e)=>{Object(diffUtils.a)(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&("filter"in t||"timeExtent"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set("objectStates",new Graphics3DObjectStates.a(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await Object(promiseUtils.q)(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,"renderer",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,"fullOpacity",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,"clippingArea",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await Object(promiseUtils.q)(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set("layer",null),this._set("owner",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,i){if(t instanceof Query.a){const{set:e,handle:s}=this.objectStates.acquireSet(0,i);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(e,t))),s}if("number"==typeof t||"string"==typeof t)return this.highlight([t],i);if(t instanceof Graphic.a)return this.highlight([t],i);if("toArray"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof Graphic.a){const e=t;if(null==Object(attributeUtils.a)(this.layer.fieldsIndex,e[0].attributes,i)){const t=e.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,t),s}t=e.map((t=>Object(attributeUtils.a)(this.layer.fieldsIndex,t.attributes,i)))}if("number"==typeof t[0]||"string"==typeof t[0]){const e=t,{set:s,handle:r}=this.objectStates.acquireSet(0,i);return this.objectStates.setObjectIds(s,e),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(Object(watchUtils.a)(this,"suspendResumeExtentMode",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case"computed":this._handles.add([Object(watchUtils.a)(this.graphicsCore,"computedExtent",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch("extentPadding",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case"data":this._handles.add([Object(watchUtils.a)(this,"dataExtent",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch("extentPadding",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:Object(compilerUtils.a)(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!Object(webMercatorUtils.a)(t,i))return;t=Object(webMercatorUtils.d)(t,i)}return Object(graphicUtils.e)(t,e,constants.a,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};Object(tslib_es6.a)([Object(property.b)({aliasOf:"graphicsCore.layer"})],V.prototype,"layer",void 0),Object(tslib_es6.a)([Object(property.b)({aliasOf:"graphicsCore.owner"})],V.prototype,"owner",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"updateClippingExtent",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"graphicsCore",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"scaleVisibility",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"filterVisibility",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"elevationAlignment",void 0),Object(tslib_es6.a)([Object(property.b)({constructOnly:!0})],V.prototype,"frustumVisibility",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"deconfliction",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"labeling",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"objectStates",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"watchUpdatingTracking",void 0),Object(tslib_es6.a)([Object(property.b)()],V.prototype,"suspendResumeExtentMode",void 0),Object(tslib_es6.a)([Object(property.b)()],V.prototype,"dataExtent",void 0),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"suspended",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],V.prototype,"suspendInfo",null),Object(tslib_es6.a)([Object(property.b)({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],V.prototype,"updating",null),V=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],V);const v=V,j="suspendResumeExtentMode",S={remove(){},pause(){},resume(){}}},"./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return c}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),_core_Handles_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/Handles.js"),_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/watchUtils.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/geometry/projectionEllipsoid.js"),_support_FrustumExtentIntersection_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/3d/support/FrustumExtentIntersection.js"),_support_Scheduler_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/views/support/Scheduler.js");let u=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_1__.a{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new _core_Handles_js__WEBPACK_IMPORTED_MODULE_2__.a,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new _support_FrustumExtentIntersection_js__WEBPACK_IMPORTED_MODULE_10__.a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on("resize",(()=>this.viewChange())),t.state.watch("camera",(()=>this.viewChange()),!0),r.registerTask(_support_Scheduler_js__WEBPACK_IMPORTED_MODULE_11__.b.FRUSTUM_VISIBILITY,this),s.on("elevation-bounds-change",(()=>this.elevationBoundsChange()))]),"local"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_3__.a)(s,["opacity","wireframe"],(()=>this.updateIsVisibleBelowSurface())),Object(_core_watchUtils_js__WEBPACK_IMPORTED_MODULE_3__.a)(t,"map.ground.navigationConstraint.type",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_9__.e)(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(1.2-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=Object(_geometry_projectionEllipsoid_js__WEBPACK_IMPORTED_MODULE_9__.e)(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0})],u.prototype,"suspended",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0})],u.prototype,"updating",void 0),u=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.a)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],u);const c=u},"./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Graphics3DObjectStates_s}));var handleUtils=__webpack_require__("./node_modules/@arcgis/core/core/handleUtils.js");class Object3DStateSet_e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}class Graphics3DObjectStateSet_e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new Object3DStateSet_e,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}class Graphics3DObjectStates_s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new Graphics3DObjectStateSet_e(s,a);this._stateSets.push(i);const h=Object(handleUtils.b)((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}},"./node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return p}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Accessor_js__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/@arcgis/core/geometry.js"),__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js")),_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/geometry/Extent.js"),_layers_graphics_data_QueryEngine_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/layers/graphics/data/QueryEngine.js"),_rest_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/@arcgis/core/rest/support/FeatureSet.js"),_rest_support_Query_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/@arcgis/core/rest/support/Query.js"),_geometry_support_typeUtils_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@arcgis/core/geometry/support/typeUtils.js");const c=_layers_graphics_data_QueryEngine_js__WEBPACK_IMPORTED_MODULE_10__.a;let l=class extends _core_Accessor_js__WEBPACK_IMPORTED_MODULE_2__.a{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new _rest_support_Query_js__WEBPACK_IMPORTED_MODULE_12__.a({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:_geometry_Extent_js__WEBPACK_IMPORTED_MODULE_9__.a.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=_rest_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__.default.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=_rest_support_FeatureSet_js__WEBPACK_IMPORTED_MODULE_11__.default.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_3__.k)(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=_geometry_support_typeUtils_js__WEBPACK_IMPORTED_MODULE_13__.a.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({constructOnly:!0})],l.prototype,"layerView",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({constructOnly:!0})],l.prototype,"priority",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],l.prototype,"spatialReference",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0,aliasOf:"layerView.layer"})],l.prototype,"layer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0})],l.prototype,"queryGeometryType",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_4__.b)({readOnly:!0})],l.prototype,"defaultQueryJSON",null),l=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.a)("esri.views.3d.layers.graphics.QueryEngine")],l);const p=l},"./node_modules/@arcgis/core/views/3d/layers/i3s/attributeEditing.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return s})),__webpack_require__.d(__webpack_exports__,"b",(function(){return i}));var _core_lang_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/lang.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_support_attributeUtils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js");const o={setAttribute(){},rollback(){},commit(){}};function s(e,r){const s=r.attributes[e.objectIdField],i=e.sessions.get(s);if(i)return i;const a=Object(_core_lang_js__WEBPACK_IMPORTED_MODULE_0__.a)(r.attributes),u=new Set;if(null==s)return o;const c=e.attributeOverrides.createInteractiveEditSession(s),f=new Map,l=(t,e)=>{const n=f.get(t);if(null==n){const n=e.indexOf(s);return f.set(t,n),n}return n};let d=0;const b={setAttribute(t,o){if(0!==d)return;const s=e.fieldsIndex.get(t);if(Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.k)(s))return;const i=e.attributeStorageInfo.findIndex((t=>t.name===s.name));if(i<0)return;c.set(i,o);const a=e.attributeStorageInfo[i];let f=!1;u.add(t),e.forEachNode(((t,n)=>{const s=l(t,n);if(-1===s)return;const i=e.getAttributeData(t.index);if(i){const n=i[a.name];n&&(n[s]=o,e.setAttributeData(t.index,i,r),f=!0)}})),f&&e.clearMemCache()},rollback(){if(0===d){for(const t of u)this.setAttribute(t,a[t]);c.rollback(),d=1,e.sessions.delete(s)}},commit(){0===d&&(c.commit(),d=2,e.sessions.delete(s))}};return e.sessions.set(s,b),b}function i(t,n){const r=function a(t,e){const n=e.edits.updateFeatures;if(!n||0===n.length)return new d;const o=function f(t){const e=new Set;if(!t.updatedFeatures)return e;for(const n of t.updatedFeatures)null!=n.objectId&&null==n.error&&e.add(n.objectId);return e}(e),s=new d,i=new Map;for(let r=0;r<t.attributeStorageInfo.length;r++)i.set(t.attributeStorageInfo[r].name,r);const a=t.fieldsIndex,c=t.objectIdField,l=n.filter((t=>{const e=Object(_support_attributeUtils_js__WEBPACK_IMPORTED_MODULE_2__.a)(a,t.attributes,c);return o.has(e)}));return t.forEachNode(((e,n)=>{const o=new Set(n);for(const i of l){const f=Object(_support_attributeUtils_js__WEBPACK_IMPORTED_MODULE_2__.a)(a,i.attributes,c);if(!o.has(f))continue;const l=n.indexOf(f);for(const n in i.attributes){const r=t.fieldsIndex.normalizeFieldName(n),o=u(s,e.index,r),a=i.attributes[n];o.push({featureIndex:l,featureId:f,value:a})}}})),s}(t,n);if(0===r.size)return;const o=new Map;for(let e=0;e<t.attributeStorageInfo.length;e++)o.set(t.attributeStorageInfo[e].name,e);let s=!1;r.forEach(((n,r)=>{const i=t.getAttributeData(r);let a=!1;n.forEach(((n,r)=>{const u=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_1__.l)(i)?i[r]:null,c=o.get(r);for(const{featureIndex:e,value:o,featureId:i}of n)u&&(u[e]=o,a=!0,s=!0),t.attributeOverrides.updateValue(i,c,o)})),a&&t.setAttributeData(r,i,null)})),s&&t.clearMemCache()}function u(t,e,n){const r=function c(t,e){const n=t.get(e);if(n)return n;const r=new l;return t.set(e,r),r}(t,e),o=r.get(n);if(o)return o;const s=new Array;return r.set(n,s),s}const l=Map,d=Map},"./node_modules/@arcgis/core/views/3d/layers/support/DefinitionExpressionSceneLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return p}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@arcgis/core/core/sql/WhereClause.js"),_i3s_I3SUtil_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@arcgis/core/views/3d/layers/i3s/I3SUtil.js");const t=_core_Logger_js__WEBPACK_IMPORTED_MODULE_1__.a.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),p=e=>{let p=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=r=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&t.error("Error while evaluating definitionExpression: "+r),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&t.error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const r=_core_sql_WhereClause_js__WEBPACK_IMPORTED_MODULE_7__.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!r.isStandardized)return t.error("definitionExpression is using non standard function"),null;const e=[],i=r.fieldNames;return Object(_i3s_I3SUtil_js__WEBPACK_IMPORTED_MODULE_8__.k)(i,this.i3slayer.fields,{missingFields:e}),e.length>0?(t.error(`definitionExpression references unknown fields: ${e.join(", ")}`),null):(this._definitionExpressionErrors=0,r)}catch(r){return t.error("Failed to parse definitionExpression: "+r),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}_evaluateClause(r,e){try{return r.testFeature(e)}catch(i){return this.logError(i),!1}}_addDefinitionExpressionToQuery(r){if(!this.parsedDefinitionExpression)return r;const e=this.i3slayer.definitionExpression,i=r.clone();return i.where?i.where=`(${e}) AND (${i.where})`:i.where=e,i}};return Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)()],p.prototype,"i3slayer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)({readOnly:!0})],p.prototype,"parsedDefinitionExpression",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_2__.b)({readOnly:!0})],p.prototype,"definitionExpressionFields",null),p=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_6__.a)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],p),p}},"./node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return c}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_Error_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/Error.js"),_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/set.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js")),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"),_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@arcgis/core/views/layers/support/popupUtils.js");const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;return t?Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.a)(s,e)?void 0:new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:s}):new _core_Error_js__WEBPACK_IMPORTED_MODULE_1__.a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);const c=Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(r)?r.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const u="scene"===this.layer.type&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_2__.l)(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,n=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.u)(this.layer.fieldsIndex,await Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.b)(u,Object(_layers_support_popupUtils_js__WEBPACK_IMPORTED_MODULE_10__.a)(this.layer,r)));await this.prepareFetchPopupFeatures(n);const l=new Set,h=[],y=[];for(const s of c)Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_9__.s)(n,s,l)?y.push(s):h.push(s);return 0===y.length?Promise.resolve(h):this.whenGraphicAttributes(y,[...l]).catch((()=>y)).then((e=>h.concat(e)))}};return u=Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_subclass_js__WEBPACK_IMPORTED_MODULE_8__.a)("esri.views.3d.layers.support.PopupSceneLayerView")],u),u}},"./node_modules/@arcgis/core/views/3d/layers/support/SceneLayerViewRequiredFields.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return c}));var tslib_es6=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),Accessor=__webpack_require__("./node_modules/@arcgis/core/core/Accessor.js"),Logger=__webpack_require__("./node_modules/@arcgis/core/core/Logger.js"),tracking=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking.js"),property=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),subclass=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js"),SimpleTrackingTarget=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking/SimpleTrackingTarget.js");const AsyncUpdate_o=s=>{let r=class extends s{constructor(){super(...arguments),this._numUpdating=0,this.asyncUpdateState=new Map}get updating(){return this._numUpdating>0}autoUpdateAsync(t,s){return function AsyncUpdate_p(t,s){const e=()=>{o&&!p&&t(a)},a=()=>{if(!o||p)return s();o.clear(),p=!0;const t=Object(tracking.b)(o,s);return p=!1,t},n=()=>{o&&(o.destroy(),o=null)};let o=new SimpleTrackingTarget.a(e),p=!1;return t(a),{remove:n}}((s=>this.updateAsync(t,s)),s)}async updateAsync(t,s){if(!this.startAsyncUpdate(t)){try{const e=await s();this._set(t,e)}catch(r){Logger.a.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,s)}}startAsyncUpdate(t){var s;const e=null!=(s=this.asyncUpdateState.get(t))?s:0;return 1&e?(this.asyncUpdateState.set(t,2|e),!0):(++this._numUpdating,this.asyncUpdateState.set(t,1|e),!1)}endAsyncUpdate(t){var s;--this._numUpdating;const e=-2&(null!=(s=this.asyncUpdateState.get(t))?s:0);return 2&e?(this.asyncUpdateState.set(t,-3&e),!0):(this.asyncUpdateState.set(t,e),!1)}};return Object(tslib_es6.a)([Object(property.b)({readOnly:!0})],r.prototype,"updating",null),Object(tslib_es6.a)([Object(property.b)()],r.prototype,"_numUpdating",void 0),r=Object(tslib_es6.a)([Object(subclass.a)("esri.core.AsyncUpdate")],r),r};let i=class extends(AsyncUpdate_o(Accessor.a)){};i=Object(tslib_es6.a)([Object(subclass.a)("esri.core.AsyncUpdate")],i);var HandleOwner=__webpack_require__("./node_modules/@arcgis/core/core/HandleOwner.js"),maybe=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),fieldUtils=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js"));const SceneLayerViewRequiredFields_p=Logger.a.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");let c=class extends(AsyncUpdate_o(HandleOwner.a)){constructor(e){super(e)}get requiredFields(){const{layerView:{layer:{fieldsIndex:e},definitionExpressionFields:r},rendererFields:s,labelingFields:t,viewFilterFields:o}=this;return Object(fieldUtils.j)(e,[...Object(maybe.v)(r,[]),...Object(maybe.v)(s,[]),...Object(maybe.v)(t,[]),...Object(maybe.v)(o,[])])}initialize(){const e=this.layerView.layer;this.layer=e,this.handles.add([this.autoUpdateAsync("rendererFields",(()=>{const{fieldsIndex:e,renderer:r}=this.layer;return r?y((s=>r.collectRequiredFields(s,e))):null})),this.autoUpdateAsync("labelingFields",(()=>{const{layer:e}=this;return e.labelsVisible?y((r=>Object(fieldUtils.g)(r,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,filter:r}=this.layerView;return y((s=>Object(fieldUtils.f)(s,e,r)))}))])}};async function y(e){const r=new Set;try{return await e(r),Array.from(r).sort()}catch(s){return SceneLayerViewRequiredFields_p.error(s),null}}Object(tslib_es6.a)([Object(property.b)()],c.prototype,"layerView",void 0),Object(tslib_es6.a)([Object(property.b)()],c.prototype,"layer",void 0),Object(tslib_es6.a)([Object(property.b)()],c.prototype,"requiredFields",null),Object(tslib_es6.a)([Object(property.b)()],c.prototype,"rendererFields",void 0),Object(tslib_es6.a)([Object(property.b)()],c.prototype,"labelingFields",void 0),Object(tslib_es6.a)([Object(property.b)()],c.prototype,"viewFilterFields",void 0),c=Object(tslib_es6.a)([Object(subclass.a)("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],c)},"./node_modules/@arcgis/core/views/3d/layers/support/fieldProperties.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return i}));var _layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");function i(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:i,layer:{fieldsIndex:t},requiredFields:l}=this;return i.outFields?Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.j)(t,[...Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.u)(t,i.outFields),...l]):Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_0__.j)(t,l)}}}}},"./node_modules/@arcgis/core/views/layers/SceneLayerView.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return o}));var _chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/chunks/tslib.es6.js"),_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js"),_LayerView_js__WEBPACK_IMPORTED_MODULE_8__=(__webpack_require__("./node_modules/@arcgis/core/core/arrayUtils.js"),__webpack_require__("./node_modules/@arcgis/core/core/has.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/ensureType.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/tracking.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/extensions/serializableProperty/reader.js"),__webpack_require__("./node_modules/@arcgis/core/core/accessorSupport/extensions/serializableProperty/writer.js"),__webpack_require__("./node_modules/@arcgis/core/views/layers/LayerView.js"));class o extends _LayerView_js__WEBPACK_IMPORTED_MODULE_8__.a{constructor(){super(...arguments),this.layer=null,this.filter=null}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("Not implemented")}queryFeatures(e,r){throw new Error("Not implemented")}queryObjectIds(e,r){throw new Error("Not implemented")}queryFeatureCount(e,r){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,r){throw new Error("Not implemented")}}Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.b)()],o.prototype,"layer",void 0),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.b)()],o.prototype,"availableFields",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.b)()],o.prototype,"maximumNumberOfFeatures",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.b)({readOnly:!0})],o.prototype,"maximumNumberOfFeaturesExceeded",null),Object(_chunks_tslib_es6_js__WEBPACK_IMPORTED_MODULE_0__.a)([Object(_core_accessorSupport_decorators_property_js__WEBPACK_IMPORTED_MODULE_1__.b)()],o.prototype,"filter",void 0)},"./node_modules/@arcgis/core/views/layers/support/popupUtils.js":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return d})),__webpack_require__.d(__webpack_exports__,"b",(function(){return t}));var _core_maybe_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@arcgis/core/core/maybe.js"),_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@arcgis/core/layers/support/fieldUtils.js");async function t(t,d=t.popupTemplate){if(!Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes("*"))return["*"];const f=n?await Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.n)(t):[],r=Object(_layers_support_fieldUtils_js__WEBPACK_IMPORTED_MODULE_1__.j)(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(l)&&l.defaultPopupTemplateEnabled&&Object(_core_maybe_js__WEBPACK_IMPORTED_MODULE_0__.l)(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}}}]);